#!/bin/bash -e

# main
# ---------
if [ "$NODE_ENV" = 'production' ] ; then
  set -e
  grunt procs clientJade componentJade livescript browserify uglify
  mkdir -p logs
  mon -d \
      -l logs/powerbulletin.log \
      -m /tmp/pb.pid \
      'node app/main.js'
else
  export NODE_WORKERS=${NODE_WORKERS:=1}
  # XXX: may want to limit --prof to child process, but don't know api
  # should be good enough for now
  if [ -n "$NODE_PROFILE" ]; then
    args='--prof'; fi
  node $args app/main.js
fi
