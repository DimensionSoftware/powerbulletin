include _post
include _post-actions
include _breadcrumb

//- posts tree
if typeof(post) !== 'undefined'
  - if (!post.user_photo) post.user_photo = cacheUrl + 'images/profile.jpg'
  .forum.resizable
    if page == 1
      .post.head(id="post_#{post.id}", class=post.reason ? 'censored' : '', data-user-id=post.user_id, data-post-id=post.id)
        h3.title= post.title
        a.user.mutant(href="/user/#{post.user_name}")
          .profile.photo
            img(src="#{cacheUrl}/#{post.user_photo}")
          span=post.user_name
        .date(data-time=post.created_iso)!= post.created_human
        .edit-container
        if post.html
          p.body!= post.html
        .reply
        .actions
          a.s-reply.onclick-footer-toggle(title='Reply')
          a.edit.mutant.no-surf(data-edit=post.id, href="#{post.uri.replace(/\/\d+$/, '')}/edit/#{post.id}") Edit
          a.s-permalink.permalink.mutant(href=post.uri, title='Permalink')
          a.s-censor.censor.onclick-censor-post(title='Censor')
    .children
      if post.posts.length
        div(data-page=page)
          each sp in post.posts
            if sp.parent_id !== null
              mixin _post(sp, 0)
      else if post.morePosts
        a(href='#') Load more posts ...
    p.onclick-footer-toggle Post Reply
else //- placeholder
  .forum.resizable

if typeof(post) !== 'undefined'
  #breadcrumb.breadcrumb
    mixin _breadcrumb(post)


//- vim:fdm=marker
