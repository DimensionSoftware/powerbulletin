include _post
include _post-actions
include _breadcrumb

//- breadcrumb for posts
if typeof(post) !== 'undefined'
  #breadcrumb.breadcrumb
    +_breadcrumb(post)

//- posts tree
if typeof(post) !== 'undefined'
  - if (!post.user_photo) post.user_photo = cacheUrl + 'images/profile.jpg'
  .forum.resizable
    if page == 1
      .post.head(id="post_#{post.id}", class=post.reason ? 'censored' : '', data-user-id=post.user_id, data-post-id=post.id)
        .onclick-footer-toggle.post-reply
          .s-reply
        .profile-container
          a.user.mutant(href="/user/#{post.user_name}")
            .profile.photo
              img(src="#{cacheUrl}/#{post.user_photo}")
            span.username=post.user_name
          .user-title=post.alias_config.title
          if post.user_last_activity
            //- rely on client to out human-friendly time
            .date Active 
              span(data-time=post.user_last_activity)
          .date(data-time=post.created_iso, title=post.created_friendly)
        .edit-container
        .container
          .s-chat-bubble
          .post-content
            h2.title= post.title
            if post.html
              .body!= post.html
          if !post.is_comment && post.alias_config.sig
            .sig!= post.alias_config.sigHtml
        .reply
        //- actions for top-level posts are different from children's post-actions partial
        .actions
          a.onclick-footer-toggle(title='Reply') Reply
            .s-dark-reply.onclick-footer-toggle
          a.edit.mutant.no-surf(data-edit=post.id, href="#{post.uri.replace(/\/\d+$/, '')}/edit/#{post.id}") Edit
          a.permalink.mutant(href=post.uri, title='Permalink') Permalink
            .s-dark-permalink
          a.censor.onclick-censor-post(title='Censor') Censor
            .s-dark-censor
        if typeof(social) !== 'undefined' && social
          .social
            .fb-share-button(data-type='button_count')
            a.twitter-share-button(href='https://twitter.com/share')
            .g-plus(data-action='share')
    .children
      if post.posts.length
        div(data-page=page)
          each sp in post.posts
            if sp.parent_id !== null
              +_post(sp, 0)
      else if post.morePosts
        a(href='#') Load more posts ...
    .onclick-footer-toggle.post-reply
      .s-reply
    .bottom
else //- placeholder
  .forum.resizable


//- vim:fdm=marker
