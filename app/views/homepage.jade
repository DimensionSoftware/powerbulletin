//-extend layout

mixin forum(f, i)
  img.bg(id="forum_bg_#{f.id}", class='initial', src="#{cache_url}/images/bg_#{f.id}.jpg")
  .forum(id="forum_#{f.id}", class="#{f.classes || ''} #{i%2 ? 'odd' : 'even'}")
    a(name="forum_#{f.id}") //- hashtag anchor
    .header
      .description
        a.mutant(href=f.uri)= f.description
    .container
      if f.posts
        each t,ii in f.posts
          mixin post(f, t, ii)
        .up(class='scroll-to', data-scroll-to="#forum_#{f.id}", title="Scroll top of #{f.title}!")

mixin post(f, p, i)
  .post(id="post_#{p.id}", class=(i % 2) ? 'odd' : 'even', class="col#{Math.ceil(Math.random()*2)}")
    a.mutant(href=p.uri)
      h5.title!= p.title
        span.date #{p.date}
    p.body!= p.html
    if p.posts
      each sp,i in p.posts
        mixin subpost(sp, i)

mixin subpost(sp, i)
 .subpost(id="subpost_#{sp.id}", class=(i % 2) ? 'odd' : 'even')
    .photo
      img(src="#{cache_url}/images/profile.jpg")
    p.body!= sp.html
    .signature
      span.username - #{sp.user_name}
      span.date= sp.date

mixin left-chrome
  #left_chrome
    //-{{{ data-fid is how we pass in the forum id of the post, this way
    //- we can put a hotlink wherever without having to write new
    //- javascript (other than calculating the fid)
    //- TODO move this into posts :hover tools }}}
    .sorter
      .indicator
      ul#sort
        li(data-value='popular').active Popular
        li(data-value='recent') Most Recent
        li(data-value='active') Most Active
        li(data-value='controversal') Controversal
        li(data-value='nearest') Nearby
      .scroll-to-top

//- main
//- ---------
mixin left-chrome
if forums
  each f,i in forums
    mixin forum(f, i)
else
  p Create a forum first
    i !

//- vim:fdm=marker
