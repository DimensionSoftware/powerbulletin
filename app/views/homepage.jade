include _post-profile

mixin forum(f, i)
  img.bg(id="forum_bg_#{f.id}", class='initial', src="#{cacheUrl}/images/bg_#{f.id}.jpg")
  .forum(id="forum_#{f.id}", class="#{f.classes || ''} #{activeForumId != 'homepage' && 'resizable'}")
    a(name="forum_#{f.id}") //- hashtag anchor
    .container
      if f.posts
        each t,ii in f.posts
          .post(id="post_#{t.id}", class="col#{Math.ceil(Math.random()*2)}")
            a.mutant(href=t.uri)
              h5.title!= t.title
                span.date #{t.date}
            //- post type
            if t.media_url
              mixin media-post(f, t, ii)
            else
              mixin html-post(f, t, ii)
            //- subpost summary
            each sp,i in t.posts
              mixin _post-profile(sp, i)
        .up(class='onclick-scroll-to', data-scroll-to="#forum_#{f.id}", title="Scroll top of #{f.title}!")

mixin media-post(f, t, i)
  img(src=t.media_url)
  p.body!= t.html
mixin html-post(f, t, i)
  p.body!= t.html

//- main
//- ---------
if forums
  .homepage
    each f,i in forums
      mixin forum(f, i)
else
  p Create a forum first
    i !
