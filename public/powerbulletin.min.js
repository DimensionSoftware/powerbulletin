(function(){var n=function(t,e){var r=n.resolve(t,e||"/"),o=n.modules[r];if(!o)throw Error("Failed to resolve module "+t+", tried "+r);var i=n.cache[r],u=i?i.exports:o();return u};n.paths=[],n.modules={},n.cache={},n.extensions=[".js",".coffee",".json",".ls"],n._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},n.resolve=function(){return function(t,e){function r(t){if(t=a.normalize(t),n.modules[t])return t;for(var e=0;n.extensions.length>e;e++){var r=n.extensions[e];if(n.modules[t+r])return t+r}}function o(t){t=t.replace(/\/+$/,"");var e=a.normalize(t+"/package.json");if(n.modules[e]){var o=n.modules[e](),i=o.browserify;if("object"==typeof i&&i.main){var u=r(a.resolve(t,i.main));if(u)return u}else if("string"==typeof i){var u=r(a.resolve(t,i));if(u)return u}else if(o.main){var u=r(a.resolve(t,o.main));if(u)return u}}return r(t+"/index")}function i(n,t){for(var e=u(t),i=0;e.length>i;i++){var a=e[i],s=r(a+"/"+n);if(s)return s;var c=o(a+"/"+n);if(c)return c}var s=r(n);return s?s:void 0}function u(n){var t;t="/"===n?[""]:a.normalize(n).split("/");for(var e=[],r=t.length-1;r>=0;r--)if("node_modules"!==t[r]){var o=t.slice(0,r+1).join("/")+"/node_modules";e.push(o)}return e}if(e||(e="/"),n._core[t])return t;var a=n.modules.path();e=a.resolve("/",e);var s=e||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var c=r(a.resolve(s,t))||o(a.resolve(s,t));if(c)return c}var l=i(t,s);if(l)return l;throw Error("Cannot find module '"+t+"'")}}(),n.alias=function(t,e){var r=n.modules.path(),o=null;try{o=n.resolve(t+"/package.json","/")}catch(i){o=n.resolve(t,"/")}for(var u=r.dirname(o),a=(Object.keys||function(n){var t=[];for(var e in n)t.push(e);return t})(n.modules),s=0;a.length>s;s++){var c=a[s];if(c.slice(0,u.length+1)===u+"/"){var l=c.slice(u.length);n.modules[e+l]=n.modules[u+l]}else c===u&&(n.modules[e]=n.modules[u])}},function(){var t={},e="undefined"!=typeof window?window:{},r=!1;n.define=function(o,i){!r&&n.modules.__browserify_process&&(t=n.modules.__browserify_process(),r=!0);var u=n._core[o]?"":n.modules.path().dirname(o),a=function(t){var e=n(t,u),r=n.cache[n.resolve(t,u)];return r&&null===r.parent&&(r.parent=s),e};a.resolve=function(t){return n.resolve(t,u)},a.modules=n.modules,a.define=n.define,a.cache=n.cache;var s={id:o,filename:o,exports:{},loaded:!1,parent:null};n.modules[o]=function(){return n.cache[o]=s,i.call(s.exports,a,s,s.exports,u,o,t,e),s.loaded=!0,s.exports}}}(),n.define("path",function(n,t,e,r,o,i){function u(n,t){for(var e=[],r=0;n.length>r;r++)t(n[r],r,n)&&e.push(n[r]);return e}function a(n,t){for(var e=0,r=n.length;r>=0;r--){var o=n[r];"."==o?n.splice(r,1):".."===o?(n.splice(r,1),e++):e&&(n.splice(r,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}var s=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;e.resolve=function(){for(var n="",t=!1,e=arguments.length;e>=-1&&!t;e--){var r=e>=0?arguments[e]:i.cwd();"string"==typeof r&&r&&(n=r+"/"+n,t="/"===r.charAt(0))}return n=a(u(n.split("/"),function(n){return!!n}),!t).join("/"),(t?"/":"")+n||"."},e.normalize=function(n){var t="/"===n.charAt(0),e="/"===n.slice(-1);return n=a(u(n.split("/"),function(n){return!!n}),!t).join("/"),n||t||(n="."),n&&e&&(n+="/"),(t?"/":"")+n},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(u(n,function(n){return n&&"string"==typeof n}).join("/"))},e.dirname=function(n){var t=s.exec(n)[1]||"",e=!1;return t?1===t.length||e&&3>=t.length&&":"===t.charAt(1)?t:t.substring(0,t.length-1):"."},e.basename=function(n,t){var e=s.exec(n)[2]||"";return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},e.extname=function(n){return s.exec(n)[3]||""}}),n.define("__browserify_process",function(n,t,e,r,o,i){var i=t.exports={};i.nextTick=function(){var n="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(n)return function(n){return window.setImmediate(n)};if(t){var e=[];return window.addEventListener("message",function(n){if(n.source===window&&"browserify-tick"===n.data&&(n.stopPropagation(),e.length>0)){var t=e.shift();t()}},!0),function(n){e.push(n),window.postMessage("browserify-tick","*")}}return function(n){setTimeout(n,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.binding=function(t){if("evals"===t)return n("vm");throw Error("No such module. (Possibly not yet loaded)")},function(){var t,e="/";i.cwd=function(){return e},i.chdir=function(r){t||(t=n("path")),e=t.resolve(r,e)}}()}),n.define("/lib/mutant/package.json",function(n,t){t.exports={main:"index.js"}}),n.define("/lib/mutant/mutant.ls",function(n){(function(){var t,e,r;"undefined"!=typeof window&&null!==window||(t=n("jsdom"),e=function(n,e){var r,o,i;return r=["../../public/local/jquery-1.8.3.min.js"],o={html:n,scripts:r},i=function(n,t){return n?e(n):(t.$=t.jQuery,e(null,t))},t.env(o,i)}),this.run=function(t,r,o){var i,u,a,s,c,l;if(null==o&&(o=function(){}),i=r.initial,u=r.locals||{},a=r.html,s=t.onLoad||function(n,t){return t(null)},c=t.onInitial||function(n,t){return t(null)},l=t.onMutate||function(n,t){return t(null)},n("../../app/views/mutants.js"),"undefined"!=typeof window&&null!==window)return i?s.call(u,window,function(n){return n?o(n):c.call(u,window,o)}):(window.renderJade=function(n,t){return o(null,jade.render(window.document.getElementById(n),t,u))},window.marshal=function(n,t){return window[n]=t},t["static"].call(u,window,function(n){return n?o(n):s.call(u,window,function(n){return n?o(n):l.call(u,window,o)})}));if(a)return e(a,function(n,e){return n?o(n):(e.renderJade=function(n,t){return jade.render(e.document.getElementById(n),t,u)},e.marshal=function(n,t){var r;return r=e.document.createElement("script"),e.$(r).attr("type","text/javascript"),e.$(r).text("window['"+n+"'] = "+JSON.stringify(t)+";"),e.document.body.appendChild(r)},t["static"].call(u,e,function(n){return n?o(n):(e.$("script.jsdom").remove(),o(null,"<!doctype html>"+e.document.outerHTML))}))});throw Error("need html for serverside")},r=function(n){return n.callbacks.some(function(n){return n.surfable})},this.surfableRoutes=function(n){var t,e,o,i,u=[];for(t=0,o=(e=n.routes.get).length;o>t;++t)i=e[t],r(i)&&u.push(""+i.regexp);return u}}).call(this)}),n.define("/app/mutants.ls",function(){(function(){var n,t;n=function(n,t,e){var r;return r=e?" forum-"+e:"",n.$("html").attr("class",t+""+r),n.marshal("mutator",t),n.$(".bg-set").remove(),n.$(".bg").each(function(){return n.$(this).addClass("bg-set").remove().prependTo(n.$("body"))}),n.$("header .menu").find(".active").removeClass("active"),n.$("menu .row").has(".forum-"+e).find(".title").addClass("active")},t=function(n,t,e){var r,o;return null==e&&(e="down"),n.bgAnim&&clearTimeout(n.bgAnim),r=n.$(".bg.active"),o=n.$("#forum"+("_bg_"+t.data("id"))),o.css("display","block"),r.length?n.bgAnim=setTimeout(function(){return r.css("top","down"===e?-300:300),r.removeClass("active"),o.addClass("active"),n.bgAnim=0},100):o.addClass("active")},this.homepage={"static":function(t,e){return t.renderJade("main_content","homepage"),n(t,"homepage",this.activeForumId),e()},onLoad:function(n,e){return n.$(".forum .container").masonry({itemSelector:".post",isAnimated:!0,isFitWidth:!0,isResizable:!0}),setTimeout(function(){var e;return e=n.$,e(".forum .header").waypoint("sticky",{offset:-70}),e(".forum").waypoint({offset:"25%",handler:function(r){var o,i,u,a;return o=e(this),i=o.attr("id"),(u="down"===r?i:e("#"+i).prevAll(".forum:first").attr("id"))?(e("header .menu").find(".active").removeClass("active"),a=e("header .menu").find("."+u.replace(/_/,"-")).addClass("active"),e(".forum .stuck").removeClass("stuck"),t(n,a,r)):void 0}})},100),e()},onUnload:function(n,t){return n.$(".forum .container").masonry("destroy"),n.$(".forum .header").waypoint("destroy"),n.$(".forum").waypoint("destroy"),t()}},this.forum={"static":function(t,e){return t.renderJade("left_content","nav"),t.renderJade("main_content","posts"),t.marshal("activeForumId",this.activeForumId),t.marshal("activePostId",this.activePostId),n(t,"forum",this.activeForumId),e()},onLoad:function(n,e){var r,o;return r=n.$("header .menu .forum-"+n.activeForumId),t(n,r),o=n.$,o(".forum .breadcrumb").waypoint("sticky",{offset:-70}),e()},onMutate:function(n,t){return n.scrollToTop(),n.s,t()},onUnload:function(n,t){return n.$(".forum .breadcrumb").waypoint("destroy"),t()}},this.search={"static":function(n,t){return t()},onLoad:function(n,t){return t()},onInitial:function(n,t){return t()},onMutate:function(n,t){return t()}},this.admin={"static":function(n,t){return t()}}}).call(this)}),n.define("/app/layout.ls",function(n){(function(){function t(n,t){for(var e=-1,r=t.length>>>0;r>++e;)if(n===t[e]&&e in t)return!0;return!1}var e,r,o,i,u,a,s,c;e=$(window),r=$(document),o=!1||t("msTransform",document.documentElement.style),i=!1||t("MozBoxSizing",document.documentElement.style),u=!(!window.opera||!window.opera.version),a=10,window.mutant=n("../lib/mutant/mutant"),window.mutants=n("./mutants"),window.mutate=function(){var n,t;return(n=$(this).attr("href"))?null!=n&&n.match(/#/)?!0:(t={},History.pushState({searchParams:t},"",n),!1):!1},s=(null!=(c=window.mutants[window.mutator])?c.onLoad:void 0)||function(n,t){return t()},s.call(this,window,function(){var n;return $("#query").focus(),r.on("click","a.mutant",window.mutate),History.Adapter.bind(window,"statechange",function(){var n;return n=History.getPageUrl().replace(/\/$/,""),$.get(n,{_surf:1},function(n){var t,e;return null!=(t=n.locals)&&t.title&&r.attr("title",n.locals.title),e=window.mutants[window.mutator].onUnload||function(n,t){return t(null)},e(window,function(){var t;try{return window.mutant.run(window.mutants[n.mutant],{locals:n.locals})}catch(e){return t=e}})}),!1}),window.scrollToTop=function(){var n;if(0!==$(window).scrollTop())return n=$("html,body"),n.animate({scrollTop:$("body").offset().top},140,function(){return n.animate({scrollTop:$("body").offset().top+a},110,function(){return n.animate({scrollTop:$("body").offset().top},75,function(){})})})},n=function(){var n;return n=e.scrollTop(),$("body").toggleClass("scrolled",n>a)},setTimeout(function(){return e.on("scroll",function(){return n()}),n()},1300),window.awesomeScrollTo=function(n,t,e){var r,i,a,s;return e=function(){var n;return e?void 0:n=1},n=$(n),r=t||600,i=100,n.length?(o||u?(n[0].scrollIntoView(),e()):(a=Math.round(n.position().top)-i,s=window.scrollY,Math.abs(a-s)>30?$("html,body").animate({scrollTop:a},r,function(){}):e()),n):void 0},r.on("click",".scroll-to",function(){return awesomeScrollTo($(this).data("scroll-to")),!1}),r.on("mousedown",".scroll-to-top",function(){return $(this).attr("title","Scroll to Top!"),window.scrollToTop(),!1}),r.on("click","header",function(n){return n.target.className.indexOf("toggler")>-1&&$("body").removeClass("expanded"),$("#query").focus()}),r.on("keypress","#query",function(){return $("body").addClass("expanded")})})}).call(this)}),n("/app/layout.ls"),n.define("/app/entry.ls",function(){(function(){var n,t,e,r,o,i,u,a;n=$(window),t=$(document),n.resize(function(){return setTimeout(function(){return $.waypoints("refresh")},800)}),setTimeout(function(){return $("#sort li").waypoint({context:"ul",offset:30,handler:function(n){var t;return t=$(this),"up"===n&&(t=t.prev()),t.length||(t=$(this)),$("#sort li.active").removeClass("active"),t.addClass("active")}})},100),t.on("click","html.homepage header .menu a.title",function(){return awesomeScrollTo($(this).data("scroll-to")),!1}),t.on("click","html.forum header .menu a.title",window.mutate),e=function(){var n;return n={fid:window.activeForumId},$.get("/resources/posts",n,function(n){return $(n).dialog({modal:!0}),!1})},r=function(){var n;return n=$("#add-post-form"),$.post("/resources/posts",n.serialize(),function(n,t,e){return console.log("success! post added",e),console.log("stub: do something fancy to confirm submission")}),!1},o=function(){var n,t,e;return n=$(this).parents(".subpost:first"),t=n.data("post-id"),window.$subpost=n,console.log("subpost",n),e='<form method="post" action="/resources/posts">\n  <textarea name="body"></textarea>\n  <input type="hidden" name="forum_id" value="'+window.activeForumId+'">\n  <input type="hidden" name="parent_id" value="'+t+'">\n  <div>\n    <input type="submit" value="Post">\n  </div>\n</form>',0===n.find(".reply form").length?n.find(".reply:first").append(e):n.find(".reply:first form").remove()},i=function(){return $.fancybox.open("#auth")},u=function(){var n,t;return n=$(this),t={username:n.find("input[name=username]").val(),password:n.find("input[name=password]").val()},$.post(n.attr("action"),t,function(t){var e;return t.success?window.location.reload():(e=n.parents(".fancybox-wrap:first"),e.removeClass("shake"),setTimeout(function(){return e.addClass("shake")},100))}),!1},a=function(n){return function(){return window.user?n.apply(this,arguments):i()}},t.on("click","#add-post-submit",r),t.on("click",".onclick-add-post-dialog",e),t.on("click",".onclick-append-reply-ui",o),t.on("submit",".login form",u),$.getJSON("/auth/user",function(n){window.user=n})}).call(this)}),n("/app/entry.ls")})();