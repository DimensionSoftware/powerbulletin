(function(){var t,o,e,n,r,i;t=$(window),o=$(document),e=10,n=function(){var o;return o=t.scrollTop(),$("body").toggleClass("has-scrolled",o>e)},setTimeout(function(){return t.on("scroll",function(){return n()}),n()},1300),$(".scroll-to-top").each(function(){var t;return t=$(this),t.attr("title","Scroll to Top!"),t.on("mousedown",function(){return $("html,body").animate({scrollTop:$("body").offset().top},140,function(){return $("html,body").animate({scrollTop:$("body").offset().top+e},110,function(){return $("html,body").animate({scrollTop:$("body").offset().top},75,function(){})})})})}),$("#query").focus(),$(".forum .container").masonry({itemSelector:".post",isAnimated:!0,isFitWidth:!0,isResizable:!0}),t.resize(function(){return setTimeout(function(){return $.waypoints("refresh")},800)}),setTimeout(function(){return $(".forum").waypoint({offset:"33%",handler:function(o){var e,n,r,i,a,s,d;return e=$(this),n=e.attr("id"),r="down"===o?n:$("#"+n).prevAll(".forum:first").attr("id"),i=$("header .menu").find(".active"),a=$("header .menu").find("."+r.replace(/_/,"-")),i.removeClass("active"),a.addClass("active"),t.bgAnim&&clearTimeout(t.bgAnim),s=$(".bg.active"),s.length?t.bgAnim=setTimeout(function(){var e;return e=$("#forum"+("_bg_"+a.data("id"))),s.css("top","down"===o?-300:300),s.removeClass("active"),e.addClass("active"),e.addClass("visible"),t.bgAnim=0},300):(d=$("#forum"+("_bg_"+a.data("id"))),d.addClass("active"))}})},100),r=function(){var t,o;return t=$(this).data("fid"),o="<h1>add post form goes here</h1>",$.get("/ajax/add-post",{fid:t},function(t){return $(t).dialog({modal:!0}),!1})},i=function(){var t;return t=$("#add-post-form"),$.post("/ajax/add-post",t.serialize(),function(){return console.log("success! post added"),console.log("stub: do something fancy to confirm submission")}),!1},o.on("click","#add-post-submit",i),o.on("click",".onclick-add-post-dialog",r),o.on("click","header",function(t){return"header"===t.target.className&&$("body").removeClass("expanded"),$("#query").focus()}),o.on("keypress","#query",function(){return $("body").addClass("expanded")})}).call(this);