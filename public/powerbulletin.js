;(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){
module.exports=function(n,r,t){function e(t,i){if(!r[t]){if(!n[t]){var o=typeof require=="function"&&require;if(!i&&o)return o(t,!0);if(u)return u(t,!0);throw new Error("Cannot find module '"+t+"'")}var a=r[t]={exports:{}};n[t][0].call(a.exports,function(r){var u=n[t][1][r];return e(u?u:r)},a,a.exports)}return r[t].exports}var u=typeof require=="function"&&require;for(var i=0;i<t.length;i++)e(t[i]);return e}({"prelude-ls":[function(n,r,t){r.exports=n("bcmc1g")},{}],bcmc1g:[function(n,r,t){var e,u,i,o,a,c,f,l,s,p={}.toString;e=n("./Func.js");u=n("./List.js");i=n("./Obj.js");o=n("./Str.js");a=n("./Num.js");c=function(n){return n};f=h(function(n,r){return p.call(r).slice(8,-1)===n});l=h(function(n,r){var t,e=[];for(t=0;t<n;++t){e.push(r)}return e});o.empty=u.empty;o.slice=u.slice;o.take=u.take;o.drop=u.drop;o.splitAt=u.splitAt;o.takeWhile=u.takeWhile;o.dropWhile=u.dropWhile;o.span=u.span;o.breakStr=u.breakList;s={Func:e,List:u,Obj:i,Str:o,Num:a,id:c,isType:f,replicate:l};s.each=u.each;s.map=u.map;s.filter=u.filter;s.compact=u.compact;s.reject=u.reject;s.partition=u.partition;s.find=u.find;s.head=u.head;s.first=u.first;s.tail=u.tail;s.last=u.last;s.initial=u.initial;s.empty=u.empty;s.reverse=u.reverse;s.difference=u.difference;s.intersection=u.intersection;s.union=u.union;s.countBy=u.countBy;s.groupBy=u.groupBy;s.fold=u.fold;s.foldl=u.foldl;s.fold1=u.fold1;s.foldl1=u.foldl1;s.foldr=u.foldr;s.foldr1=u.foldr1;s.unfoldr=u.unfoldr;s.andList=u.andList;s.orList=u.orList;s.any=u.any;s.all=u.all;s.unique=u.unique;s.sort=u.sort;s.sortWith=u.sortWith;s.sortBy=u.sortBy;s.sum=u.sum;s.product=u.product;s.mean=u.mean;s.average=u.average;s.concat=u.concat;s.concatMap=u.concatMap;s.flatten=u.flatten;s.maximum=u.maximum;s.minimum=u.minimum;s.scan=u.scan;s.scanl=u.scanl;s.scan1=u.scan1;s.scanl1=u.scanl1;s.scanr=u.scanr;s.scanr1=u.scanr1;s.slice=u.slice;s.take=u.take;s.drop=u.drop;s.splitAt=u.splitAt;s.takeWhile=u.takeWhile;s.dropWhile=u.dropWhile;s.span=u.span;s.breakList=u.breakList;s.zip=u.zip;s.zipWith=u.zipWith;s.zipAll=u.zipAll;s.zipAllWith=u.zipAllWith;s.apply=e.apply;s.curry=e.curry;s.flip=e.flip;s.fix=e.fix;s.split=o.split;s.join=o.join;s.lines=o.lines;s.unlines=o.unlines;s.words=o.words;s.unwords=o.unwords;s.chars=o.chars;s.unchars=o.unchars;s.values=i.values;s.keys=i.keys;s.pairsToObj=i.pairsToObj;s.objToPairs=i.objToPairs;s.listsToObj=i.listsToObj;s.objToLists=i.objToLists;s.max=a.max;s.min=a.min;s.negate=a.negate;s.abs=a.abs;s.signum=a.signum;s.quot=a.quot;s.rem=a.rem;s.div=a.div;s.mod=a.mod;s.recip=a.recip;s.pi=a.pi;s.tau=a.tau;s.exp=a.exp;s.sqrt=a.sqrt;s.ln=a.ln;s.pow=a.pow;s.sin=a.sin;s.tan=a.tan;s.cos=a.cos;s.acos=a.acos;s.asin=a.asin;s.atan=a.atan;s.atan2=a.atan2;s.truncate=a.truncate;s.round=a.round;s.ceiling=a.ceiling;s.floor=a.floor;s.isItNaN=a.isItNaN;s.even=a.even;s.odd=a.odd;s.gcd=a.gcd;s.lcm=a.lcm;s.VERSION="1.0.0";r.exports=s;function h(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}},{"./Func.js":1,"./Obj.js":2,"./Num.js":3,"./List.js":4,"./Str.js":5}],1:[function(n,r,t){var e,u,i,o;e=function(n){return a(n)};u=a(function(n,r,t){return n(t,r)});i=function(n){return function(r,t){return function(){return n(r(r)).apply(null,arguments)}}(function(r,t){return function(){return n(r(r)).apply(null,arguments)}})};o=a(function(n,r){return n.apply(null,r)});r.exports={curry:e,flip:u,fix:i,apply:o};function a(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}},{}],2:[function(n,r,t){var e,u,i,o,a,c,f,l,s,p,h,g,v,m;e=function(n){var r,t,e=[];for(r in n){t=n[r];e.push(t)}return e};u=function(n){var r,t=[];for(r in n){t.push(r)}return t};i=function(n){var r,t,e,u={};for(r=0,t=n.length;r<t;++r){e=n[r];u[e[0]]=e[1]}return u};o=function(n){var r,t,e=[];for(r in n){t=n[r];e.push([r,t])}return e};a=d(function(n,r){var t,e,u,i,o={};for(t=0,e=n.length;t<e;++t){u=t;i=n[t];o[i]=r[u]}return o});c=function(n){var r,t,e,u;r=[];t=[];for(e in n){u=n[e];r.push(e);t.push(u)}return[r,t]};f=function(n){var r;for(r in n){return false}return true};l=d(function(n,r){var t,e;for(t in r){e=r[t];n(e)}return r});s=d(function(n,r){var t,e,u={};for(t in r){e=r[t];u[t]=n(e)}return u});p=d(function(n){var r,t,e={};for(r in n){t=n[r];if(t){e[r]=t}}return e});h=d(function(n,r){var t,e,u={};for(t in r){e=r[t];if(n(e)){u[t]=e}}return u});g=d(function(n,r){var t,e,u={};for(t in r){e=r[t];if(!n(e)){u[t]=e}}return u});v=d(function(n,r){var t,e,u,i;t={};e={};for(u in r){i=r[u];(n(i)?t:e)[u]=i}return[t,e]});m=d(function(n,r){var t,e;for(t in r){e=r[t];if(n(e)){return e}}});r.exports={values:e,keys:u,pairsToObj:i,objToPairs:o,listsToObj:a,objToLists:c,empty:f,each:l,map:s,filter:h,compact:p,reject:g,partition:v,find:m};function d(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}},{}],3:[function(n,r,t){var e,u,i,o,a,c,f,l,s,p,h,g,v,m,d,y,j,b,x,M,k,W,L,q,w,T,z,A,N,O,B,S;e=I(function(n,r){return n>r?n:r});u=I(function(n,r){return n<r?n:r});i=function(n){return-n};o=Math.abs;a=function(n){if(n<0){return-1}else if(n>0){return 1}else{return 0}};c=I(function(n,r){return~~(n/r)});f=I(function(n,r){return n%r});l=I(function(n,r){return Math.floor(n/r)});s=I(function(n,r){var t;return(n%(t=r)+t)%t});p=function(n){return 1/n};h=Math.PI;g=h*2;v=Math.exp;m=Math.sqrt;d=Math.log;y=I(function(n,r){return Math.pow(n,r)});j=Math.sin;b=Math.tan;x=Math.cos;M=Math.asin;k=Math.acos;W=Math.atan;L=I(function(n,r){return Math.atan2(n,r)});q=function(n){return~~n};w=Math.round;T=Math.ceil;z=Math.floor;A=function(n){return n!==n};N=function(n){return n%2===0};O=function(n){return n%2!==0};B=I(function(n,r){var t;n=Math.abs(n);r=Math.abs(r);while(r!==0){t=n%r;n=r;r=t}return n});S=I(function(n,r){return Math.abs(Math.floor(n/B(n,r)*r))});r.exports={max:e,min:u,negate:i,abs:o,signum:a,quot:c,rem:f,div:l,mod:s,recip:p,pi:h,tau:g,exp:v,sqrt:m,ln:d,pow:y,sin:j,tan:b,cos:x,acos:k,asin:M,atan:W,atan2:L,truncate:q,round:w,ceiling:T,floor:z,isItNaN:A,even:N,odd:O,gcd:B,lcm:S};function I(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}},{}],4:[function(n,r,t){var e,u,i,o,a,c,f,l,s,p,h,g,v,m,d,y,j,b,x,M,k,W,L,q,w,T,z,A,N,O,B,S,I,P,F,E,C,R,V,D,G,H,J,K,Q,U,X,Y,Z,$,_,nr,rr,tr,er,ur,ir,or,ar,cr,fr,lr=[].slice;e=sr(function(n,r){var t,e,u;for(t=0,e=r.length;t<e;++t){u=r[t];n(u)}return r});u=sr(function(n,r){var t,e,u,i=[];for(t=0,e=r.length;t<e;++t){u=r[t];i.push(n(u))}return i});i=sr(function(n){var r,t,e,u=[];for(r=0,t=n.length;r<t;++r){e=n[r];if(e){u.push(e)}}return u});o=sr(function(n,r){var t,e,u,i=[];for(t=0,e=r.length;t<e;++t){u=r[t];if(n(u)){i.push(u)}}return i});a=sr(function(n,r){var t,e,u,i=[];for(t=0,e=r.length;t<e;++t){u=r[t];if(!n(u)){i.push(u)}}return i});c=sr(function(n,r){var t,e,u,i,o;t=[];e=[];for(u=0,i=r.length;u<i;++u){o=r[u];(n(o)?t:e).push(o)}return[t,e]});f=sr(function(n,r){var t,e,u;for(t=0,e=r.length;t<e;++t){u=r[t];if(n(u)){return u}}});l=s=function(n){if(!n.length){return}return n[0]};p=function(n){if(!n.length){return}return n.slice(1)};h=function(n){if(!n.length){return}return n[n.length-1]};g=function(n){var r;r=n.length;if(!r){return}return n.slice(0,r-1)};v=function(n){return!n.length};m=function(n){return n.concat().reverse()};d=function(n){var r,t,e,u;r=[];for(t=0,e=n.length;t<e;++t){u=n[t];if(!pr(u,r)){r.push(u)}}return r};y=j=sr(function(n,r,t){var e,u,i;for(e=0,u=t.length;e<u;++e){i=t[e];r=n(r,i)}return r});b=x=sr(function(n,r){return y(n,r[0],r.slice(1))});M=sr(function(n,r,t){return y(n,r,t.concat().reverse())});k=sr(function(n,r){var t;t=r.concat().reverse();return y(n,t[0],t.slice(1))});W=sr(function(n,r){var t,e,u;t=[];e=r;while((u=n(e))!=null){t.push(u[0]);e=u[1]}return t});L=function(n){return[].concat.apply([],n)};q=sr(function(n,r){var t;return[].concat.apply([],function(){var e,u,i,o=[];for(e=0,i=(u=r).length;e<i;++e){t=u[e];o.push(n(t))}return o}())});w=sr(function(n){var r;return[].concat.apply([],function(){var t,e,u,i=[];for(t=0,u=(e=n).length;t<u;++t){r=e[t];if(r.length!=null){i.push(w(r))}else{i.push(r)}}return i}())});T=function(n){var r,t,e,u,i,o,a,c;r=lr.call(arguments,1);t=[];n:for(e=0,u=n.length;e<u;++e){i=n[e];for(o=0,a=r.length;o<a;++o){c=r[o];if(pr(i,c)){continue n}}t.push(i)}return t};z=function(n){var r,t,e,u,i,o,a,c;r=lr.call(arguments,1);t=[];n:for(e=0,u=n.length;e<u;++e){i=n[e];for(o=0,a=r.length;o<a;++o){c=r[o];if(!pr(i,c)){continue n}}t.push(i)}return t};A=function(){var n,r,t,e,u,i,o,a;n=lr.call(arguments);r=[];for(t=0,e=n.length;t<e;++t){u=n[t];for(i=0,o=u.length;i<o;++i){a=u[i];if(!pr(a,r)){r.push(a)}}}return r};N=sr(function(n,r){var t,e,u,i,o;t={};for(e=0,u=r.length;e<u;++e){i=r[e];o=n(i);if(o in t){t[o]+=1}else{t[o]=1}}return t});O=sr(function(n,r){var t,e,u,i,o;t={};for(e=0,u=r.length;e<u;++e){i=r[e];o=n(i);if(o in t){t[o].push(i)}else{t[o]=[i]}}return t});B=function(n){var r,t,e;for(r=0,t=n.length;r<t;++r){e=n[r];if(!e){return false}}return true};S=function(n){var r,t,e;for(r=0,t=n.length;r<t;++r){e=n[r];if(e){return true}}return false};I=sr(function(n,r){var t,e,u;for(t=0,e=r.length;t<e;++t){u=r[t];if(n(u)){return true}}return false});P=sr(function(n,r){var t,e,u;for(t=0,e=r.length;t<e;++t){u=r[t];if(!n(u)){return false}}return true});F=function(n){return n.concat().sort(function(n,r){if(n>r){return 1}else if(n<r){return-1}else{return 0}})};E=sr(function(n,r){if(!r.length){return[]}return r.concat().sort(n)});C=sr(function(n,r){if(!r.length){return[]}return r.concat().sort(function(r,t){if(n(r)>n(t)){return 1}else if(n(r)<n(t)){return-1}else{return 0}})});R=function(n){var r,t,e,u;r=0;for(t=0,e=n.length;t<e;++t){u=n[t];r+=u}return r};V=function(n){var r,t,e,u;r=1;for(t=0,e=n.length;t<e;++t){u=n[t];r*=u}return r};D=G=function(n){var r,t,e,u;r=0;t=n.length;for(e=0;e<t;++e){u=e;r+=n[u]}return r/t};H=function(n){var r,t,e,u,i;r=n[0];for(t=0,u=(e=n.slice(1)).length;t<u;++t){i=e[t];if(i>r){r=i}}return r};J=function(n){var r,t,e,u,i;r=n[0];for(t=0,u=(e=n.slice(1)).length;t<u;++t){i=e[t];if(i<r){r=i}}return r};K=Q=sr(function(n,r,t){var e,u;e=r;return[r].concat(function(){var r,i,o,a=[];for(r=0,o=(i=t).length;r<o;++r){u=i[r];a.push(e=n(e,u))}return a}())});U=X=sr(function(n,r){if(!r.length){return}return K(n,r[0],r.slice(1))});Y=sr(function(n,r,t){t=t.concat().reverse();return K(n,r,t).reverse()});Z=sr(function(n,r){if(!r.length){return}r=r.concat().reverse();return K(n,r[0],r.slice(1)).reverse()});$=sr(function(n,r,t){return t.slice(n,r)});_=sr(function(n,r){if(n<=0){return r.slice(0,0)}else if(!r.length){return r}else{return r.slice(0,n)}});nr=sr(function(n,r){if(n<=0||!r.length){return r}else{return r.slice(n)}});rr=sr(function(n,r){return[_(n,r),nr(n,r)]});tr=sr(function(n,r){var t,e,u;t=r.length;if(!t){return r}for(e=0;e<t;++e){u=e;if(!n(r[u])){break}}return r.slice(0,u)});er=sr(function(n,r){var t,e,u;t=r.length;if(!t){return r}for(e=0;e<t;++e){u=e;if(!n(r[u])){break}}return r.slice(u)});ur=sr(function(n,r){return[tr(n,r),er(n,r)]});ir=sr(function(n,r){return ur(hr([gr,n]),r)});or=sr(function(n,r){var t,e,u,i,o,a;t=[];e=r.length;for(u=0,i=n.length;u<i;++u){o=u;a=n[u];if(o===e){break}t.push([a,r[o]])}return t});ar=sr(function(n,r,t){var e,u,i,o,a,c;e=[];u=t.length;for(i=0,o=r.length;i<o;++i){a=i;c=r[i];if(a===u){break}e.push(n(c,t[a]))}return e});cr=function(){var n,r,t,e,u,i,o,a,c,f=[];n=lr.call(arguments);r=9e9;for(t=0,e=n.length;t<e;++t){u=n[t];r<=(i=u.length)||(r=i)}for(t=0;t<r;++t){o=t;a=[];for(c=0,e=n.length;c<e;++c){u=n[c];a.push(u[o])}f.push(a)}return f};fr=function(n){var r,t,e,u,i,o,a,c=[];r=lr.call(arguments,1);t=9e9;for(e=0,u=r.length;e<u;++e){i=r[e];t<=(o=i.length)||(t=o)}for(e=0;e<t;++e){a=e;c.push(n.apply(null,f()))}return c;function f(){var n,t,e,u=[];for(n=0,e=(t=r).length;n<e;++n){i=t[n];u.push(i[a])}return u}};r.exports={each:e,map:u,filter:o,compact:i,reject:a,partition:c,find:f,head:l,first:s,tail:p,last:h,initial:g,empty:v,reverse:m,difference:T,intersection:z,union:A,countBy:N,groupBy:O,fold:y,fold1:b,foldl:j,foldl1:x,foldr:M,foldr1:k,unfoldr:W,andList:B,orList:S,any:I,all:P,unique:d,sort:F,sortWith:E,sortBy:C,sum:R,product:V,mean:D,average:G,concat:L,concatMap:q,flatten:w,maximum:H,minimum:J,scan:K,scan1:U,scanl:Q,scanl1:X,scanr:Y,scanr1:Z,slice:$,take:_,drop:nr,splitAt:rr,takeWhile:tr,dropWhile:er,span:ur,breakList:ir,zip:or,zipWith:ar,zipAll:cr,zipAllWith:fr};function sr(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}function pr(n,r){var t=-1,e=r.length>>>0;while(++t<e)if(n===r[t]&&t in r)return true;return false}function hr(n){return function(){var r,t=arguments;for(r=n.length;r>0;--r){t=[n[r-1].apply(this,t)]}return t[0]}}function gr(n){return!n}},{}],5:[function(n,r,t){var e,u,i,o,a,c,f,l,s,p;e=h(function(n,r){return r.split(n)});u=h(function(n,r){return r.join(n)});i=function(n){if(!n.length){return[]}return n.split("\n")};o=function(n){return n.join("\n")};a=function(n){if(!n.length){return[]}return n.split(/[ ]+/)};c=function(n){return n.join(" ")};f=function(n){return n.split("")};l=function(n){return n.join("")};s=function(n){return n.split("").reverse().join("")};p=h(function(n,r){var t,e,u;e=[];for(u=0;u<n;++u){e.push(r)}t=e;return t.join("")});r.exports={split:e,join:u,lines:i,unlines:o,words:a,unwords:c,chars:f,unchars:l,reverse:s,repeat:p};function h(n,r){var t,e=function(u){return n.length>1?function(){var i=u?u.concat():[];t=r?t||this:this;return i.push.apply(i,arguments)<n.length&&arguments.length?e.call(t,i):n.apply(t,i)}:n};return e()}},{}]},{},[]);

},{}],2:[function(require,module,exports){
var $R, mutant, ch, $w, $d, isIe, isMoz, isOpera, isTouchable, threshold, lastReqId, hasScrolled, timeUpdater, showTimeoutId, hideTimeoutId;
window.helpers = require('./shared-helpers.ls');
window.mutants = require('./pb-mutants.ls');
$R = require('reactivejs');
window.rUser = $R.state();
mutant = require('../lib/mutant/mutant.ls');
ch = require('./client-helpers.ls');
window.Auth = require('../component/Auth.ls');
window.cors = {
  ajaxParams: {
    xhrFields: {
      withCredentials: true
    },
    success: function(){},
    error: function(){}
  },
  get: function(url, data, cb){
    var params;
    params = {};
    import$(params, this.ajaxParams);
    params.type = 'GET';
    params.url = url;
    params.data = data;
    if (cb) {
      params.success = cb;
    }
    return $.ajax(params);
  },
  post: function(url, data, cb){
    var params;
    params = {};
    import$(params, this.ajaxParams);
    params.type = 'POST';
    params.url = url;
    params.data = data;
    if (cb) {
      params.success = cb;
    }
    return $.ajax(params);
  }
};
window.hints = {
  last: {
    pathname: null,
    mutator: null
  },
  current: {
    pathname: window.location.pathname,
    mutator: window.mutator
  }
};
$w = $(window);
$d = $(document);
isIe = false || in$('msTransform', document.documentElement.style);
isMoz = false || in$('MozBoxSizing', document.documentElement.style);
isOpera = !!(window.opera && window.opera.version);
isTouchable = function(){
  var e;
  try {
    document.createEvent('TouchEvent');
    return true;
  } catch (e$) {
    e = e$;
    return false;
  }
}();
threshold = 15;
$d.on('click', 'a.mutant', ch.mutate);
window.lastStatechangeWasUser = true;
lastReqId = 0;
History.Adapter.bind(window, 'statechange', function(e){
  var statechangeWasUser, url, params, ref$, rc, surfParams, reqId, jqxhr;
  statechangeWasUser = window.lastStatechangeWasUser;
  window.lastStatechangeWasUser = true;
  url = History.getPageUrl().replace(/\/$/, '');
  params = History.getState().data;
  import$(window.hints.last, window.hints.current);
  ref$ = window.hints.current;
  ref$.pathname = window.location.pathname;
  ref$.mutator = null;
  if (window.hints.last.mutator === 'forum' && !window.location.pathname.match(/^\/(auth|admin|resources)/)) {
    rc = window.tasks.recommendation(window.location.pathname, window.hints.last.pathname);
  }
  if (!(params != null && params.noSurf)) {
    spin(true);
    surfParams = {
      _surf: mutator,
      _surfData: params != null ? params.surfData : void 8
    };
    if (rc != null && ((ref$ = rc.keep) != null && ref$.length)) {
      surfParams._surfTasks = rc.keep.sort().map(function(it){
        return tasks.cc(it);
      }).join(',');
    }
    reqId = ++lastReqId;
    jqxhr = $.get(url, surfParams, function(r){
      var ref$, onUnload;
      if (!r.mutant) {
        return;
      }
      if ((ref$ = r.locals) != null && ref$.title) {
        $d.attr('title', r.locals.title);
      }
      onUnload = mutants[window.mutator].onUnload || function(w, nextMutant, cb){
        return cb(null);
      };
      return onUnload(window, r.mutant, function(){
        var locals;
        if (reqId === lastReqId) {
          locals = import$({
            statechangeWasUser: statechangeWasUser
          }, r.locals);
          return mutant.run(mutants[r.mutant], {
            locals: locals,
            user: window.user
          }, function(){
            onloadResizable();
            window.hints.current.mutator = window.mutator;
            return spin(false);
          });
        }
      });
    });
    return jqxhr.fail(function(xhr, status, error){
      showTooltip($('#warning'), "Page Not Found", 8000);
      History.back();
      return window.spin(false);
    });
  }
});
window.onloadPersonalize = function(){
  var ref$;
  if (window.user) {
    $('.onclick-profile').each(function(){
      return this.href = "/user/" + window.user.name;
    });
    $('.onclick-login').hide();
    $('.onclick-logout').show();
    $('.onclick-profile').show();
    if (((typeof user != 'undefined' && user !== null) && ((ref$ = user.rights) != null && ref$['super'])) || ((typeof user != 'undefined' && user !== null) && ((ref$ = user.rights) != null && ref$.admin))) {
      return $('.admin-only').show();
    } else {
      return $('.admin-only').hide();
    }
  } else {
    $('.onclick-login').show();
    $('.onclick-logout').hide();
    $('.onclick-profile').hide();
    return $('.admin-only').hide();
  }
};
window.onloadResizable = function(){
  var leftOffset, $l, $r;
  leftOffset = 50;
  $l = $('#left_content');
  $r = $('#main_content .resizable');
  if ($r.length) {
    $l.resizable({
      minWidth: 200,
      maxWidth: 450,
      resize: function(e, ui){
        $l.toggleClass('wide', $l.width() > 300);
        $r.css('padding-left', ui.size.width + leftOffset);
        $l.find('.scrollable').getNiceScroll().resize();
        return window.saveUi();
      }
    });
    $l.find('.scrollable').niceScroll({
      bouncescroll: true,
      cursorcolor: '#bbb',
      cursorwidth: 6,
      hidecursordelay: 1000,
      mousescrollstep: 6,
      railoffset: true,
      railpadding: {
        bottom: 150
      }
    });
    return $r.css('padding-left', $l.width() + leftOffset);
  } else {
    try {
      return $l.resizable('destroy');
    } catch (e$) {}
  }
};
window.scrollToTop = function(cb){
  var $e;
  cb == null && (cb = function(){});
  if ($(window).scrollTop() === 0) {
    return;
  }
  $e = $('html,body');
  $e.animate({
    scrollTop: 0
  }, 250, function(){
    return $e.animate({
      scrollTop: threshold / 2
    }, 70, function(){
      return $e.animate({
        scrollTop: 0
      }, 55, function(){});
    });
  });
  return cb();
};
window.awesomeScrollTo = function(e, duration, cb){
  var ms, offset, dstScroll, curScroll;
  cb == null && (cb = function(){});
  e = $(e);
  ms = duration || 250;
  offset = 10;
  if (!e.length) {
    return;
  }
  if (isIe || isOpera) {
    e[0].scrollIntoView();
    cb();
  } else {
    dstScroll = Math.round(e.position().top) - offset;
    curScroll = window.scrollY;
    if (Math.abs(dstScroll - curScroll) > threshold * 2) {
      $('html,body').animate({
        scrollTop: dstScroll
      }, ms, function(){
        return $('html,body').animate({
          scrollTop: dstScroll + threshold / 2
        }, 70, function(){
          return $('html,body').animate({
            scrollTop: dstScroll
          }, 50, function(){
            return cb();
          });
        });
      });
    } else {
      cb();
    }
  }
  return e;
};
hasScrolled = function(){
  var st;
  st = $w.scrollTop();
  return $('body').toggleClass('scrolled', st > threshold);
};
setTimeout(function(){
  $w.on('scroll', function(){
    return hasScrolled();
  });
  return hasScrolled();
}, 600);
$('header.header').on('click', function(ev){
  var b;
  if ($(ev.target).hasClass('header')) {
    b = $('body');
    if ($w.scrollTop() > threshold) {
      b.toggleClass('scrolled');
      return setTimeout(function(){
        return $('#query').focus();
      }, 1);
    }
  }
});
$d.on('click', '.onclick-scroll-to', function(){
  awesomeScrollTo($(this).data('scroll-to'));
  return false;
});
$d.on('mousedown', '.onclick-scroll-top', function(){
  $(this).attr('title', 'Scroll to Top!');
  window.scrollToTop();
  return false;
});
window.shakeDialog = function($form, time){
  var $fancybox;
  $fancybox = $form.parents('.fancybox-wrap:first').removeClass('shake');
  return setTimeout(function(){
    return $fancybox.addClass('shake');
  }, 100);
};
Auth.afterLogin = function(){
  return $.getJSON('/auth/user', function(user){
    var ref$;
    window.user = user;
    onloadPersonalize();
    if (user && ((typeof mutants != 'undefined' && mutants !== null) && ((ref$ = mutants[window.mutator]) != null && ref$.onPersonalize))) {
      setProfile(user.photo);
      return typeof mutants != 'undefined' && mutants !== null ? (ref$ = mutants[window.mutator]) != null ? ref$.onPersonalize(window, user, function(){
        var ref$;
        if (typeof socket != 'undefined' && socket !== null) {
          socket.disconnect();
        }
        return typeof socket != 'undefined' && socket !== null ? (ref$ = socket.socket) != null ? ref$.connect() : void 8 : void 8;
      }) : void 8 : void 8;
    }
  });
};
window.logout = function(){
  window.location = '/auth/logout';
  return false;
};
$d.on('click', '.onclick-logout', function(){
  window.logout();
  return false;
});
$d.on('click', '.require-login', Auth.requireLogin(function(){
  return this.click;
}));
$d.on('click', '.onclick-login', function(){
  Auth.showLoginDialog();
  return false;
});
timeUpdater = function(){
  var now;
  now = new Date;
  return $('[data-time]').each(function(){
    var $el, d, elapsed, hr, lh;
    $el = $(this);
    d = new Date($el.data('time'));
    elapsed = (now - d) / 1000;
    hr = window.helpers.elapsedToHumanReadable(elapsed);
    lh = $el.data('last-human');
    $el.data('last-human', hr);
    if ($el.hasClass('time-title')) {
      return $el.attr('title', hr.replace(/<.*?\/?>/g, ''));
    } else {
      return $el.html(hr);
    }
  });
};
setInterval(timeUpdater, 30000);
window.spin = function(loading){
  var timeUntilShow, timeUntilHide, $b, show, hide;
  loading == null && (loading = true);
  timeUntilShow = 500;
  timeUntilHide = 6500;
  clearTimeout(showTimeoutId);
  clearTimeout(hideTimeoutId);
  $b || ($b = $('body'));
  show = function(){
    $b.addClass('waiting');
    return hideTimeoutId = setTimeout(hide, timeUntilHide);
  };
  hide = function(){
    return $b.removeClass('waiting');
  };
  if (loading) {
    return showTimeoutId = setTimeout(show, timeUntilShow);
  } else {
    return hide();
  }
};
onloadResizable();
$.getJSON('/auth/user', function(user){
  var m;
  window.user = user;
  setTimeout(function(){
    return window.rUser(window.user);
  }, 50);
  if (window.location.hash.match(/^\#recover=/)) {
    Auth.showResetPasswordDialog();
  }
  if (m = window.location.hash.match(/^\#invalid=(.+)/)) {
    Auth.showInfoDialog("Welcome back " + m[1] + "!");
  }
  switch (window.location.hash) {
  case '#invalid':
    Auth.showInfoDialog('Invalid invite code!');
    break;
  case '#validate':
    Auth.afterLogin();
    break;
  case '#once':
    Auth.loginWithToken();
  }
  onloadPersonalize();
  if (window.initialMutant) {
    return mutant.run(mutants[window.initialMutant], {
      initial: true,
      user: window.user
    }, function(){});
  }
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
function in$(x, arr){
  var i = -1, l = arr.length >>> 0;
  while (++i < l) if (x === arr[i] && i in arr) return true;
  return false;
}
},{"./pb-mutants.ls":3,"./shared-helpers.ls":4,"./client-helpers.ls":5,"../lib/mutant/mutant.ls":6,"../component/Auth.ls":7,"reactivejs":8}],9:[function(require,module,exports){
(function(global){var Buy, Paginator, $w, $d, leftOffset, sep, appendReplyUi, censor, submit, ckSubmit, postSubmit, submitSelectors, cleanupOutput, subscribe, this$ = this;
window.__ = require('lodash');
window.Chat = require('../component/Chat.ls');
window.Auth = require('../component/Auth.ls');
window.Pager = require('./pager.ls');
window.furl = require('./forum-urls.ls');
window.tasks = require('./tasks.ls');
window.ioc = require('./io-client.ls');
window.PhotoCropper = require('../component/PhotoCropper.ls');
import$(global, require('prelude-ls/prelude-browser-min')('prelude-ls'));
import$(global, require('./shared-helpers.ls'));
import$(global, require('./client-helpers.ls'));
Buy = require('../component/Buy.ls');
Paginator = require('../component/Paginator.ls');
$w = $(window);
$d = $(document);
leftOffset = 50;
sep = '-';
window.saveUi = function(){
  var minWidth, w, s, ref$, _, prev, vals;
  minWidth = 200;
  w = $('#left_content').width();
  s = $.cookie('s');
  if (s) {
    ref$ = s.split(sep), _ = ref$[0], _ = ref$[1], prev = ref$[2];
  }
  w = w > minWidth
    ? w
    : prev || minWidth;
  vals = [$('body').hasClass('collapsed') ? 1 : 0, w];
  return $.cookie('s', vals.join(sep), {
    path: '/',
    secure: true
  });
};
window.loadUi = function(){
  var s, $l, ref$, collapsed, w;
  s = $.cookie('s');
  $l = $('#left_content');
  if (s) {
    ref$ = s.split(sep), collapsed = ref$[0], w = ref$[1];
    if (collapsed === '1' && !$('html').hasClass('admin')) {
      $('body').addClass('collapsed');
      $l.find('.scrollable').getNiceScroll().resize();
    }
    w = parseInt(w);
    $l.transition({
      width: w
    }, 500, 'easeOutExpo', function(){
      return setWide();
    });
    setTimeout(function(){
      return $('#main_content .resizable').transition({
        paddingLeft: w + leftOffset
      }, 450, 'snap');
    }, 300);
  }
  return setTimeout(function(){
    setWide();
    return alignBreadcrumb();
  }, 500);
};
$w.resize(__.debounce(function(){
  $.waypoints('refresh');
  respondResize();
  return alignBreadcrumb();
}, 800));
appendReplyUi = function(ev){
  var $p;
  $p = $(ev.target).parents('.post:first');
  if (!$p.find('.reply .post-edit:visible').length) {
    return renderAndAppend(window, $p.find('.reply:first'), 'post-edit', {
      post: {
        method: 'post',
        forum_id: $p.data('forum-id') || window.activeForumId,
        parent_id: $p.data('post-id'),
        is_comment: true
      }
    }, function(){
      return $p.find('textarea[name="body"]').focus();
    });
  } else {
    return $p.find('.reply .cancel').click();
  }
};
censor = function(ev){
  var $p, postId;
  $p = $(ev.target).parents('.post:first');
  postId = $p.data('post-id');
  return $.post("/resources/posts/" + postId + "/censor", function(r){
    if (r != null && r.success) {
      return $p.addClass('censored');
    }
  });
};
loadUi();
setTimeout(function(){
  return $('footer').addClass('active');
}, 2500);
$('#query').focus().select();
window.$ui = $({});
window.rSearchopts = $R.state(window.searchopts);
window.rSocket = $R.state();
(function(){
  var blacklist;
  blacklist = {
    9: 1,
    17: 1,
    18: 1,
    27: 1,
    32: 1,
    37: 1,
    38: 1,
    39: 1,
    40: 1,
    224: 1
  };
  return $d.on('keyup', '#query', __.debounce(function(it){
    var q, submitType, newopts, ref$;
    q = $(this).val();
    if (!blacklist[it.which]) {
      if (it.which === 13) {
        submitType = 'hard';
      } else {
        submitType = 'soft';
      }
      newopts = (ref$ = import$({}, window.searchopts), ref$.q = q, ref$.submitType = submitType, ref$);
      delete newopts.page;
      return rSearchopts(newopts);
    }
  }, 500));
})();
$d.on('change', '#search_filters [name=forum_id]', function(){
  var submitType, forum_id, newopts, ref$;
  submitType = 'soft';
  forum_id = $(this).val();
  newopts = (ref$ = import$({}, window.searchopts), ref$.forum_id = forum_id, ref$.submitType = submitType, ref$);
  delete newopts.page;
  rSearchopts(newopts);
  return false;
});
$d.on('change', '#search_filters [name=within]', function(it){
  var submitType, within, newopts, ref$;
  console.log(it);
  submitType = 'soft';
  within = $(this).val();
  newopts = (ref$ = import$({}, window.searchopts), ref$.within = within, ref$.submitType = submitType, ref$);
  delete newopts.page;
  rSearchopts(newopts);
  return false;
});
$R(function(sopts){
  var parser, uri, shouldSearch, shouldReplace, k, v, qs;
  parser = document.createElement('a');
  parser.href = History.getState().url;
  uri = parser.pathname;
  shouldSearch = sopts.submitType === 'hard' || uri === '/search';
  shouldReplace = sopts.submitType === 'soft';
  delete sopts.submitType;
  (function(){
    var ref$, results$ = [];
    for (k in ref$ = sopts) {
      v = ref$[k];
      if (!v) {
        results$.push(k);
      }
    }
    return results$;
  }()).map(function(it){
    var ref$;
    return ref$ = sopts[it], delete sopts[it], ref$;
  });
  if (shouldSearch) {
    qs = $.param(sopts);
    uri = "/search" + (qs ? '?' : '') + qs;
    window.lastStatechangeWasUser = false;
    if (shouldReplace) {
      return History.replaceState({}, '', uri);
    } else {
      return History.pushState({}, '', uri);
    }
  }
}).bindTo(rSearchopts);
$ui.on('thread-create', function(e, thread){
  console.info('thread-create', thread);
  return renderAndPrepend(window, $('#left_container .threads'), 'thread', {
    thread: thread
  }, function(){
    return $('#left_container .threads div.fadein li').unwrap();
  });
});
$ui.on('nav-top-posts', function(e, threads){
  return console.info('stub', threads);
});
$d.on('click', '.create .no-surf', Auth.requireLogin(function(ev){
  var e;
  $('#main_content .forum').html('');
  e = $(ev.target);
  return editPost(e.data('edit'), {
    forum_id: window.activeForumId
  });
}));
$d.on('click', '.edit.no-surf', Auth.requireLogin(function(ev){
  return editPost($(ev.target).data('edit'));
}));
$d.on('click', '.onclick-submit .cancel', function(ev){
  var f, meta;
  f = $(ev.target).closest('.post-edit');
  f.hide(350, 'easeOutExpo');
  meta = furl.parse(window.location.pathname);
  switch (meta.type) {
  case 'new-thread':
    History.back();
    break;
  default:
    removeEditingUrl(meta);
  }
  return false;
});
submit = Auth.requireLogin(function(ev){
  return submitForm(ev, function(data){
    var f, p, t, ref$, meta;
    f = $(ev.target).closest('.post-edit');
    p = f.closest('.editing');
    t = $(f.find('.tooltip'));
    if (!data.success) {
      showTooltip(t, data != null ? (ref$ = data.errors) != null ? ref$.join('<br>') : void 8 : void 8);
    } else {
      p.find('.title').html((ref$ = data[0]) != null ? ref$.title : void 8);
      p.find('.body').html((ref$ = data[0]) != null ? ref$.body : void 8);
      f.removeClass('fadein').hide(200);
      meta = furl.parse(window.location.pathname);
      window.lastStatechangeWasUser = false;
      switch (meta.type) {
      case 'new-thread':
        History.replaceState({}, '', data.uri);
        break;
      case 'edit':
        removeEditingUrl(meta);
      }
    }
    return false;
  });
});
ckSubmit = Auth.requireLogin(function(ev){
  ckSubmitForm({
    element: {
      $: {
        id: 'editor'
      }
    }
  }, function(data){
    return postSuccess(ev, data);
  });
  return false;
});
postSubmit = Auth.requireLogin(function(ev){
  submitForm(ev, function(data){
    return postSuccess(ev, data);
  });
  return false;
});
submitSelectors = ["html.profile .onclick-submit button[type='submit']", "html.forum .onclick-submit button[type='submit']", "html.search .onclick-submit button[type='submit']"];
$d.on('click', submitSelectors.join(', '), postSubmit);
$d.on('keydown', '.onshiftenter-submit', function(it){
  if (it.which === 13 && it.shiftKey) {
    return postSubmit(it);
  }
});
$d.on('click', '.onclick-append-reply-ui', Auth.requireLogin(appendReplyUi));
$d.on('click', '.onclick-censor-post', Auth.requireLogin(censor));
$d.on('click', 'html header .menu a.title', mutate);
$d.on('click', 'header .onclick-close', function(e){
  $('#query').val('').focus();
  return History.back();
});
$d.on('click', '#handle', function(){
  var $l;
  $l = $('#left_content');
  $('body').toggleClass('collapsed');
  $('#main_content .resizable').css('padding-left', $l.width() + leftOffset);
  return saveUi();
});
if ((typeof mocha != 'undefined' && mocha !== null) && window.location.search.match(/test=1/)) {
  cleanupOutput = function(){
    var mochaCssEl;
    $('body > *:not(#mocha)').remove();
    mochaCssEl = $("<link rel=\"stylesheet\" type=\"text/css\" href=\"" + window.cacheUrl + "/local/mocha.css\">");
    return $('head').append(mochaCssEl);
  };
  mocha.setup('bdd');
  $.getScript(window.cacheUrl + "/tests/test1.js", function(){
    var run;
    run = function(){
      return mocha.run(cleanupOutput);
    };
    return setTimeout(run, 2000);
  });
}
$d.on('click', '.onclick-chat', Auth.requireLogin(function(ev){
  var profileName, f, $p, t;
  profileName = $('div.profile:first').data('user-name');
  f = user;
  $p = $('div.profile:first');
  t = {
    id: $p.data('user-id'),
    name: $p.data('user-name'),
    photo: $p.find('img').attr('src')
  };
  return Chat.start([f, t]);
}));
$d.on('click', 'html.admin .onclick-submit button[type="submit"]', function(ev){
  return submitForm(ev, function(data){
    var f, t, inputs, k, v, i$, len$, e;
    f = $(this);
    t = $(f.find('.tooltip'));
    inputs = {
      saved: f.find('input, textarea')
    };
    if (!f.hasClass('no-focus')) {
      f.find('input:first').focus().select();
    }
    if (data != null && data.success) {
      showTooltip(t, t.data('msg') || 'Saved!');
      for (k in inputs) {
        v = inputs[k];
        for (i$ = 0, len$ = v.length; i$ < len$; ++i$) {
          e = v[i$];
          e = $(e);
          e.addClass(k);
          if (e.hasClass('clear')) {
            e.val('');
          }
        }
      }
      return setTimeout(function(){
        var k, ref$, v, lresult$, i$, len$, e, results$ = [];
        for (k in ref$ = inputs) {
          v = ref$[k];
          lresult$ = [];
          for (i$ = 0, len$ = v.length; i$ < len$; ++i$) {
            e = v[i$];
            lresult$.push($(e).removeClass(k));
          }
          results$.push(lresult$);
        }
        return results$;
      }, 3000);
    } else {
      return showTooltip(t, data != null ? data.msg : void 8);
    }
  });
});
$d.on('change', 'html.admin .domain', function(){
  var id, domain, i$, ref$, len$, k, results$ = [];
  id = parseInt($('.domain option:selected').val());
  domain = find(function(it){
    return it.id === id;
  }, site.domains);
  for (i$ = 0, len$ = (ref$ = ['facebookClientId', 'facebookClientSecret', 'twitterConsumerKey', 'twitterConsumerSecret', 'googleConsumerKey', 'googleConsumerSecret']).length; i$ < len$; ++i$) {
    k = ref$[i$];
    results$.push($("[name='" + k + "']").val(domain.config[k]));
  }
  return results$;
});
subscribe = function(what){
  if (!in$(what, site.subscriptions)) {
    doBuy(what);
    return false;
  }
};
$d.on('click', 'html.admin #private', function(){
  return subscribe('private');
});
$d.on('click', 'html.admin #analytics', function(){
  return subscribe('analytics');
});
window.component = {};
$d.on('click', '.onclick-buy', function(ev){
  return doBuy($(ev.target).data('product'));
});
window.doBuy = function(productId){
  if (!productId) {
    throw new Error("window.do-buy must specify a product-id");
  }
  return lazyLoadFancybox(function(){
    return $.get('/resources/products/' + productId, function(product){
      var locals, ref$, b;
      locals = {
        product: product,
        cardNeeded: !((ref$ = window.site) != null && ref$.has_stripe)
      };
      b = (ref$ = window.component) != null ? ref$.buy : void 8;
      if (b) {
        b.detach();
      }
      b = window.component.buy = new Buy({
        locals: locals
      });
      return $.fancybox(b.$, fancyboxParams);
    });
  });
};
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
function in$(x, arr){
  var i = -1, l = arr.length >>> 0;
  while (++i < l) if (x === arr[i] && i in arr) return true;
  return false;
}
})(window)
},{"./pager.ls":10,"../component/Chat.ls":11,"../component/Auth.ls":7,"./tasks.ls":12,"./io-client.ls":13,"./forum-urls.ls":14,"./shared-helpers.ls":4,"../component/PhotoCropper.ls":15,"../component/Paginator.ls":16,"./client-helpers.ls":5,"../component/Buy.ls":17,"prelude-ls/prelude-browser-min":1,"lodash":18}],8:[function(require,module,exports){
(function() {
  var defaultContext = this;
  var __id = 0;

  function $R(fnc, context) {
      var rf = function() {
        var dirtyNodes = topo(rf);
        var v = dirtyNodes[0].run.apply(rf, arguments);
        dirtyNodes.slice(1).forEach(function (n) { n.run() } );
        return v;
      };
      rf.id = __id++;
      rf.context = context || defaultContext;
      rf.fnc = fnc;
      rf.dependents = [];
      rf.dependencies = [];
      rf.memo = $R.empty;
      return $R.extend(rf, reactiveExtensions, $R.pluginExtensions);
  }
  $R._ = {};
  $R.empty = {};
  $R.state = function (initial) {
    var rFnc = $R(function () {
      if (arguments.length) {
        this.val = arguments[0];
      }
      return this.val;
    })
    rFnc.context = rFnc;
    rFnc.val = initial;
    return rFnc;
  }
  $R.extend = function(o) {
    var extensions = Array.prototype.slice.call(arguments, 1);
    extensions.forEach(function (extension) {
      if (extension) {
        for (var prop in extension) { o[prop] = extension[prop] }
      }
    });
    return o;
  };
  $R.pluginExtensions = {}

  var reactiveExtensions = {
    _isReactive: true,
    toString: function () { return this.fnc.toString() },
    get: function() { return this.memo === $R.empty ? this.run() : this.memo },
    run: function() {
      var unboundArgs = Array.prototype.slice.call(arguments);
      return this.memo = this.fnc.apply(this.context, this.argumentList(unboundArgs));
    },
    bindTo: function() {
      var newDependencies = Array.prototype.slice.call(arguments).map(wrap);
      var oldDependencies = this.dependencies;

      oldDependencies.forEach(function (d) {
        if (d !== $R._) { d.removeDependent(this) }
      }, this);

      newDependencies.forEach(function (d) {
        if (d !== $R._) { d.addDependent(this) }
      }, this);

      this.dependencies = newDependencies;
      return this;
    },
    removeDependent: function(rFnc) {
      this.dependents = this.dependents.filter(function (d) { return d !== rFnc });
    },
    addDependent: function(rFnc) {
      if (!this.dependents.some(function (d) { return d === rFnc })) {
        this.dependents.push(rFnc);
      }
    },
    argumentList: function(unboundArgs) {
      return this.dependencies.map(function(dependency) {
        if (dependency === $R._) {
          return unboundArgs.shift();
        } else if (dependency._isReactive) {
          return dependency.get();
        } else {
          return undefined;
        }
      }).concat(unboundArgs);
    }
  }

  if (typeof module !== 'undefined') {
    module.exports = $R;
  } else {
    defaultContext.$R = $R;
  }

  //Private
  function topo(rootFnc) {
    var explored = {};
    function search(rFnc) {
      if (explored[rFnc.id]) { return [] }
      explored[rFnc.id] = true;
      return rFnc.dependents.reduce(function (acc, dep) { return acc.concat(search(dep))},[]).concat(rFnc);
    }

    return search(rootFnc).reverse();
  }

  function wrap(v) {
    return v && (v._isReactive || v == $R._) ? v : $R(function () {return v});
  }
})();

},{}],5:[function(require,module,exports){
var postSuccess, ckSubmitForm, submitForm, setInlineEditor, focus, render, togglePost, editPost, loadCssCache, loadCss, lazyLoad, lazyLoadDeserialize, lazyLoadNestedSortable, lazyLoadHtml5Uploader, lazyLoadJcrop, lazyLoadEditor, lazyLoadFancybox, lazyLoadSocketio, fancyboxParams, respondResize, setWide, alignBreadcrumb, removeEditingUrl, mutate, timers, showTooltip, switchAndFocus, setOnlineUser, setProfile, out$ = typeof exports != 'undefined' && exports || this, this$ = this;
out$.postSuccess = postSuccess = function(ev, data){
  var f, p, t, ref$, meta;
  f = $(ev.target).closest('.post-edit');
  p = f.closest('.editing');
  t = $(f.find('.tooltip'));
  if (!data.success) {
    showTooltip(t, data != null ? (ref$ = data.errors) != null ? ref$.join('<br>') : void 8 : void 8);
  } else {
    p.find('.title').html((ref$ = data[0]) != null ? ref$.title : void 8);
    p.find('.body').html((ref$ = data[0]) != null ? ref$.body : void 8);
    f.removeClass('fadein').hide(300);
    meta = furl.parse(window.location.pathname);
    window.lastStatechangeWasUser = false;
    switch (meta.type) {
    case 'new-thread':
      History.replaceState({}, '', data.uri);
      break;
    case 'edit':
      removeEditingUrl(meta);
    }
  }
  return false;
};
out$.ckSubmitForm = ckSubmitForm = function(e){
  var editor, ref$, ev, $p;
  editor = e != null ? (ref$ = e.element) != null ? ref$.$ : void 8 : void 8;
  ev = {
    target: editor
  };
  if (!(editor != null && editor.id)) {
    $p = $(editor).closest('.post');
    return $.ajax({
      url: '/resources/posts/' + $p.data('post-id'),
      type: 'put',
      data: {
        id: $p.data('post-id'),
        forum_id: $p.data('forum-id'),
        parent_id: $p.data('thread-id'),
        body: e.getData()
      },
      success: function(data){
        e.fire('blur');
        return $p.find('[contentEditable=true]').blur();
      }
    });
  } else {
    return submitForm(ev, function(data){
      postSuccess(ev, data);
      $('footer').removeClass('expanded');
      return $('#post_new .fadein').remove();
    });
  }
};
out$.submitForm = submitForm = function(ev, fn){
  var $f, $s, body, e, ref$, input;
  $f = $(ev.target).closest('form');
  $s = $($f.find('[type=submit]:first'));
  if ($s) {
    $s.attr('disabled', 'disabled');
  }
  body = $f.find('textarea.body');
  e = typeof CKEDITOR != 'undefined' && CKEDITOR !== null ? (ref$ = CKEDITOR.instances) != null ? ref$[body.attr('id')] : void 8 : void 8;
  if (e) {
    input = e.getData();
    if (input != null && input.length) {
      body.val(input);
      e.setData('');
    }
  }
  $.ajax({
    url: $f.attr('action'),
    type: $f.attr('method'),
    data: $f.serialize(),
    dataType: 'json',
    success: function(data){
      $s.removeAttr('disabled');
      if ($('footer').hasClass('expanded')) {
        $('.onclick-footer-toggle:first').click();
      }
      if (fn) {
        return fn.call($f, data);
      }
    },
    error: function(data){
      $s.removeAttr('disabled');
      return showTooltip($($f.find('.tooltip')), data != null ? data.msg : void 8) || 'Try again!';
    }
  });
  return false;
};
out$.setInlineEditor = setInlineEditor = function(userId){
  $(".post[data-user-id=" + userId + "] .post-content").attr('contentEditable', true);
  return lazyLoadEditor(function(){
    var i$, ref$, len$, e;
    for (i$ = 0, len$ = (ref$ = CKEDITOR.instances).length; i$ < len$; ++i$) {
      e = ref$[i$];
      e.destroy(true);
    }
    try {
      return CKEDITOR.inlineAll();
    } catch (e$) {}
  });
};
focus = function($e){
  return setTimeout(function(){
    return $e.find('input[type="text"]').focus();
  }, 10);
};
render = function(sel, locals, cb){
  var $e;
  cb == null && (cb = function(){});
  $e = $(sel);
  return renderAndAppend(window, sel, 'post-edit', {
    user: user,
    post: locals
  }, function($e){
    cb();
    return focus($e);
  });
};
out$.togglePost = togglePost = function(ev){
  var data, e;
  if (!$(ev != null ? ev.target : void 8).hasClass('onclick-footer-toggle')) {
    return;
  }
  if (!user) {
    Auth.showLoginDialog();
    return;
  }
  data = {
    action: '/resources/posts',
    method: 'post'
  };
  e = $('footer');
  if (e.hasClass('expanded')) {
    e.removeClass('expanded');
    return $('#post_new .fadein').remove();
  } else {
    e.addClass('expanded');
    return render('#post_new', data, function(){
      return lazyLoadEditor(function(){
        if (!CKEDITOR.instances.post_new) {
          CKEDITOR.replace($('#post_new textarea')[0]);
        }
        e.find('form.post-new input[name="forum_id"]').val(window.activeForumId);
        return e.find('form.post-new input[name="parent_id"]').val(window.activeThreadId);
      });
    });
  }
};
out$.editPost = editPost = function(id, data){
  var sel, e;
  data == null && (data = {});
  if (id === true) {
    scrollToTop();
    data.action = '/resources/posts';
    data.method = 'post';
    return render('.forum', data, function(){
      return lazyLoadEditor(function(){
        return CKEDITOR.replace($('#editor')[0]);
      });
    });
  } else {
    sel = "#post_" + id;
    e = $(sel);
    if (!e.find("#post_edit_" + id + ":visible").length) {
      return $.get("/resources/posts/" + id, function(p){
        render(sel, p);
        return e.addClass('editing');
      });
    } else {
      return focus(e);
    }
  }
};
loadCssCache = {};
loadCss = function(href){
  if (loadCssCache[href]) {
    return;
  }
  $('head').append($('<link rel="stylesheet" type="text/css">').attr('href', href));
  return loadCssCache[href] = true;
};
out$.lazyLoad = lazyLoad = function(test, script, css, cb){
  var b;
  b = $('body');
  b.addClass('waiting');
  if (!test()) {
    if (css) {
      loadCss(css);
    }
    return headjs(script, function(){
      b.removeClass('waiting');
      return cb();
    });
  } else {
    b.removeClass('waiting');
    return cb();
  }
};
out$.lazyLoadDeserialize = lazyLoadDeserialize = function(cb){
  return lazyLoad(function(){
    var ref$;
    return (ref$ = window.$().deserialize) != null ? ref$.length : void 8;
  }, cacheUrl + "/local/jquery.deserialize.min.js", null, cb);
};
out$.lazyLoadNestedSortable = lazyLoadNestedSortable = function(cb){
  return lazyLoad(function(){
    var ref$;
    return (ref$ = window.$().nestedSortable) != null ? ref$.length : void 8;
  }, cacheUrl + "/local/jquery.mjs.nestedSortable.js", null, cb);
};
out$.lazyLoadHtml5Uploader = lazyLoadHtml5Uploader = function(cb){
  return lazyLoad(function(){
    var ref$;
    return (ref$ = window.$().html5Uploader) != null ? ref$.length : void 8;
  }, cacheUrl + "/local/jquery.html5uploader.js", cacheUrl + "/local/editor/skins/moono/editor.css", cb);
};
out$.lazyLoadJcrop = lazyLoadJcrop = function(cb){
  return lazyLoad(function(){
    var ref$;
    return (ref$ = window.$().Jcrop) != null ? ref$.length : void 8;
  }, cacheUrl + "/jcrop/js/jquery.Jcrop.min.js", cacheUrl + "/jcrop/css/jquery.Jcrop.min.css", cb);
};
out$.lazyLoadEditor = lazyLoadEditor = function(cb){
  return lazyLoad(function(){
    return typeof CKEDITOR != 'undefined' && CKEDITOR !== null ? CKEDITOR.version : void 8;
  }, cacheUrl + "/local/editor/ckeditor.js", null, cb);
};
out$.lazyLoadFancybox = lazyLoadFancybox = function(cb){
  return lazyLoad(function(){
    var ref$;
    return (ref$ = window.$().fancybox) != null ? ref$.length : void 8;
  }, cacheUrl + "/fancybox/jquery.fancybox.pack.js", cacheUrl + "/fancybox/jquery.fancybox.css", cb);
};
out$.lazyLoadSocketio = lazyLoadSocketio = function(cb){
  return lazyLoad(function(){
    return window.io;
  }, "/socket.io/socket.io.js", null, cb);
};
out$.fancyboxParams = fancyboxParams = {
  closeEffect: 'elastic',
  closeSpeed: 200,
  closeEasing: 'easeOutExpo',
  openEffect: 'fade',
  openSpeed: 450
};
out$.respondResize = respondResize = function(){
  var w;
  w = $(window);
  if (window.mutator !== 'admin') {
    if (w.width() <= 800) {
      return $('body').addClass('collapsed');
    }
  }
};
out$.setWide = setWide = function(){
  var l;
  l = $('#left_content');
  return l.toggleClass('wide', l.width() > 300);
};
out$.alignBreadcrumb = alignBreadcrumb = function(){
  var b, m, l, pos;
  b = $('#breadcrumb');
  m = $('#main_content');
  l = $('#left_content');
  pos = (m.width() - b.width()) / 2;
  return b.transition({
    left: pos < l.width() ? l.width() : pos
  }, 300, 'easeOutExpo');
};
out$.removeEditingUrl = removeEditingUrl = function(meta){
  return History.replaceState({
    noSurf: true
  }, '', meta.threadUri);
};
out$.mutate = mutate = function(){
  var $e, href, params;
  $e = $(this);
  if ($e.hasClass('require-login') && !user) {
    return;
  }
  href = $e.attr('href');
  if (!href) {
    return false;
  }
  if (href != null && href.match(/#/)) {
    return true;
  }
  params = {};
  if ($e.hasClass('no-surf')) {
    params.noSurf = true;
  }
  params.surfData = $e.data('surf') || window.surfData || void 8;
  window.lastStatechangeWasUser = false;
  History.pushState(params, '', href);
  return false;
};
timers = {};
out$.showTooltip = showTooltip = function($tooltip, msg, duration){
  var timer;
  duration == null && (duration = 4000);
  if (!(msg != null && msg.length)) {
    return;
  }
  timer = timers[msg];
  if (timer) {
    clearTimeout(timer);
  }
  $tooltip.html(msg).addClass('hover');
  return timers[msg] = setTimeout(function(){
    timers[msg] = void 8;
    return $tooltip.removeClass('hover');
  }, duration);
};
out$.switchAndFocus = switchAndFocus = function(remove, add, focusOn){
  var $e;
  $e = $('.fancybox-wrap');
  $e.removeClass(remove + " shake slide").addClass(add);
  return setTimeout(function(){
    $e.addClass('slide');
    return setTimeout(function(){
      return $(focusOn).focus();
    }, 250);
  }, 50);
};
out$.setOnlineUser = setOnlineUser = function(id){
  var x$;
  x$ = $("[data-user-id=" + id + "] .profile.photo");
  x$.addClass('online');
  x$.attr('title', 'Online!');
  return x$;
};
out$.setProfile = setProfile = function(src){
  var x$, y$;
  x$ = $('.photo');
  x$.attr('href', "/user/" + user.name);
  x$.addClass('online');
  y$ = $('#profile');
  y$.on('load', function(){
    return $('.profile').show();
  });
  y$.attr('src', window.cacheUrl + src);
  return y$;
};
},{}],10:[function(require,module,exports){
/*

## An Experiment in Pagination

- It wants to fill all (or most) of the displayed height of the area its controlling.
- It should be relatively narrow.
- Clicking on it will change what page you're on.
  - The page number is calculated proportionally to the height of the pager relative to the number of pages.
- Hovering over it could provide info on what page you'll go to if you click there.
  - However, many touch devices are unable to hover.  What to do?
    http://ux.stackexchange.com/questions/970/what-are-some-alternatives-to-hover-on-touch-based-devices


- It has to work on the server side, too.

### HTML Structure

  #pager
    .first
    .current
    .last

*/
var indicatorHeight, indicatorTop, pageFromClickHeight, Pager;
indicatorHeight = function(pages, height){
  return Math.floor(height / pages);
};
indicatorTop = function(page, iHeight){
  return (page - 1) * iHeight;
};
pageFromClickHeight = function(clickHeight, iHeight){
  var f;
  f = Math.ceil(clickHeight / iHeight);
  if (f === 0) {
    return 1;
  } else {
    return f;
  }
};
module.exports = Pager = (function(){
  Pager.displayName = 'Pager';
  var prototype = Pager.prototype, constructor = Pager;
  function Pager(id, options){
    var this$ = this;
    this.id = id;
    this.onResizeReInit = bind$(this, 'onResizeReInit', prototype);
    this.onClickSetPage = bind$(this, 'onClickSetPage', prototype);
    this.setNextAndPreviousLinks = bind$(this, 'setNextAndPreviousLinks', prototype);
    this.previousPage = bind$(this, 'previousPage', prototype);
    this.nextPage = bind$(this, 'nextPage', prototype);
    this.setPage = bind$(this, 'setPage', prototype);
    this.urlForPage = bind$(this, 'urlForPage', prototype);
    this.last = options.last;
    this.current = parseInt(options.current) || 1;
    this.forumId = options.forumId;
    this.$el = $(this.id);
    this.init();
    this.$el.click(this.onClickSetPage);
    this.$el.find('.current').draggable({
      axis: 'y',
      containment: 'parent',
      grid: [0, this.indicatorHeight],
      drag: function(ev, ui){
        var page;
        return page = pageFromClickHeight(ui.position.top + Math.floor(this$.indicatorHeight / 2), this$.indicatorHeight);
      },
      stop: function(ev, ui){
        var page;
        page = pageFromClickHeight(ui.position.top + Math.floor(this$.indicatorHeight / 2), this$.indicatorHeight);
        return this$.setPage(page);
      }
    });
    this.$el.find('a.previous').click(function(ev){
      this$.previousPage();
      ev.preventDefault();
      return false;
    });
    this.$el.find('a.next').click(function(ev){
      this$.nextPage();
      ev.preventDefault();
      return false;
    });
    $(window).resize(this.onResizeReInit);
  }
  prototype.init = function(){
    $('body').toggleClass('paginator', this.last > 1);
    this.height = this.$el.height();
    this.indicatorHeight = indicatorHeight(this.last, this.height);
    try {
      return this.$el.find('.current').draggable('option', 'grid', [0, this.indicatorHeight]);
    } catch (e$) {}
  };
  prototype.urlForPage = function(n){
    var href, base;
    href = window.location.pathname;
    base = href.replace(/\/page\/.*$/, '');
    if (n === 1) {
      return base;
    } else {
      return base + "/page/" + n;
    }
  };
  prototype.setPage = function(n, useHistory){
    var t;
    useHistory == null && (useHistory = true);
    this.current = n > this.last ? this.last : n;
    this.$el.find('.current').css({
      top: indicatorTop(this.current, this.indicatorHeight),
      height: this.indicatorHeight
    });
    if (useHistory) {
      History.pushState({
        surfData: window.surfData
      }, '', this.urlForPage(this.current));
    }
    this.setNextAndPreviousLinks();
    t = this.$el.find('.tooltip');
    return showTooltip(t, "Page " + this.current);
  };
  prototype.nextPage = function(){
    if (this.current < this.last) {
      return this.setPage(parseInt(this.current) + 1);
    } else {
      return false;
    }
  };
  prototype.previousPage = function(){
    if (this.current > 1) {
      return this.setPage(this.current - 1);
    } else {
      return false;
    }
  };
  prototype.setNextAndPreviousLinks = function(){
    this.$el.find('a.previous').attr('href', this.urlForPage(this.current - 1 || 1));
    this.$el.find('a.next').attr('href', this.urlForPage(Math.min(this.last, parseInt(this.current) + 1)));
    switch (this.current) {
    case 1:
      this.$el.find('a.page.previous').hide();
      return this.$el.find('a.page.next').show();
    case this.last:
      this.$el.find('a.page.previous').show();
      return this.$el.find('a.page.next').hide();
    default:
      return this.$el.find('a.page').show();
    }
  };
  prototype.onClickSetPage = function(ev){
    var y, dy, page;
    window.ev = ev;
    y = function(ev, $el){
      var dy;
      dy = ev.pageY - parseInt($el.css('padding-top')) - $el.offset().top;
      if (dy < 0) {
        return 0;
      } else if (dy > $el.height()) {
        return $el.height();
      } else {
        return dy;
      }
    };
    dy = y(ev, this.$el);
    page = pageFromClickHeight(dy, this.indicatorHeight);
    return this.setPage(page);
  };
  prototype.onResizeReInit = function(ev){
    this.init();
    return this.setPage(this.current, false);
  };
  return Pager;
}());
Pager.indicatorHeight = indicatorHeight;
Pager.indicatorTop = indicatorTop;
Pager.pageFromClickHeight = pageFromClickHeight;
function bind$(obj, key, target){
  return function(){ return (target || obj)[key].apply(obj, arguments) };
}
},{}],18:[function(require,module,exports){
(function(global){/*!
 * Lo-Dash 1.0.0-rc.3 <http://lodash.com>
 * (c) 2012 John-David Dalton <http://allyoucanleet.com/>
 * Based on Underscore.js 1.4.3 <http://underscorejs.org>
 * (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
 * Available under MIT license <http://lodash.com/license>
 */
;(function(window, undefined) {

  /** Detect free variable `exports` */
  var freeExports = typeof exports == 'object' && exports;

  /** Detect free variable `global` and use it as `window` */
  var freeGlobal = typeof global == 'object' && global;
  if (freeGlobal.global === freeGlobal) {
    window = freeGlobal;
  }

  /** Used for array and object method references */
  var arrayRef = [],
      // avoid a Closure Compiler bug by creatively creating an object
      objectRef = new function(){};

  /** Used to generate unique IDs */
  var idCounter = 0;

  /** Used internally to indicate various things */
  var indicatorObject = objectRef;

  /** Used by `cachedContains` as the default size when optimizations are enabled for large arrays */
  var largeArraySize = 30;

  /** Used to restore the original `_` reference in `noConflict` */
  var oldDash = window._;

  /** Used to detect template delimiter values that require a with-statement */
  var reComplexDelimiter = /[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/;

  /** Used to match HTML entities */
  var reEscapedHtml = /&(?:amp|lt|gt|quot|#x27);/g;

  /** Used to match empty string literals in compiled template source */
  var reEmptyStringLeading = /\b__p \+= '';/g,
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

  /** Used to match regexp flags from their coerced string values */
  var reFlags = /\w*$/;

  /** Used to insert the data object variable into compiled template source */
  var reInsertVariable = /(?:__e|__t = )\(\s*(?![\d\s"']|this\.)/g;

  /** Used to detect if a method is native */
  var reNative = RegExp('^' +
    (objectRef.valueOf + '')
      .replace(/[.*+?^=!:${}()|[\]\/\\]/g, '\\$&')
      .replace(/valueOf|for [^\]]+/g, '.+?') + '$'
  );

  /**
   * Used to match ES6 template delimiters
   * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-7.8.6
   */
  var reEsTemplate = /\$\{((?:(?=\\?)\\?[\s\S])*?)}/g;

  /** Used to match "interpolate" template delimiters */
  var reInterpolate = /<%=([\s\S]+?)%>/g;

  /** Used to ensure capturing order of template delimiters */
  var reNoMatch = /($^)/;

  /** Used to match HTML characters */
  var reUnescapedHtml = /[&<>"']/g;

  /** Used to match unescaped characters in compiled string literals */
  var reUnescapedString = /['\n\r\t\u2028\u2029\\]/g;

  /** Used to fix the JScript [[DontEnum]] bug */
  var shadowed = [
    'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',
    'toLocaleString', 'toString', 'valueOf'
  ];

  /** Used to make template sourceURLs easier to identify */
  var templateCounter = 0;

  /** Native method shortcuts */
  var ceil = Math.ceil,
      concat = arrayRef.concat,
      floor = Math.floor,
      getPrototypeOf = reNative.test(getPrototypeOf = Object.getPrototypeOf) && getPrototypeOf,
      hasOwnProperty = objectRef.hasOwnProperty,
      push = arrayRef.push,
      propertyIsEnumerable = objectRef.propertyIsEnumerable,
      toString = objectRef.toString;

  /* Native method shortcuts for methods with the same name as other `lodash` methods */
  var nativeBind = reNative.test(nativeBind = slice.bind) && nativeBind,
      nativeIsArray = reNative.test(nativeIsArray = Array.isArray) && nativeIsArray,
      nativeIsFinite = window.isFinite,
      nativeIsNaN = window.isNaN,
      nativeKeys = reNative.test(nativeKeys = Object.keys) && nativeKeys,
      nativeMax = Math.max,
      nativeMin = Math.min,
      nativeRandom = Math.random;

  /** `Object#toString` result shortcuts */
  var argsClass = '[object Arguments]',
      arrayClass = '[object Array]',
      boolClass = '[object Boolean]',
      dateClass = '[object Date]',
      funcClass = '[object Function]',
      numberClass = '[object Number]',
      objectClass = '[object Object]',
      regexpClass = '[object RegExp]',
      stringClass = '[object String]';

  /** Detect various environments */
  var isIeOpera = !!window.attachEvent,
      isV8 = nativeBind && !/\n|true/.test(nativeBind + isIeOpera);

  /* Detect if `Function#bind` exists and is inferred to be fast (all but V8) */
  var isBindFast = nativeBind && !isV8;

  /* Detect if `Object.keys` exists and is inferred to be fast (IE, Opera, V8) */
  var isKeysFast = nativeKeys && (isIeOpera || isV8);

  /**
   * Detect the JScript [[DontEnum]] bug:
   *
   * In IE < 9 an objects own properties, shadowing non-enumerable ones, are
   * made non-enumerable as well.
   */
  var hasDontEnumBug;

  /** Detect if own properties are iterated after inherited properties (IE < 9) */
  var iteratesOwnLast;

  /**
   * Detect if `Array#shift` and `Array#splice` augment array-like objects
   * incorrectly:
   *
   * Firefox < 10, IE compatibility mode, and IE < 9 have buggy Array `shift()`
   * and `splice()` functions that fail to remove the last element, `value[0]`,
   * of array-like objects even though the `length` property is set to `0`.
   * The `shift()` method is buggy in IE 8 compatibility mode, while `splice()`
   * is buggy regardless of mode in IE < 9 and buggy in compatibility mode in IE 9.
   */
  var hasObjectSpliceBug = (hasObjectSpliceBug = { '0': 1, 'length': 1 },
    arrayRef.splice.call(hasObjectSpliceBug, 0, 1), hasObjectSpliceBug[0]);

  /** Detect if an `arguments` object's indexes are non-enumerable (IE < 9) */
  var nonEnumArgs = true;

  (function() {
    var props = [];
    function ctor() { this.x = 1; }
    ctor.prototype = { 'valueOf': 1, 'y': 1 };
    for (var prop in new ctor) { props.push(prop); }
    for (prop in arguments) { nonEnumArgs = !prop; }

    hasDontEnumBug = !/valueOf/.test(props);
    iteratesOwnLast = props[0] != 'x';
  }(1));

  /** Detect if `arguments` objects are `Object` objects (all but Opera < 10.5) */
  var argsAreObjects = arguments.constructor == Object;

  /** Detect if `arguments` objects [[Class]] is unresolvable (Firefox < 4, IE < 9) */
  var noArgsClass = !isArguments(arguments);

  /**
   * Detect lack of support for accessing string characters by index:
   *
   * IE < 8 can't access characters by index and IE 8 can only access
   * characters by index on string literals.
   */
  var noCharByIndex = ('x'[0] + Object('x')[0]) != 'xx';

  /**
   * Detect if a node's [[Class]] is unresolvable (IE < 9)
   * and that the JS engine won't error when attempting to coerce an object to
   * a string without a `toString` property value of `typeof` "function".
   */
  try {
    var noNodeClass = ({ 'toString': 0 } + '', toString.call(document) == objectClass);
  } catch(e) { }

  /**
   * Detect if sourceURL syntax is usable without erroring:
   *
   * The JS engine embedded in Adobe products will throw a syntax error when
   * it encounters a single line comment beginning with the `@` symbol.
   *
   * The JS engine in Narwhal will generate the function `function anonymous(){//}`
   * and throw a syntax error.
   *
   * Avoid comments beginning `@` symbols in IE because they are part of its
   * non-standard conditional compilation support.
   * http://msdn.microsoft.com/en-us/library/121hztk3(v=vs.94).aspx
   */
  try {
    var useSourceURL = (Function('//@')(), !isIeOpera);
  } catch(e) { }

  /** Used to identify object classifications that `_.clone` supports */
  var cloneableClasses = {};
  cloneableClasses[funcClass] = false;
  cloneableClasses[argsClass] = cloneableClasses[arrayClass] =
  cloneableClasses[boolClass] = cloneableClasses[dateClass] =
  cloneableClasses[numberClass] = cloneableClasses[objectClass] =
  cloneableClasses[regexpClass] = cloneableClasses[stringClass] = true;

  /** Used to lookup a built-in constructor by [[Class]] */
  var ctorByClass = {};
  ctorByClass[arrayClass] = Array;
  ctorByClass[boolClass] = Boolean;
  ctorByClass[dateClass] = Date;
  ctorByClass[objectClass] = Object;
  ctorByClass[numberClass] = Number;
  ctorByClass[regexpClass] = RegExp;
  ctorByClass[stringClass] = String;

  /** Used to determine if values are of the language type Object */
  var objectTypes = {
    'boolean': false,
    'function': true,
    'object': true,
    'number': false,
    'string': false,
    'undefined': false
  };

  /** Used to escape characters for inclusion in compiled string literals */
  var stringEscapes = {
    '\\': '\\',
    "'": "'",
    '\n': 'n',
    '\r': 'r',
    '\t': 't',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  /*--------------------------------------------------------------------------*/

  /**
   * Creates a `lodash` object, that wraps the given `value`, to enable
   * method chaining.
   *
   * The chainable wrapper functions are:
   * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`, `compose`,
   * `concat`, `countBy`, `debounce`, `defaults`, `defer`, `delay`, `difference`,
   * `filter`, `flatten`, `forEach`, `forIn`, `forOwn`, `functions`, `groupBy`,
   * `initial`, `intersection`, `invert`, `invoke`, `keys`, `map`, `max`, `memoize`,
   * `merge`, `min`, `object`, `omit`, `once`, `pairs`, `partial`, `pick`, `pluck`,
   * `push`, `range`, `reject`, `rest`, `reverse`, `shuffle`, `slice`, `sort`,
   * `sortBy`, `splice`, `tap`, `throttle`, `times`, `toArray`, `union`, `uniq`,
   * `unshift`, `values`, `where`, `without`, `wrap`, and `zip`
   *
   * The non-chainable wrapper functions are:
   * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `has`, `identity`,
   * `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`, `isElement`, `isEmpty`,
   * `isEqual`, `isFinite`, `isFunction`, `isNaN`, `isNull`, `isNumber`, `isObject`,
   * `isPlainObject`, `isRegExp`, `isString`, `isUndefined`, `join`, `lastIndexOf`,
   * `mixin`, `noConflict`, `pop`, `random`, `reduce`, `reduceRight`, `result`,
   * `shift`, `size`, `some`, `sortedIndex`, `template`, `unescape`, and `uniqueId`
   *
   * The wrapper functions `first` and `last` return wrapped values when `n` is
   * passed, otherwise they return unwrapped values.
   *
   * @name _
   * @constructor
   * @category Chaining
   * @param {Mixed} value The value to wrap in a `lodash` instance.
   * @returns {Object} Returns a `lodash` instance.
   */
  function lodash(value) {
    // exit early if already wrapped, even if wrapped by a different `lodash` constructor
    if (value && typeof value == 'object' && value.__wrapped__) {
      return value;
    }
    // allow invoking `lodash` without the `new` operator
    if (!(this instanceof lodash)) {
      return new lodash(value);
    }
    this.__wrapped__ = value;
  }

  /**
   * By default, the template delimiters used by Lo-Dash are similar to those in
   * embedded Ruby (ERB). Change the following template settings to use alternative
   * delimiters.
   *
   * @static
   * @memberOf _
   * @type Object
   */
  lodash.templateSettings = {

    /**
     * Used to detect `data` property values to be HTML-escaped.
     *
     * @static
     * @memberOf _.templateSettings
     * @type RegExp
     */
    'escape': /<%-([\s\S]+?)%>/g,

    /**
     * Used to detect code to be evaluated.
     *
     * @static
     * @memberOf _.templateSettings
     * @type RegExp
     */
    'evaluate': /<%([\s\S]+?)%>/g,

    /**
     * Used to detect `data` property values to inject.
     *
     * @static
     * @memberOf _.templateSettings
     * @type RegExp
     */
    'interpolate': reInterpolate,

    /**
     * Used to reference the data object in the template text.
     *
     * @static
     * @memberOf _.templateSettings
     * @type String
     */
    'variable': ''
  };

  /*--------------------------------------------------------------------------*/

  /**
   * The template used to create iterator functions.
   *
   * @private
   * @param {Obect} data The data object used to populate the text.
   * @returns {String} Returns the interpolated text.
   */
  var iteratorTemplate = template(
    // conditional strict mode
    "<% if (obj.useStrict) { %>'use strict';\n<% } %>" +

    // the `iteratee` may be reassigned by the `top` snippet
    'var index, iteratee = <%= firstArg %>, ' +
    // assign the `result` variable an initial value
    'result = <%= firstArg %>;\n' +
    // exit early if the first argument is falsey
    'if (!<%= firstArg %>) return result;\n' +
    // add code before the iteration branches
    '<%= top %>;\n' +

    // array-like iteration:
    '<% if (arrayLoop) { %>' +
    'var length = iteratee.length; index = -1;\n' +
    "if (typeof length == 'number') {" +

    // add support for accessing string characters by index if needed
    '  <% if (noCharByIndex) { %>\n' +
    '  if (isString(iteratee)) {\n' +
    "    iteratee = iteratee.split('')\n" +
    '  }' +
    '  <% } %>\n' +

    // iterate over the array-like value
    '  while (++index < length) {\n' +
    '    <%= arrayLoop %>\n' +
    '  }\n' +
    '}\n' +
    'else {' +

    // object iteration:
    // add support for iterating over `arguments` objects if needed
    '  <%  } else if (nonEnumArgs) { %>\n' +
    '  var length = iteratee.length; index = -1;\n' +
    '  if (length && isArguments(iteratee)) {\n' +
    '    while (++index < length) {\n' +
    "      index += '';\n" +
    '      <%= objectLoop %>\n' +
    '    }\n' +
    '  } else {' +
    '  <% } %>' +

    // Firefox < 3.6, Opera > 9.50 - Opera < 11.60, and Safari < 5.1
    // (if the prototype or a property on the prototype has been set)
    // incorrectly sets a function's `prototype` property [[Enumerable]]
    // value to `true`. Because of this Lo-Dash standardizes on skipping
    // the the `prototype` property of functions regardless of its
    // [[Enumerable]] value.
    '  <% if (!hasDontEnumBug) { %>\n' +
    "  var skipProto = typeof iteratee == 'function' && \n" +
    "    propertyIsEnumerable.call(iteratee, 'prototype');\n" +
    '  <% } %>' +

    // iterate own properties using `Object.keys` if it's fast
    '  <% if (isKeysFast && useHas) { %>\n' +
    '  var ownIndex = -1,\n' +
    '      ownProps = objectTypes[typeof iteratee] ? nativeKeys(iteratee) : [],\n' +
    '      length = ownProps.length;\n\n' +
    '  while (++ownIndex < length) {\n' +
    '    index = ownProps[ownIndex];\n' +
    "    <% if (!hasDontEnumBug) { %>if (!(skipProto && index == 'prototype')) {\n  <% } %>" +
    '    <%= objectLoop %>\n' +
    '    <% if (!hasDontEnumBug) { %>}\n<% } %>' +
    '  }' +

    // else using a for-in loop
    '  <% } else { %>\n' +
    '  for (index in iteratee) {<%' +
    '    if (!hasDontEnumBug || useHas) { %>\n    if (<%' +
    "      if (!hasDontEnumBug) { %>!(skipProto && index == 'prototype')<% }" +
    '      if (!hasDontEnumBug && useHas) { %> && <% }' +
    '      if (useHas) { %>hasOwnProperty.call(iteratee, index)<% }' +
    '    %>) {' +
    '    <% } %>\n' +
    '    <%= objectLoop %>;' +
    '    <% if (!hasDontEnumBug || useHas) { %>\n    }<% } %>\n' +
    '  }' +
    '  <% } %>' +

    // Because IE < 9 can't set the `[[Enumerable]]` attribute of an
    // existing property and the `constructor` property of a prototype
    // defaults to non-enumerable, Lo-Dash skips the `constructor`
    // property when it infers it's iterating over a `prototype` object.
    '  <% if (hasDontEnumBug) { %>\n\n' +
    '  var ctor = iteratee.constructor;\n' +
    '    <% for (var k = 0; k < 7; k++) { %>\n' +
    "  index = '<%= shadowed[k] %>';\n" +
    '  if (<%' +
    "      if (shadowed[k] == 'constructor') {" +
    '        %>!(ctor && ctor.prototype === iteratee) && <%' +
    '      } %>hasOwnProperty.call(iteratee, index)) {\n' +
    '    <%= objectLoop %>\n' +
    '  }' +
    '    <% } %>' +
    '  <% } %>' +
    '  <% if (arrayLoop || nonEnumArgs) { %>\n}<% } %>\n' +

    // add code to the bottom of the iteration function
    '<%= bottom %>;\n' +
    // finally, return the `result`
    'return result'
  );

  /** Reusable iterator options for `assign` and `defaults` */
  var assignIteratorOptions = {
    'args': 'object, source, guard',
    'top':
      "for (var argsIndex = 1, argsLength = typeof guard == 'number' ? 2 : arguments.length; argsIndex < argsLength; argsIndex++) {\n" +
      '  if ((iteratee = arguments[argsIndex])) {',
    'objectLoop': 'result[index] = iteratee[index]',
    'bottom': '  }\n}'
  };

  /**
   * Reusable iterator options shared by `each`, `forIn`, and `forOwn`.
   */
  var eachIteratorOptions = {
    'args': 'collection, callback, thisArg',
    'top': "callback = callback && typeof thisArg == 'undefined' ? callback : createCallback(callback, thisArg)",
    'arrayLoop': 'if (callback(iteratee[index], index, collection) === false) return result',
    'objectLoop': 'if (callback(iteratee[index], index, collection) === false) return result'
  };

  /** Reusable iterator options for `forIn` and `forOwn` */
  var forOwnIteratorOptions = {
    'arrayLoop': null
  };

  /*--------------------------------------------------------------------------*/

  /**
   * Creates a function optimized to search large arrays for a given `value`,
   * starting at `fromIndex`, using strict equality for comparisons, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to search.
   * @param {Mixed} value The value to search for.
   * @param {Number} [fromIndex=0] The index to search from.
   * @param {Number} [largeSize=30] The length at which an array is considered large.
   * @returns {Boolean} Returns `true` if `value` is found, else `false`.
   */
  function cachedContains(array, fromIndex, largeSize) {
    fromIndex || (fromIndex = 0);

    var length = array.length,
        isLarge = (length - fromIndex) >= (largeSize || largeArraySize);

    if (isLarge) {
      var cache = {},
          index = fromIndex - 1;

      while (++index < length) {
        // manually coerce `value` to a string because `hasOwnProperty`, in some
        // older versions of Firefox, coerces objects incorrectly
        var key = array[index] + '';
        (hasOwnProperty.call(cache, key) ? cache[key] : (cache[key] = [])).push(array[index]);
      }
    }
    return function(value) {
      if (isLarge) {
        var key = value + '';
        return hasOwnProperty.call(cache, key) && indexOf(cache[key], value) > -1;
      }
      return indexOf(array, value, fromIndex) > -1;
    }
  }

  /**
   * Used by `_.max` and `_.min` as the default `callback` when a given
   * `collection` is a string value.
   *
   * @private
   * @param {String} value The character to inspect.
   * @returns {Number} Returns the code unit of given character.
   */
  function charAtCallback(value) {
    return value.charCodeAt(0);
  }

  /**
   * Used by `sortBy` to compare transformed `collection` values, stable sorting
   * them in ascending order.
   *
   * @private
   * @param {Object} a The object to compare to `b`.
   * @param {Object} b The object to compare to `a`.
   * @returns {Number} Returns the sort order indicator of `1` or `-1`.
   */
  function compareAscending(a, b) {
    var ai = a.index,
        bi = b.index;

    a = a.criteria;
    b = b.criteria;

    // ensure a stable sort in V8 and other engines
    // http://code.google.com/p/v8/issues/detail?id=90
    if (a !== b) {
      if (a > b || typeof a == 'undefined') {
        return 1;
      }
      if (a < b || typeof b == 'undefined') {
        return -1;
      }
    }
    return ai < bi ? -1 : 1;
  }

  /**
   * Creates a function that, when called, invokes `func` with the `this`
   * binding of `thisArg` and prepends any `partailArgs` to the arguments passed
   * to the bound function.
   *
   * @private
   * @param {Function|String} func The function to bind or the method name.
   * @param {Mixed} [thisArg] The `this` binding of `func`.
   * @param {Array} partialArgs An array of arguments to be partially applied.
   * @returns {Function} Returns the new bound function.
   */
  function createBound(func, thisArg, partialArgs) {
    var isFunc = isFunction(func),
        isPartial = !partialArgs,
        key = thisArg;

    // juggle arguments
    if (isPartial) {
      partialArgs = thisArg;
    }
    if (!isFunc) {
      thisArg = func;
    }

    function bound() {
      // `Function#bind` spec
      // http://es5.github.com/#x15.3.4.5
      var args = arguments,
          thisBinding = isPartial ? this : thisArg;

      if (!isFunc) {
        func = thisArg[key];
      }
      if (partialArgs.length) {
        args = args.length
          ? partialArgs.concat(slice(args))
          : partialArgs;
      }
      if (this instanceof bound) {
        // ensure `new bound` is an instance of `bound` and `func`
        noop.prototype = func.prototype;
        thisBinding = new noop;
        noop.prototype = null;

        // mimic the constructor's `return` behavior
        // http://es5.github.com/#x13.2.2
        var result = func.apply(thisBinding, args);
        return isObject(result) ? result : thisBinding;
      }
      return func.apply(thisBinding, args);
    }
    return bound;
  }

  /**
   * Produces an iteration callback bound to an optional `thisArg`. If `func` is
   * a property name, the callback will return the property value for a given element.
   *
   * @private
   * @param {Function|String} [func=identity|property] The function called per
   * iteration or property name to query.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @param {Object} [accumulating] Used to indicate that the callback should
   *  accept an `accumulator` argument.
   * @returns {Function} Returns a callback function.
   */
  function createCallback(func, thisArg, accumulating) {
    if (!func) {
      return identity;
    }
    if (typeof func != 'function') {
      return function(object) {
        return object[func];
      };
    }
    if (typeof thisArg != 'undefined') {
      if (accumulating) {
        return function(accumulator, value, index, object) {
          return func.call(thisArg, accumulator, value, index, object);
        };
      }
      return function(value, index, object) {
        return func.call(thisArg, value, index, object);
      };
    }
    return func;
  }

  /**
   * Creates compiled iteration functions.
   *
   * @private
   * @param {Object} [options1, options2, ...] The compile options object(s).
   *  useHas - A boolean to specify using `hasOwnProperty` checks in the object loop.
   *  args - A string of comma separated arguments the iteration function will accept.
   *  top - A string of code to execute before the iteration branches.
   *  arrayLoop - A string of code to execute in the array loop.
   *  objectLoop - A string of code to execute in the object loop.
   *  bottom - A string of code to execute after the iteration branches.
   *
   * @returns {Function} Returns the compiled function.
   */
  function createIterator() {
    var data = {
      'arrayLoop': '',
      'bottom': '',
      'hasDontEnumBug': hasDontEnumBug,
      'isKeysFast': isKeysFast,
      'objectLoop': '',
      'nonEnumArgs': nonEnumArgs,
      'noCharByIndex': noCharByIndex,
      'shadowed': shadowed,
      'top': '',
      'useHas': true
    };

    // merge options into a template data object
    for (var object, index = 0; object = arguments[index]; index++) {
      for (var key in object) {
        data[key] = object[key];
      }
    }
    var args = data.args;
    data.firstArg = /^[^,]+/.exec(args)[0];

    // create the function factory
    var factory = Function(
        'createCallback, hasOwnProperty, isArguments, isString, objectTypes, ' +
        'nativeKeys, propertyIsEnumerable',
      'return function(' + args + ') {\n' + iteratorTemplate(data) + '\n}'
    );
    // return the compiled function
    return factory(
      createCallback, hasOwnProperty, isArguments, isString, objectTypes,
      nativeKeys, propertyIsEnumerable
    );
  }

  /**
   * A function compiled to iterate `arguments` objects, arrays, objects, and
   * strings consistenly across environments, executing the `callback` for each
   * element in the `collection`. The `callback` is bound to `thisArg` and invoked
   * with three arguments; (value, index|key, collection). Callbacks may exit
   * iteration early by explicitly returning `false`.
   *
   * @private
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array|Object|String} Returns `collection`.
   */
  var each = createIterator(eachIteratorOptions);

  /**
   * Used by `template` to escape characters for inclusion in compiled
   * string literals.
   *
   * @private
   * @param {String} match The matched character to escape.
   * @returns {String} Returns the escaped character.
   */
  function escapeStringChar(match) {
    return '\\' + stringEscapes[match];
  }

  /**
   * Used by `escape` to convert characters to HTML entities.
   *
   * @private
   * @param {String} match The matched character to escape.
   * @returns {String} Returns the escaped character.
   */
  function escapeHtmlChar(match) {
    return htmlEscapes[match];
  }

  /**
   * Checks if `value` is a DOM node in IE < 9.
   *
   * @private
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a DOM node, else `false`.
   */
  function isNode(value) {
    // IE < 9 presents DOM nodes as `Object` objects except they have `toString`
    // methods that are `typeof` "string" and still can coerce nodes to strings
    return typeof value.toString != 'function' && typeof (value + '') == 'string';
  }

  /**
   * A no-operation function.
   *
   * @private
   */
  function noop() {
    // no operation performed
  }

  /**
   * Slices the `collection` from the `start` index up to, but not including,
   * the `end` index.
   *
   * Note: This function is used, instead of `Array#slice`, to support node lists
   * in IE < 9 and to ensure dense arrays are returned.
   *
   * @private
   * @param {Array|Object|String} collection The collection to slice.
   * @param {Number} start The start index.
   * @param {Number} end The end index.
   * @returns {Array} Returns the new array.
   */
  function slice(array, start, end) {
    start || (start = 0);
    if (typeof end == 'undefined') {
      end = array ? array.length : 0;
    }
    var index = -1,
        length = end - start || 0,
        result = Array(length < 0 ? 0 : length);

    while (++index < length) {
      result[index] = array[start + index];
    }
    return result;
  }

  /**
   * Used by `unescape` to convert HTML entities to characters.
   *
   * @private
   * @param {String} match The matched character to unescape.
   * @returns {String} Returns the unescaped character.
   */
  function unescapeHtmlChar(match) {
    return htmlUnescapes[match];
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Assigns own enumerable properties of source object(s) to the `destination`
   * object. Subsequent sources will overwrite propery assignments of previous
   * sources.
   *
   * @static
   * @memberOf _
   * @alias extend
   * @category Objects
   * @param {Object} object The destination object.
   * @param {Object} [source1, source2, ...] The source objects.
   * @returns {Object} Returns the destination object.
   * @example
   *
   * _.assign({ 'name': 'moe' }, { 'age': 40 });
   * // => { 'name': 'moe', 'age': 40 }
   */
  var assign = createIterator(assignIteratorOptions);

  /**
   * Checks if `value` is an `arguments` object.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is an `arguments` object, else `false`.
   * @example
   *
   * (function() { return _.isArguments(arguments); })(1, 2, 3);
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */
  function isArguments(value) {
    return toString.call(value) == argsClass;
  }
  // fallback for browsers that can't detect `arguments` objects by [[Class]]
  if (noArgsClass) {
    isArguments = function(value) {
      return value ? hasOwnProperty.call(value, 'callee') : false;
    };
  }

  /**
   * Iterates over `object`'s own and inherited enumerable properties, executing
   * the `callback` for each property. The `callback` is bound to `thisArg` and
   * invoked with three arguments; (value, key, object). Callbacks may exit iteration
   * early by explicitly returning `false`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns `object`.
   * @example
   *
   * function Dog(name) {
   *   this.name = name;
   * }
   *
   * Dog.prototype.bark = function() {
   *   alert('Woof, woof!');
   * };
   *
   * _.forIn(new Dog('Dagny'), function(value, key) {
   *   alert(key);
   * });
   * // => alerts 'name' and 'bark' (order is not guaranteed)
   */
  var forIn = createIterator(eachIteratorOptions, forOwnIteratorOptions, {
    'useHas': false
  });

  /**
   * Iterates over an object's own enumerable properties, executing the `callback`
   * for each property. The `callback` is bound to `thisArg` and invoked with three
   * arguments; (value, key, object). Callbacks may exit iteration early by explicitly
   * returning `false`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns `object`.
   * @example
   *
   * _.forOwn({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {
   *   alert(key);
   * });
   * // => alerts '0', '1', and 'length' (order is not guaranteed)
   */
  var forOwn = createIterator(eachIteratorOptions, forOwnIteratorOptions);

  /**
   * A fallback implementation of `isPlainObject` that checks if a given `value`
   * is an object created by the `Object` constructor, assuming objects created
   * by the `Object` constructor have no inherited enumerable properties and that
   * there are no `Object.prototype` extensions.
   *
   * @private
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if `value` is a plain object, else `false`.
   */
  function shimIsPlainObject(value) {
    // avoid non-objects and false positives for `arguments` objects
    var result = false;
    if (!(value && typeof value == 'object') || isArguments(value)) {
      return result;
    }
    // check that the constructor is `Object` (i.e. `Object instanceof Object`)
    var ctor = value.constructor;
    if ((!isFunction(ctor) && (!noNodeClass || !isNode(value))) || ctor instanceof ctor) {
      // IE < 9 iterates inherited properties before own properties. If the first
      // iterated property is an object's own property then there are no inherited
      // enumerable properties.
      if (iteratesOwnLast) {
        forIn(value, function(value, key, object) {
          result = !hasOwnProperty.call(object, key);
          return false;
        });
        return result === false;
      }
      // In most environments an object's own properties are iterated before
      // its inherited properties. If the last iterated property is an object's
      // own property then there are no inherited enumerable properties.
      forIn(value, function(value, key) {
        result = key;
      });
      return result === false || hasOwnProperty.call(value, result);
    }
    return result;
  }

  /**
   * A fallback implementation of `Object.keys` that produces an array of the
   * given object's own enumerable property names.
   *
   * @private
   * @param {Object} object The object to inspect.
   * @returns {Array} Returns a new array of property names.
   */
  function shimKeys(object) {
    var result = [];
    forOwn(object, function(value, key) {
      result.push(key);
    });
    return result;
  }

  /**
   * Used to convert characters to HTML entities:
   *
   * Though the `>` character is escaped for symmetry, characters like `>` and `/`
   * don't require escaping in HTML and have no special meaning unless they're part
   * of a tag or an unquoted attribute value.
   * http://mathiasbynens.be/notes/ambiguous-ampersands (under "semi-related fun fact")
   */
  var htmlEscapes = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#x27;'
  };

  /** Used to convert HTML entities to characters */
  var htmlUnescapes = invert(htmlEscapes);

  /*--------------------------------------------------------------------------*/

  /**
   * Creates a clone of `value`. If `deep` is `true`, nested objects will also
   * be cloned, otherwise they will be assigned by reference.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to clone.
   * @param {Boolean} deep A flag to indicate a deep clone.
   * @param- {Object} [guard] Internally used to allow this method to work with
   *  others like `_.map` without using their callback `index` argument for `deep`.
   * @param- {Array} [stackA=[]] Internally used to track traversed source objects.
   * @param- {Array} [stackB=[]] Internally used to associate clones with their
   *  source counterparts.
   * @returns {Mixed} Returns the cloned `value`.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe', 'age': 40 },
   *   { 'name': 'larry', 'age': 50 },
   *   { 'name': 'curly', 'age': 60 }
   * ];
   *
   * var shallow = _.clone(stooges);
   * shallow[0] === stooges[0];
   * // => true
   *
   * var deep = _.clone(stooges, true);
   * deep[0] === stooges[0];
   * // => false
   */
  function clone(value, deep, guard, stackA, stackB) {
    if (value == null) {
      return value;
    }
    if (guard) {
      deep = false;
    }
    // inspect [[Class]]
    var isObj = isObject(value);
    if (isObj) {
      var className = toString.call(value);
      if (!cloneableClasses[className] || (noNodeClass && isNode(value))) {
        return value;
      }
      var isArr = isArray(value);
    }
    // shallow clone
    if (!isObj || !deep) {
      return isObj
        ? (isArr ? slice(value) : assign({}, value))
        : value;
    }
    var ctor = ctorByClass[className];
    switch (className) {
      case boolClass:
      case dateClass:
        return new ctor(+value);

      case numberClass:
      case stringClass:
        return new ctor(value);

      case regexpClass:
        return ctor(value.source, reFlags.exec(value));
    }
    // check for circular references and return corresponding clone
    stackA || (stackA = []);
    stackB || (stackB = []);

    var length = stackA.length;
    while (length--) {
      if (stackA[length] == value) {
        return stackB[length];
      }
    }
    // init cloned object
    var result = isArr ? ctor(value.length) : {};

    // add the source value to the stack of traversed objects
    // and associate it with its clone
    stackA.push(value);
    stackB.push(result);

    // recursively populate clone (susceptible to call stack limits)
    (isArr ? forEach : forOwn)(value, function(objValue, key) {
      result[key] = clone(objValue, deep, null, stackA, stackB);
    });

    // add array properties assigned by `RegExp#exec`
    if (isArr) {
      if (hasOwnProperty.call(value, 'index')) {
        result.index = value.index;
      }
      if (hasOwnProperty.call(value, 'input')) {
        result.input = value.input;
      }
    }
    return result;
  }

  /**
   * Creates a deep clone of `value`. Functions and DOM nodes are **not** cloned.
   * The enumerable properties of `arguments` objects and objects created by
   * constructors other than `Object` are cloned to plain `Object` objects.
   *
   * Note: This function is loosely based on the structured clone algorithm.
   * See http://www.w3.org/TR/html5/common-dom-interfaces.html#internal-structured-cloning-algorithm.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to deep clone.
   * @returns {Mixed} Returns the deep cloned `value`.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe', 'age': 40 },
   *   { 'name': 'larry', 'age': 50 },
   *   { 'name': 'curly', 'age': 60 }
   * ];
   *
   * var deep = _.cloneDeep(stooges);
   * deep[0] === stooges[0];
   * // => false
   */
  function cloneDeep(value) {
    return clone(value, true);
  }

  /**
   * Assigns own enumerable properties of source object(s) to the `destination`
   * object for all `destination` properties that resolve to `null`/`undefined`.
   * Once a property is set, additional defaults of the same property will be
   * ignored.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The destination object.
   * @param {Object} [default1, default2, ...] The default objects.
   * @returns {Object} Returns the destination object.
   * @example
   *
   * var iceCream = { 'flavor': 'chocolate' };
   * _.defaults(iceCream, { 'flavor': 'vanilla', 'sprinkles': 'rainbow' });
   * // => { 'flavor': 'chocolate', 'sprinkles': 'rainbow' }
   */
  var defaults = createIterator(assignIteratorOptions, {
    'objectLoop': 'if (result[index] == null) ' + assignIteratorOptions.objectLoop
  });

  /**
   * Creates a sorted array of all enumerable properties, own and inherited,
   * of `object` that have function values.
   *
   * @static
   * @memberOf _
   * @alias methods
   * @category Objects
   * @param {Object} object The object to inspect.
   * @returns {Array} Returns a new array of property names that have function values.
   * @example
   *
   * _.functions(_);
   * // => ['all', 'any', 'bind', 'bindAll', 'clone', 'compact', 'compose', ...]
   */
  function functions(object) {
    var result = [];
    forIn(object, function(value, key) {
      if (isFunction(value)) {
        result.push(key);
      }
    });
    return result.sort();
  }

  /**
   * Checks if the specified object `property` exists and is a direct property,
   * instead of an inherited property.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to check.
   * @param {String} property The property to check for.
   * @returns {Boolean} Returns `true` if key is a direct property, else `false`.
   * @example
   *
   * _.has({ 'a': 1, 'b': 2, 'c': 3 }, 'b');
   * // => true
   */
  function has(object, property) {
    return object ? hasOwnProperty.call(object, property) : false;
  }

  /**
   * Creates an object composed of the inverted keys and values of the given `object`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to invert.
   * @returns {Object} Returns the created inverted object.
   * @example
   *
   *  _.invert({ 'first': 'Moe', 'second': 'Larry', 'third': 'Curly' });
   * // => { 'Moe': 'first', 'Larry': 'second', 'Curly': 'third' } (order is not guaranteed)
   */
  function invert(object) {
    var result = {};
    forOwn(object, function(value, key) {
      result[value] = key;
    });
    return result;
  }

  /**
   * Checks if `value` is an array.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is an array, else `false`.
   * @example
   *
   * (function() { return _.isArray(arguments); })();
   * // => false
   *
   * _.isArray([1, 2, 3]);
   * // => true
   */
  var isArray = nativeIsArray || function(value) {
    // `instanceof` may cause a memory leak in IE 7 if `value` is a host object
    // http://ajaxian.com/archives/working-aroung-the-instanceof-memory-leak
    return (argsAreObjects && value instanceof Array) || toString.call(value) == arrayClass;
  };

  /**
   * Checks if `value` is a boolean (`true` or `false`) value.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a boolean value, else `false`.
   * @example
   *
   * _.isBoolean(null);
   * // => false
   */
  function isBoolean(value) {
    return value === true || value === false || toString.call(value) == boolClass;
  }

  /**
   * Checks if `value` is a date.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a date, else `false`.
   * @example
   *
   * _.isDate(new Date);
   * // => true
   */
  function isDate(value) {
    return value instanceof Date || toString.call(value) == dateClass;
  }

  /**
   * Checks if `value` is a DOM element.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a DOM element, else `false`.
   * @example
   *
   * _.isElement(document.body);
   * // => true
   */
  function isElement(value) {
    return value ? value.nodeType === 1 : false;
  }

  /**
   * Checks if `value` is empty. Arrays, strings, or `arguments` objects with a
   * length of `0` and objects with no own enumerable properties are considered
   * "empty".
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Array|Object|String} value The value to inspect.
   * @returns {Boolean} Returns `true` if the `value` is empty, else `false`.
   * @example
   *
   * _.isEmpty([1, 2, 3]);
   * // => false
   *
   * _.isEmpty({});
   * // => true
   *
   * _.isEmpty('');
   * // => true
   */
  function isEmpty(value) {
    var result = true;
    if (!value) {
      return result;
    }
    var className = toString.call(value),
        length = value.length;

    if ((className == arrayClass || className == stringClass ||
        className == argsClass || (noArgsClass && isArguments(value))) ||
        (className == objectClass && typeof length == 'number' && isFunction(value.splice))) {
      return !length;
    }
    forOwn(value, function() {
      return (result = false);
    });
    return result;
  }

  /**
   * Performs a deep comparison between two values to determine if they are
   * equivalent to each other.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} a The value to compare.
   * @param {Mixed} b The other value to compare.
   * @param- {Object} [stackA=[]] Internally used track traversed `a` objects.
   * @param- {Object} [stackB=[]] Internally used track traversed `b` objects.
   * @returns {Boolean} Returns `true` if the values are equvalent, else `false`.
   * @example
   *
   * var moe = { 'name': 'moe', 'luckyNumbers': [13, 27, 34] };
   * var clone = { 'name': 'moe', 'luckyNumbers': [13, 27, 34] };
   *
   * moe == clone;
   * // => false
   *
   * _.isEqual(moe, clone);
   * // => true
   */
  function isEqual(a, b, stackA, stackB) {
    // exit early for identical values
    if (a === b) {
      // treat `+0` vs. `-0` as not equal
      return a !== 0 || (1 / a == 1 / b);
    }
    // a strict comparison is necessary because `null == undefined`
    if (a == null || b == null) {
      return a === b;
    }
    // compare [[Class]] names
    var className = toString.call(a),
        otherName = toString.call(b);

    if (className == argsClass) {
      className = objectClass;
    }
    if (otherName == argsClass) {
      otherName = objectClass;
    }
    if (className != otherName) {
      return false;
    }
    switch (className) {
      case boolClass:
      case dateClass:
        // coerce dates and booleans to numbers, dates to milliseconds and booleans
        // to `1` or `0`, treating invalid dates coerced to `NaN` as not equal
        return +a == +b;

      case numberClass:
        // treat `NaN` vs. `NaN` as equal
        return a != +a
          ? b != +b
          // but treat `+0` vs. `-0` as not equal
          : (a == 0 ? (1 / a == 1 / b) : a == +b);

      case regexpClass:
      case stringClass:
        // coerce regexes to strings (http://es5.github.com/#x15.10.6.4)
        // treat string primitives and their corresponding object instances as equal
        return a == b + '';
    }
    var isArr = className == arrayClass;
    if (!isArr) {
      // unwrap any `lodash` wrapped values
      if (a.__wrapped__ || b.__wrapped__) {
        return isEqual(a.__wrapped__ || a, b.__wrapped__ || b);
      }
      // exit for functions and DOM nodes
      if (className != objectClass || (noNodeClass && (isNode(a) || isNode(b)))) {
        return false;
      }
      // in older versions of Opera, `arguments` objects have `Array` constructors
      var ctorA = !argsAreObjects && isArguments(a) ? Object : a.constructor,
          ctorB = !argsAreObjects && isArguments(b) ? Object : b.constructor;

      // non `Object` object instances with different constructors are not equal
      if (ctorA != ctorB && !(
            isFunction(ctorA) && ctorA instanceof ctorA &&
            isFunction(ctorB) && ctorB instanceof ctorB
          )) {
        return false;
      }
    }
    // assume cyclic structures are equal
    // the algorithm for detecting cyclic structures is adapted from ES 5.1
    // section 15.12.3, abstract operation `JO` (http://es5.github.com/#x15.12.3)
    stackA || (stackA = []);
    stackB || (stackB = []);

    var length = stackA.length;
    while (length--) {
      if (stackA[length] == a) {
        return stackB[length] == b;
      }
    }
    var index = -1,
        result = true,
        size = 0;

    // add `a` and `b` to the stack of traversed objects
    stackA.push(a);
    stackB.push(b);

    // recursively compare objects and arrays (susceptible to call stack limits)
    if (isArr) {
      // compare lengths to determine if a deep comparison is necessary
      size = a.length;
      result = size == b.length;

      if (result) {
        // deep compare the contents, ignoring non-numeric properties
        while (size--) {
          if (!(result = isEqual(a[size], b[size], stackA, stackB))) {
            break;
          }
        }
      }
      return result;
    }
    // deep compare objects using `forIn`, instead of `forOwn`, to avoid `Object.keys`
    // which, in this case, is more costly
    forIn(a, function(value, key, a) {
      if (hasOwnProperty.call(a, key)) {
        // count the number of properties.
        size++;
        // deep compare each property value.
        return (result = hasOwnProperty.call(b, key) && isEqual(value, b[key], stackA, stackB));
      }
    });

    if (result) {
      // ensure both objects have the same number of properties
      forIn(b, function(value, key, b) {
        if (hasOwnProperty.call(b, key)) {
          // `size` will be `-1` if `b` has more properties than `a`
          return (result = --size > -1);
        }
      });
    }
    return result;
  }

  /**
   * Checks if `value` is, or can be coerced to, a finite number.
   *
   * Note: This is not the same as native `isFinite`, which will return true for
   * booleans and empty strings. See http://es5.github.com/#x15.1.2.5.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a finite number, else `false`.
   * @example
   *
   * _.isFinite(-101);
   * // => true
   *
   * _.isFinite('10');
   * // => true
   *
   * _.isFinite(true);
   * // => false
   *
   * _.isFinite('');
   * // => false
   *
   * _.isFinite(Infinity);
   * // => false
   */
  function isFinite(value) {
    return nativeIsFinite(value) && !nativeIsNaN(parseFloat(value));
  }

  /**
   * Checks if `value` is a function.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   */
  function isFunction(value) {
    return typeof value == 'function';
  }
  // fallback for older versions of Chrome and Safari
  if (isFunction(/x/)) {
    isFunction = function(value) {
      return value instanceof Function || toString.call(value) == funcClass;
    };
  }

  /**
   * Checks if `value` is the language type of Object.
   * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(1);
   * // => false
   */
  function isObject(value) {
    // check if the value is the ECMAScript language type of Object
    // http://es5.github.com/#x8
    // and avoid a V8 bug
    // http://code.google.com/p/v8/issues/detail?id=2291
    return value ? objectTypes[typeof value] : false;
  }

  /**
   * Checks if `value` is `NaN`.
   *
   * Note: This is not the same as native `isNaN`, which will return `true` for
   * `undefined` and other values. See http://es5.github.com/#x15.1.2.4.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is `NaN`, else `false`.
   * @example
   *
   * _.isNaN(NaN);
   * // => true
   *
   * _.isNaN(new Number(NaN));
   * // => true
   *
   * isNaN(undefined);
   * // => true
   *
   * _.isNaN(undefined);
   * // => false
   */
  function isNaN(value) {
    // `NaN` as a primitive is the only value that is not equal to itself
    // (perform the [[Class]] check first to avoid errors with some host objects in IE)
    return isNumber(value) && value != +value
  }

  /**
   * Checks if `value` is `null`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is `null`, else `false`.
   * @example
   *
   * _.isNull(null);
   * // => true
   *
   * _.isNull(undefined);
   * // => false
   */
  function isNull(value) {
    return value === null;
  }

  /**
   * Checks if `value` is a number.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a number, else `false`.
   * @example
   *
   * _.isNumber(8.4 * 5);
   * // => true
   */
  function isNumber(value) {
    return typeof value == 'number' || toString.call(value) == numberClass;
  }

  /**
   * Checks if a given `value` is an object created by the `Object` constructor.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if `value` is a plain object, else `false`.
   * @example
   *
   * function Stooge(name, age) {
   *   this.name = name;
   *   this.age = age;
   * }
   *
   * _.isPlainObject(new Stooge('moe', 40));
   * // => false
   *
   * _.isPlainObject([1, 2, 3]);
   * // => false
   *
   * _.isPlainObject({ 'name': 'moe', 'age': 40 });
   * // => true
   */
  var isPlainObject = !getPrototypeOf ? shimIsPlainObject : function(value) {
    if (!(value && typeof value == 'object')) {
      return false;
    }
    var valueOf = value.valueOf,
        objProto = typeof valueOf == 'function' && (objProto = getPrototypeOf(valueOf)) && getPrototypeOf(objProto);

    return objProto
      ? value == objProto || (getPrototypeOf(value) == objProto && !isArguments(value))
      : shimIsPlainObject(value);
  };

  /**
   * Checks if `value` is a regular expression.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a regular expression, else `false`.
   * @example
   *
   * _.isRegExp(/moe/);
   * // => true
   */
  function isRegExp(value) {
    return value instanceof RegExp || toString.call(value) == regexpClass;
  }

  /**
   * Checks if `value` is a string.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is a string, else `false`.
   * @example
   *
   * _.isString('moe');
   * // => true
   */
  function isString(value) {
    return typeof value == 'string' || toString.call(value) == stringClass;
  }

  /**
   * Checks if `value` is `undefined`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Mixed} value The value to check.
   * @returns {Boolean} Returns `true` if the `value` is `undefined`, else `false`.
   * @example
   *
   * _.isUndefined(void 0);
   * // => true
   */
  function isUndefined(value) {
    return typeof value == 'undefined';
  }

  /**
   * Creates an array composed of the own enumerable property names of `object`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to inspect.
   * @returns {Array} Returns a new array of property names.
   * @example
   *
   * _.keys({ 'one': 1, 'two': 2, 'three': 3 });
   * // => ['one', 'two', 'three'] (order is not guaranteed)
   */
  var keys = !nativeKeys ? shimKeys : function(object) {
    // avoid iterating over the `prototype` property
    return typeof object == 'function' && propertyIsEnumerable.call(object, 'prototype')
      ? shimKeys(object)
      : (isObject(object) ? nativeKeys(object) : []);
  };

  /**
   * Merges enumerable properties of the source object(s) into the `destination`
   * object. Subsequent sources will overwrite propery assignments of previous
   * sources.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The destination object.
   * @param {Object} [source1, source2, ...] The source objects.
   * @param- {Object} [indicator] Internally used to indicate that the `stack`
   *  argument is an array of traversed objects instead of another source object.
   * @param- {Array} [stackA=[]] Internally used to track traversed source objects.
   * @param- {Array} [stackB=[]] Internally used to associate values with their
   *  source counterparts.
   * @returns {Object} Returns the destination object.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe' },
   *   { 'name': 'larry' }
   * ];
   *
   * var ages = [
   *   { 'age': 40 },
   *   { 'age': 50 }
   * ];
   *
   * _.merge(stooges, ages);
   * // => [{ 'name': 'moe', 'age': 40 }, { 'name': 'larry', 'age': 50 }]
   */
  function merge(object, source, indicator) {
    var args = arguments,
        index = 0,
        length = 2,
        stackA = args[3],
        stackB = args[4];

    if (indicator !== indicatorObject) {
      stackA = [];
      stackB = [];

      // work with `_.reduce` by only using its callback `accumulator` and `value` arguments
      if (typeof indicator != 'number') {
        length = args.length;
      }
    }
    while (++index < length) {
      forOwn(args[index], function(source, key) {
        var found, isArr, value;
        if (source && ((isArr = isArray(source)) || isPlainObject(source))) {
          // avoid merging previously merged cyclic sources
          var stackLength = stackA.length;
          while (stackLength--) {
            found = stackA[stackLength] == source;
            if (found) {
              break;
            }
          }
          if (found) {
            object[key] = stackB[stackLength];
          }
          else {
            // add `source` and associated `value` to the stack of traversed objects
            stackA.push(source);
            stackB.push(value = (value = object[key], isArr)
              ? (isArray(value) ? value : [])
              : (isPlainObject(value) ? value : {})
            );
            // recursively merge objects and arrays (susceptible to call stack limits)
            object[key] = merge(value, source, indicatorObject, stackA, stackB);
          }
        } else if (source != null) {
          object[key] = source;
        }
      });
    }
    return object;
  }

  /**
   * Creates a shallow clone of `object` excluding the specified properties.
   * Property names may be specified as individual arguments or as arrays of
   * property names. If `callback` is passed, it will be executed for each property
   * in the `object`, omitting the properties `callback` returns truthy for. The
   * `callback` is bound to `thisArg` and invoked with three arguments; (value, key, object).
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The source object.
   * @param {Function|String} callback|[prop1, prop2, ...] The properties to omit
   *  or the function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns an object without the omitted properties.
   * @example
   *
   * _.omit({ 'name': 'moe', 'age': 40, 'userid': 'moe1' }, 'userid');
   * // => { 'name': 'moe', 'age': 40 }
   *
   * _.omit({ 'name': 'moe', '_hint': 'knucklehead', '_seed': '96c4eb' }, function(value, key) {
   *   return key.charAt(0) == '_';
   * });
   * // => { 'name': 'moe' }
   */
  function omit(object, callback, thisArg) {
    var isFunc = typeof callback == 'function',
        result = {};

    if (isFunc) {
      callback = createCallback(callback, thisArg);
    } else {
      var props = concat.apply(arrayRef, arguments);
    }
    forIn(object, function(value, key, object) {
      if (isFunc
            ? !callback(value, key, object)
            : indexOf(props, key, 1) < 0
          ) {
        result[key] = value;
      }
    });
    return result;
  }

  /**
   * Creates a two dimensional array of the given object's key-value pairs,
   * i.e. `[[key1, value1], [key2, value2]]`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to inspect.
   * @returns {Array} Returns new array of key-value pairs.
   * @example
   *
   * _.pairs({ 'moe': 30, 'larry': 40, 'curly': 50 });
   * // => [['moe', 30], ['larry', 40], ['curly', 50]] (order is not guaranteed)
   */
  function pairs(object) {
    var result = [];
    forOwn(object, function(value, key) {
      result.push([key, value]);
    });
    return result;
  }

  /**
   * Creates a shallow clone of `object` composed of the specified properties.
   * Property names may be specified as individual arguments or as arrays of
   * property names. If `callback` is passed, it will be executed for each property
   * in the `object`, picking the properties `callback` returns truthy for. The
   * `callback` is bound to `thisArg` and invoked with three arguments; (value, key, object).
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The source object.
   * @param {Function|String} callback|[prop1, prop2, ...] The properties to pick
   *  or the function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns an object composed of the picked properties.
   * @example
   *
   * _.pick({ 'name': 'moe', 'age': 40, 'userid': 'moe1' }, 'name', 'age');
   * // => { 'name': 'moe', 'age': 40 }
   *
   * _.pick({ 'name': 'moe', '_hint': 'knucklehead', '_seed': '96c4eb' }, function(value, key) {
   *   return key.charAt(0) != '_';
   * });
   * // => { 'name': 'moe' }
   */
  function pick(object, callback, thisArg) {
    var result = {};
    if (typeof callback != 'function') {
      var index = 0,
          props = concat.apply(arrayRef, arguments),
          length = props.length;

      while (++index < length) {
        var key = props[index];
        if (key in object) {
          result[key] = object[key];
        }
      }
    } else {
      callback = createCallback(callback, thisArg);
      forIn(object, function(value, key, object) {
        if (callback(value, key, object)) {
          result[key] = value;
        }
      });
    }
    return result;
  }

  /**
   * Creates an array composed of the own enumerable property values of `object`.
   *
   * @static
   * @memberOf _
   * @category Objects
   * @param {Object} object The object to inspect.
   * @returns {Array} Returns a new array of property values.
   * @example
   *
   * _.values({ 'one': 1, 'two': 2, 'three': 3 });
   * // => [1, 2, 3]
   */
  function values(object) {
    var result = [];
    forOwn(object, function(value) {
      result.push(value);
    });
    return result;
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Checks if a given `target` element is present in a `collection` using strict
   * equality for comparisons, i.e. `===`. If `fromIndex` is negative, it is used
   * as the offset from the end of the collection.
   *
   * @static
   * @memberOf _
   * @alias include
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Mixed} target The value to check for.
   * @param {Number} [fromIndex=0] The index to search from.
   * @returns {Boolean} Returns `true` if the `target` element is found, else `false`.
   * @example
   *
   * _.contains([1, 2, 3], 1);
   * // => true
   *
   * _.contains([1, 2, 3], 1, 2);
   * // => false
   *
   * _.contains({ 'name': 'moe', 'age': 40 }, 'moe');
   * // => true
   *
   * _.contains('curly', 'ur');
   * // => true
   */
  function contains(collection, target, fromIndex) {
    var index = -1,
        length = collection ? collection.length : 0,
        result = false;

    fromIndex = (fromIndex < 0 ? nativeMax(0, length + fromIndex) : fromIndex) || 0;
    if (typeof length == 'number') {
      result = (isString(collection)
        ? collection.indexOf(target, fromIndex)
        : indexOf(collection, target, fromIndex)
      ) > -1;
    } else {
      each(collection, function(value) {
        if (++index >= fromIndex) {
          return !(result = value === target);
        }
      });
    }
    return result;
  }

  /**
   * Creates an object composed of keys returned from running each element of
   * `collection` through a `callback`. The corresponding value of each key is
   * the number of times the key was returned by `callback`. The `callback` is
   * bound to `thisArg` and invoked with three arguments; (value, index|key, collection).
   * The `callback` argument may also be the name of a property to count by (e.g. 'length').
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function|String} callback|property The function called per iteration
   *  or property name to count by.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns the composed aggregate object.
   * @example
   *
   * _.countBy([4.3, 6.1, 6.4], function(num) { return Math.floor(num); });
   * // => { '4': 1, '6': 2 }
   *
   * _.countBy([4.3, 6.1, 6.4], function(num) { return this.floor(num); }, Math);
   * // => { '4': 1, '6': 2 }
   *
   * _.countBy(['one', 'two', 'three'], 'length');
   * // => { '3': 2, '5': 1 }
   */
  function countBy(collection, callback, thisArg) {
    var result = {};
    callback = createCallback(callback, thisArg);

    forEach(collection, function(value, key, collection) {
      key = callback(value, key, collection);
      (hasOwnProperty.call(result, key) ? result[key]++ : result[key] = 1);
    });
    return result;
  }

  /**
   * Checks if the `callback` returns a truthy value for **all** elements of a
   * `collection`. The `callback` is bound to `thisArg` and invoked with three
   * arguments; (value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias all
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Boolean} Returns `true` if all elements pass the callback check,
   *  else `false`.
   * @example
   *
   * _.every([true, 1, null, 'yes'], Boolean);
   * // => false
   */
  function every(collection, callback, thisArg) {
    var result = true;
    callback = createCallback(callback, thisArg);

    if (isArray(collection)) {
      var index = -1,
          length = collection.length;

      while (++index < length) {
        if (!(result = !!callback(collection[index], index, collection))) {
          break;
        }
      }
    } else {
      each(collection, function(value, index, collection) {
        return (result = !!callback(value, index, collection));
      });
    }
    return result;
  }

  /**
   * Examines each element in a `collection`, returning an array of all elements
   * the `callback` returns truthy for. The `callback` is bound to `thisArg` and
   * invoked with three arguments; (value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias select
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a new array of elements that passed the callback check.
   * @example
   *
   * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
   * // => [2, 4, 6]
   */
  function filter(collection, callback, thisArg) {
    var result = [];
    callback = createCallback(callback, thisArg);

    if (isArray(collection)) {
      var index = -1,
          length = collection.length;

      while (++index < length) {
        var value = collection[index];
        if (callback(value, index, collection)) {
          result.push(value);
        }
      }
    } else {
      each(collection, function(value, index, collection) {
        if (callback(value, index, collection)) {
          result.push(value);
        }
      });
    }
    return result;
  }

  /**
   * Examines each element in a `collection`, returning the first one the `callback`
   * returns truthy for. The function returns as soon as it finds an acceptable
   * element, and does not iterate over the entire `collection`. The `callback` is
   * bound to `thisArg` and invoked with three arguments; (value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias detect
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Mixed} Returns the element that passed the callback check,
   *  else `undefined`.
   * @example
   *
   * var even = _.find([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
   * // => 2
   */
  function find(collection, callback, thisArg) {
    var result;
    callback = createCallback(callback, thisArg);

    forEach(collection, function(value, index, collection) {
      if (callback(value, index, collection)) {
        result = value;
        return false;
      }
    });
    return result;
  }

  /**
   * Iterates over a `collection`, executing the `callback` for each element in
   * the `collection`. The `callback` is bound to `thisArg` and invoked with three
   * arguments; (value, index|key, collection). Callbacks may exit iteration early
   * by explicitly returning `false`.
   *
   * @static
   * @memberOf _
   * @alias each
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array|Object|String} Returns `collection`.
   * @example
   *
   * _([1, 2, 3]).forEach(alert).join(',');
   * // => alerts each number and returns '1,2,3'
   *
   * _.forEach({ 'one': 1, 'two': 2, 'three': 3 }, alert);
   * // => alerts each number value (order is not guaranteed)
   */
  function forEach(collection, callback, thisArg) {
    if (callback && typeof thisArg == 'undefined' && isArray(collection)) {
      var index = -1,
          length = collection.length;

      while (++index < length) {
        if (callback(collection[index], index, collection) === false) {
          break;
        }
      }
    } else {
      each(collection, callback, thisArg);
    }
    return collection;
  }

  /**
   * Creates an object composed of keys returned from running each element of
   * `collection` through a `callback`. The corresponding value of each key is an
   * array of elements passed to `callback` that returned the key. The `callback`
   * is bound to `thisArg` and invoked with three arguments; (value, index|key, collection).
   * The `callback` argument may also be the name of a property to group by (e.g. 'length').
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function|String} callback|property The function called per iteration
   *  or property name to group by.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Object} Returns the composed aggregate object.
   * @example
   *
   * _.groupBy([4.2, 6.1, 6.4], function(num) { return Math.floor(num); });
   * // => { '4': [4.2], '6': [6.1, 6.4] }
   *
   * _.groupBy([4.2, 6.1, 6.4], function(num) { return this.floor(num); }, Math);
   * // => { '4': [4.2], '6': [6.1, 6.4] }
   *
   * _.groupBy(['one', 'two', 'three'], 'length');
   * // => { '3': ['one', 'two'], '5': ['three'] }
   */
  function groupBy(collection, callback, thisArg) {
    var result = {};
    callback = createCallback(callback, thisArg);

    forEach(collection, function(value, key, collection) {
      key = callback(value, key, collection);
      (hasOwnProperty.call(result, key) ? result[key] : result[key] = []).push(value);
    });
    return result;
  }

  /**
   * Invokes the method named by `methodName` on each element in the `collection`,
   * returning an array of the results of each invoked method. Additional arguments
   * will be passed to each invoked method. If `methodName` is a function it will
   * be invoked for, and `this` bound to, each element in the `collection`.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function|String} methodName The name of the method to invoke or
   *  the function invoked per iteration.
   * @param {Mixed} [arg1, arg2, ...] Arguments to invoke the method with.
   * @returns {Array} Returns a new array of the results of each invoked method.
   * @example
   *
   * _.invoke([[5, 1, 7], [3, 2, 1]], 'sort');
   * // => [[1, 5, 7], [1, 2, 3]]
   *
   * _.invoke([123, 456], String.prototype.split, '');
   * // => [['1', '2', '3'], ['4', '5', '6']]
   */
  function invoke(collection, methodName) {
    var args = slice(arguments, 2),
        isFunc = typeof methodName == 'function',
        result = [];

    forEach(collection, function(value) {
      result.push((isFunc ? methodName : value[methodName]).apply(value, args));
    });
    return result;
  }

  /**
   * Creates an array of values by running each element in the `collection`
   * through a `callback`. The `callback` is bound to `thisArg` and invoked with
   * three arguments; (value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias collect
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a new array of the results of each `callback` execution.
   * @example
   *
   * _.map([1, 2, 3], function(num) { return num * 3; });
   * // => [3, 6, 9]
   *
   * _.map({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { return num * 3; });
   * // => [3, 6, 9] (order is not guaranteed)
   */
  function map(collection, callback, thisArg) {
    var index = -1,
        length = collection ? collection.length : 0,
        result = Array(typeof length == 'number' ? length : 0);

    callback = createCallback(callback, thisArg);
    if (isArray(collection)) {
      while (++index < length) {
        result[index] = callback(collection[index], index, collection);
      }
    } else {
      each(collection, function(value, key, collection) {
        result[++index] = callback(value, key, collection);
      });
    }
    return result;
  }

  /**
   * Retrieves the maximum value of an `array`. If `callback` is passed,
   * it will be executed for each value in the `array` to generate the
   * criterion by which the value is ranked. The `callback` is bound to
   * `thisArg` and invoked with three arguments; (value, index, collection).
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Mixed} Returns the maximum value.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe', 'age': 40 },
   *   { 'name': 'larry', 'age': 50 },
   *   { 'name': 'curly', 'age': 60 }
   * ];
   *
   * _.max(stooges, function(stooge) { return stooge.age; });
   * // => { 'name': 'curly', 'age': 60 };
   */
  function max(collection, callback, thisArg) {
    var computed = -Infinity,
        index = -1,
        length = collection ? collection.length : 0,
        result = computed;

    if (callback || !isArray(collection)) {
      callback = !callback && isString(collection)
        ? charAtCallback
        : createCallback(callback, thisArg);

      each(collection, function(value, index, collection) {
        var current = callback(value, index, collection);
        if (current > computed) {
          computed = current;
          result = value;
        }
      });
    } else {
      while (++index < length) {
        if (collection[index] > result) {
          result = collection[index];
        }
      }
    }
    return result;
  }

  /**
   * Retrieves the minimum value of an `array`. If `callback` is passed,
   * it will be executed for each value in the `array` to generate the
   * criterion by which the value is ranked. The `callback` is bound to `thisArg`
   * and invoked with three arguments; (value, index, collection).
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Mixed} Returns the minimum value.
   * @example
   *
   * _.min([10, 5, 100, 2, 1000]);
   * // => 2
   */
  function min(collection, callback, thisArg) {
    var computed = Infinity,
        index = -1,
        length = collection ? collection.length : 0,
        result = computed;

    if (callback || !isArray(collection)) {
      callback = !callback && isString(collection)
        ? charAtCallback
        : createCallback(callback, thisArg);

      each(collection, function(value, index, collection) {
        var current = callback(value, index, collection);
        if (current < computed) {
          computed = current;
          result = value;
        }
      });
    } else {
      while (++index < length) {
        if (collection[index] < result) {
          result = collection[index];
        }
      }
    }
    return result;
  }

  /**
   * Retrieves the value of a specified property from all elements in
   * the `collection`.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {String} property The property to pluck.
   * @returns {Array} Returns a new array of property values.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe', 'age': 40 },
   *   { 'name': 'larry', 'age': 50 },
   *   { 'name': 'curly', 'age': 60 }
   * ];
   *
   * _.pluck(stooges, 'name');
   * // => ['moe', 'larry', 'curly']
   */
  function pluck(collection, property) {
    return map(collection, property + '');
  }

  /**
   * Boils down a `collection` to a single value. The initial state of the
   * reduction is `accumulator` and each successive step of it should be returned
   * by the `callback`. The `callback` is bound to `thisArg` and invoked with 4
   * arguments; for arrays they are (accumulator, value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias foldl, inject
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [accumulator] Initial value of the accumulator.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Mixed} Returns the accumulated value.
   * @example
   *
   * var sum = _.reduce([1, 2, 3], function(memo, num) { return memo + num; });
   * // => 6
   */
  function reduce(collection, callback, accumulator, thisArg) {
    var noaccum = arguments.length < 3;
    callback = createCallback(callback, thisArg, indicatorObject);

    if (isArray(collection)) {
      var index = -1,
          length = collection.length;

      if (noaccum) {
        accumulator = collection[++index];
      }
      while (++index < length) {
        accumulator = callback(accumulator, collection[index], index, collection);
      }
    } else {
      each(collection, function(value, index, collection) {
        accumulator = noaccum
          ? (noaccum = false, value)
          : callback(accumulator, value, index, collection)
      });
    }
    return accumulator;
  }

  /**
   * The right-associative version of `_.reduce`.
   *
   * @static
   * @memberOf _
   * @alias foldr
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [accumulator] Initial value of the accumulator.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Mixed} Returns the accumulated value.
   * @example
   *
   * var list = [[0, 1], [2, 3], [4, 5]];
   * var flat = _.reduceRight(list, function(a, b) { return a.concat(b); }, []);
   * // => [4, 5, 2, 3, 0, 1]
   */
  function reduceRight(collection, callback, accumulator, thisArg) {
    var iteratee = collection,
        length = collection ? collection.length : 0,
        noaccum = arguments.length < 3;

    if (typeof length != 'number') {
      var props = keys(collection);
      length = props.length;
    } else if (noCharByIndex && isString(collection)) {
      iteratee = collection.split('');
    }
    callback = createCallback(callback, thisArg, indicatorObject);
    forEach(collection, function(value, index, collection) {
      index = props ? props[--length] : --length;
      accumulator = noaccum
        ? (noaccum = false, iteratee[index])
        : callback(accumulator, iteratee[index], index, collection);
    });
    return accumulator;
  }

  /**
   * The opposite of `_.filter`, this method returns the values of a
   * `collection` that `callback` does **not** return truthy for.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a new array of elements that did **not** pass the
   *  callback check.
   * @example
   *
   * var odds = _.reject([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
   * // => [1, 3, 5]
   */
  function reject(collection, callback, thisArg) {
    callback = createCallback(callback, thisArg);
    return filter(collection, function(value, index, collection) {
      return !callback(value, index, collection);
    });
  }

  /**
   * Creates an array of shuffled `array` values, using a version of the
   * Fisher-Yates shuffle. See http://en.wikipedia.org/wiki/Fisher-Yates_shuffle.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to shuffle.
   * @returns {Array} Returns a new shuffled collection.
   * @example
   *
   * _.shuffle([1, 2, 3, 4, 5, 6]);
   * // => [4, 1, 6, 3, 5, 2]
   */
  function shuffle(collection) {
    var index = -1,
        result = Array(collection ? collection.length : 0);

    forEach(collection, function(value) {
      var rand = floor(nativeRandom() * (++index + 1));
      result[index] = result[rand];
      result[rand] = value;
    });
    return result;
  }

  /**
   * Gets the size of the `collection` by returning `collection.length` for arrays
   * and array-like objects or the number of own enumerable properties for objects.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to inspect.
   * @returns {Number} Returns `collection.length` or number of own enumerable properties.
   * @example
   *
   * _.size([1, 2]);
   * // => 2
   *
   * _.size({ 'one': 1, 'two': 2, 'three': 3 });
   * // => 3
   *
   * _.size('curly');
   * // => 5
   */
  function size(collection) {
    var length = collection ? collection.length : 0;
    return typeof length == 'number' ? length : keys(collection).length;
  }

  /**
   * Checks if the `callback` returns a truthy value for **any** element of a
   * `collection`. The function returns as soon as it finds passing value, and
   * does not iterate over the entire `collection`. The `callback` is bound to
   * `thisArg` and invoked with three arguments; (value, index|key, collection).
   *
   * @static
   * @memberOf _
   * @alias any
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Boolean} Returns `true` if any element passes the callback check,
   *  else `false`.
   * @example
   *
   * _.some([null, 0, 'yes', false], Boolean);
   * // => true
   */
  function some(collection, callback, thisArg) {
    var result;
    callback = createCallback(callback, thisArg);

    if (isArray(collection)) {
      var index = -1,
          length = collection.length;

      while (++index < length) {
        if ((result = callback(collection[index], index, collection))) {
          break;
        }
      }
    } else {
      each(collection, function(value, index, collection) {
        return !(result = callback(value, index, collection));
      });
    }
    return !!result;
  }

  /**
   * Creates an array, stable sorted in ascending order by the results of
   * running each element of `collection` through a `callback`. The `callback`
   * is bound to `thisArg` and invoked with three arguments; (value, index|key, collection).
   * The `callback` argument may also be the name of a property to sort by (e.g. 'length').
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Function|String} callback|property The function called per iteration
   *  or property name to sort by.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a new array of sorted elements.
   * @example
   *
   * _.sortBy([1, 2, 3], function(num) { return Math.sin(num); });
   * // => [3, 1, 2]
   *
   * _.sortBy([1, 2, 3], function(num) { return this.sin(num); }, Math);
   * // => [3, 1, 2]
   *
   * _.sortBy(['larry', 'brendan', 'moe'], 'length');
   * // => ['moe', 'larry', 'brendan']
   */
  function sortBy(collection, callback, thisArg) {
    var result = [];
    callback = createCallback(callback, thisArg);

    forEach(collection, function(value, index, collection) {
      result.push({
        'criteria': callback(value, index, collection),
        'index': index,
        'value': value
      });
    });

    var length = result.length;
    result.sort(compareAscending);
    while (length--) {
      result[length] = result[length].value;
    }
    return result;
  }

  /**
   * Converts the `collection` to an array.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to convert.
   * @returns {Array} Returns the new converted array.
   * @example
   *
   * (function() { return _.toArray(arguments).slice(1); })(1, 2, 3, 4);
   * // => [2, 3, 4]
   */
  function toArray(collection) {
    var length = collection ? collection.length : 0;
    if (typeof length == 'number') {
      return noCharByIndex && isString(collection)
        ? collection.split('')
        : slice(collection);
    }
    return values(collection);
  }

  /**
   * Examines each element in a `collection`, returning an array of all elements
   * that contain the given `properties`.
   *
   * @static
   * @memberOf _
   * @category Collections
   * @param {Array|Object|String} collection The collection to iterate over.
   * @param {Object} properties The object of property values to filter by.
   * @returns {Array} Returns a new array of elements that contain the given `properties`.
   * @example
   *
   * var stooges = [
   *   { 'name': 'moe', 'age': 40 },
   *   { 'name': 'larry', 'age': 50 },
   *   { 'name': 'curly', 'age': 60 }
   * ];
   *
   * _.where(stooges, { 'age': 40 });
   * // => [{ 'name': 'moe', 'age': 40 }]
   */
  function where(collection, properties) {
    var props = keys(properties);
    return filter(collection, function(object) {
      var length = props.length;
      while (length--) {
        var result = object[props[length]] === properties[props[length]];
        if (!result) {
          break;
        }
      }
      return !!result;
    });
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Creates an array with all falsey values of `array` removed. The values
   * `false`, `null`, `0`, `""`, `undefined` and `NaN` are all falsey.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to compact.
   * @returns {Array} Returns a new filtered array.
   * @example
   *
   * _.compact([0, 1, false, 2, '', 3]);
   * // => [1, 2, 3]
   */
  function compact(array) {
    var index = -1,
        length = array ? array.length : 0,
        result = [];

    while (++index < length) {
      var value = array[index];
      if (value) {
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Creates an array of `array` elements not present in the other arrays
   * using strict equality for comparisons, i.e. `===`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to process.
   * @param {Array} [array1, array2, ...] Arrays to check.
   * @returns {Array} Returns a new array of `array` elements not present in the
   *  other arrays.
   * @example
   *
   * _.difference([1, 2, 3, 4, 5], [5, 2, 10]);
   * // => [1, 3, 4]
   */
  function difference(array) {
    var index = -1,
        length = array ? array.length : 0,
        flattened = concat.apply(arrayRef, arguments),
        contains = cachedContains(flattened, length),
        result = [];

    while (++index < length) {
      var value = array[index];
      if (!contains(value)) {
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Gets the first element of the `array`. Pass `n` to return the first `n`
   * elements of the `array`.
   *
   * @static
   * @memberOf _
   * @alias head, take
   * @category Arrays
   * @param {Array} array The array to query.
   * @param {Number} [n] The number of elements to return.
   * @param- {Object} [guard] Internally used to allow this method to work with
   *  others like `_.map` without using their callback `index` argument for `n`.
   * @returns {Mixed} Returns the first element, or an array of the first `n`
   *  elements, of `array`.
   * @example
   *
   * _.first([5, 4, 3, 2, 1]);
   * // => 5
   */
  function first(array, n, guard) {
    if (array) {
      var length = array.length;
      return (n == null || guard)
        ? array[0]
        : slice(array, 0, nativeMin(nativeMax(0, n), length));
    }
  }

  /**
   * Flattens a nested array (the nesting can be to any depth). If `shallow` is
   * truthy, `array` will only be flattened a single level.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to compact.
   * @param {Boolean} shallow A flag to indicate only flattening a single level.
   * @returns {Array} Returns a new flattened array.
   * @example
   *
   * _.flatten([1, [2], [3, [[4]]]]);
   * // => [1, 2, 3, 4];
   *
   * _.flatten([1, [2], [3, [[4]]]], true);
   * // => [1, 2, 3, [[4]]];
   */
  function flatten(array, shallow) {
    var index = -1,
        length = array ? array.length : 0,
        result = [];

    while (++index < length) {
      var value = array[index];

      // recursively flatten arrays (susceptible to call stack limits)
      if (isArray(value)) {
        push.apply(result, shallow ? value : flatten(value));
      } else {
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Gets the index at which the first occurrence of `value` is found using
   * strict equality for comparisons, i.e. `===`. If the `array` is already
   * sorted, passing `true` for `fromIndex` will run a faster binary search.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to search.
   * @param {Mixed} value The value to search for.
   * @param {Boolean|Number} [fromIndex=0] The index to search from or `true` to
   *  perform a binary search on a sorted `array`.
   * @returns {Number} Returns the index of the matched value or `-1`.
   * @example
   *
   * _.indexOf([1, 2, 3, 1, 2, 3], 2);
   * // => 1
   *
   * _.indexOf([1, 2, 3, 1, 2, 3], 2, 3);
   * // => 4
   *
   * _.indexOf([1, 1, 2, 2, 3, 3], 2, true);
   * // => 2
   */
  function indexOf(array, value, fromIndex) {
    var index = -1,
        length = array ? array.length : 0;

    if (typeof fromIndex == 'number') {
      index = (fromIndex < 0 ? nativeMax(0, length + fromIndex) : fromIndex || 0) - 1;
    } else if (fromIndex) {
      index = sortedIndex(array, value);
      return array[index] === value ? index : -1;
    }
    while (++index < length) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * Gets all but the last element of `array`. Pass `n` to exclude the last `n`
   * elements from the result.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to query.
   * @param {Number} [n=1] The number of elements to exclude.
   * @param- {Object} [guard] Internally used to allow this method to work with
   *  others like `_.map` without using their callback `index` argument for `n`.
   * @returns {Array} Returns all but the last element, or `n` elements, of `array`.
   * @example
   *
   * _.initial([3, 2, 1]);
   * // => [3, 2]
   */
  function initial(array, n, guard) {
    if (!array) {
      return [];
    }
    var length = array.length;
    n = n == null || guard ? 1 : n || 0;
    return slice(array, 0, nativeMin(nativeMax(0, length - n), length));
  }

  /**
   * Computes the intersection of all the passed-in arrays using strict equality
   * for comparisons, i.e. `===`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} [array1, array2, ...] Arrays to process.
   * @returns {Array} Returns a new array of unique elements that are present
   *  in **all** of the arrays.
   * @example
   *
   * _.intersection([1, 2, 3], [101, 2, 1, 10], [2, 1]);
   * // => [1, 2]
   */
  function intersection(array) {
    var args = arguments,
        argsLength = args.length,
        cache = { '0': {} },
        index = -1,
        length = array ? array.length : 0,
        isLarge = length >= 100,
        result = [],
        seen = result;

    outer:
    while (++index < length) {
      var value = array[index];
      if (isLarge) {
        var key = value + '';
        var inited = hasOwnProperty.call(cache[0], key)
          ? !(seen = cache[0][key])
          : (seen = cache[0][key] = []);
      }
      if (inited || indexOf(seen, value) < 0) {
        if (isLarge) {
          seen.push(value);
        }
        var argsIndex = argsLength;
        while (--argsIndex) {
          if (!(cache[argsIndex] || (cache[argsIndex] = cachedContains(args[argsIndex], 0, 100)))(value)) {
            continue outer;
          }
        }
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Gets the last element of the `array`. Pass `n` to return the last `n`
   * elements of the `array`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to query.
   * @param {Number} [n] The number of elements to return.
   * @param- {Object} [guard] Internally used to allow this method to work with
   *  others like `_.map` without using their callback `index` argument for `n`.
   * @returns {Mixed} Returns the last element, or an array of the last `n`
   *  elements, of `array`.
   * @example
   *
   * _.last([3, 2, 1]);
   * // => 1
   */
  function last(array, n, guard) {
    if (array) {
      var length = array.length;
      return (n == null || guard) ? array[length - 1] : slice(array, nativeMax(0, length - n));
    }
  }

  /**
   * Gets the index at which the last occurrence of `value` is found using strict
   * equality for comparisons, i.e. `===`. If `fromIndex` is negative, it is used
   * as the offset from the end of the collection.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to search.
   * @param {Mixed} value The value to search for.
   * @param {Number} [fromIndex=array.length-1] The index to search from.
   * @returns {Number} Returns the index of the matched value or `-1`.
   * @example
   *
   * _.lastIndexOf([1, 2, 3, 1, 2, 3], 2);
   * // => 4
   *
   * _.lastIndexOf([1, 2, 3, 1, 2, 3], 2, 3);
   * // => 1
   */
  function lastIndexOf(array, value, fromIndex) {
    var index = array ? array.length : 0;
    if (typeof fromIndex == 'number') {
      index = (fromIndex < 0 ? nativeMax(0, index + fromIndex) : nativeMin(fromIndex, index - 1)) + 1;
    }
    while (index--) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * Creates an object composed from arrays of `keys` and `values`. Pass either
   * a single two dimensional array, i.e. `[[key1, value1], [key2, value2]]`, or
   * two arrays, one of `keys` and one of corresponding `values`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} keys The array of keys.
   * @param {Array} [values=[]] The array of values.
   * @returns {Object} Returns an object composed of the given keys and
   *  corresponding values.
   * @example
   *
   * _.object(['moe', 'larry', 'curly'], [30, 40, 50]);
   * // => { 'moe': 30, 'larry': 40, 'curly': 50 }
   */
  function object(keys, values) {
    var index = -1,
        length = keys ? keys.length : 0,
        result = {};

    while (++index < length) {
      var key = keys[index];
      if (values) {
        result[key] = values[index];
      } else {
        result[key[0]] = key[1];
      }
    }
    return result;
  }

  /**
   * Creates an array of numbers (positive and/or negative) progressing from
   * `start` up to but not including `stop`. This method is a port of Python's
   * `range()` function. See http://docs.python.org/library/functions.html#range.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Number} [start=0] The start of the range.
   * @param {Number} end The end of the range.
   * @param {Number} [step=1] The value to increment or descrement by.
   * @returns {Array} Returns a new range array.
   * @example
   *
   * _.range(10);
   * // => [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
   *
   * _.range(1, 11);
   * // => [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
   *
   * _.range(0, 30, 5);
   * // => [0, 5, 10, 15, 20, 25]
   *
   * _.range(0, -10, -1);
   * // => [0, -1, -2, -3, -4, -5, -6, -7, -8, -9]
   *
   * _.range(0);
   * // => []
   */
  function range(start, end, step) {
    start = +start || 0;
    step = +step || 1;

    if (end == null) {
      end = start;
      start = 0;
    }
    // use `Array(length)` so V8 will avoid the slower "dictionary" mode
    // http://youtu.be/XAqIpGU8ZZk#t=17m25s
    var index = -1,
        length = nativeMax(0, ceil((end - start) / step)),
        result = Array(length);

    while (++index < length) {
      result[index] = start;
      start += step;
    }
    return result;
  }

  /**
   * The opposite of `_.initial`, this method gets all but the first value of
   * `array`. Pass `n` to exclude the first `n` values from the result.
   *
   * @static
   * @memberOf _
   * @alias drop, tail
   * @category Arrays
   * @param {Array} array The array to query.
   * @param {Number} [n=1] The number of elements to exclude.
   * @param- {Object} [guard] Internally used to allow this method to work with
   *  others like `_.map` without using their callback `index` argument for `n`.
   * @returns {Array} Returns all but the first element, or `n` elements, of `array`.
   * @example
   *
   * _.rest([3, 2, 1]);
   * // => [2, 1]
   */
  function rest(array, n, guard) {
    return slice(array, (n == null || guard) ? 1 : nativeMax(0, n));
  }

  /**
   * Uses a binary search to determine the smallest index at which the `value`
   * should be inserted into `array` in order to maintain the sort order of the
   * sorted `array`. If `callback` is passed, it will be executed for `value` and
   * each element in `array` to compute their sort ranking. The `callback` is
   * bound to `thisArg` and invoked with one argument; (value). The `callback`
   * argument may also be the name of a property to order by.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to iterate over.
   * @param {Mixed} value The value to evaluate.
   * @param {Function|String} [callback=identity|property] The function called
   *  per iteration or property name to order by.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Number} Returns the index at which the value should be inserted
   *  into `array`.
   * @example
   *
   * _.sortedIndex([20, 30, 50], 40);
   * // => 2
   *
   * _.sortedIndex([{ 'x': 20 }, { 'x': 30 }, { 'x': 50 }], { 'x': 40 }, 'x');
   * // => 2
   *
   * var dict = {
   *   'wordToNumber': { 'twenty': 20, 'thirty': 30, 'fourty': 40, 'fifty': 50 }
   * };
   *
   * _.sortedIndex(['twenty', 'thirty', 'fifty'], 'fourty', function(word) {
   *   return dict.wordToNumber[word];
   * });
   * // => 2
   *
   * _.sortedIndex(['twenty', 'thirty', 'fifty'], 'fourty', function(word) {
   *   return this.wordToNumber[word];
   * }, dict);
   * // => 2
   */
  function sortedIndex(array, value, callback, thisArg) {
    var low = 0,
        high = array ? array.length : low;

    // explicitly reference `identity` for better inlining in Firefox
    callback = callback ? createCallback(callback, thisArg) : identity;
    value = callback(value);

    while (low < high) {
      var mid = (low + high) >>> 1;
      callback(array[mid]) < value
        ? low = mid + 1
        : high = mid;
    }
    return low;
  }

  /**
   * Computes the union of the passed-in arrays using strict equality for
   * comparisons, i.e. `===`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} [array1, array2, ...] Arrays to process.
   * @returns {Array} Returns a new array of unique values, in order, that are
   *  present in one or more of the arrays.
   * @example
   *
   * _.union([1, 2, 3], [101, 2, 1, 10], [2, 1]);
   * // => [1, 2, 3, 101, 10]
   */
  function union() {
    return uniq(concat.apply(arrayRef, arguments));
  }

  /**
   * Creates a duplicate-value-free version of the `array` using strict equality
   * for comparisons, i.e. `===`. If the `array` is already sorted, passing `true`
   * for `isSorted` will run a faster algorithm. If `callback` is passed, each
   * element of `array` is passed through a callback` before uniqueness is computed.
   * The `callback` is bound to `thisArg` and invoked with three arguments; (value, index, array).
   *
   * @static
   * @memberOf _
   * @alias unique
   * @category Arrays
   * @param {Array} array The array to process.
   * @param {Boolean} [isSorted=false] A flag to indicate that the `array` is already sorted.
   * @param {Function} [callback=identity] The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a duplicate-value-free array.
   * @example
   *
   * _.uniq([1, 2, 1, 3, 1]);
   * // => [1, 2, 3]
   *
   * _.uniq([1, 1, 2, 2, 3], true);
   * // => [1, 2, 3]
   *
   * _.uniq([1, 2, 1.5, 3, 2.5], function(num) { return Math.floor(num); });
   * // => [1, 2, 3]
   *
   * _.uniq([1, 2, 1.5, 3, 2.5], function(num) { return this.floor(num); }, Math);
   * // => [1, 2, 3]
   */
  function uniq(array, isSorted, callback, thisArg) {
    var index = -1,
        length = array ? array.length : 0,
        result = [],
        seen = result;

    // juggle arguments
    if (typeof isSorted == 'function') {
      thisArg = callback;
      callback = isSorted;
      isSorted = false;
    }
    // init value cache for large arrays
    var isLarge = !isSorted && length >= 75;
    if (isLarge) {
      var cache = {};
    }
    if (callback) {
      seen = [];
      callback = createCallback(callback, thisArg);
    }
    while (++index < length) {
      var value = array[index],
          computed = callback ? callback(value, index, array) : value;

      if (isLarge) {
        var key = computed + '';
        var inited = hasOwnProperty.call(cache, key)
          ? !(seen = cache[key])
          : (seen = cache[key] = []);
      }
      if (isSorted
            ? !index || seen[seen.length - 1] !== computed
            : inited || indexOf(seen, computed) < 0
          ) {
        if (callback || isLarge) {
          seen.push(computed);
        }
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Creates an array with all occurrences of the passed values removed using
   * strict equality for comparisons, i.e. `===`.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} array The array to filter.
   * @param {Mixed} [value1, value2, ...] Values to remove.
   * @returns {Array} Returns a new filtered array.
   * @example
   *
   * _.without([1, 2, 1, 0, 3, 1, 4], 0, 1);
   * // => [2, 3, 4]
   */
  function without(array) {
    var index = -1,
        length = array ? array.length : 0,
        contains = cachedContains(arguments, 1, 20),
        result = [];

    while (++index < length) {
      var value = array[index];
      if (!contains(value)) {
        result.push(value);
      }
    }
    return result;
  }

  /**
   * Groups the elements of each array at their corresponding indexes. Useful for
   * separate data sources that are coordinated through matching array indexes.
   * For a matrix of nested arrays, `_.zip.apply(...)` can transpose the matrix
   * in a similar fashion.
   *
   * @static
   * @memberOf _
   * @category Arrays
   * @param {Array} [array1, array2, ...] Arrays to process.
   * @returns {Array} Returns a new array of grouped elements.
   * @example
   *
   * _.zip(['moe', 'larry', 'curly'], [30, 40, 50], [true, false, false]);
   * // => [['moe', 30, true], ['larry', 40, false], ['curly', 50, false]]
   */
  function zip(array) {
    var index = -1,
        length = array ? max(pluck(arguments, 'length')) : 0,
        result = Array(length);

    while (++index < length) {
      result[index] = pluck(arguments, index);
    }
    return result;
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Creates a function that is restricted to executing `func` only after it is
   * called `n` times. The `func` is executed with the `this` binding of the
   * created function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Number} n The number of times the function must be called before
   * it is executed.
   * @param {Function} func The function to restrict.
   * @returns {Function} Returns the new restricted function.
   * @example
   *
   * var renderNotes = _.after(notes.length, render);
   * _.forEach(notes, function(note) {
   *   note.asyncSave({ 'success': renderNotes });
   * });
   * // `renderNotes` is run once, after all notes have saved
   */
  function after(n, func) {
    if (n < 1) {
      return func();
    }
    return function() {
      if (--n < 1) {
        return func.apply(this, arguments);
      }
    };
  }

  /**
   * Creates a function that, when called, invokes `func` with the `this`
   * binding of `thisArg` and prepends any additional `bind` arguments to those
   * passed to the bound function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to bind.
   * @param {Mixed} [thisArg] The `this` binding of `func`.
   * @param {Mixed} [arg1, arg2, ...] Arguments to be partially applied.
   * @returns {Function} Returns the new bound function.
   * @example
   *
   * var func = function(greeting) {
   *   return greeting + ' ' + this.name;
   * };
   *
   * func = _.bind(func, { 'name': 'moe' }, 'hi');
   * func();
   * // => 'hi moe'
   */
  function bind(func, thisArg) {
    // use `Function#bind` if it exists and is fast
    // (in V8 `Function#bind` is slower except when partially applied)
    return isBindFast || (nativeBind && arguments.length > 2)
      ? nativeBind.call.apply(nativeBind, arguments)
      : createBound(func, thisArg, slice(arguments, 2));
  }

  /**
   * Binds methods on `object` to `object`, overwriting the existing method.
   * If no method names are provided, all the function properties of `object`
   * will be bound.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Object} object The object to bind and assign the bound methods to.
   * @param {String} [methodName1, methodName2, ...] Method names on the object to bind.
   * @returns {Object} Returns `object`.
   * @example
   *
   * var buttonView = {
   *  'label': 'lodash',
   *  'onClick': function() { alert('clicked: ' + this.label); }
   * };
   *
   * _.bindAll(buttonView);
   * jQuery('#lodash_button').on('click', buttonView.onClick);
   * // => When the button is clicked, `this.label` will have the correct value
   */
  function bindAll(object) {
    var funcs = arguments,
        index = funcs.length > 1 ? 0 : (funcs = functions(object), -1),
        length = funcs.length;

    while (++index < length) {
      var key = funcs[index];
      object[key] = bind(object[key], object);
    }
    return object;
  }

  /**
   * Creates a function that, when called, invokes the method at `object[key]`
   * and prepends any additional `bindKey` arguments to those passed to the bound
   * function. This method differs from `_.bind` by allowing bound functions to
   * reference methods that will be redefined or don't yet exist.
   * See http://michaux.ca/articles/lazy-function-definition-pattern.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Object} object The object the method belongs to.
   * @param {String} key The key of the method.
   * @param {Mixed} [arg1, arg2, ...] Arguments to be partially applied.
   * @returns {Function} Returns the new bound function.
   * @example
   *
   * var object = {
   *   'name': 'moe',
   *   'greet': function(greeting) {
   *     return greeting + ' ' + this.name;
   *   }
   * };
   *
   * var func = _.bindKey(object, 'greet', 'hi');
   * func();
   * // => 'hi moe'
   *
   * object.greet = function(greeting) {
   *   return greeting + ', ' + this.name + '!';
   * };
   *
   * func();
   * // => 'hi, moe!'
   */
  function bindKey(object, key) {
    return createBound(object, key, slice(arguments, 2));
  }

  /**
   * Creates a function that is the composition of the passed functions,
   * where each function consumes the return value of the function that follows.
   * In math terms, composing the functions `f()`, `g()`, and `h()` produces `f(g(h()))`.
   * Each function is executed with the `this` binding of the composed function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} [func1, func2, ...] Functions to compose.
   * @returns {Function} Returns the new composed function.
   * @example
   *
   * var greet = function(name) { return 'hi: ' + name; };
   * var exclaim = function(statement) { return statement + '!'; };
   * var welcome = _.compose(exclaim, greet);
   * welcome('moe');
   * // => 'hi: moe!'
   */
  function compose() {
    var funcs = arguments;
    return function() {
      var args = arguments,
          length = funcs.length;

      while (length--) {
        args = [funcs[length].apply(this, args)];
      }
      return args[0];
    };
  }

  /**
   * Creates a function that will delay the execution of `func` until after
   * `wait` milliseconds have elapsed since the last time it was invoked. Pass
   * `true` for `immediate` to cause debounce to invoke `func` on the leading,
   * instead of the trailing, edge of the `wait` timeout. Subsequent calls to
   * the debounced function will return the result of the last `func` call.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to debounce.
   * @param {Number} wait The number of milliseconds to delay.
   * @param {Boolean} immediate A flag to indicate execution is on the leading
   *  edge of the timeout.
   * @returns {Function} Returns the new debounced function.
   * @example
   *
   * var lazyLayout = _.debounce(calculateLayout, 300);
   * jQuery(window).on('resize', lazyLayout);
   */
  function debounce(func, wait, immediate) {
    var args,
        result,
        thisArg,
        timeoutId;

    function delayed() {
      timeoutId = null;
      if (!immediate) {
        result = func.apply(thisArg, args);
      }
    }
    return function() {
      var isImmediate = immediate && !timeoutId;
      args = arguments;
      thisArg = this;

      clearTimeout(timeoutId);
      timeoutId = setTimeout(delayed, wait);

      if (isImmediate) {
        result = func.apply(thisArg, args);
      }
      return result;
    };
  }

  /**
   * Executes the `func` function after `wait` milliseconds. Additional arguments
   * will be passed to `func` when it is invoked.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to delay.
   * @param {Number} wait The number of milliseconds to delay execution.
   * @param {Mixed} [arg1, arg2, ...] Arguments to invoke the function with.
   * @returns {Number} Returns the `setTimeout` timeout id.
   * @example
   *
   * var log = _.bind(console.log, console);
   * _.delay(log, 1000, 'logged later');
   * // => 'logged later' (Appears after one second.)
   */
  function delay(func, wait) {
    var args = slice(arguments, 2);
    return setTimeout(function() { func.apply(undefined, args); }, wait);
  }

  /**
   * Defers executing the `func` function until the current call stack has cleared.
   * Additional arguments will be passed to `func` when it is invoked.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to defer.
   * @param {Mixed} [arg1, arg2, ...] Arguments to invoke the function with.
   * @returns {Number} Returns the `setTimeout` timeout id.
   * @example
   *
   * _.defer(function() { alert('deferred'); });
   * // returns from the function before `alert` is called
   */
  function defer(func) {
    var args = slice(arguments, 1);
    return setTimeout(function() { func.apply(undefined, args); }, 1);
  }

  /**
   * Creates a function that memoizes the result of `func`. If `resolver` is
   * passed, it will be used to determine the cache key for storing the result
   * based on the arguments passed to the memoized function. By default, the first
   * argument passed to the memoized function is used as the cache key. The `func`
   * is executed with the `this` binding of the memoized function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to have its output memoized.
   * @param {Function} [resolver] A function used to resolve the cache key.
   * @returns {Function} Returns the new memoizing function.
   * @example
   *
   * var fibonacci = _.memoize(function(n) {
   *   return n < 2 ? n : fibonacci(n - 1) + fibonacci(n - 2);
   * });
   */
  function memoize(func, resolver) {
    var cache = {};
    return function() {
      var key = resolver ? resolver.apply(this, arguments) : arguments[0];
      return hasOwnProperty.call(cache, key)
        ? cache[key]
        : (cache[key] = func.apply(this, arguments));
    };
  }

  /**
   * Creates a function that is restricted to execute `func` once. Repeat calls to
   * the function will return the value of the first call. The `func` is executed
   * with the `this` binding of the created function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to restrict.
   * @returns {Function} Returns the new restricted function.
   * @example
   *
   * var initialize = _.once(createApplication);
   * initialize();
   * initialize();
   * // Application is only created once.
   */
  function once(func) {
    var result,
        ran = false;

    return function() {
      if (ran) {
        return result;
      }
      ran = true;
      result = func.apply(this, arguments);

      // clear the `func` variable so the function may be garbage collected
      func = null;
      return result;
    };
  }

  /**
   * Creates a function that, when called, invokes `func` with any additional
   * `partial` arguments prepended to those passed to the new function. This
   * method is similar to `bind`, except it does **not** alter the `this` binding.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to partially apply arguments to.
   * @param {Mixed} [arg1, arg2, ...] Arguments to be partially applied.
   * @returns {Function} Returns the new partially applied function.
   * @example
   *
   * var greet = function(greeting, name) { return greeting + ': ' + name; };
   * var hi = _.partial(greet, 'hi');
   * hi('moe');
   * // => 'hi: moe'
   */
  function partial(func) {
    return createBound(func, slice(arguments, 1));
  }

  /**
   * Creates a function that, when executed, will only call the `func`
   * function at most once per every `wait` milliseconds. If the throttled
   * function is invoked more than once during the `wait` timeout, `func` will
   * also be called on the trailing edge of the timeout. Subsequent calls to the
   * throttled function will return the result of the last `func` call.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Function} func The function to throttle.
   * @param {Number} wait The number of milliseconds to throttle executions to.
   * @returns {Function} Returns the new throttled function.
   * @example
   *
   * var throttled = _.throttle(updatePosition, 100);
   * jQuery(window).on('scroll', throttled);
   */
  function throttle(func, wait) {
    var args,
        result,
        thisArg,
        timeoutId,
        lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
          remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      }
      else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  }

  /**
   * Creates a function that passes `value` to the `wrapper` function as its
   * first argument. Additional arguments passed to the function are appended
   * to those passed to the `wrapper` function. The `wrapper` is executed with
   * the `this` binding of the created function.
   *
   * @static
   * @memberOf _
   * @category Functions
   * @param {Mixed} value The value to wrap.
   * @param {Function} wrapper The wrapper function.
   * @returns {Function} Returns the new function.
   * @example
   *
   * var hello = function(name) { return 'hello ' + name; };
   * hello = _.wrap(hello, function(func) {
   *   return 'before, ' + func('moe') + ', after';
   * });
   * hello();
   * // => 'before, hello moe, after'
   */
  function wrap(value, wrapper) {
    return function() {
      var args = [value];
      push.apply(args, arguments);
      return wrapper.apply(this, args);
    };
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Converts the characters `&`, `<`, `>`, `"`, and `'` in `string` to their
   * corresponding HTML entities.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {String} string The string to escape.
   * @returns {String} Returns the escaped string.
   * @example
   *
   * _.escape('Moe, Larry & Curly');
   * // => 'Moe, Larry &amp; Curly'
   */
  function escape(string) {
    return string == null ? '' : (string + '').replace(reUnescapedHtml, escapeHtmlChar);
  }

  /**
   * This function returns the first argument passed to it.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Mixed} value Any value.
   * @returns {Mixed} Returns `value`.
   * @example
   *
   * var moe = { 'name': 'moe' };
   * moe === _.identity(moe);
   * // => true
   */
  function identity(value) {
    return value;
  }

  /**
   * Adds functions properties of `object` to the `lodash` function and chainable
   * wrapper.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Object} object The object of function properties to add to `lodash`.
   * @example
   *
   * _.mixin({
   *   'capitalize': function(string) {
   *     return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
   *   }
   * });
   *
   * _.capitalize('larry');
   * // => 'Larry'
   *
   * _('curly').capitalize();
   * // => 'Curly'
   */
  function mixin(object) {
    forEach(functions(object), function(methodName) {
      var func = lodash[methodName] = object[methodName];

      lodash.prototype[methodName] = function() {
        var args = [this.__wrapped__];
        push.apply(args, arguments);

        var result = func.apply(lodash, args);
        return new lodash(result);
      };
    });
  }

  /**
   * Reverts the '_' variable to its previous value and returns a reference to
   * the `lodash` function.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @returns {Function} Returns the `lodash` function.
   * @example
   *
   * var lodash = _.noConflict();
   */
  function noConflict() {
    window._ = oldDash;
    return this;
  }

  /**
   * Produces a random number between `min` and `max` (inclusive). If only one
   * argument is passed, a number between `0` and the given number will be returned.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Number} [min=0] The minimum possible value.
   * @param {Number} [max=1] The maximum possible value.
   * @returns {Number} Returns a random number.
   * @example
   *
   * _.random(0, 5);
   * // => a number between 1 and 5
   *
   * _.random(5);
   * // => also a number between 1 and 5
   */
  function random(min, max) {
    if (min == null && max == null) {
      max = 1;
    }
    min = +min || 0;
    if (max == null) {
      max = min;
      min = 0;
    }
    return min + floor(nativeRandom() * ((+max || 0) - min + 1));
  }

  /**
   * Resolves the value of `property` on `object`. If `property` is a function
   * it will be invoked and its result returned, else the property value is
   * returned. If `object` is falsey, then `null` is returned.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Object} object The object to inspect.
   * @param {String} property The property to get the value of.
   * @returns {Mixed} Returns the resolved value.
   * @example
   *
   * var object = {
   *   'cheese': 'crumpets',
   *   'stuff': function() {
   *     return 'nonsense';
   *   }
   * };
   *
   * _.result(object, 'cheese');
   * // => 'crumpets'
   *
   * _.result(object, 'stuff');
   * // => 'nonsense'
   */
  function result(object, property) {
    // based on Backbone's private `getValue` function
    // https://github.com/documentcloud/backbone/blob/0.9.2/backbone.js#L1419-1424
    var value = object ? object[property] : null;
    return isFunction(value) ? object[property]() : value;
  }

  /**
   * A micro-templating method that handles arbitrary delimiters, preserves
   * whitespace, and correctly escapes quotes within interpolated code.
   *
   * Note: In the development build `_.template` utilizes sourceURLs for easier
   * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
   *
   * Note: Lo-Dash may be used in Chrome extensions by either creating a `lodash csp`
   * build and avoiding `_.template` use, or loading Lo-Dash in a sandboxed page.
   * See http://developer.chrome.com/trunk/extensions/sandboxingEval.html
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {String} text The template text.
   * @param {Obect} data The data object used to populate the text.
   * @param {Object} options The options object.
   *  escape - The "escape" delimiter regexp.
   *  evaluate - The "evaluate" delimiter regexp.
   *  interpolate - The "interpolate" delimiter regexp.
   *  sourceURL - The sourceURL of the template's compiled source.
   *  variable - The data object variable name.
   *
   * @returns {Function|String} Returns a compiled function when no `data` object
   *  is given, else it returns the interpolated text.
   * @example
   *
   * // using a compiled template
   * var compiled = _.template('hello <%= name %>');
   * compiled({ 'name': 'moe' });
   * // => 'hello moe'
   *
   * var list = '<% _.forEach(people, function(name) { %><li><%= name %></li><% }); %>';
   * _.template(list, { 'people': ['moe', 'larry', 'curly'] });
   * // => '<li>moe</li><li>larry</li><li>curly</li>'
   *
   * // using the "escape" delimiter to escape HTML in data property values
   * _.template('<b><%- value %></b>', { 'value': '<script>' });
   * // => '<b>&lt;script&gt;</b>'
   *
   * // using the ES6 delimiter as an alternative to the default "interpolate" delimiter
   * _.template('hello ${ name }', { 'name': 'curly' });
   * // => 'hello curly'
   *
   * // using the internal `print` function in "evaluate" delimiters
   * _.template('<% print("hello " + epithet); %>!', { 'epithet': 'stooge' });
   * // => 'hello stooge!'
   *
   * // using custom template delimiters
   * _.templateSettings = {
   *   'interpolate': /{{([\s\S]+?)}}/g
   * };
   *
   * _.template('hello {{ name }}!', { 'name': 'mustache' });
   * // => 'hello mustache!'
   *
   * // using the `sourceURL` option to specify a custom sourceURL for the template
   * var compiled = _.template('hello <%= name %>', null, { 'sourceURL': '/basic/greeting.jst' });
   * compiled(data);
   * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector
   *
   * // using the `variable` option to ensure a with-statement isn't used in the compiled template
   * var compiled = _.template('hello <%= data.name %>!', null, { 'variable': 'data' });
   * compiled.source;
   * // => function(data) {
   *   var __t, __p = '', __e = _.escape;
   *   __p += 'hello ' + ((__t = ( data.name )) == null ? '' : __t) + '!';
   *   return __p;
   * }
   *
   * // using the `source` property to inline compiled templates for meaningful
   * // line numbers in error messages and a stack trace
   * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
   *   var JST = {\
   *     "main": ' + _.template(mainText).source + '\
   *   };\
   * ');
   */
  function template(text, data, options) {
    // based on John Resig's `tmpl` implementation
    // http://ejohn.org/blog/javascript-micro-templating/
    // and Laura Doktorova's doT.js
    // https://github.com/olado/doT
    text || (text = '');
    options || (options = {});

    var isEvaluating,
        result,
        settings = lodash.templateSettings,
        index = 0,
        interpolate = options.interpolate || settings.interpolate || reNoMatch,
        source = "__p += '",
        variable = options.variable || settings.variable,
        hasVariable = variable;

    // compile regexp to match each delimiter
    var reDelimiters = RegExp(
      (options.escape || settings.escape || reNoMatch).source + '|' +
      interpolate.source + '|' +
      (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
      (options.evaluate || settings.evaluate || reNoMatch).source + '|$'
    , 'g');

    text.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
      interpolateValue || (interpolateValue = esTemplateValue);

      // escape characters that cannot be included in string literals
      source += text.slice(index, offset).replace(reUnescapedString, escapeStringChar);

      // replace delimiters with snippets
      if (escapeValue) {
        source += "' +\n__e(" + escapeValue + ") +\n'";
      }
      if (evaluateValue) {
        source += "';\n" + evaluateValue + ";\n__p += '";
      }
      if (interpolateValue) {
        source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
      }
      isEvaluating || (isEvaluating = evaluateValue || reComplexDelimiter.test(escapeValue || interpolateValue));
      index = offset + match.length;

      // the JS engine embedded in Adobe products requires returning the `match`
      // string in order to produce the correct `offset` value
      return match;
    });

    source += "';\n";

    // if `variable` is not specified and the template contains "evaluate"
    // delimiters, wrap a with-statement around the generated code to add the
    // data object to the top of the scope chain
    if (!hasVariable) {
      variable = 'obj';
      if (isEvaluating) {
        source = 'with (' + variable + ') {\n' + source + '\n}\n';
      }
      else {
        // avoid a with-statement by prepending data object references to property names
        var reDoubleVariable = RegExp('(\\(\\s*)' + variable + '\\.' + variable + '\\b', 'g');
        source = source
          .replace(reInsertVariable, '$&' + variable + '.')
          .replace(reDoubleVariable, '$1__d');
      }
    }

    // cleanup code by stripping empty strings
    source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
      .replace(reEmptyStringMiddle, '$1')
      .replace(reEmptyStringTrailing, '$1;');

    // frame code as the function body
    source = 'function(' + variable + ') {\n' +
      (hasVariable ? '' : variable + ' || (' + variable + ' = {});\n') +
      "var __t, __p = '', __e = _.escape" +
      (isEvaluating
        ? ', __j = Array.prototype.join;\n' +
          "function print() { __p += __j.call(arguments, '') }\n"
        : (hasVariable ? '' : ', __d = ' + variable + '.' + variable + ' || ' + variable) + ';\n'
      ) +
      source +
      'return __p\n}';

    // use a sourceURL for easier debugging
    // http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
    var sourceURL = useSourceURL
      ? '\n//@ sourceURL=' + (options.sourceURL || '/lodash/template/source[' + (templateCounter++) + ']')
      : '';

    try {
      result = Function('_', 'return ' + source + sourceURL)(lodash);
    } catch(e) {
      e.source = source;
      throw e;
    }

    if (data) {
      return result(data);
    }
    // provide the compiled function's source via its `toString` method, in
    // supported environments, or the `source` property as a convenience for
    // inlining compiled templates during the build process
    result.source = source;
    return result;
  }

  /**
   * Executes the `callback` function `n` times, returning an array of the results
   * of each `callback` execution. The `callback` is bound to `thisArg` and invoked
   * with one argument; (index).
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Number} n The number of times to execute the callback.
   * @param {Function} callback The function called per iteration.
   * @param {Mixed} [thisArg] The `this` binding of `callback`.
   * @returns {Array} Returns a new array of the results of each `callback` execution.
   * @example
   *
   * var diceRolls = _.times(3, _.partial(_.random, 1, 6));
   * // => [3, 6, 4]
   *
   * _.times(3, function(n) { mage.castSpell(n); });
   * // => calls `mage.castSpell(n)` three times, passing `n` of `0`, `1`, and `2` respectively
   *
   * _.times(3, function(n) { this.cast(n); }, mage);
   * // => also calls `mage.castSpell(n)` three times
   */
  function times(n, callback, thisArg) {
    n = +n || 0;
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = callback.call(thisArg, index);
    }
    return result;
  }

  /**
   * The opposite of `_.escape`, this method converts the HTML entities
   * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#x27;` in `string` to their
   * corresponding characters.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {String} string The string to unescape.
   * @returns {String} Returns the unescaped string.
   * @example
   *
   * _.unescape('Moe, Larry &amp; Curly');
   * // => 'Moe, Larry & Curly'
   */
  function unescape(string) {
    return string == null ? '' : (string + '').replace(reEscapedHtml, unescapeHtmlChar);
  }

  /**
   * Generates a unique ID. If `prefix` is passed, the ID will be appended to it.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {String} [prefix] The value to prefix the ID with.
   * @returns {String} Returns the unique ID.
   * @example
   *
   * _.uniqueId('contact_');
   * // => 'contact_104'
   *
   * _.uniqueId();
   * // => '105'
   */
  function uniqueId(prefix) {
    return (prefix == null ? '' : prefix + '') + (++idCounter);
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Invokes `interceptor` with the `value` as the first argument, and then
   * returns `value`. The purpose of this method is to "tap into" a method chain,
   * in order to perform operations on intermediate results within the chain.
   *
   * @static
   * @memberOf _
   * @category Chaining
   * @param {Mixed} value The value to pass to `interceptor`.
   * @param {Function} interceptor The function to invoke.
   * @returns {Mixed} Returns `value`.
   * @example
   *
   * _.chain([1, 2, 3, 200])
   *  .filter(function(num) { return num % 2 == 0; })
   *  .tap(alert)
   *  .map(function(num) { return num * num; })
   *  .value();
   * // => // [2, 200] (alerted)
   * // => [4, 40000]
   */
  function tap(value, interceptor) {
    interceptor(value);
    return value;
  }

  /**
   * Produces the `toString` result of the wrapped value.
   *
   * @name toString
   * @memberOf _
   * @category Chaining
   * @returns {String} Returns the string result.
   * @example
   *
   * _([1, 2, 3]).toString();
   * // => '1,2,3'
   */
  function wrapperToString() {
    return this.__wrapped__ + '';
  }

  /**
   * Extracts the wrapped value.
   *
   * @name valueOf
   * @memberOf _
   * @alias value
   * @category Chaining
   * @returns {Mixed} Returns the wrapped value.
   * @example
   *
   * _([1, 2, 3]).valueOf();
   * // => [1, 2, 3]
   */
  function wrapperValueOf() {
    return this.__wrapped__;
  }

  /*--------------------------------------------------------------------------*/

  // add functions that return wrapped values when chaining
  lodash.after = after;
  lodash.assign = assign;
  lodash.bind = bind;
  lodash.bindAll = bindAll;
  lodash.bindKey = bindKey;
  lodash.compact = compact;
  lodash.compose = compose;
  lodash.countBy = countBy;
  lodash.debounce = debounce;
  lodash.defaults = defaults;
  lodash.defer = defer;
  lodash.delay = delay;
  lodash.difference = difference;
  lodash.filter = filter;
  lodash.flatten = flatten;
  lodash.forEach = forEach;
  lodash.forIn = forIn;
  lodash.forOwn = forOwn;
  lodash.functions = functions;
  lodash.groupBy = groupBy;
  lodash.initial = initial;
  lodash.intersection = intersection;
  lodash.invert = invert;
  lodash.invoke = invoke;
  lodash.keys = keys;
  lodash.map = map;
  lodash.max = max;
  lodash.memoize = memoize;
  lodash.merge = merge;
  lodash.min = min;
  lodash.object = object;
  lodash.omit = omit;
  lodash.once = once;
  lodash.pairs = pairs;
  lodash.partial = partial;
  lodash.pick = pick;
  lodash.pluck = pluck;
  lodash.range = range;
  lodash.reject = reject;
  lodash.rest = rest;
  lodash.shuffle = shuffle;
  lodash.sortBy = sortBy;
  lodash.tap = tap;
  lodash.throttle = throttle;
  lodash.times = times;
  lodash.toArray = toArray;
  lodash.union = union;
  lodash.uniq = uniq;
  lodash.values = values;
  lodash.where = where;
  lodash.without = without;
  lodash.wrap = wrap;
  lodash.zip = zip;

  // add aliases
  lodash.collect = map;
  lodash.drop = rest;
  lodash.each = forEach;
  lodash.extend = assign;
  lodash.methods = functions;
  lodash.select = filter;
  lodash.tail = rest;
  lodash.unique = uniq;

  // add functions to `lodash.prototype`
  mixin(lodash);

  /*--------------------------------------------------------------------------*/

  // add functions that return unwrapped values when chaining
  lodash.clone = clone;
  lodash.cloneDeep = cloneDeep;
  lodash.contains = contains;
  lodash.escape = escape;
  lodash.every = every;
  lodash.find = find;
  lodash.has = has;
  lodash.identity = identity;
  lodash.indexOf = indexOf;
  lodash.isArguments = isArguments;
  lodash.isArray = isArray;
  lodash.isBoolean = isBoolean;
  lodash.isDate = isDate;
  lodash.isElement = isElement;
  lodash.isEmpty = isEmpty;
  lodash.isEqual = isEqual;
  lodash.isFinite = isFinite;
  lodash.isFunction = isFunction;
  lodash.isNaN = isNaN;
  lodash.isNull = isNull;
  lodash.isNumber = isNumber;
  lodash.isObject = isObject;
  lodash.isPlainObject = isPlainObject;
  lodash.isRegExp = isRegExp;
  lodash.isString = isString;
  lodash.isUndefined = isUndefined;
  lodash.lastIndexOf = lastIndexOf;
  lodash.mixin = mixin;
  lodash.noConflict = noConflict;
  lodash.random = random;
  lodash.reduce = reduce;
  lodash.reduceRight = reduceRight;
  lodash.result = result;
  lodash.size = size;
  lodash.some = some;
  lodash.sortedIndex = sortedIndex;
  lodash.template = template;
  lodash.unescape = unescape;
  lodash.uniqueId = uniqueId;

  // add aliases
  lodash.all = every;
  lodash.any = some;
  lodash.detect = find;
  lodash.foldl = reduce;
  lodash.foldr = reduceRight;
  lodash.include = contains;
  lodash.inject = reduce;

  forOwn(lodash, function(func, methodName) {
    if (!lodash.prototype[methodName]) {
      lodash.prototype[methodName] = function() {
        var args = [this.__wrapped__];
        push.apply(args, arguments);
        return func.apply(lodash, args);
      };
    }
  });

  /*--------------------------------------------------------------------------*/

  // add functions capable of returning wrapped and unwrapped values when chaining
  lodash.first = first;
  lodash.last = last;

  // add aliases
  lodash.take = first;
  lodash.head = first;

  forOwn(lodash, function(func, methodName) {
    if (!lodash.prototype[methodName]) {
      lodash.prototype[methodName]= function(n, guard) {
        var result = func(this.__wrapped__, n, guard);
        return (n == null || guard) ? result : new lodash(result);
      };
    }
  });

  /*--------------------------------------------------------------------------*/

  /**
   * The semantic version number.
   *
   * @static
   * @memberOf _
   * @type String
   */
  lodash.VERSION = '1.0.0-rc.3';

  // add "Chaining" functions to the wrapper
  lodash.prototype.toString = wrapperToString;
  lodash.prototype.value = wrapperValueOf;
  lodash.prototype.valueOf = wrapperValueOf;

  // add `Array` functions that return unwrapped values
  each(['join', 'pop', 'shift'], function(methodName) {
    var func = arrayRef[methodName];
    lodash.prototype[methodName] = function() {
      return func.apply(this.__wrapped__, arguments);
    };
  });

  // add `Array` functions that return the wrapped value
  each(['push', 'reverse', 'sort', 'unshift'], function(methodName) {
    var func = arrayRef[methodName];
    lodash.prototype[methodName] = function() {
      func.apply(this.__wrapped__, arguments);
      return this;
    };
  });

  // add `Array` functions that return new wrapped values
  each(['concat', 'slice', 'splice'], function(methodName) {
    var func = arrayRef[methodName];
    lodash.prototype[methodName] = function() {
      var result = func.apply(this.__wrapped__, arguments);
      return new lodash(result);
    };
  });

  // avoid array-like object bugs with `Array#shift` and `Array#splice`
  // in Firefox < 10 and IE < 9
  if (hasObjectSpliceBug) {
    each(['pop', 'shift', 'splice'], function(methodName) {
      var func = arrayRef[methodName],
          isSplice = methodName == 'splice';

      lodash.prototype[methodName] = function() {
        var value = this.__wrapped__,
            result = func.apply(value, arguments);

        if (value.length === 0) {
          delete value[0];
        }
        return isSplice ? new lodash(result) : result;
      };
    });
  }

  // add pseudo private property to be used and removed during the build process
  lodash._each = each;
  lodash._iteratorTemplate = iteratorTemplate;

  /*--------------------------------------------------------------------------*/

  // expose Lo-Dash
  // some AMD build optimizers, like r.js, check for specific condition patterns like the following:
  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {
    // Expose Lo-Dash to the global object even when an AMD loader is present in
    // case Lo-Dash was injected by a third-party script and not intended to be
    // loaded as a module. The global assignment can be reverted in the Lo-Dash
    // module via its `noConflict()` method.
    window._ = lodash;

    // define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module
    define(function() {
      return lodash;
    });
  }
  // check for `exports` after `define` in case a build optimizer adds an `exports` object
  else if (freeExports) {
    // in Node.js or RingoJS v0.8.0+
    if (typeof module == 'object' && module && module.exports == freeExports) {
      (module.exports = lodash)._ = lodash;
    }
    // in Narwhal or RingoJS v0.7.0-
    else {
      freeExports._ = lodash;
    }
  }
  else {
    // in a browser or Rhino
    window._ = lodash;
  }
}(this));

})(window)
},{}],19:[function(require,module,exports){

},{}],20:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            if (ev.source === window && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],3:[function(require,module,exports){
(function(process,global){var AdminUpgrade, AdminMenu, Paginator, PhotoCropper, layoutStatic, layoutOnPersonalize, pagerInit, homepage, forum, sameProfile, profile, admin, joinSearch, resetPaginator, endSearch, mkSearchPnumToHref, mkPostPnumToHref, search, page, privateSite, slice$ = [].slice, out$ = typeof exports != 'undefined' && exports || this;
global.furl = require('./forum-urls.ls');
import$(global, require('./shared-helpers.ls'));
AdminUpgrade = require('../component/AdminUpgrade.ls');
AdminMenu = require('../component/AdminMenu.ls');
Paginator = require('../component/Paginator.ls');
PhotoCropper = require('../component/PhotoCropper.ls');
function bench(subjectName, subjectBody){
  var bef, aft;
  if (process.env.NODE_ENV === 'production') {
    subjectBody();
  } else {
    bef = new Date;
    subjectBody();
    aft = new Date;
    partialize$.apply(this, [setTimeout, [void 8, 1], [0]])(function(){
      var dur;
      dur = aft - bef;
      return console.log("benchmarked '" + subjectName + "': took " + dur + "ms");
    });
  }
}
function renderComponent(win, target, name, klass, firstKlassArg){
  var wc, c, locals;
  wc = win.component || (win.component = {});
  if (c = wc[name]) {
    if (locals = firstKlassArg != null ? firstKlassArg.locals : void 8) {
      c.locals(locals);
    }
    c.reload();
  } else {
    c = wc[name] = new klass(firstKlassArg);
  }
  win.$(target).html('').append(c.$);
}
function paginatorComponent(w, locals, pnumToHref){
  var wc;
  wc = w.component || (w.component = {});
  if (wc.paginator) {
    wc.paginator.locals(locals);
    wc.paginator.pnumToHref(pnumToHref);
    wc.paginator.reload();
  } else {
    wc.paginator = new Paginator({
      locals: locals,
      pnumToHref: pnumToHref
    }, w.$('#pb_paginator'));
  }
}
function parseUrl(url){
  var a, p;
  if (typeof document != 'undefined' && document !== null) {
    a = document.createElement('a');
    a.href = url;
    return {
      search: a.search,
      pathname: a.pathname
    };
  } else {
    p = require('url').parse(url);
    return {
      search: p.search,
      pathname: p.pathname
    };
  }
}
function defaultPnumToHrefFun(uri){
  return function(pg){
    var parsed;
    parsed = parseUrl(uri);
    if (pg > 1) {
      return parsed.pathname + ("?page=" + pg);
    } else {
      return parsed.pathname;
    }
  };
}
layoutStatic = function(w, nextMutant, activeForumId){
  var forumClass, fid, p;
  activeForumId == null && (activeForumId = -1);
  forumClass = w.activeForumId ? " forum-" + w.activeForumId : '';
  w.$('html').attr('class', nextMutant + "" + forumClass);
  w.marshal('mutator', nextMutant);
  fid = activeForumId || w.activeForumId;
  w.$('header .menu').find('.active').removeClass('active');
  w.$("menu .row .forum-" + fid).addClass('active');
  p = w.$("menu .submenu .forum-" + fid);
  if (p.length) {
    p.parent().addClass('active');
    return w.$(last(p.parents('li'))).find('.title').addClass('active');
  }
};
layoutOnPersonalize = function(w, u){
  if (u) {
    setOnlineUser(u.id);
    setProfile(u.photo);
    switch (window.location.hash) {
    case '#choose':
      if (isEmail(typeof user != 'undefined' && user !== null ? user.name : void 8)) {
        Auth.showLoginDialog();
        return switchAndFocus('on-login', 'on-choose', '#auth input[name=username]');
      }
    }
  }
};
pagerInit = function(w){
  var pagerOpts;
  pagerOpts = {
    current: parseInt(w.page),
    last: parseInt(w.pagesCount),
    forumId: parseInt(w.activeForumId)
  };
  if (w.pager) {
    import$(w.pager, pagerOpts);
    w.pager.init();
  } else {
    w.pager = new w.Pager('#paginator', pagerOpts);
  }
  if (w.page) {
    return w.pager.setPage(w.page, false);
  }
};
out$.homepage = homepage = {
  'static': function(window, next){
    window.renderMutant('main_content', 'homepage');
    layoutStatic.call(this, window, 'homepage');
    return next();
  },
  onPersonalize: function(w, u, next){
    layoutOnPersonalize(w, u);
    return next();
  },
  onLoad: function(window, next){
    var active, ref$;
    try {
      window.$('.forum .container').masonry({
        itemSelector: '.post',
        isAnimated: true,
        animationOptions: {
          duration: 200
        },
        isFitWidth: true,
        isResizable: true
      });
    } catch (e$) {}
    active = ((ref$ = window.location.search.match(/order=(\w+)/)) != null ? ref$[1] : void 8) || 'recent';
    window.jade.render($('.extra:first')[0], 'order-control', {
      active: active
    });
    setTimeout(function(){
      var reorder;
      $('.forum').waypoint({
        offset: '25%',
        handler: function(direction){
          var e, eid, id, cur;
          e = $(this);
          eid = e.attr('id');
          id = direction === 'down'
            ? eid
            : $("#" + eid).prevAll('.forum:first').attr('id');
          if (!id) {
            return;
          }
          $('header .menu').find('.active').removeClass('active');
          cur = $('header .menu').find("." + id.replace(/_/, '-')).addClass('active');
          $('.forum .stuck').removeClass('stuck');
          return flipBackground(window, cur, direction);
        }
      });
      reorder = __.debounce(function(it){
        return History.pushState({}, '', it);
      }, 100);
      window.currentOrder = false;
      return $('#order li').waypoint({
        context: 'ul',
        offset: 30,
        handler: function(direction){
          var e, order, path;
          e = $(this);
          if (direction === 'up') {
            e = e.prev();
          }
          if (!e.length) {
            e = $(this);
          }
          $('#order li.active').removeClass('active');
          e.addClass('active');
          order = e.data('value');
          path = "/?order=" + order;
          if (window.currentOrder) {
            return reorder(path);
          } else {
            return window.currentOrder = order;
          }
        }
      });
    }, 100);
    return next();
  },
  onUnload: function(window, nextMutant, next){
    try {
      window.$('.forum .container').masonry('destroy');
      window.$('.forum .header').waypoint('destroy');
      window.$('.forum').waypoint('destroy');
      window.$('#order li').waypoint('destroy');
      window.$('.bg').remove();
      window.$($('.extra:first')).html('');
    } catch (e$) {}
    return next();
  }
};
function renderThreadPaginatorComponent(win, qty, step){
  var onPage, locals;
  onPage = function(page){
    return $.get("/resources/threads/" + window.activeForumId, {
      page: page
    }, function(topThreads, status){
      var container;
      container = win.$('#left_container .scrollable');
      return container.html(win.jade.templates.__threads({
        topThreads: topThreads
      }));
    });
  };
  locals = {
    qty: qty,
    step: step,
    activePage: 1
  };
  renderComponent(win, '#thread-paginator', 'threadPaginator', Paginator, {
    locals: locals,
    onPage: onPage
  });
}
out$.forum = forum = {
  'static': function(window, next){
    var prevMutant, this$ = this;
    prevMutant = window.mutator;
    window.renderMutant('main_content', isEditing(this.furl.path) === true
      ? 'post-new'
      : isForumHomepage(this.furl.path) ? 'homepage' : 'posts');
    if (this.topThreads) {
      window.renderMutant('left_container', 'nav');
      renderThreadPaginatorComponent(window, this.tQty, this.tStep);
      window.marshal('tQty', this.tQty);
      window.marshal('tStep', this.tStep);
    }
    window.marshal('activeForumId', this.activeForumId);
    window.marshal('activeThreadId', this.activeThreadId);
    window.marshal('page', this.page);
    window.marshal('pagesCount', this.pagesCount);
    window.marshal('prevPages', this.prevPages);
    (function(){
      var wc, locals, pnumToHref;
      if (!this$.post) {
        return;
      }
      wc = window.component || (window.component = {});
      locals = {
        step: this$.limit,
        qty: this$.qty,
        activePage: this$.page
      };
      pnumToHref = mkPostPnumToHref(this$.post.uri);
      return paginatorComponent(window, locals, pnumToHref);
    })();
    layoutStatic.call(this, window, 'forum', this.activeForumId);
    return next();
  },
  onLoad: function(window, next){
    var cur, $, $l, id, postId;
    cur = window.$("header .menu .forum-" + window.activeForumId);
    flipBackground(window, cur);
    $ = window.$;
    alignBreadcrumb();
    $l = $('#left_container');
    $l.find('.active').removeClass('active');
    $l.find(".thread[data-id='" + window.activeThreadId + "']").addClass('active');
    id = isEditing(window.location.pathname);
    if (id) {
      editPost(id, {
        forum_id: window.activeForumId
      });
    }
    $('body').on('click', togglePost);
    postId = $('#main_content .post:first').data('post-id');
    if (postId) {
      $.post("/resources/posts/" + postId + "/impression");
    }
    pagerInit(window);
    if (user) {
      setTimeout(function(){
        return $('.onclick-append-reply-ui:first').click();
      }, 300);
    }
    window.surfData = window.activeForumId;
    return next();
  },
  onInitial: function(window, next){
    setTimeout(function(){
      var threads, offset, cur, dst, ref$;
      threads = $('#left_container .threads');
      offset = -125;
      cur = threads.scrollTop();
      dst = Math.round((ref$ = $('#left_container .threads > .active').position()) != null ? ref$.top : void 8);
      if (dst) {
        return threads.animate({
          scrollTop: cur + dst + offset
        }, 500, 'easeOutExpo');
      }
    }, 500);
    renderThreadPaginatorComponent(window, window.tQty, window.tStep);
    return next();
  },
  onMutate: function(window, next){
    var ref$;
    scrollToTop();
    setWide();
    if ((ref$ = window.socket) != null) {
      ref$.emit('online-now');
    }
    return next();
  },
  onPersonalize: function(w, u, next){
    var ref$;
    if (u) {
      layoutOnPersonalize(w, u);
      $(".post[data-user-id=" + u.id + "] .censor").css('display', 'inline');
      if ((ref$ = u.rights) != null && ref$['super']) {
        $('.censor').css('display', 'inline');
      }
      setInlineEditor(u.id);
    }
    return next();
  },
  onUnload: function(win, nextMutant, next){
    $('body').off('click');
    try {
      win.$('#left_container').resizable('destroy');
    } catch (e$) {}
    if (nextMutant !== 'forum') {
      resetPaginator(win);
    }
    return next();
  }
};
sameProfile = function(hints){
  var ref$, l, c, p1, p2;
  ref$ = [hints.last, hints.current], l = ref$[0], c = ref$[1];
  if (l.mutator === null) {
    return false;
  }
  ref$ = [l.pathname.split('/'), c.pathname.split('/')], p1 = ref$[0], p2 = ref$[1];
  if (p1[1] === 'user' && p2[1] === 'user') {
    if (p1[2] === p2[2]) {
      return p1[2];
    }
  }
  return false;
};
out$.profile = profile = {
  'static': function(window, next){
    var this$ = this;
    if (window.hints) {
      if (!sameProfile(window.hints)) {
        window.renderMutant('left_container', 'profile');
      }
    } else {
      window.renderMutant('left_container', 'profile');
    }
    window.renderMutant('main_content', 'posts-by-user');
    window.marshal('step', this.step);
    window.marshal('qty', this.qty);
    window.marshal('page', this.page);
    window.marshal('pagesCount', this.pagesCount);
    (function(){
      var locals, pnumToHref;
      locals = {
        step: this$.limit,
        qty: this$.qty,
        activePage: this$.page
      };
      pnumToHref = mkPostPnumToHref("/user/" + this$.profile.name);
      window.marshal('uri', this$.uri);
      return paginatorComponent(window, locals, pnumToHref);
    })();
    layoutStatic.call(this, window, 'profile');
    return next();
  },
  onLoad: function(window, next){
    pagerInit(window);
    return next();
  },
  onMutate: function(window, next){
    scrollToTop();
    return next();
  },
  onPersonalize: function(w, u, next){
    return lazyLoadHtml5Uploader(function(){
      var photocropperStart, photocropperEnable, photocropperDisable, profileUserId;
      photocropperStart = function(ev){
        return PhotoCropper.start();
      };
      photocropperEnable = function(){
        var options;
        window.$('#left_content').addClass('editable');
        window.$('body').on('click', '#left_content.editable .avatar', photocropperStart);
        options = {
          name: 'avatar',
          postUrl: "/resources/users/" + window.user.id + "/avatar",
          onSuccess: function(r){
            return PhotoCropper.start({
              mode: 'crop'
            });
          }
        };
        return window.$('#left_content .avatar').html5Uploader(options);
      };
      photocropperDisable = function(){
        window.$('#left_content').removeClass('editable');
        return window.$('body').off('click', '#left_content.editable .avatar', photocropperStart);
      };
      if (u) {
        layoutOnPersonalize(w, u);
        profileUserId = window.$('#left_content .profile').data('userId');
        if (profileUserId === u.id) {
          photocropperEnable();
        } else {
          photocropperDisable();
        }
      } else {
        photocropperDisable();
      }
      return next();
    });
  },
  onUnload: function(window, nextMutant, next){
    if (nextMutant !== 'forum') {
      resetPaginator(window);
    }
    return next();
  },
  onInitial: function(window, next){
    var this$ = this;
    (function(){
      var locals, name, pnumToHref;
      locals = {
        step: window.step,
        qty: window.qty,
        activePage: window.page
      };
      name = window.location.pathname.split('/')[2];
      pnumToHref = mkPostPnumToHref("/user/" + name);
      return paginatorComponent(window, locals, pnumToHref);
    })();
    return next();
  }
};
function renderAdminComponents(action, site, win){
  switch (action) {
  case 'domains':
    try {
      win.renderMutant('main_content', 'admin-domains');
    } catch (e$) {}
    break;
  case 'invites':
    try {
      win.renderMutant('main_content', 'admin-invites');
    } catch (e$) {}
    break;
  case 'menu':
    renderComponent(win, '#main_content', 'admin-menu', AdminMenu, {
      locals: {
        site: site
      }
    });
    break;
  case 'upgrade':
    renderComponent(win, '#main_content', 'admin-upgrade', AdminUpgrade, {
      locals: {
        subscriptions: site.subscriptions
      }
    });
    break;
  default:
    try {
      win.renderMutant('main_content', 'admin-general');
    } catch (e$) {}
  }
}
out$.admin = admin = {
  'static': function(window, next){
    window.renderMutant('left_container', 'admin-nav');
    window.$('#left_container menu li').removeClass('active');
    window.$("#left_container menu ." + (this.action || 'general')).addClass('active');
    renderAdminComponents(this.action, this.site, window);
    window.marshal('action', this.action);
    window.marshal('site', this.site);
    layoutStatic.call(this, window, 'admin');
    return next();
  },
  onPersonalize: function(w, u, next){
    layoutOnPersonalize(w, u);
    return next();
  },
  onUnload: function(window, nextMutant, next){
    if (window.adminExpanded) {
      $('body').addClass('collapsed');
    }
    return next();
  },
  onLoad: function(window, next){
    var $b, this$ = this;
    $b = $('body');
    if (window.adminExpanded = $b.hasClass('collapsed')) {
      $b.removeClass('collapsed');
    }
    $('form input:first').focus().select();
    $('.domain').trigger('change');
    window.pagesCount = 0;
    pagerInit(window);
    return lazyLoadNestedSortable(function(){
      return lazyLoadDeserialize(function(){
        return next();
      });
    });
  },
  onInitial: function(win, next){
    renderAdminComponents(win.action, win.site, win);
    return next();
  },
  onMutate: function(window, next){
    scrollToTop();
    return next();
  }
};
joinSearch = function(sock){
  return sock.emit('search', window.searchopts);
};
resetPaginator = function(w){
  var ref$, x$;
  $('#pb_paginator').hide();
  if ((ref$ = w.component) != null && ref$.paginator) {
    x$ = w.component.paginator;
    x$.local('qty', 0);
    x$.reload();
    return x$;
  }
};
endSearch = function(w){
  resetPaginator(w);
  return socket.emit('search-end');
};
mkSearchPnumToHref = function(searchopts){
  return function(pnum){
    var query, rval, ref$, k, v;
    query = pnum === void 8 || parseInt(pnum) === 1
      ? (rval = import$({}, searchopts), delete rval.page, rval)
      : (ref$ = import$({}, searchopts), ref$.page = pnum, ref$);
    if (Object.keys(query).length) {
      return '/search?' + (function(){
        var ref$, results$ = [];
        for (k in ref$ = query) {
          v = ref$[k];
          results$.push(k + "=" + v);
        }
        return results$;
      }()).join('&');
    } else {
      return '/search';
    }
  };
};
mkPostPnumToHref = function(postUri){
  return function(pnum){
    if (pnum > 1) {
      return postUri + "/page/" + pnum;
    } else {
      return postUri;
    }
  };
};
out$.search = search = {
  'static': {
    prepare: function(window, next){
      var params, after, ref$, ref1$, $q, qEl, q;
      params = this;
      after = window.afterPrepare = [];
      window.marshal('page', this.page);
      window.marshal('pagesCount', this.pagesCount);
      window.marshal('searchopts', this.searchopts);
      window.marshal('newHits', 0);
      if (((ref$ = window.hints) != null ? (ref1$ = ref$.last) != null ? ref1$.mutator : void 8 : void 8) !== 'search') {
        (function(){
          var filtersHtml, $t;
          window.replaceHtml(window.$('#left_container'), '<div id="search_filters"></div><div id="search_facets"></div>');
          filtersHtml = window.render('search-filters');
          $t = window.$('#search_filters');
          return after.push(function(){
            return bench('search-filters', function(){
              return window.replaceHtml($t, filtersHtml);
            });
          });
        })();
      }
      (function(){
        var html, $t;
        html = window.render('search-facets');
        $t = window.$('#search_facets');
        return after.push(function(){
          return bench('search-facets', function(){
            return window.replaceHtml($t, html);
          });
        });
      })();
      (function(){
        var html, $t;
        html = window.render('search');
        $t = window.$('#main_content');
        return after.push(function(){
          return bench('search-content', function(){
            return window.replaceHtml($t, html);
          });
        });
      })();
      $q = window.$('#query');
      qEl = $q[0];
      q = this.searchopts.q;
      if (typeof History != 'undefined' && History !== null) {
        if (this.statechangeWasUser) {
          after.push(function(){
            return bench('query-string-update', function(){
              return qEl.value = q;
            });
          });
        }
      } else {
        after.push(function(){
          return bench('query-string-update', function(){
            return $q.val(q);
          });
        });
      }
      if (typeof History != 'undefined' && History !== null) {
        if (document.activeElement === qEl) {
          $q.blur();
          after.push(function(){
            return bench('re-focus', function(){
              return partialize$.apply(this, [setTimeout, [void 8, 1], [0]])(function(){
                return $q.focus();
              });
            });
          });
        }
      }
      return next();
    },
    draw: function(window, next){
      var after, i$, len$, f, this$ = this;
      after = window.afterPrepare;
      for (i$ = 0, len$ = after.length; i$ < len$; ++i$) {
        f = after[i$];
        f();
      }
      bench('filter-state', function(){
        window.$('#search_filters [name=forum_id]').val(this$.searchopts.forum_id);
        return window.$('#search_filters [name=within]').val(this$.searchopts.within);
      });
      (function(){
        var wc, locals, pnumToHref;
        wc = window.component || (window.component = {});
        locals = {
          step: 10,
          qty: this$.elres.total,
          activePage: this$.page
        };
        pnumToHref = mkSearchPnumToHref(this$.searchopts);
        return paginatorComponent(window, locals, pnumToHref);
      })();
      bench('layout-static', function(){
        return layoutStatic.call(this$, window, 'search');
      });
      return next();
    }
  },
  onInitial: function(w, next){
    $R(joinSearch).bindTo(w.rSocket);
    return next();
  },
  onMutate: function(w, next){
    joinSearch(w.socket);
    return next();
  },
  onLoad: function(w, next){
    window.$newHits = w.$('<div/>');
    alignBreadcrumb();
    pagerInit(w);
    return next();
  },
  onUnload: function(w, nextMutant, next){
    endSearch(w);
    delete w.searchopts;
    return next();
  }
};
out$.page = page = {
  'static': function(window, next){
    window.replaceHtml(window.$('#left_container'), '');
    window.replaceHtml(window.$('#main_content'), this.page.config.main_content);
    layoutStatic.call(this, window, 'page');
    return next();
  },
  onLoad: function(window, next){
    pagerInit(window);
    return next();
  },
  onMutate: function(window, next){
    scrollToTop();
    return next();
  }
};
out$.privateSite = privateSite = {
  'static': function(window, next){
    window.$('header').remove();
    window.$('footer').remove();
    window.$('#left_content').remove();
    window.$('#main_content').remove();
    return next();
  },
  onLoad: function(window, next){
    var ref$;
    ref$ = window.fancyboxParams;
    ref$.closeBtn = false;
    ref$.closeClick = false;
    ref$.modal = true;
    Auth.showLoginDialog();
    return next();
  }
};
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
function partialize$(f, args, where){
  var context = this;
  return function(){
    var params = slice$.call(arguments), i,
        len = params.length, wlen = where.length,
        ta = args ? args.concat() : [], tw = where ? where.concat() : [];
    for(i = 0; i < len; ++i) { ta[tw[0]] = params[i]; tw.shift(); }
    return len < wlen && len ?
      partialize$.apply(context, [f, ta, tw]) : f.apply(context, ta);
  };
}
})(require("__browserify_process"),window)
},{"url":19,"./shared-helpers.ls":4,"../component/AdminUpgrade.ls":21,"./forum-urls.ls":14,"../component/Paginator.ls":16,"../component/AdminMenu.ls":22,"../component/PhotoCropper.ls":15,"__browserify_process":20}],12:[function(require,module,exports){
var furl, forMutant, requiredTasks, difference, expandKeys, expandString, cc, recommendation, out$ = typeof exports != 'undefined' && exports || this, slice$ = [].slice;
furl = require('./forum-urls.ls');
out$.forMutant = forMutant = {
  forum: {
    "menu": 1,
    "forum :forum-id": 1,
    "forums :forum-id": 1,
    "top-threads :forum-id": 1
  },
  thread: {
    "menu": 1,
    "sub-posts-tree :post-id :limit :offset": 1,
    "sub-posts-count :post-id": 1,
    "top-threads :forum-id": 1,
    "forum :forum-id": 1
  }
};
out$.requiredTasks = requiredTasks = function(arg$, arg1$){
  var src, srcVars, dst, dstVars;
  src = arg$[0], srcVars = arg$[1];
  dst = arg1$[0], dstVars = arg1$[1];
  return map(function(it){
    return it.replace(/ .*$/, '');
  })(
  keys(difference(expandKeys(src, srcVars), expandKeys(dst, dstVars))));
};
out$.difference = difference = function(a, b){
  var k, v, results$ = {};
  for (k in a) {
    v = a[k];
if (!b.hasOwnProperty(k)) {
      results$[k] = v;
    }
  }
  return results$;
};
out$.expandKeys = expandKeys = function(a, vars){
  var k, v, results$ = {};
  for (k in a) {
    v = a[k];
    results$[expandString(k, vars)] = v;
  }
  return results$;
};
out$.expandString = expandString = function(s, vars){
  return s.replace(/(:[\w-]+)/g, function(m, p){
    return vars[cc(p)];
  });
};
out$.cc = cc = function(s){
  var ref$, first, rest;
  ref$ = s.split('-'), first = ref$[0], rest = slice$.call(ref$, 1);
  return first.replace(/^:/, '') + join('')(
  map(function(it){
    return it.charAt(0).toUpperCase() + it.slice(1);
  })(
  rest));
};
out$.recommendation = recommendation = function(path, lastPath){
  var meta, lastMeta, simplify, mutant, lastMutant, defaultRecommendation, metaVars, lastMetaVars, src, dst, keep;
  meta = furl.parse(path);
  lastMeta = furl.parse(lastPath);
  simplify = function(t){
    if (t.match(/^thread/)) {
      return 'thread';
    } else {
      return t;
    }
  };
  mutant = simplify(meta.type);
  lastMutant = simplify(lastMeta.type);
  defaultRecommendation = {
    remove: ['menu']
  };
  switch (mutant) {
  case 'forum':
    metaVars = {
      forumId: 1
    };
    lastMetaVars = {
      forumId: meta.forumUri === lastMeta.forumUri ? 1 : 2
    };
    if (lastMutant === 'thread') {
      lastMetaVars.postId = 1;
      lastMetaVars.limit = 10;
      lastMetaVars.offset = 0;
    }
    src = forMutant[mutant];
    dst = forMutant[lastMutant];
    keep = requiredTasks([src, metaVars], [dst, lastMetaVars]);
    return {
      keep: keep
    };
  case 'thread':
    metaVars = {
      forumId: 1,
      postId: 1,
      limit: 10,
      offset: ((meta.page || 1) - 1) * 10
    };
    lastMetaVars = {
      forumId: meta.forumUri === lastMeta.forumUri ? 1 : 2
    };
    if (lastMutant === 'thread') {
      lastMetaVars.postId = meta.threadUri === lastMeta.threadUri ? 1 : 2;
      lastMetaVars.limit = 10;
      lastMetaVars.offset = ((lastMeta.page || 1) - 1) * 10;
    }
    src = forMutant[mutant];
    dst = forMutant[lastMutant];
    keep = requiredTasks([src, metaVars], [dst, lastMetaVars]);
    return {
      keep: keep
    };
  default:
    return defaultRecommendation;
  }
};
},{"./forum-urls.ls":14}],14:[function(require,module,exports){
var fsm, typeOfPart, machine, parse, forumUri, out$ = typeof exports != 'undefined' && exports || this, slice$ = [].slice;
fsm = require('./fsm.ls');
/*
states =
  * \initial
  * \forum
  * \new-thread
  * \-thread-marker
  * \thread
  * \thread-page
  * \-page-marker
  * \thread-permalink
  * \-permalink-page-marker
  * \thread-permalink-page
  * \-edit-marker
  * \edit
  * \error

inputs =
  * \string
  * \number
  * \new
  * \edit
  * \t
  * \page
*/
out$.typeOfPart = typeOfPart = function(i){
  switch (i) {
  case 'page':
    return 'page';
  case 't':
    return 't';
  case 'edit':
    return 'edit';
  case 'new':
    return 'new';
  default:
    if (i.match(/[\.]/)) {
      return 'fbdn';
    }
    if (i.match(/^\d+$/)) {
      return 'number';
    } else {
      return 'string';
    }
  }
};
out$.machine = machine = {
  initial: {
    string: 'forum',
    number: 'forum',
    'new': 'forum',
    edit: 'forum',
    t: 'forum',
    page: 'forum',
    fbdn: 'error'
  },
  forum: {
    string: 'forum',
    number: 'forum',
    'new': 'new-thread',
    edit: 'forum',
    t: '-thread-marker',
    page: 'forum',
    fbdn: 'error'
  },
  'new-thread': {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  '-thread-marker': {
    string: 'thread',
    number: 'thread',
    'new': 'thread',
    edit: 'thread',
    t: 'thread',
    page: 'thread',
    fbdn: 'error'
  },
  thread: {
    string: 'thread-permalink',
    number: 'thread-permalink',
    'new': 'error',
    edit: '-edit-marker',
    t: 'error',
    page: '-page-marker',
    fbdn: 'error'
  },
  'thread-permalink': {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: '-edit-marker',
    t: 'error',
    page: '-permalink-page-marker',
    fbdn: 'error'
  },
  '-edit-marker': {
    string: 'error',
    number: 'edit',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  edit: {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  '-permalink-page-marker': {
    string: 'error',
    number: 'thread-permalink-page',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  'thread-permalink-page': {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  '-page-marker': {
    string: 'error',
    number: 'thread-page',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  'thread-page': {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  },
  error: {
    string: 'error',
    number: 'error',
    'new': 'error',
    edit: 'error',
    t: 'error',
    page: 'error',
    fbdn: 'error'
  }
};
out$.parse = parse = function(path){
  var parts, inputs, type, meta, uriParts, page, n, edit, id;
  parts = reject(function(it){
    return it === '';
  })(
  path.split('/'));
  inputs = map(typeOfPart, parts);
  type = fsm.newState(machine, 'initial', inputs);
  meta = (function(){
    var ref$, ref1$;
    switch (type) {
    case 'initial':
      return {
        incomplete: true
      };
    case 'forum':
      return {
        forumUri: "/" + parts.join('/')
      };
    case 'new-thread':
      return {
        forumUri: "/" + slice$.call(parts, 0, parts.length - 1).join('/')
      };
    case 'thread':
      return {
        forumUri: forumUri(path),
        threadUri: "/" + parts.join('/')
      };
    case 'thread-page':
      ref$ = splitAt(parts.length - 2, parts), uriParts = ref$[0], ref1$ = ref$[1], page = ref1$[0], n = ref1$[1];
      return {
        forumUri: forumUri(path),
        threadUri: "/" + uriParts.join('/'),
        page: parseInt(n)
      };
    case 'thread-permalink':
      return {
        forumUri: forumUri(path),
        threadUri: "/" + parts.join('/'),
        slug: parts[parts.length - 1]
      };
    case 'thread-permalink-page':
      ref$ = splitAt(parts.length - 2, parts), uriParts = ref$[0], ref1$ = ref$[1], page = ref1$[0], n = ref1$[1];
      return {
        forumUri: forumUri(path),
        threadUri: "/" + uriParts.join('/'),
        page: parseInt(n)
      };
    case 'edit':
      ref$ = splitAt(parts.length - 2, parts), uriParts = ref$[0], ref1$ = ref$[1], edit = ref1$[0], id = ref1$[1];
      return {
        forumUri: forumUri(path),
        threadUri: "/" + uriParts.join('/'),
        id: parseInt(id)
      };
    default:
      return {
        incomplete: true
      };
    }
  }());
  return import$({
    type: type,
    parts: parts,
    path: "/" + parts.join('/')
  }, meta);
};
out$.forumUri = forumUri = function(path){
  var parts, inputs, t, forumStates;
  parts = reject(function(it){
    return it === '';
  })(
  path.split('/'));
  inputs = map(typeOfPart, parts);
  t = function(state, input){
    return fsm.newState(machine, state, [input]);
  };
  forumStates = takeWhile(function(it){
    return it === 'initial' || it === 'forum';
  })(
  scan(t, 'initial', inputs));
  return '/' + join('/')(
  take(forumStates.length - 1)(
  parts));
};
/*
Try these in the REPL.

furl.parse '/otherground-forum'
furl.parse '/otherground-forum/supportground'
furl.parse '/otherground-forum/new'                                                 # we can identify the new thread marker
furl.parse '/otherground-forum/supportground/t/new'                                 # threads can be called "new"
furl.parse '/otherground-forum/supportground/t/edit'                                # threads can be called "edit"
furl.parse '/otherground-forum/supportground/t/edit/edit'                           # ...but we can still identify the edit marker
furl.parse '/otherground-forum/supportground/t/edit/edit/1234'                      # and know this is an edit url
furl.parse '/otherground-forum/supportground/t/new-thing'                  
furl.parse '/otherground-forum/supportground/t/new-thing/page/5'                    # pretty page urls are not a problem
furl.parse '/otherground-forum/supportground/t/this-is-a-test/edit/2108'
*/
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"./fsm.ls":23}],13:[function(require,module,exports){
var ch;
ch = require('./client-helpers.ls');
ch.lazyLoadSocketio(function(){
  window.socket = io.connect();
  socket.on('connect', function(){
    return setTimeout(function(){
      return window.rSocket(socket);
    }, 50);
  });
  socket.on('disconnect', function(){});
  socket.on('enter-site', function(message, cb){
    return setOnlineUser(message != null ? message.id : void 8);
  });
  socket.on('leave-site', function(message, cb){
    return $("[data-user-id=" + message.id + "] .profile.photo").removeClass('online');
  });
  socket.on('thread-impression', function(thread, cb){
    if (thread.forum_id === window.activeForumId) {
      return $("#left_container ul.threads li[data-id=" + thread.id + "] span.views").html(thread.views + "<i>views</i>");
    }
  });
  socket.on('thread-create', function(thread, cb){
    if (window.activeForumId === (thread != null ? thread.forum_id : void 8)) {
      return $ui.trigger('thread-create', thread);
    }
  });
  socket.on('post-create', function(post, cb){
    var pc, sel, animateIn;
    window.activeThreadId || (window.activeThreadId = -1);
    if (post.thread_id === window.activeThreadId || (post.user_id === user.id && mutator === 'profile')) {
      if ($("post_" + post.id).length) {
        return;
      }
      pc = $("#left_container ul.threads li[data-id=" + post.thread_id + "] span.post-count");
      pc.html((parseInt(pc.text()) + 1) + " <i>posts</i>");
      sel = "#post_" + post.parent_id + " + .children";
      animateIn = function(e){
        return $(e).addClass('post-animate-in');
      };
      return renderAndAppend(window, $(sel), 'post', {
        post: post
      }, function(newPost){
        if (post.user_id === (typeof user != 'undefined' && user !== null ? user.id : void 8)) {
          mutants.forum.onPersonalize(window, user, function(){});
          setTimeout(function(){
            return animateIn(newPost);
          }, 250);
          if (mutator === 'forum') {
            return awesomeScrollTo(newPost, 300);
          }
        } else {
          return animateIn(newPost);
        }
      });
    }
  });
  socket.on('new-hit', function(hit){
    var hs, suffix, realtimeHtml, x$;
    hs = hit._source;
    window.newHits++;
    window.$newHits.prepend(jade.templates.post({
      post: hs
    }));
    window.showNewHits = function(){
      return window.awesomeScrollTo('#main_content', null, function(){
        $('#new_posts').html('').append(window.$newHits).effect('flash');
        return false;
      });
    };
    window.hideNewHits = function(){
      $('#new_posts').html('');
      return false;
    };
    suffix = window.newHits === 1 ? '' : 's';
    realtimeHtml = "<a href=\"#\" onclick=\"showNewHits()\">\n  " + window.newHits + " new result" + suffix + "\n</a>";
    x$ = $('#new_hit_count');
    x$.find('.count').html(window.newHits);
    x$.show().effect('highlight');
    $('#new_hits').html(realtimeHtml);
    return $('#breadcrumb').slideDown(300);
  });
  socket.on('debug', function(message, cb){
    return typeof console != 'undefined' && console !== null ? console.log('debug', message) : void 8;
  });
  return Chat.clientSocketInit(socket);
});
},{"./client-helpers.ls":5}],6:[function(require,module,exports){
var cheerio, useJsdom, domWindow, isSurfable, slice$ = [].slice;
if (typeof window != 'undefined' && window !== null) {
  true;
} else {
  cheerio = require('cheerio');
  useJsdom = false;
  domWindow = function(html, cb){
    var scripts, jsdom_opts, jsdom_done, this$ = this;
    scripts = ['../../public/local/jquery-1.9.1.min.js', '../../node_modules/reactivejs/src/reactive.js'];
    jsdom_opts = {
      html: html,
      scripts: scripts
    };
    jsdom_done = function(err, window){
      if (err) {
        return cb(err);
      }
      window.$ = window.jQuery;
      return cb(null, window);
    };
    return jsdom.env(jsdom_opts, jsdom_done);
  };
}
this.run = function(template, opts, cb){
  /*
  run returns void because it mutates the window object
  
  on the server side we need to know the base html before we can mutate it
  
  on the client side the callback returns nothing because the dom has been mutated already
  on the server side the callback will return html
  
  templates are objects with up to four methods:
  static, onLoad, onInitial, onMutate
  
  static is client or serverside and this phase is purely for html dom tree creation/manipulation
  
  onLoad happens when a mutant template is run, regardless of whether it is the initial pageload, or a mutation
  
  onInitial only happens on an initial pageload (not on mutation)
  
  onMutate only happens on a mutation (not on an initial pageload)
  */
  var initial_run, params, html, user, ref$, prepare, rawDraw, raf, draw, onLoad, onInitial, onMutate, onPersonalize, renderMutant, render, varStatements, marshal, runStatic, $;
  cb == null && (cb = function(){});
  initial_run = opts.initial;
  params = opts.locals || {};
  html = opts.html;
  user = opts.user;
  if (((ref$ = template['static']) != null && ref$.prepare) && ((ref$ = template['static']) != null && ref$.draw)) {
    prepare = ((ref$ = template['static']) != null ? ref$.prepare : void 8) || function(w, cb){
      return cb();
    };
    rawDraw = ((ref$ = template['static']) != null ? ref$.draw : void 8) || function(w, cb){
      return cb();
    };
  } else {
    prepare = function(w, cb){
      return cb();
    };
    rawDraw = template['static'] || function(w, cb){
      return cb();
    };
  }
  if (raf = typeof window != 'undefined' && window !== null ? window.requestAnimationFrame : void 8) {
    draw = function(w, cb){
      var params;
      params = this;
      return raf(function(){
        var beg;
        beg = new Date;
        return rawDraw.call(params, w, function(){
          var end;
          end = new Date;
          cb();
          return partialize$.apply(this, [setTimeout, [void 8, 1], [0]])(function(){
            var dur, info;
            dur = end - beg;
            if (true) {
              info = "request-animation-frame took " + dur + "ms in mutant static draw phase";
              return console.warn(info);
            }
          });
        });
      });
    };
  } else {
    draw = rawDraw;
  }
  onLoad = template.onLoad || function(w, cb){
    return cb();
  };
  onInitial = template.onInitial || function(w, cb){
    return cb();
  };
  onMutate = template.onMutate || function(w, cb){
    return cb();
  };
  onPersonalize = template.onPersonalize || function(w, u, cb){
    return cb();
  };
  require('../../build/client-jade.js');
  function replaceHtml($el, html){
    var el, newEl;
    if (typeof window != 'undefined' && window !== null) {
      el = $el[0];
      newEl = el.cloneNode(false);
      newEl.innerHTML = html;
      el.parentNode.replaceChild(newEl, el);
    } else {
      $el.html(html);
    }
  }
  renderMutant = function(id, tmpl){
    return replaceHtml($("#" + id), jade.templates[tmpl](params));
  };
  render = function(t){
    return jade.templates[t](params);
  };
  if (typeof window != 'undefined' && window !== null) {
    window.render = render;
    window.replaceHtml = replaceHtml;
    if (initial_run) {
      return onLoad.call(params, window, function(err){
        if (err) {
          return cb(err);
        }
        return onInitial.call(params, window, function(err){
          if (err) {
            return cb(err);
          }
          if (user) {
            return onPersonalize.call(params, window, user, cb);
          } else {
            return cb();
          }
        });
      });
    } else {
      window.renderMutant = function(target, tmpl){
        return jade.render(window.document.getElementById(target), tmpl, params);
      };
      window.marshal = function(key, val){
        return window[key] = val;
      };
      return prepare.call(params, window, function(err){
        var hasDraw, ref$;
        if (err) {
          return cb(err);
        }
        hasDraw = !!((ref$ = template['static']) != null && ref$.draw);
        return (hasDraw ? draw : rawDraw).call(params, window, function(err){
          if (err) {
            return cb(err);
          }
          return onLoad.call(params, window, function(err){
            if (err) {
              return cb(err);
            }
            return onMutate.call(params, window, function(err){
              if (err) {
                return cb(err);
              }
              if (user) {
                return onPersonalize.call(params, window, user, cb);
              } else {
                return cb();
              }
            });
          });
        });
      });
    }
  } else if (html) {
    varStatements = [];
    marshal = function(key, val){
      if (val !== void 8) {
        return varStatements.push("window['" + key + "']=" + JSON.stringify(val));
      }
    };
    runStatic = function(window){
      window.render = render;
      window.replaceHtml = replaceHtml;
      return prepare.call(params, window, function(err){
        if (err) {
          return cb(err);
        }
        return draw.call(params, window, function(err){
          var s;
          if (err) {
            return cb(err);
          }
          if (useJsdom) {
            window.$('script.jsdom').remove();
            s = window.document.createElement('script');
            window.$(s).attr('type', 'text/javascript');
            window.$(s).text(varStatements.join(';'));
            window.document.body.appendChild(s);
          } else {
            $('body').append("<script type=\"text/javascript\">" + varStatements.join(';') + "</script>");
          }
          return cb(null, useJsdom
            ? "<!doctype html>" + window.document.outerHTML
            : $.html());
        });
      });
    };
    if (useJsdom) {
      return domWindow(html, function(err, jsdomWindow){
        if (err) {
          return cb(err);
        }
        jsdomWindow.marshal = marshal;
        jsdomWindow.renderMutant = function(target, tmpl){
          return jade.render(jsdomWindow.document.getElementById(target), tmpl, params);
        };
        return runStatic(jsdomWindow);
      });
    } else {
      $ = cheerio.load(html);
      return runStatic({
        marshal: marshal,
        renderMutant: renderMutant,
        $: $
      });
    }
  } else {
    throw new Error("need html for serverside");
  }
};
isSurfable = function(r){
  return r.callbacks.some(function(m){
    return m.surfable;
  });
};
this.surfableRoutes = function(app){
  var i$, ref$, len$, r, results$ = [];
  for (i$ = 0, len$ = (ref$ = app.routes.get).length; i$ < len$; ++i$) {
    r = ref$[i$];
    if (isSurfable(r)) {
      results$.push(r.regexp.toString());
    }
  }
  return results$;
};
function partialize$(f, args, where){
  var context = this;
  return function(){
    var params = slice$.call(arguments), i,
        len = params.length, wlen = where.length,
        ta = args ? args.concat() : [], tw = where ? where.concat() : [];
    for(i = 0; i < len; ++i) { ta[tw[0]] = params[i]; tw.shift(); }
    return len < wlen && len ?
      partialize$.apply(context, [f, ta, tw]) : f.apply(context, ta);
  };
}
},{"cheerio":19,"../../build/client-jade.js":24}],15:[function(require,module,exports){
var Component, sh, templates, PhotoCropper;
Component = require('yacomponent');
sh = require('../app/shared-helpers.ls');
templates = require('../build/component-jade.js').templates;
module.exports = PhotoCropper = (function(superclass){
  var prototype = extend$((import$(PhotoCropper, superclass).displayName = 'PhotoCropper', PhotoCropper), superclass).prototype, constructor = PhotoCropper;
  PhotoCropper.pc = null;
  PhotoCropper.start = function(arg$, cb){
    var ref$, title, ref1$, mode, photo, aspectRatio, endpointUrl;
    ref$ = arg$ != null
      ? arg$
      : {}, title = (ref1$ = ref$.title) != null ? ref1$ : "Profile Photo", mode = (ref1$ = ref$.mode) != null ? ref1$ : 'upload', photo = (ref1$ = ref$.photo) != null ? ref1$ : null, aspectRatio = (ref1$ = ref$.aspectRatio) != null
      ? ref1$
      : 1 / 1, endpointUrl = (ref1$ = ref$.endpointUrl) != null ? ref1$ : null;
    cb == null && (cb = function(){});
    if (!photo) {
      photo = user.photo;
    }
    if (!endpointUrl) {
      endpointUrl = "/resources/users/" + user.id + "/avatar";
    }
    return lazyLoadFancybox(function(){
      PhotoCropper.pc = new PhotoCropper({
        aspectRatio: aspectRatio,
        endpointUrl: endpointUrl,
        locals: {
          title: title,
          photo: photo,
          endpointUrl: endpointUrl
        }
      });
      if (mode === 'crop') {
        PhotoCropper.pc.cropMode();
      }
      return $.fancybox.open(PhotoCropper.pc.$, {
        afterLoad: cb
      });
    });
  };
  function PhotoCropper(arg$){
    var title, aspectRatio;
    title = arg$.title, aspectRatio = arg$.aspectRatio, this.endpointUrl = arg$.endpointUrl;
    this.crop = bind$(this, 'crop', prototype);
    this.aspectRatio = parseFloat(aspectRatio);
    PhotoCropper.superclass.apply(this, arguments);
  }
  prototype.template = templates.PhotoCropper;
  prototype.jcrop = null;
  prototype.init = function(){
    if (this.aspectRatio) {
      return 1;
    } else {
      return 1;
    }
  };
  prototype.onAttach = function(){
    var this$ = this;
    this.$.find('.upload input[type=file]').html5Uploader({
      name: 'avatar',
      postUrl: this.endpointUrl,
      onSuccess: function(xhr, file, rJson){
        var r;
        r = JSON.parse(rJson);
        this$.$.find('img').attr('src', cacheUrl + "" + r.url);
        return this$.cropMode();
      }
    });
    return this.$.find('.crop .button').click(this.crop);
  };
  prototype.upload = function(){
    var data, jqxhr, this$ = this;
    data = this.$.find('form').serialize();
    jqxhr = constructor.$.post(this.endpointUrl, data);
    jqxhr.done(function(r){
      return this$.cropMode(r);
    });
    return jqxhr.fail(function(r){
      return console.warn('upload failed', r);
    });
  };
  prototype.uploadMode = function(){
    this.$.find('.crop').hide();
    return this.$.find('.upload').show();
  };
  prototype.cropMode = function(){
    var this$ = this;
    this.$.find('.upload').hide();
    this.$.find('.crop').show();
    return lazyLoadJcrop(function(){
      var options, fb, saveJcrop;
      if (this$.jcrop) {
        this$.jcrop.destroy();
      }
      options = {
        aspectRatio: this$.aspectRatio
      };
      import$(options, this$.boxDimensions());
      fb = constructor.$.fancybox;
      saveJcrop = function(j){
        return this$.jcrop = j;
      };
      return this$.$.find('.crop img').Jcrop(options, function(){
        saveJcrop(this);
        return fb.update();
      });
    });
  };
  prototype.boxDimensions = function(){
    var fancyboxSideMargin, resize;
    fancyboxSideMargin = 35;
    resize = 0.95;
    return {
      boxWidth: parseInt(constructor.$(window).width() - fancyboxSideMargin * 2),
      boxHeight: parseInt(constructor.$(window).height() * resize)
    };
  };
  prototype.crop = function(ev){
    var data, jqxhr, this$ = this;
    data = this.jcrop.tellSelect();
    if (data.height === 0 || data.width === 0) {
      return;
    }
    jqxhr = constructor.$.ajax({
      type: 'PUT',
      data: data,
      url: this.endpointUrl
    });
    jqxhr.done(function(r){
      return constructor.$.fancybox.close();
    });
    return jqxhr.fail(function(r){
      return console.warn('upload failed', r);
    });
  };
  return PhotoCropper;
}(Component));
function bind$(obj, key, target){
  return function(){ return (target || obj)[key].apply(obj, arguments) };
}
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"../app/shared-helpers.ls":4,"yacomponent":26}],7:[function(require,module,exports){
var Component, ch, templates, Auth;
Component = require('yacomponent');
ch = require('../app/client-helpers.ls');
templates = require('../build/component-jade.js').templates;
module.exports = Auth = (function(superclass){
  var prototype = extend$((import$(Auth, superclass).displayName = 'Auth', Auth), superclass).prototype, constructor = Auth;
  prototype.componentName = 'Auth';
  prototype.template = templates.Auth;
  Auth.showLoginDialog = function(cb){
    var this$ = this;
    cb == null && (cb = function(){});
    return ch.lazyLoadFancybox(function(){
      return ch.lazyLoad(function(){
        return window.$.fn.complexify;
      }, window.cacheUrl + "/local/jquery.complexify.min.js", null, function(){
        if (!window._auth) {
          window._auth = new Auth({
            locals: {
              siteName: window.siteName,
              inviteOnly: window.inviteOnly
            }
          }, $('#auth'));
          if (Auth.afterLogin) {
            window._auth.afterLogin = Auth.afterLogin;
          }
        }
        if (!$('.fancybox-overlay:visible').length) {
          $.fancybox.open('#auth', window.fancyboxParams);
        }
        setTimeout(function(){
          return $('#auth input[name=username]').focus();
        }, 100);
        window.COMPLEXIFY_BANLIST = ['god', 'money', 'password', 'love'];
        $('#auth [name="password"]').complexify({}, function(pass, percent){
          var e;
          e = $(this).parent();
          e.find('.strength-meter').toggleClass('strong', pass);
          return e.find('.strength').css({
            height: parseInt(percent) + '%'
          });
        });
        return cb(window._auth.$);
      });
    });
  };
  Auth.showInfoDialog = function(msg, msg2, remove, cb){
    msg2 == null && (msg2 = '');
    remove == null && (remove = '');
    cb == null && (cb = function(){});
    return Auth.showLoginDialog(function(){
      var fb;
      fb = $('.fancybox-wrap:first');
      fb.find('#msg').html(msg);
      fb.find('.dialog .msg2').html(msg2);
      ch.switchAndFocus(remove, 'on-dialog', '');
      return cb(window._auth.$);
    });
  };
  Auth.showRegisterDialog = function(remove, cb){
    remove == null && (remove = '');
    cb == null && (cb = function(){});
    return Auth.showLoginDialog(function(){
      ch.switchAndFocus(remove, 'on-register', '.register input:first');
      return cb(window._auth.$);
    });
  };
  Auth.showResetPasswordDialog = function(){
    return Auth.showLoginDialog(function($auth){
      var $form, hash;
      $form = $auth.find('.reset form');
      ch.switchAndFocus('', 'on-reset', '#auth .reset input:first');
      hash = location.hash.split('=')[1];
      $form.find('input[type=hidden]').val(hash);
      console.log(hash, $form, $auth);
      return $.post('/auth/forgot-user', {
        forgot: hash
      }, function(r){
        if (r.success) {
          $form.find('h2:first').html('Choose a New Password');
          return $form.find('input').prop('disabled', false);
        } else {
          return $form.find('h2:first').html("Couldn't find you. :(");
        }
      });
    });
  };
  Auth.loginWithToken = function(){
    return cors.get(authDomain + "/auth/once", {
      site_id: window.siteId
    }, function(r){
      if (r) {
        return $.post('/auth/once', {
          token: r.token
        }, function(rr){
          if (rr.success) {
            Auth.afterLogin();
            return window.location.hash = '';
          }
        });
      }
    });
  };
  Auth.requireLogin = function(fn){
    return function(){
      if (window.user) {
        return fn.apply(window, arguments);
      } else {
        Auth.showLoginDialog();
        return false;
      }
    };
  };
  Auth.requireRegistration = function(fn){
    return function(){
      if (window.user) {
        return fn.apply(window, arguments);
      } else {
        Auth.showRegisterDialog();
        return false;
      }
    };
  };
  function Auth(){
    this.choose = bind$(this, 'choose', prototype);
    this.togglePassword = bind$(this, 'togglePassword', prototype);
    this.resend = bind$(this, 'resend', prototype);
    this.resetPassword = bind$(this, 'resetPassword', prototype);
    this.forgotPassword = bind$(this, 'forgotPassword', prototype);
    this.register = bind$(this, 'register', prototype);
    this.afterLogin = bind$(this, 'afterLogin', prototype);
    this.login = bind$(this, 'login', prototype);
    this.onDetach = bind$(this, 'onDetach', prototype);
    this.onAttach = bind$(this, 'onAttach', prototype);
    Auth.superclass.apply(this, arguments);
  }
  prototype.onAttach = function(){
    this.$.find('.social a').click(this.openOauthWindow);
    this.$.on('submit', '.login form', this.login);
    this.$.on('submit', '.register form', this.register);
    this.$.on('submit', '.forgot form', this.forgotPassword);
    this.$.on('submit', '.reset form', this.resetPassword);
    this.$.on('click', '.toggle-password', this.togglePassword);
    this.$.on('submit', '.choose form', this.choose);
    this.$.on('click', '.dialog a.resend', this.resend);
    this.$.on('click', '.onclick-close-fancybox', function(){
      return $.fancybox.close();
    });
    this.$.on('click', '.onclick-show-login', function(){
      return ch.switchAndFocus('on-forgot on-register on-reset', 'on-login', '#auth input[name=username]');
    });
    this.$.on('click', '.onclick-show-forgot', function(){
      return ch.switchAndFocus('on-error', 'on-forgot', '#auth input[name=email]');
    });
    this.$.on('click', '.onclick-show-choose', function(){
      return ch.switchAndFocus('on-login', 'on-choose', '#auth input[name=username]');
    });
    this.$.on('click', '.onclick-show-register', function(){
      return ch.switchAndFocus('on-login', 'on-register', '#auth input[name=username]');
    });
    this.$.on('keyup', '.fancybox-inner input', function(it){
      if (it.which === 27) {
        $.fancybox.close();
        return false;
      }
    });
  };
  prototype.onDetach = function(){};
  prototype.openOauthWindow = function(ev){
    var url;
    url = $(this).attr('href');
    window.open(url, 'popup', "width=980,height=650,scrollbars=no,toolbar=no,location=no,directories=no,status=no,menubar=no");
    return false;
  };
  prototype.login = function(ev){
    var $form, u, p, s, params, this$ = this;
    $form = $(ev.target);
    u = $form.find('input[name=username]');
    p = $form.find('input[name=password]');
    s = $form.find('input[type=submit]');
    params = {
      username: u.val(),
      password: p.val()
    };
    s.attr('disabled', 'disabled');
    $.post($form.attr('action'), params, function(r){
      var resend, $fancybox;
      if (r.success) {
        $.fancybox.close();
        if (this$.afterLogin) {
          this$.afterLogin();
        }
        if (initialMutant === 'privateSite') {
          window.location.reload();
        }
      } else {
        if (r.type === 'unverified-user') {
          resend = "To resend your verification email, <a class=\"resend\" data-email=\"" + r.email + "\">click here</a>.";
          constructor.showInfoDialog('Please verify your account first.', resend, 'on-login');
        } else {
          $fancybox = $form.parents('.fancybox-wrap:first');
          $fancybox.addClass('on-error');
          $fancybox.removeClass('shake');
          ch.showTooltip($form.find('.tooltip'), 'Try again!');
          setTimeout(function(){
            $fancybox.addClass('shake');
            return u.focus();
          }, 10);
        }
      }
      return s.removeAttr('disabled');
    });
    return false;
  };
  prototype.afterLogin = function(){};
  prototype.register = function(ev){
    var $form, s, this$ = this;
    $form = $(ev.target);
    $form.find('input').removeClass('validation-error');
    s = $form.find('input[type=submit]');
    s.attr('disabled', 'disabled');
    $.post($form.attr('action'), $form.serialize(), function(r){
      var msgs, ref$;
      if (r.success) {
        $form.find("input:text,input:password").removeClass('validation-error').val('');
        ch.switchAndFocus('on-register', 'on-dialog', '');
        Auth.afterLogin();
        Auth.showInfoDialog("Welcome to " + siteName);
      } else {
        msgs = [];
        if ((ref$ = r.errors) != null) {
          ref$.forEach(function(e){
            var $e;
            $e = $form.find("input[name=" + e.param + "]");
            $e.addClass('validation-error').focus();
            return msgs.push(e.msg);
          });
        }
        ch.showTooltip($form.find('.tooltip'), unique(msgs).join('<br>'));
        shakeDialog($form, 100);
      }
      return s.removeAttr('disabled');
    });
    return false;
  };
  prototype.forgotPassword = function(ev){
    var $form, s, this$ = this;
    $form = $(ev.target);
    s = $form.find('input[type=submit]');
    s.attr('disabled', 'disabled');
    $.post($form.attr('action'), $form.serialize(), function(r){
      var msg, ref$, ref1$;
      if (r.success) {
        Auth.showInfoDialog('Check your inbox for reset link!', '', 'on-forgot');
      } else {
        $form.find('input:first').focus();
        msg = ((ref$ = r.errors) != null ? (ref1$ = ref$[0]) != null ? ref1$.name : void 8 : void 8) || ((ref$ = r.errors) != null ? (ref1$ = ref$[0]) != null ? ref1$.msg : void 8 : void 8) || 'Unable to find you';
        ch.showTooltip($form.find('.tooltip'), msg);
        shakeDialog($form, 100);
      }
      return s.removeAttr('disabled');
    });
    return false;
  };
  prototype.resetPassword = function(ev){
    var $form, password, s, this$ = this;
    $form = $(ev.target);
    password = $form.find('input[name=password]').val();
    if (password.match(/^\s*$/)) {
      ch.showTooltip($form.find('.tooltip'), "Password may not be blank");
      return false;
    }
    s = $form.find('input[type=submit]');
    s.attr('disabled', 'disabled');
    $.post($form.attr('action'), $form.serialize(), function(r){
      if (r.success) {
        $form.find('input').prop('disabled', true);
        ch.showTooltip($form.find('.tooltip'), "Password changed!");
        location.hash = '';
        $form.find('input[name=password]').val('');
        setTimeout(function(){
          ch.switchAndFocus('on-reset', 'on-login', '#auth .login input:first');
          return ch.showTooltip($('#auth .login form .tooltip'), "Now log in!");
        }, 1500);
      } else {
        ch.showTooltip($form.find('.tooltip'), "Choose a better password");
      }
      return s.removeAttr('disabled');
    });
    return false;
  };
  prototype.resend = function(ev){
    var email;
    email = $('.dialog a.resend').data('email');
    return $.post('/auth/resend', {
      email: email
    }, function(r){
      if (r.success) {
        return constructor.showInfoDialog('Verification email sent again.', 'Please check your email.  It might be in your spam.');
      } else {
        return constructor.showInfoDialog('There was a problem sending the email', 'Please try again.');
      }
    });
  };
  prototype.togglePassword = function(ev){
    var e, p;
    e = $(ev.target);
    p = e.prev('[name=password]');
    if (p.attr('type') === 'password') {
      e.html('Hide');
      p.attr('type', 'text');
    } else {
      e.html('Show');
      p.attr('type', 'password');
    }
    setTimeout(function(){
      return p.focus();
    }, 10);
    return false;
  };
  prototype.choose = function(ev){
    var $form, s, this$ = this;
    $form = $(ev.target);
    s = $form.find('input[type=submit]');
    s.attr('disabled', 'disabled');
    $.post($form.attr('action'), $form.serialize(), function(r){
      if (r.success) {
        $.fancybox.close();
        this$.afterLogin();
        window.location.hash = '';
      } else {
        $form.find('input:first').focus();
        ch.showTooltip($form.find('.tooltip'), r.msg);
        shakeDialog($form, 100);
      }
      return s.removeAttr('disabled');
    });
    return false;
  };
  return Auth;
}(Component));
function bind$(obj, key, target){
  return function(){ return (target || obj)[key].apply(obj, arguments) };
}
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../app/client-helpers.ls":5,"../build/component-jade.js":25,"yacomponent":26}],4:[function(require,module,exports){
var __, secondsToHumanReadable, dateFields;
__ = require('lodash');
this.addCommas = function(s){
  return Str.reverse(
  join(',')(
  filter(function(it){
    return it.length;
  })(
  split(/(\d{3})/)(
  Str.reverse(
  s.toString())))));
};
this.titleCase = function(s){
  return s != null ? s.replace(/[\w]\S*/g, function(word){
    if (word === word.toUpperCase()) {
      if (word.indexOf('.') > -1 || word.indexOf('-') > -1 || word.length < 6) {
        return word;
      }
    }
    if (word.length > 3) {
      return word[0].toUpperCase() + word.substr(1).toLowerCase();
    }
    return word;
  }) : void 8;
};
this.ellipse = function(s, len, suffix){
  suffix == null && (suffix = '...');
  if ((s != null ? s.length : void 8) > len) {
    s = s.substr(0, len);
    if (s.lastIndexOf(' ') > 0) {
      s = s.substr(0, s.lastIndexOf(' ')) + suffix;
    }
  }
  return s;
};
this.dayName = function(i){
  switch (i) {
  case 0:
    return 'sun';
  case 1:
    return 'mon';
  case 2:
    return 'tue';
  case 3:
    return 'wed';
  case 4:
    return 'thu';
  case 5:
    return 'fri';
  case 6:
    return 'sat';
  }
};
this.prettyDayName = function(i){
  switch (i) {
  case 0:
    return 'Sunday';
  case 1:
    return 'Monday';
  case 2:
    return 'Tuesday';
  case 3:
    return 'Wednesday';
  case 4:
    return 'Thursday';
  case 5:
    return 'Friday';
  case 6:
    return 'Saturday';
  }
};
secondsToHumanReadable = function(secs){
  var hours, minutes, seconds, timestring;
  hours = Math.floor(secs / (60 * 60));
  secs -= hours * (60 * 60);
  minutes = Math.floor(secs / 60);
  secs -= minutes * 60;
  seconds = secs;
  timestring = '';
  if (hours > 1) {
    timestring += hours + ' hours';
  } else if (hours === 1) {
    timestring += '1 hour';
  }
  if (minutes) {
    if (hours) {
      timestring += ', ';
    }
    if (minutes > 1) {
      timestring += minutes + ' minutes';
    } else if (minutes === 1) {
      timestring += '1 minute';
    }
  } else if (!hours) {
    if (secs === 1) {
      timestring = secs + " second";
    } else {
      timestring = secs + " seconds";
    }
  }
  return timestring;
};
this.elapsedToHumanReadable = function(secsAgo){
  var suffix, human, d, weeks, months, years;
  suffix = 'ago';
  human = secsAgo < 30
    ? 'Just now!'
    : secsAgo < 60
      ? "A moment " + suffix
      : secsAgo < 120
        ? "A minute " + suffix
        : secsAgo < 86400
          ? secondsToHumanReadable(secsAgo) + ' ' + suffix
          : secsAgo < 172800
            ? 'Yesterday'
            : secsAgo < 604800
              ? (d = new Date(), d.setTime(d.getTime() - secsAgo * 1000), this.prettyDayName(d.getDay()))
              : secsAgo < 2628000
                ? (weeks = Math.floor(secsAgo / 604800), weeks === 1
                  ? "A week " + suffix
                  : weeks + " weeks " + suffix)
                : secsAgo < 31446925
                  ? (months = Math.floor(secsAgo / 2628000), months === 1
                    ? "A month " + suffix
                    : months + " months " + suffix)
                  : (years = Math.floor(secsAgo / 31446925), years === 1
                    ? "A year " + suffix
                    : years + " years " + suffix);
  return human.replace(/(\d+)/g, '<b>$1</b>');
};
this.djb2Hash = function(str){
  var hash, i$, len$, i, char;
  hash = 5381;
  for (i$ = 0, len$ = str.length; i$ < len$; ++i$) {
    i = str[i$];
    char = str.charCodeAt(i);
    hash = ((hash << 5) + hash) + char;
  }
  return hash;
};
dateFields = ['created', 'updated'];
this.addDates = function(o){
  var now, i$, ref$, len$, df, sub, k, i, v;
  now = Date.now();
  if (!o) {
    return o;
  }
  switch (typeof o) {
  case 'object':
    for (i$ = 0, len$ = (ref$ = dateFields).length; i$ < len$; ++i$) {
      df = ref$[i$];
      if (o[df]) {
        o[df] = new Date(o[df]);
        o[df + "_human"] = this.elapsedToHumanReadable((now - o[df]) / 1000);
        o[df + "_iso"] = o[df].toISOString();
      }
    }
    sub = __.keys(o).filter(function(k){
      return typeof o[k] === 'array' || typeof o[k] === 'object';
    });
    for (i$ = 0, len$ = sub.length; i$ < len$; ++i$) {
      k = sub[i$];
      o[k] = this.addDates(o[k]);
    }
    return o;
  case 'array':
    for (i$ = 0, len$ = o.length; i$ < len$; ++i$) {
      i = i$;
      v = o[i$];
      if (typeof v === 'object') {
        o[i] = this.addDates(o[i]);
      }
    }
    return o;
  default:
    return o;
  }
};
this.renderAnd = curry$(function(fn, w, target, tmpl, params, cb){
  var $t, $b;
  $t = w.$(target);
  $b = w.$('<div>');
  $b.hide();
  $t[fn]($b);
  w.jade.render($b[0], tmpl, params);
  $b.show().addClass('fadein');
  return setTimeout(function(){
    return cb($b);
  }, 100);
});
this.renderAndAppend = this.renderAnd('append');
this.renderAndPrepend = this.renderAnd('prepend');
this.isEmail = function(name){
  return name.indexOf('@') !== -1;
};
this.isForumHomepage = function(path){
  return furl.parse(path).type === 'forum';
};
this.isEditing = function(path){
  var meta;
  meta = furl.parse(path);
  switch (meta.type) {
  case 'new-thread':
    return true;
  case 'edit':
    return meta.id;
  default:
    return false;
  }
};
this.flipBackground = function(w, cur, direction){
  var last, next;
  direction == null && (direction = 'down');
  if (w.bgAnim) {
    clearTimeout(w.bgAnim);
  }
  last = w.$('.bg.active');
  next = w.$('#forum_bg_' + cur.data('id'));
  next.css('display', 'block');
  if (!last.length) {
    return next.addClass('active');
  } else {
    return w.bgAnim = setTimeout(function(){
      last.css('top', direction === 'down' ? -300 : 300);
      last.removeClass('active');
      next.addClass('active');
      return w.bgAnim = 0;
    }, 100);
  }
};
this.rUnbind = function(rf){
  var i$, ref$, len$, d;
  for (i$ = 0, len$ = (ref$ = rf.dependencies).length; i$ < len$; ++i$) {
    d = ref$[i$];
    d.removeDependent();
  }
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
},{"lodash":18}],17:[function(require,module,exports){
var Component, templates, Buy;
Component = require('yacomponent');
templates = require('../build/component-jade.js').templates;
module.exports = Buy = (function(superclass){
  var prototype = extend$((import$(Buy, superclass).displayName = 'Buy', Buy), superclass).prototype, constructor = Buy;
  prototype.template = templates.Buy;
  prototype.init = function(){
    if (this.local('cardNeeded') === void 8) {
      return this.local('cardNeeded', true);
    }
  };
  prototype.onAttach = function(){
    var this$ = this;
    setTimeout(function(){
      return constructor.$('.Buy-card-number').focus();
    }, 100);
    this.$.on('click', '.Buy-change-card', function(){
      var $fb;
      this$.local('cardNeeded', true);
      this$.detach().render().attach();
      $fb = constructor.$('.fancybox-wrap:first');
      $fb.removeClass('slide');
      setTimeout(function(){
        return $fb.addClass('slide');
      }, 10);
      return false;
    });
    return this.$.on('click', '.Buy-checkout', function(ev){
      var data, product, reEnable;
      $(ev.target).attr('disabled', 'disabled');
      data = {
        number: this$.$.find('.Buy-card-number').val(),
        expmo: this$.$.find('.Buy-card-month').val(),
        expyear: this$.$.find('.Buy-card-year').val(),
        code: this$.$.find('.Buy-card-code').val()
      };
      product = this$.local('product').id;
      reEnable = function(){
        return $(ev.target).attr('disabled', null);
      };
      showTooltip(this$.$.find('.tooltip'), 'Securing a connection');
      constructor.$.post("/ajax/checkout/" + product, data, function(r){
        var ref$, cardNumber, i$, len$, e, $fb;
        if (r.success) {
          site.subscriptions.push(product);
          site.has_stripe = true;
          $("#" + product).focus();
          showTooltip(this$.$.find('.tooltip'), ['Sincere thanks!', "Awesome.  Go ahead!", 'You got it!', 'Thank you!'][parseInt(Math.random() * 5)]);
          return setTimeout(function(){
            reEnable();
            $("." + product + "-available").hide();
            $("." + product + "-purchased").show(500);
            return $.fancybox.close();
          }, 2000);
        } else {
          showTooltip(this$.$.find('.tooltip'), (ref$ = r.errors) != null && ref$.length ? r.errors.join("\n") : 'Invalid payment!');
          cardNumber = this$.$.find('.Buy-card-number');
          for (i$ = 0, len$ = (ref$ = [cardNumber, constructor.$('.Buy-card-code')]).length; i$ < len$; ++i$) {
            e = ref$[i$];
            e.addClass('has-error');
          }
          $fb = constructor.$('.fancybox-wrap:first');
          $fb.addClass('on-error');
          $fb.removeClass('shake');
          setTimeout(function(){
            $fb.addClass('shake');
            return cardNumber.focus();
          }, 10);
          return reEnable();
        }
      });
      return false;
    });
  };
  prototype.onDetach = function(){
    return this.$.off();
  };
  function Buy(){
    Buy.superclass.apply(this, arguments);
  }
  return Buy;
}(Component));
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"yacomponent":26}],16:[function(require,module,exports){
var Component, templates, Paginator;
Component = require('yacomponent');
templates = require('../build/component-jade.js').templates;
function calcPages(activePage, step, qty, pageDistance, pageQty, pnumToHref){
  var beg, end, pages, res$, i$, ref$, len$, num, firstNum, lastNum;
  activePage = parseInt(activePage);
  step = parseInt(step);
  qty = parseInt(qty);
  pageDistance = parseInt(pageDistance);
  pageQty = parseInt(pageQty);
  activePage = parseInt(activePage);
  beg = Math.max(activePage - pageDistance, 1);
  end = Math.min(activePage + pageDistance, pageQty);
  if (activePage <= pageDistance) {
    end = Math.min(end + (pageDistance - activePage) + 1, pageQty);
  } else if (activePage >= pageQty - pageDistance) {
    beg = Math.max(beg - (pageDistance - (pageQty - activePage)), 1);
  }
  res$ = [];
  for (i$ = 0, len$ = (ref$ = (fn$())).length; i$ < len$; ++i$) {
    num = ref$[i$];
    res$.push({
      num: num,
      title: num,
      href: pnumToHref(num),
      active: activePage === num
    });
  }
  pages = res$;
  firstNum = 1;
  if (pages.length && pages[0].title !== firstNum) {
    pages.unshift({
      num: firstNum,
      title: 'First',
      href: pnumToHref(firstNum)
    });
  }
  lastNum = pages.length - 1;
  if (pages.length && pages[lastNum].title !== pageQty) {
    pages.push({
      num: pageQty,
      title: 'Last',
      href: pnumToHref(pageQty)
    });
  }
  return pages;
  function fn$(){
    var i$, to$, results$ = [];
    for (i$ = beg, to$ = end; i$ <= to$; ++i$) {
      results$.push(i$);
    }
    return results$;
  }
}
module.exports = Paginator = (function(superclass){
  var defaultLocals, prototype = extend$((import$(Paginator, superclass).displayName = 'Paginator', Paginator), superclass).prototype, constructor = Paginator;
  defaultLocals = {
    activePage: 1,
    step: 8,
    qty: 0,
    pageDistance: 4
  };
  function Paginator(arg$){
    var ref$, pnumToHref;
    ref$ = arg$ != null
      ? arg$
      : {}, pnumToHref = ref$.pnumToHref, this.onPage = ref$.onPage;
    if (!pnumToHref) {
      if (this.onPage) {
        pnumToHref = function(){
          return '#';
        };
      } else {
        pnumToHref = function(it){
          return "?page=" + it;
        };
      }
    }
    this.pnumToHref = constructor.$R.state(pnumToHref);
    Paginator.superclass.apply(this, arguments);
  }
  prototype.init = function(){
    var k, ref$, v, this$ = this;
    for (k in ref$ = defaultLocals) {
      v = ref$[k];
      if (this.local(k) === void 8) {
        this.local(k, v);
      }
    }
    this.state.pageQty = constructor.$R(function(qty, step){
      return Math.ceil(qty / step);
    }).bindTo(this.state.qty, this.state.step);
    return function(){
      var bindings, ref$;
      bindings = [this$.state.activePage, this$.state.step, this$.state.qty, this$.state.pageDistance, this$.state.pageQty, this$.pnumToHref];
      return this$.state.pages = (ref$ = constructor.$R(calcPages)).bindTo.apply(ref$, bindings);
    }();
  };
  prototype.template = templates.Paginator;
  prototype.onAttach = function(){
    var c, handler;
    this.$.show();
    if (this.onPage) {
      c = this;
      handler = function(){
        var pg;
        pg = parseInt(constructor.$(this).data('page'));
        c.local('activePage', pg);
        c.reload();
        c.onPage(pg, c);
        return false;
      };
      return this.$.on('click', 'a', handler);
    }
  };
  prototype.onDetach = function(){
    return this.$.off();
  };
  return Paginator;
}(Component));
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"yacomponent":26}],11:[function(require,module,exports){
var Component, templates, addMessage, Chat, slice$ = [].slice;
Component = require('yacomponent');
templates = require('../build/component-jade.js').templates;
addMessage = curry$(function(fn, m){
  var $msg, $messages;
  $msg = this.messageNode(m);
  $messages = this.$.find('.messages')[fn]($msg);
  $msg.show();
  $messages[0].scrollTop = $messages[0].scrollHeight;
  return this.$.find('textarea').val('');
});
module.exports = Chat = (function(superclass){
  var prototype = extend$((import$(Chat, superclass).displayName = 'Chat', Chat), superclass).prototype, constructor = Chat;
  Chat.duration = 300;
  Chat.easing = 'easeOutExpo';
  Chat.chats = {};
  prototype.conversation = null;
  prototype.template = templates.Chat;
  prototype.rememberChat = function(){
    var chats, id, ref$;
    chats = JSON.parse($.cookie('chats') || '[]');
    id = (ref$ = this.conversation) != null ? ref$.id : void 8;
    if (chats.indexOf(id) === -1 && id) {
      chats.push(id);
      return $.cookie('chats', JSON.stringify(chats), {
        path: '/'
      });
    } else {
      return console.warn(chats.indexOf(id), id);
    }
  };
  prototype.forgetChat = function(){
    var chats, id, ref$, i;
    chats = JSON.parse($.cookie('chats') || '[]');
    id = (ref$ = this.conversation) != null ? ref$.id : void 8;
    i = chats.indexOf(id);
    if (i !== -1 && id) {
      chats.splice(i, 1);
      return $.cookie('chats', JSON.stringify(chats), {
        path: '/'
      });
    } else {
      return console.warn(chats.indexOf(id), id);
    }
  };
  prototype.onAttach = function(){
    this.$.draggable({
      snap: 'footer',
      snapMode: 'outer',
      cursor: 'move',
      start: function(ev){
        return $(ev.target).find('.minimize').addClass('no-click');
      }
    }).css({
      left: 50,
      bottom: 335
    });
    this.$.on('click', '.minimize', this.minimize);
    this.$.on('click', '.close', this.close);
    this.$.on('keydown', 'textarea', this.sendMessage);
    return this.$.find('.messages').scroll(this.maybeLoadMore);
  };
  prototype.onDetach = function(){};
  prototype.key = function(){
    var ref$, me, others;
    ref$ = [this.state.me.val, this.state.others.val], me = ref$[0], others = ref$[1];
    return me.name + "/" + others.map(function(it){
      return it.name;
    }).join('/');
  };
  prototype.users = function(){
    return fold(function(m, u){
      m[u.id] = u;
      return m;
    }, {})(
    flatten([this.state.me.val, this.state.others.val]));
  };
  prototype.messageFromEnv = function(){
    var u, ref$, ref1$, m;
    u = (ref$ = this.state) != null ? (ref1$ = ref$.others) != null ? (ref$ = ref1$.val) != null ? ref$[0] : void 8 : void 8 : void 8;
    return m = {
      conversation_id: (ref$ = this.conversation) != null ? ref$.id : void 8,
      from: window.user,
      to: {
        id: u.id,
        name: u.name
      },
      body: this.$.find('textarea').val()
    };
  };
  prototype.messageNode = function(m){
    var $msg, myName, ref$, ref1$;
    console.warn('m', m);
    $msg = this.$.find('.container > .msg').clone();
    $msg.attr('data-message-id', m.id);
    if (m.created_human) {
      $msg.find('.body').attr('title', m.created_human.replace(/<.*?\/?>/g, '')).attr('data-time', m.created_iso).addClass('time-title').html(m.body);
    } else {
      console.warn("missing m.created_human", m);
      $msg.find('.body').html(m.body);
    }
    $msg.find('a.from-name').attr('href', "/user/" + m.from.name).html(m.from.name);
    myName = (ref$ = this.state.me) != null ? (ref1$ = ref$.val) != null ? ref1$.name : void 8 : void 8;
    if (m.from.name !== myName) {
      $msg.addClass('other');
    }
    return $msg;
  };
  prototype.sendMessage = function(ev){
    var m, this$ = this;
    if (ev.keyCode === 13) {
      m = this.messageFromEnv();
      console.log('m', m);
      if (m.body.match(/^\s*$/)) {
        return false;
      }
      return socket.emit('chat-message', m, function(err, r){
        if (err) {
          console.error(err);
          return;
        }
        if (this$.conversation === null) {
          this$.conversation = r.conversation;
        }
        console.log('r', r);
        m.id = r.message.id;
        m.body = r.message.body;
        console.log('r', r.message);
        return this$.appendMessage(m);
      });
    }
  };
  prototype.appendMessage = addMessage('append');
  prototype.prependMessage = addMessage('prepend');
  prototype.maybeLoadMore = function(ev){
    var pos;
    if (this.loadedAll) {
      return false;
    }
    pos = $(ev.target).scrollTop();
    if (pos === 0) {
      return this.loadMoreMessages();
    }
  };
  prototype.loadMoreMessages = function(last){
    var $firstMsg, this$ = this;
    $firstMsg = this.$.find('.messages .msg:first');
    last || (last = $firstMsg.data('message-id'));
    return $.get("/resources/conversations/" + this.conversation.id, {
      last: last
    }, function(r){
      var id, ref$, users;
      if (r.success) {
        id = (ref$ = r.messages[0]) != null ? ref$.id : void 8;
        if (!id || id >= last) {
          this$.loadedAll = true;
          return;
        }
        users = this$.users();
        each(function(it){
          return this$.prependMessage(it);
        })(
        map(function(it){
          it.from = users[it.user_id];
          return it;
        })(
        r.messages));
        return this$.$.find('.messages').scrollTop(0 + 50);
      }
    });
  };
  prototype.minimize = function(ev){
    var e;
    e = $(ev.target);
    if (e.hasClass('no-click')) {
      return e.removeClass('no-click');
    } else {
      this.$.toggleClass('minimized');
      return this.$.find('textarea').focus();
    }
  };
  prototype.close = function(){
    var key, this$ = this;
    key = this.key();
    Chat.stop(this.key());
    return socket.emit('chat-leave', this.conversation, function(err, r){});
  };
  function Chat(){
    this.close = bind$(this, 'close', prototype);
    this.minimize = bind$(this, 'minimize', prototype);
    this.loadMoreMessages = bind$(this, 'loadMoreMessages', prototype);
    this.maybeLoadMore = bind$(this, 'maybeLoadMore', prototype);
    this.sendMessage = bind$(this, 'sendMessage', prototype);
    this.messageNode = bind$(this, 'messageNode', prototype);
    this.messageFromEnv = bind$(this, 'messageFromEnv', prototype);
    this.users = bind$(this, 'users', prototype);
    this.key = bind$(this, 'key', prototype);
    this.onDetach = bind$(this, 'onDetach', prototype);
    this.onAttach = bind$(this, 'onAttach', prototype);
    Chat.superclass.apply(this, arguments);
  }
  return Chat;
}(Component));
Chat.start = function(users, messages, x, y){
  var me, others, key, c, $div;
  me = users[0], others = slice$.call(users, 1);
  messages == null && (messages = []);
  x == null && (x = null);
  y == null && (y = null);
  key = join('/')(
  map(function(it){
    return it.name;
  }, users));
  if (c = this.chats[key]) {
    return c;
  }
  $div = $('<div/>').hide();
  c = this.chats[key] = new Chat({
    locals: {
      me: me,
      others: others
    }
  }, $div);
  if (x || y) {
    setTimeout(function(){
      return $div.show(this.duration, this.easing).css({
        top: '',
        left: ''
      }).transition({
        bottom: y,
        right: x
      });
    }, 2000);
  } else {
    c.$.show();
  }
  $('#chat_drawer').after(c.$);
  return $.post('/resources/conversations', {
    site_id: window.siteId,
    users: users
  }, function(r){
    var i$, len$, m;
    console.log('r', r);
    if (r.messages.length > 0 && messages.length === 0) {
      messages = r.messages;
    }
    for (i$ = 0, len$ = messages.length; i$ < len$; ++i$) {
      m = messages[i$];
      c.prependMessage(m);
    }
    c.$.find('textarea').focus();
    c.conversation = r;
    c.rememberChat();
    return c;
  });
};
Chat.stop = function(key){
  var c, this$ = this;
  c = this.chats[key];
  if (!c) {
    return;
  }
  return c.$.fadeOut(this.duration, function(){
    var ref$, ref1$;
    c.$.empty().remove();
    this$.reorganize();
    c.forgetChat();
    return ref1$ = (ref$ = this$.chats)[key], delete ref$[key], ref1$;
  });
};
Chat.reorganize = function(){
  var $cs, width, n;
  $cs = $('#chat_drawer .Chat');
  width = $cs.first().width();
  n = $cs.length;
  return $cs.each(function(i, e){
    var right;
    right = (n - i - 1) * (width + 8) + 8;
    return $(e).transition({
      right: right
    }, this.duration, this.easing);
  });
};
Chat.remember = function(){
  var ids, x, y, i$, len$, id, results$ = [];
  ids = JSON.parse($.cookie('chats') || '[]');
  x = 0 + 8;
  y = $('footer').height() - 14;
  for (i$ = 0, len$ = ids.length; i$ < len$; ++i$) {
    id = ids[i$];
    console.log('chat-join-and-open', id);
    results$.push(fn$());
  }
  return results$;
  function fn$(){
    return $.get("/resources/conversations/" + id, function(c){
      var meFirst, people, chat;
      console.log('c', c);
      if (c) {
        meFirst = function(a, b){
          var ref$;
          switch (false) {
          case a.name !== ((ref$ = window.user) != null ? ref$.name : void 8):
            return -1;
          default:
            return 1;
          }
        };
        people = sortWith(meFirst, c.participants);
        console.log('x-y', x, y);
        chat = Chat.start(people, c.messages, x, y);
        return x = x + 220 + 8;
      } else {
        return console.warn('no-chat', id);
      }
    });
  }
};
Chat.clientSocketInit = function(socket){
  var this$ = this;
  socket.on('chat-open', function(conversation, cb){
    console.warn("received request to open chat " + conversation.id, conversation);
    return socket.emit('chat-join', conversation, function(err, c2){
      var meFirst, people, names, key, c;
      console.log('after-chat-join', err, c2);
      meFirst = function(a, b){
        var ref$;
        switch (false) {
        case a.name !== ((ref$ = window.user) != null ? ref$.name : void 8):
          return -1;
        default:
          return 1;
        }
      };
      people = sortWith(meFirst, conversation.participants);
      names = map(function(it){
        return it.name;
      }, people);
      key = names.join('/');
      console.log('kkk', key, Chat.chats[key]);
      if (Chat.chats[key]) {
        return;
      }
      c = Chat.start(people, conversation.messages);
      console.warn('after-chat-start');
      c.conversation = conversation;
      c.room = c2.room;
      return console.warn('end-of-chat-open', c === Chat.chats[key], c);
    });
  });
  socket.on('chat-message', function(msg, cb){
    var c;
    console.log('incoming-chat', msg);
    if (msg.from.id === (typeof user != 'undefined' && user !== null ? user.id : void 8)) {
      return;
    }
    c = Obj.find(function(it){
      var ref$;
      return ((ref$ = it.conversation) != null ? ref$.id : void 8) === msg.conversation_id;
    }, Chat.chats);
    if (c) {
      return c.appendMessage(msg);
    } else {
      return console.warn('chat-message', 'c not found', msg);
    }
  });
  return Chat.remember();
};
function curry$(f, bound){
  var context,
  _curry = function(args) {
    return f.length > 1 ? function(){
      var params = args ? args.concat() : [];
      context = bound ? context || this : this;
      return params.push.apply(params, arguments) <
          f.length && arguments.length ?
        _curry.call(context, params) : f.apply(context, params);
    } : f;
  };
  return _curry();
}
function bind$(obj, key, target){
  return function(){ return (target || obj)[key].apply(obj, arguments) };
}
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"yacomponent":26}],23:[function(require,module,exports){
/*
export example =
  A:
    a: "B"
    b: "C"
  B:
    a: "A"
    b: "C"
  C:
    a: "C"
    b: "C"
*/
var newState, out$ = typeof exports != 'undefined' && exports || this;
out$.newState = newState = function(machine, state, inputs){
  var transition;
  transition = function(s, i){
    return machine[s][i];
  };
  return fold(transition, state, inputs);
};
},{}],25:[function(require,module,exports){

module.exports = jade = (function(exports){
/*!
 * Jade - runtime
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */

/**
 * Lame Array.isArray() polyfill for now.
 */

if (!Array.isArray) {
  Array.isArray = function(arr){
    return '[object Array]' == Object.prototype.toString.call(arr);
  };
}

/**
 * Lame Object.keys() polyfill for now.
 */

if (!Object.keys) {
  Object.keys = function(obj){
    var arr = [];
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        arr.push(key);
      }
    }
    return arr;
  }
}

/**
 * Merge two attribute objects giving precedence
 * to values in object `b`. Classes are special-cased
 * allowing for arrays and merging/joining appropriately
 * resulting in a string.
 *
 * @param {Object} a
 * @param {Object} b
 * @return {Object} a
 * @api private
 */

exports.merge = function merge(a, b) {
  var ac = a['class'];
  var bc = b['class'];

  if (ac || bc) {
    ac = ac || [];
    bc = bc || [];
    if (!Array.isArray(ac)) ac = [ac];
    if (!Array.isArray(bc)) bc = [bc];
    ac = ac.filter(nulls);
    bc = bc.filter(nulls);
    a['class'] = ac.concat(bc).join(' ');
  }

  for (var key in b) {
    if (key != 'class') {
      a[key] = b[key];
    }
  }

  return a;
};

/**
 * Filter null `val`s.
 *
 * @param {Mixed} val
 * @return {Mixed}
 * @api private
 */

function nulls(val) {
  return val != null;
}

/**
 * Render the given attributes object.
 *
 * @param {Object} obj
 * @param {Object} escaped
 * @return {String}
 * @api private
 */

exports.attrs = function attrs(obj, escaped){
  var buf = []
    , terse = obj.terse;

  delete obj.terse;
  var keys = Object.keys(obj)
    , len = keys.length;

  if (len) {
    buf.push('');
    for (var i = 0; i < len; ++i) {
      var key = keys[i]
        , val = obj[key];

      if ('boolean' == typeof val || null == val) {
        if (val) {
          terse
            ? buf.push(key)
            : buf.push(key + '="' + key + '"');
        }
      } else if (0 == key.indexOf('data') && 'string' != typeof val) {
        buf.push(key + "='" + JSON.stringify(val) + "'");
      } else if ('class' == key && Array.isArray(val)) {
        buf.push(key + '="' + exports.escape(val.join(' ')) + '"');
      } else if (escaped && escaped[key]) {
        buf.push(key + '="' + exports.escape(val) + '"');
      } else {
        buf.push(key + '="' + val + '"');
      }
    }
  }

  return buf.join(' ');
};

/**
 * Escape the given string of `html`.
 *
 * @param {String} html
 * @return {String}
 * @api private
 */

exports.escape = function escape(html){
  return String(html)
    .replace(/&(?!(\w+|\#\d+);)/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
};

/**
 * Re-throw the given `err` in context to the
 * the jade in `filename` at the given `lineno`.
 *
 * @param {Error} err
 * @param {String} filename
 * @param {String} lineno
 * @api private
 */

exports.rethrow = function rethrow(err, filename, lineno){
  if (!filename) throw err;

  var context = 3
    , str = require('fs').readFileSync(filename, 'utf8')
    , lines = str.split('\n')
    , start = Math.max(lineno - context, 0)
    , end = Math.min(lines.length, lineno + context);

  // Error context
  var context = lines.slice(start, end).map(function(line, i){
    var curr = i + start + 1;
    return (curr == lineno ? '  > ' : '    ')
      + curr
      + '| '
      + line;
  }).join('\n');

  // Alter exception message
  err.path = filename;
  err.message = (filename || 'Jade') + ':' + lineno
    + '\n' + context + '\n\n' + err.message;
  throw err;
};

  return exports;

})({});

jade.templates = {};
jade.render = function(node, template, data) {
  var tmp = jade.templates[template](data);
  node.innerHTML = tmp;
};

jade.templates["AdminMenu"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<li class="default"><div><input type="text" placeholder="Title" class="row"/></div></li><form');
buf.push(attrs({ 'action':("/resources/sites/" + (site.id) + ""), 'method':("put"), "class": ('menus') + ' ' + ('onclick-submit') }, {"action":true,"method":true}));
buf.push('><input type="hidden" name="action" value="menu"/><div class="col1"><button class="onclick-add">Add</button><ol class="sortable"></ol></div><div class="col2"><fieldset><label class="type">Type</label><ul class="options"><li><label for="forum" class="header">Forum</label><input id="forum" type="radio" name="dialog" checked="checked" class="option"/><div class="dialog"><label for="forum_slug">Slug</label><input id="forum_slug" type="text" name="forumSlug"/><div class="note">URL suffix for this page</div><div class="break"></div><label for="locked">Admin Only</label><div class="box"><input id="locked" type="checkbox" value="checked" name="locked"/><label for="locked" class="switch-control"><div class="switch"></div></label><span class="label checked">Locked</span><div class="note">Lock entire forum (read-only except admin)</div></div><div class="break">   </div><label for="comments">Comments</label><div class="box"><input id="comments" type="checkbox" value="checked" name="comments"/><label for="comments" class="switch-control"><div class="switch"></div></label><span class="label checked">Yes</span><div class="note">Commentable forums are threaded like Reddit</div></div><div class="break">   </div><button type="submit" value="Save">Save</button><div class="tooltip"></div></div></li><li><label for="page" class="header">Page</label><input id="page" type="radio" name="dialog" class="option"/><div class="dialog"><label for="page_slug">Slug</label><input id="page_slug" type="text" name="pageSlug"/><div class="note">URL suffix for this page</div><div class="break"></div><label>Main Menu</label><div class="box"><input id="hide_menu" type="checkbox" value="checked" name="hideMenu"/><label for="hide_menu" class="switch-control"><div class="switch"></div></label><span class="label checked">On</span><div class="note">Shows &amp; hides the main menu for this page</div></div><div class="break"></div><label for="body">Body</label><textarea id="body" name="body"></textarea><div class="note">Paste the contents of the page above</div><div class="break">   </div><button type="submit" value="Save">Save</button><div class="tooltip"></div></div></li><li><label for="link" class="header">External Link</label><input id="link" type="radio" name="dialog" class="option"/><div class="dialog"><label for="url">Url</label><input id="url" type="text" name="url" placeholder="http://"/><div class="break"></div><label for="separate_tab">Separate Tab</label><div class="box"><input id="separate_tab" type="checkbox" value="checked" name="separateTab"/><label for="separate_tab" class="switch-control"><div class="switch"></div></label><span class="label checked">Yes</span><div class="note">Open link in separate window</div></div><div class="break">   </div><button type="submit" value="Save">Save</button><div class="tooltip"></div></div></li></ul></fieldset></div></form>');
}
return buf.join("");
}
jade.templates["AdminUpgrade"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var product_mixin = function(p, msg){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
if ( subscriptions.indexOf(p)==-1)
{
buf.push('<div');
buf.push(attrs({ "class": ("" + (p) + "-available") }, {"class":true}));
buf.push('><button');
buf.push(attrs({ 'type':('button'), 'data-product':(p), 'value':('Get It'), "class": ('onclick-buy') }, {"type":true,"data-product":true,"value":true}));
buf.push('>Get It</button></div><div');
buf.push(attrs({ "class": ("" + (p) + "-purchased hidden") }, {"class":true}));
buf.push('><p class="green">');
var __val__ = msg
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<span>&#x2713;</span></p></div>');
}
else
{
buf.push('<div');
buf.push(attrs({ "class": ("" + (p) + "-available hidden") }, {"class":true}));
buf.push('><button');
buf.push(attrs({ 'type':('button'), 'data-product':(p), 'value':('Get It'), "class": ('onclick-buy') }, {"type":true,"data-product":true,"value":true}));
buf.push('>Get It</button></div><div');
buf.push(attrs({ "class": ("" + (p) + "-purchased") }, {"class":true}));
buf.push('><p class="green">');
var __val__ = msg
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<span>&#x2713;</span></p></div>');
}
};
buf.push('<fieldset><h2>Custom Domain</h2><p>Add your own personal flair!  Get serious and aim any domain at your PowerBulletin site.</p>');
product_mixin('custom_domain', 'Custom Domain Purchased');
buf.push('<div class="notes"><a href="/admin/domains" class="mutant">Click here to bring your domains online!</a></div></fieldset><fieldset><h2>Go Private</h2><p>Privacy?  We got you covered.  This feature hides your content from Search Engines and the public.</p>');
product_mixin('private', 'Private Site Purchased');
buf.push('<div class="notes"><a href="/admin" class="mutant">Click here to toggle privacy settings!</a></div></fieldset><fieldset><h2>Analytics</h2><p>Your enterprising PowerBulletin community is bustling!  Know who, where and how with your favorite analytics tracker.</p>');
product_mixin('analytics', 'Analytics Purchased');
buf.push('<div class="notes"><a href="/admin" class="mutant">Get started with analytics here!</a></div></fieldset><fieldset><h2>Super Computing Instance</h2><p>Your site really took off and you\'d like more horsepower--speed is everything!  With your turbo-charged instance comes additional security, monitoring and peace of mind.</p>');
product_mixin('compute_instance', 'Super Computing Instance Purchased');
buf.push('<div class="notes"><p>A PowerBulletin team member will contact you after purchase!</p></div></fieldset><fieldset><h2>Engineering &amp; Creative</h2><p>Need extra personalization for your PowerBulletin community?  Our engineering ninjas entertain inventive ideas!</p>');
product_mixin('engineering', 'Engineering Purchased');
buf.push('<div class="notes"><p>A PowerBulletin team member will contact you after purchase!</p></div></fieldset>');
}
return buf.join("");
}
jade.templates["Auth"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div style="display:none;" class="reset"><form method="post" action="/auth/reset-password"><label for="password"><h2>Authenticating...</h2></label><fieldset><div class="tooltip"></div><input id="password" name="password" type="text" placeholder="Password" disabled="disabled" autocomplete="off"/><div class="toggle-password">Hide</div><div title="Stronger passwords are green" class="strength-meter"><div class="strength"></div></div><input type="hidden" name="forgot"/><button type="submit" value="Save" disabled="disabled">Save</button><a class="msg onclick-show-login"><h3>Back</h3></a></fieldset></form></div><div style="display:none;" class="choose"><form method="post" action="/auth/choose-username"><label for="username"><h2>Choose a User Name<i>!</i></h2></label><fieldset><div class="tooltip"></div><input id="username" name="username" type="text" placeholder="Username"/><button type="submit" value="Save">Save</button><a class="msg onclick-show-login"><h3>Back</h3></a></fieldset></form></div><div style="display:none;" class="forgot"><form method="post" action="/auth/forgot"><label for="email"><h2>Tell Us Your Email Address<i>!</i></h2></label><fieldset><div class="tooltip"></div><input id="email" name="email" type="text" placeholder="Email" maxlength="254"/><button type="submit" value="Send Reset">Send Reset</button><a class="msg onclick-show-login"><h3>Back</h3></a></fieldset></form></div><div style="display:none;" class="dialog"><h2 id="msg">Check your inbox for activation<i>!</i></h2><div class="msg2"></div><a class="msg onclick-close-fancybox"><h3>Close</h3></a></div><div style="display:none;" class="register"><form method="post" action="/auth/register"><label for="username"><h2>Welcome<i>!</i></h2></label><fieldset><div class="tooltip"></div><input id="username" name="username" type="text" placeholder="Username"/><input name="password" type="text" placeholder="Password" autocomplete="off"/><div class="toggle-password">Hide</div><div title="Stronger passwords are green" class="strength-meter"><div class="strength"></div></div><input name="email" type="text" placeholder="Email" maxlength="254" class="register-email"/><button type="submit" value="Register">Register</button><a class="msg onclick-show-login"><h3>I already have an account</h3></a></fieldset></form></div><div class="login"><form method="post" action="/auth/login"><label for="username"><h2>');
var __val__ = siteName
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h2></label><fieldset><a class="fmsg msg onclick-show-forgot"><h3>Forgot?</h3></a><div class="tooltip"></div><input id="username" name="username" type="text" placeholder="Username"/><input name="password" type="password" placeholder="Password" autocomplete="off"/><button type="submit" value="Login">Login</button>');
if (!( inviteOnly))
{
buf.push('<a class="msg onclick-show-register"><h3>Register<i>!</i></h3></a>');
}
buf.push('<a class="small msg onclick-show-forgot"><h3>Help<i>?</i></h3></a></fieldset></form>');
if (!( inviteOnly))
{
buf.push('<div class="social has-auth"><h3>Or Log In With</h3><a href="/auth/facebook" title="Facebook!" class="has-facebook"> <img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/facebook_32.png") }, {"src":true}));
buf.push('/></a><a href="/auth/google" title="Google+" class="has-google"> <img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/google_32.png") }, {"src":true}));
buf.push('/></a><a href="/auth/twitter" title="Twitter!" class="has-twitter"> <img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/twitter_32.png") }, {"src":true}));
buf.push('/></a></div>');
}
buf.push('</div>');
}
return buf.join("");
}
jade.templates["Buy"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var price = ((product.price / 100.0).toFixed(0));
buf.push('<h1>' + escape((interp = product.description) == null ? '' : interp) + '</h1><div class="right ccinfo"><form autocomplete="off"><div class="tooltip"></div>');
if ( cardNeeded)
{
buf.push('<div class="clear"></div><label for="card_number">Card Number</label><input id="card_number" type="text" placeholder="XXXX - XXXX - XXXX - XXXX" maxlength="19" class="Buy-card-number"/><div class="clear"></div><label for="card_month">Expiration</label><select id="card_month" class="Buy-card-month"><option disabled="disabled" selected="selected">- Month -</option><option value="1">Jan - 1</option><option value="2">Feb - 2</option><option value="3">Mar - 3</option><option value="4">Apr - 4</option><option value="5">May - 5</option><option value="6">Jun - 6</option><option value="7">Jul - 7</option><option value="8">Aug - 8</option><option value="9">Sept - 9</option><option value="10">Oct - 10</option><option value="11">Nov - 11</option><option value="12">Dec - 12</option></select><small>/</small><select id="card_year" class="Buy-card-year"><option disabled="disabled" selected="selected">- Year -</option>');
var d = (new Date().getFullYear());
 for (var i=0; i<=16; i++)
{
buf.push('<option>');
var __val__ = d + i
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</option>');
}
buf.push('</select><div class="clear"></div><label for="card_code">Security Code</label><input id="card_code" type="password" placeholder="CCV" maxlength="5" class="Buy-card-code"/><span class="code">?<div class="cvvinfo"><img');
buf.push(attrs({ 'src':(cacheUrl + '/images/cvv2_example.gif') }, {"src":true}));
buf.push('/><img');
buf.push(attrs({ 'src':(cacheUrl + '/images/cvv2_example_amex.gif') }, {"src":true}));
buf.push('/></div></span>');
}
else
{
buf.push('<h3>Your payment information is Ready-to-Go<i>!</i></h3><a href="#" class="Buy-change-card">Enter different credit card details</a><div class="clear"></div><em>Saves for all subscriptions</em>');
}
buf.push('<div class="clear"><button type="submit" value="CHECKOUT" class="Buy-checkout">CHECKOUT</button></div></form></div><div class="right features">');
if ( price && (price !== '0'))
{
buf.push('<h2>Only <b><small>$</small>');
var __val__ = price
buf.push(null == __val__ ? "" : __val__);
buf.push('</b><small>/mo</small></h2>');
}
else
{
buf.push('<h2><b>Free<i>!</i></b></h2>');
}
buf.push('<menu>');
// iterate product.config.features
;(function(){
  if ('number' == typeof product.config.features.length) {
    for (var $index = 0, $$l = product.config.features.length; $index < $$l; $index++) {
      var f = product.config.features[$index];

buf.push('<li>');
var __val__ = f
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
    }
  } else {
    for (var $index in product.config.features) {
      var f = product.config.features[$index];

buf.push('<li>');
var __val__ = f
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
   }
  }
}).call(this);

buf.push('</menu></div><div class="cards"><div class="jcb"></div><div class="dinersclub"></div><div class="discover"></div><div class="amex"></div><div class="mastercard"></div><div class="visa"></div></div>');
}
return buf.join("");
}
jade.templates["Chat"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="header"><div class="profile"><div');
buf.push(attrs({ 'title':(others[0].name), "class": ('minimize') }, {"title":true}));
buf.push('>');
if ( others[0].photo.match(/^https?\:/) || others[0].photo.match(/\/\//))
{
buf.push('<img');
buf.push(attrs({ 'src':(others[0].photo) }, {"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (others[0].photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></div><h2>' + escape((interp = others[0].name) == null ? '' : interp) + '</h2><div title="Close" class="close onclick-close">X</div></div><div class="container"><div class="messages"><div style="display:none;" class="load-more">load more...</div></div><div style="display:none;" class="msg"><div class="from"><a class="from-name mutant"></a></div><div class="body"></div></div></div><div class="footer"><form><textarea name="body"></textarea></form></div>');
}
return buf.join("");
}
jade.templates["Paginator"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
if ( pages.length >= 2)
{
// iterate pages
;(function(){
  if ('number' == typeof pages.length) {
    for (var $index = 0, $$l = pages.length; $index < $$l; $index++) {
      var p = pages[$index];

if ( p.active)
{
buf.push('<strong class="Paginator-page">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</strong>');
}
else
{
buf.push('<a');
buf.push(attrs({ 'href':(p.href), 'data-page':(p.num), "class": ('mutant') + ' ' + ('Paginator-page') }, {"href":true,"data-page":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a>');
}
    }
  } else {
    for (var $index in pages) {
      var p = pages[$index];

if ( p.active)
{
buf.push('<strong class="Paginator-page">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</strong>');
}
else
{
buf.push('<a');
buf.push(attrs({ 'href':(p.href), 'data-page':(p.num), "class": ('mutant') + ' ' + ('Paginator-page') }, {"href":true,"data-page":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a>');
}
   }
  }
}).call(this);

}
}
return buf.join("");
}
jade.templates["PhotoCropper"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="upload"><h1>');
var __val__ = title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h1><div><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (photo) + "") }, {"src":true}));
buf.push('/></div><div><form');
buf.push(attrs({ 'method':("POST"), 'action':("" + (endpointUrl) + ""), 'enctype':("multipart/form-data") }, {"method":true,"action":true,"enctype":true}));
buf.push('><div class="button"> <span>Upload Image</span><input type="file" name="avatar"/></div></form></div></div><div style="display:none;" class="crop"><h1>');
var __val__ = title + " (crop)"
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h1><div><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (photo) + "") }, {"src":true}));
buf.push('/></div><div class="button"><span>Crop Image</span></div></div>');
}
return buf.join("");
}
jade.templates["Sales"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="logo"><h1>Power<b>Bulletin</b></h1><em>The Official Real-Time Community Builder</em></div><h2 id="imagine" class="stick">Imagine real-time communities at the click of a button.</h2><div id="register_top"></div><h2 id="features" class="stick">Why you\'ll love PowerBulletin ...</h2><section class="translucent stick"><article><h4>Breakthrough Navigation</h4><p>From SEO technology that speedily transmits page delta instead of reloading browsers,\nto a split-thread &amp; post interface, the PowerBulletin experience is always secure, fast &amp; fluid.</p></article></section><section class="bg first"></section><section class="stick"><article><h4>Unmatched Responsive Design</h4><p>A modern, responsive interface that scales from to your phone,\ntablet and PC to wide-screen projectors--your PowerBulletin community always stuns.</p></article></section><section class="bg second"></section><section class="stick"><article><h4>Real-Time Flow</h4><p>Ultrafast PowerBulletin is built on a real-time engine that powers\neverything from user chat &amp; posts to administration, such as creating products.</p></article></section><section class="bg third"></section><section class="stick"><article><h4>Products &amp; e-Commerce Capabilities</h4><p>Sell your business products &amp; services around PowerBulletin communities.\nOffering e-commerce is so easy to use, it\'s easy to love.</p></article></section><section class="bg fourth"></section><section class="stick"><article><h4>Live Support</h4><p>Knowledge is PowerBulletin!  With<a href="mailto:support@powerbulletin.com">direct access to our team</a>of friendly developers &amp; designers\nthere\'s almost no limit to what you can build.</p></article></section><section class="last"><article><div id="register_bottom"></div></article></section><section id="faq" class="faq"><article><h3>FAQ</h3><menu><li><h4>Can I change the look of PowerBulletin?</h4><p>Absolutely!  We provide a solid default theme to get started quickly.\nAnything is possible with your stylish eye:<a href="http://www.w3schools.com/cssref/" target="_blank">CSS</a>&amp;<a href="http://learnboost.github.io/stylus/" target="_blank">Stylus</a>are supported.</p></li></menu><menu><li><h4>Contact</h4><p>We\'re here for YOU:<a href="mailto:support@powerbulletin.com">support@powerbulletin.com</a></p></li></menu></article></section><footer><div class="onclick-scroll-top">Top</div></footer>');
}
return buf.join("");
}
jade.templates["SalesApp"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<header><ul><li><a data-scroll-to="#features" class="onclick-scroll-to">Features</a></li><li><a data-scroll-to="#faq" class="onclick-scroll-to">FAQ</a></li><li class="auth"><a class="onclick-login">Login</a><a style="display:none;" class="onclick-logout">Logout</a></li></ul></header><div id="wrapper" class="SalesApp-content"></div><div id="auth"></div>');
}
return buf.join("");
}
jade.templates["SalesLoader"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<!DOCTYPE html><html><head><title>PowerBulletin</title>');
// iterate stylesheets
;(function(){
  if ('number' == typeof stylesheets.length) {
    for (var $index = 0, $$l = stylesheets.length; $index < $$l; $index++) {
      var stylesheet = stylesheets[$index];

buf.push('<link');
buf.push(attrs({ terse: true, 'rel':('stylesheet'), 'type':('text/css'), 'href':(stylesheet) }, {"rel":true,"type":true,"href":true}));
buf.push('>');
    }
  } else {
    for (var $index in stylesheets) {
      var stylesheet = stylesheets[$index];

buf.push('<link');
buf.push(attrs({ terse: true, 'rel':('stylesheet'), 'type':('text/css'), 'href':(stylesheet) }, {"rel":true,"type":true,"href":true}));
buf.push('>');
   }
  }
}).call(this);

buf.push('<script');
buf.push(attrs({ terse: true, 'type':('text/javascript'), 'src':("" + (cacheUrl) + "/local/head-0.99.load.min.js") }, {"type":true,"src":true}));
buf.push('></script><script type="text/javascript">\n window.headjs = head.js\n window.env = \'' + ((interp = env) == null ? '' : interp) + '\'\n window.cacheUrl = \'' + ((interp = cacheUrl) == null ? '' : interp) + '\';\n window.siteName = \'PowerBulletin\';\n window.authDomain = \'' + ((interp = authDomain) == null ? '' : interp) + '\';\n head.js.apply(head, ' + ((interp = JSON.stringify(scripts)) == null ? '' : interp) + ');\n</script></head><body></body></html>');
}
return buf.join("");
}
jade.templates["SiteRegister"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<h3>Start by creating a name now<i>!</i></h3><div class="tooltip SiteRegister-errors"></div><form class="site-register"><fieldset><input');
buf.push(attrs({ 'type':('text'), 'name':('subdomain'), 'value':(typeof subdomain != 'undefined' ? subdomain : ''), 'autocomplete':("off"), "class": ('SiteRegister-subdomain') }, {"type":true,"name":true,"value":true,"autocomplete":true}));
buf.push('/><span class="hostname">');
var __val__ = hostname
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><span class="SiteRegister-available"><div class="success">&#x2713;</div><div class="error">&#x2718;</div></span><div class="SiteRegister-create"></div></fieldset></form>');
}
return buf.join("");
}
},{"fs":27}],24:[function(require,module,exports){

module.exports = jade = (function(exports){
/*!
 * Jade - runtime
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */

/**
 * Lame Array.isArray() polyfill for now.
 */

if (!Array.isArray) {
  Array.isArray = function(arr){
    return '[object Array]' == Object.prototype.toString.call(arr);
  };
}

/**
 * Lame Object.keys() polyfill for now.
 */

if (!Object.keys) {
  Object.keys = function(obj){
    var arr = [];
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        arr.push(key);
      }
    }
    return arr;
  }
}

/**
 * Merge two attribute objects giving precedence
 * to values in object `b`. Classes are special-cased
 * allowing for arrays and merging/joining appropriately
 * resulting in a string.
 *
 * @param {Object} a
 * @param {Object} b
 * @return {Object} a
 * @api private
 */

exports.merge = function merge(a, b) {
  var ac = a['class'];
  var bc = b['class'];

  if (ac || bc) {
    ac = ac || [];
    bc = bc || [];
    if (!Array.isArray(ac)) ac = [ac];
    if (!Array.isArray(bc)) bc = [bc];
    ac = ac.filter(nulls);
    bc = bc.filter(nulls);
    a['class'] = ac.concat(bc).join(' ');
  }

  for (var key in b) {
    if (key != 'class') {
      a[key] = b[key];
    }
  }

  return a;
};

/**
 * Filter null `val`s.
 *
 * @param {Mixed} val
 * @return {Mixed}
 * @api private
 */

function nulls(val) {
  return val != null;
}

/**
 * Render the given attributes object.
 *
 * @param {Object} obj
 * @param {Object} escaped
 * @return {String}
 * @api private
 */

exports.attrs = function attrs(obj, escaped){
  var buf = []
    , terse = obj.terse;

  delete obj.terse;
  var keys = Object.keys(obj)
    , len = keys.length;

  if (len) {
    buf.push('');
    for (var i = 0; i < len; ++i) {
      var key = keys[i]
        , val = obj[key];

      if ('boolean' == typeof val || null == val) {
        if (val) {
          terse
            ? buf.push(key)
            : buf.push(key + '="' + key + '"');
        }
      } else if (0 == key.indexOf('data') && 'string' != typeof val) {
        buf.push(key + "='" + JSON.stringify(val) + "'");
      } else if ('class' == key && Array.isArray(val)) {
        buf.push(key + '="' + exports.escape(val.join(' ')) + '"');
      } else if (escaped && escaped[key]) {
        buf.push(key + '="' + exports.escape(val) + '"');
      } else {
        buf.push(key + '="' + val + '"');
      }
    }
  }

  return buf.join(' ');
};

/**
 * Escape the given string of `html`.
 *
 * @param {String} html
 * @return {String}
 * @api private
 */

exports.escape = function escape(html){
  return String(html)
    .replace(/&(?!(\w+|\#\d+);)/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
};

/**
 * Re-throw the given `err` in context to the
 * the jade in `filename` at the given `lineno`.
 *
 * @param {Error} err
 * @param {String} filename
 * @param {String} lineno
 * @api private
 */

exports.rethrow = function rethrow(err, filename, lineno){
  if (!filename) throw err;

  var context = 3
    , str = require('fs').readFileSync(filename, 'utf8')
    , lines = str.split('\n')
    , start = Math.max(lineno - context, 0)
    , end = Math.min(lines.length, lineno + context);

  // Error context
  var context = lines.slice(start, end).map(function(line, i){
    var curr = i + start + 1;
    return (curr == lineno ? '  > ' : '    ')
      + curr
      + '| '
      + line;
  }).join('\n');

  // Alter exception message
  err.path = filename;
  err.message = (filename || 'Jade') + ':' + lineno
    + '\n' + context + '\n\n' + err.message;
  throw err;
};

  return exports;

})({});

jade.templates = {};
jade.render = function(node, template, data) {
  var tmp = jade.templates[template](data);
  node.innerHTML = tmp;
};

jade.templates["layout"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
 var invite = (inviteOnly) ? "window.inviteOnly='true';" : ''
buf.push('<!DOCTYPE html><!--\n\n\n, jsb.mae.kh ~--><html><head>');
if ( typeof(title) !== 'undefined')
{
buf.push('<title>');
var __val__ = title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</title>');
}
if ( typeof(meta_description) !== 'undefined')
{
buf.push('<meta');
buf.push(attrs({ 'name':('description'), 'content':(meta_description) }, {"name":true,"content":true}));
buf.push('/>');
}
if ( typeof(meta_keywords) !== 'undefined')
{
buf.push('<meta');
buf.push(attrs({ 'name':('keywords'), 'content':(meta_keywords.join(', ')) }, {"name":true,"content":true}));
buf.push('/>');
}
if ( typeof(meta_zipcode) !== 'undefined')
{
buf.push('<meta');
buf.push(attrs({ 'name':('zipcode'), 'content':(meta_zipcode) }, {"name":true,"content":true}));
buf.push('/>');
}
buf.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9,chrome=1"/><meta name="robots" content="index, follow"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="viewport" content="user-scalable=0, initial-scale=1, maximum-scale=1, width=device-width"/><link');
buf.push(attrs({ 'href':("" + (cacheUrl) + "/images/favicon.ico"), 'rel':('shortcut icon'), 'type':('image/x-icon') }, {"href":true,"rel":true,"type":true}));
buf.push('/><link');
buf.push(attrs({ 'href':("" + (cache2Url) + "/images/apple-touch-icon.png"), 'rel':('apple-touch-icon') }, {"href":true,"rel":true}));
buf.push('/><link');
buf.push(attrs({ 'href':("" + (cache3Url) + "/images/apple-touch-icon-72x72.png"), 'sizes':("72x72"), 'rel':('apple-touch-icon') }, {"href":true,"sizes":true,"rel":true}));
buf.push('/><link');
buf.push(attrs({ 'href':("" + (cache4Url) + "/images/apple-touch-icon-114x114.png"), 'sizes':("114x114"), 'rel':('apple-touch-icon') }, {"href":true,"sizes":true,"rel":true}));
buf.push('/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" rel="stylesheet" type="text/css"/>');
if ( cssUrls)
{
// iterate cssUrls
;(function(){
  if ('number' == typeof cssUrls.length) {
    for (var $index = 0, $$l = cssUrls.length; $index < $$l; $index++) {
      var obj = cssUrls[$index];

buf.push('<link');
buf.push(attrs({ 'rel':('stylesheet'), 'type':('text/css'), 'href':(obj.url) }, {"rel":true,"type":true,"href":true}));
buf.push('/>');
    }
  } else {
    for (var $index in cssUrls) {
      var obj = cssUrls[$index];

buf.push('<link');
buf.push(attrs({ 'rel':('stylesheet'), 'type':('text/css'), 'href':(obj.url) }, {"rel":true,"type":true,"href":true}));
buf.push('/>');
   }
  }
}).call(this);

}
buf.push('<link');
buf.push(attrs({ 'href':("" + (cache5Url) + "/sites/" + (currentDomain) + ".css"), 'rel':('stylesheet'), 'type':('text/css') }, {"href":true,"rel":true,"type":true}));
buf.push('/>');
if ( style)
{
buf.push('<link');
buf.push(attrs({ 'href':("/sites/" + (siteId) + ".css"), 'rel':('stylesheet'), 'type':('text/css') }, {"href":true,"rel":true,"type":true}));
buf.push('/>');
}
if ( cvars.env != 'production')
{
buf.push('<script');
buf.push(attrs({ 'type':('text/javascript'), 'src':("" + (cache5Url) + "/local/head-0.99.load.min.js") }, {"type":true,"src":true}));
buf.push('></script>');
}
else
{
buf.push('<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/headjs/0.99/head.load.min.js"></script>');
}
if ( jsUrls)
{
buf.push('<script type="text/javascript">window.siteName="' + ((interp = siteName) == null ? '' : interp) + '";window.siteId=' + ((interp = siteId) == null ? '' : interp) + ';' + ((interp = invite) == null ? '' : interp) + 'window.initialMutant=' + ((interp = JSON.stringify(initialMutant)) == null ? '' : interp) + ';window.cacheUrl=' + ((interp = JSON.stringify(cvars.cacheUrl)) == null ? '' : interp) + ';window.authDomain="' + ((interp = cvars.authDomain) == null ? '' : interp) + '";window.headjs=head.js;head.js.apply(head,' + ((interp = JSON.stringify(cvars.baseJsUrls.concat(jsUrls))) == null ? '' : interp) + ');</script>');
}
buf.push('</head><body><header class="header toggler"><h1 class="logo"><a href="/" class="mutant">Power<strong>Bulletin</strong></a></h1><div class="container"><div class="search"><input id="query" type="text" placeholder="Search" autocomplete="off" class="query"/><div title="Close!" class="onclick-close toggler">x</div></div><div id="warning" class="tooltip"></div><div class="menu-container"><menu id="menu" class="menu">');
// iterate menu
;(function(){
  if ('number' == typeof menu.length) {
    for (var i = 0, $$l = menu.length; i < $$l; i++) {
      var f = menu[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'data-surf':(f.id), 'data-scroll-to':("#forum_" + (f.id) + ""), 'href':("/" + (f.slug) + ""), "class": ('title') + ' ' + ("forum-" + (f.id) + "") }, {"class":true,"data-surf":true,"data-scroll-to":true,"href":true}));
buf.push('>');
var __val__ = f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a>');
if ( f.forums.length)
{
buf.push('<div class="submenu"><menu>');
// iterate f.forums
;(function(){
  if ('number' == typeof f.forums.length) {
    for (var i = 0, $$l = f.forums.length; i < $$l; i++) {
      var sf = f.forums[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'href':(sf.uri), "class": ('mutant') + ' ' + ("forum-" + (sf.id) + "") }, {"class":true,"href":true}));
buf.push('>');
var __val__ = sf.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></li>');
    }
  } else {
    for (var i in f.forums) {
      var sf = f.forums[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'href':(sf.uri), "class": ('mutant') + ' ' + ("forum-" + (sf.id) + "") }, {"class":true,"href":true}));
buf.push('>');
var __val__ = sf.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></li>');
   }
  }
}).call(this);

buf.push('</menu></div>');
}
buf.push('</li>');
    }
  } else {
    for (var i in menu) {
      var f = menu[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'data-surf':(f.id), 'data-scroll-to':("#forum_" + (f.id) + ""), 'href':("/" + (f.slug) + ""), "class": ('title') + ' ' + ("forum-" + (f.id) + "") }, {"class":true,"data-surf":true,"data-scroll-to":true,"href":true}));
buf.push('>');
var __val__ = f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a>');
if ( f.forums.length)
{
buf.push('<div class="submenu"><menu>');
// iterate f.forums
;(function(){
  if ('number' == typeof f.forums.length) {
    for (var i = 0, $$l = f.forums.length; i < $$l; i++) {
      var sf = f.forums[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'href':(sf.uri), "class": ('mutant') + ' ' + ("forum-" + (sf.id) + "") }, {"class":true,"href":true}));
buf.push('>');
var __val__ = sf.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></li>');
    }
  } else {
    for (var i in f.forums) {
      var sf = f.forums[i];

buf.push('<li class="row"><a');
buf.push(attrs({ 'href':(sf.uri), "class": ('mutant') + ' ' + ("forum-" + (sf.id) + "") }, {"class":true,"href":true}));
buf.push('>');
var __val__ = sf.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></li>');
   }
  }
}).call(this);

buf.push('</menu></div>');
}
buf.push('</li>');
   }
  }
}).call(this);

buf.push('</menu></div><menu class="tools"><a class="profile photo mutant"><img id="profile"/></a><li class="onclick-login"><a href="/auth/login">Login</a></li><li class="admin-only"><a href="/admin" class="mutant">Admin</a></li><li><a href="/users" class="mutant onclick-profile">Profile</a></li><li class="onclick-logout"><a href="/auth/logout">Logout</a></li></menu></div></header><section id="left_content" class="left-content"><div id="handle" title="Toggle" class="handle"></div><div id="left_container"></div><div id="paginator" title="Go to this Page">');
if ( typeof page == 'number')
{
if ( page != 1)
{
if ( page != 2)
{
buf.push('<a');
buf.push(attrs({ 'title':('Previous Page'), 'href':("" + (furl.threadUri) + "/page/" + (page - 1) + ""), "class": ('page') + ' ' + ('previous') }, {"title":true,"href":true}));
buf.push('> </a>');
}
else
{
buf.push('<a');
buf.push(attrs({ 'title':('Previous Page'), 'href':("" + (furl.threadUri) + ""), "class": ('page') + ' ' + ('previous') }, {"title":true,"href":true}));
buf.push('> </a>');
}
}
else
{
buf.push('<a');
buf.push(attrs({ 'title':('Previous Page'), 'href':("" + (furl.threadUri) + ""), 'style':("display:none;"), "class": ('page') + ' ' + ('previous') }, {"title":true,"href":true,"style":true}));
buf.push('> </a>');
}
buf.push('<div title="Drag to Page through" class="current"><div class="tooltip right"></div></div>');
if ( page != pagesCount)
{
buf.push('<a');
buf.push(attrs({ 'title':('Next Page'), 'href':("" + (furl.threadUri) + "/page/" + (page + 1) + ""), "class": ('page') + ' ' + ('next') }, {"title":true,"href":true}));
buf.push('> </a>');
}
else
{
buf.push('<a');
buf.push(attrs({ 'title':('Next Page'), 'href':("" + (furl.threadUri) + "/page/" + (pagesCount) + ""), 'style':("display:none;"), "class": ('page') + ' ' + ('next') }, {"title":true,"href":true,"style":true}));
buf.push('> </a>');
}
}
else
{
buf.push('<a title="Previous Page" href="/" style="display:none;" class="page previous"> </a><div title="Drag to Page through" class="current"><div class="tooltip right"></div></div><a title="Next Page" href="/" style="display:none;" class="page next"> </a>');
}
buf.push('</div></section><section id="main_content" class="main-content container"></section><section class="extra"></section><section id="auth" style="display:none;"></section>');
if ( cvars.env != 'production')
{
buf.push('<div id="mocha"></div>');
}
buf.push('<footer class="onclick-footer-toggle"><div class="post-reply onclick-footer-toggle"></div><div class="onclick-scroll-top">Top</div><div id="pb_paginator"></div><h6 class="onclick-footer-toggle"><small>&copy; ' + escape((interp = siteName) == null ? '' : interp) + ' &nbsp;</small><b>');
var __val__ = new Date().getFullYear()
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</b></h6><div class="post-container"><form action="/resources/posts" method="post" class="post post-new"><div id="post_new"></div><div class="tooltip"></div></form></div></footer><div id="chat_drawer"></div><link');
buf.push(attrs({ 'href':("" + (cache5Url) + "/local/jquery-ui.min.css"), 'rel':('stylesheet'), 'type':('text/css') }, {"href":true,"rel":true,"type":true}));
buf.push('/>');
var __val__ = analytics
buf.push(null == __val__ ? "" : __val__);
buf.push('</body></html>');
}
return buf.join("");
}
jade.templates["homepage"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var media_post_mixin = function(f, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<img');
buf.push(attrs({ 'src':(f.media_url) }, {"src":true}));
buf.push('/>');
};
var html_post_mixin = function(f, t, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<p class="body">');
var __val__ = f.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
};
var posts_mixin = function(f, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
// iterate f.posts
;(function(){
  if ('number' == typeof f.posts.length) {
    for (var i = 0, $$l = f.posts.length; i < $$l; i++) {
      var p = f.posts[i];

buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), "class": ('post') + ' ' + ("col" + (Math.ceil(Math.random()*2)) + "") }, {"class":true,"id":true}));
buf.push('><a');
buf.push(attrs({ 'href':(p.uri), "class": ('mutant') }, {"href":true}));
buf.push('><h5 class="title">');
var __val__ = p.title
buf.push(null == __val__ ? "" : __val__);
buf.push('<span class="date">' + escape((interp = p.date) == null ? '' : interp) + '</span></h5></a>');
if ( p.media_url)
{
media_post_mixin(p, i);
}
else
{
html_post_mixin(p, i);
}
_post_profile_mixin(p, i);
buf.push('</div>');
    }
  } else {
    for (var i in f.posts) {
      var p = f.posts[i];

buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), "class": ('post') + ' ' + ("col" + (Math.ceil(Math.random()*2)) + "") }, {"class":true,"id":true}));
buf.push('><a');
buf.push(attrs({ 'href':(p.uri), "class": ('mutant') }, {"href":true}));
buf.push('><h5 class="title">');
var __val__ = p.title
buf.push(null == __val__ ? "" : __val__);
buf.push('<span class="date">' + escape((interp = p.date) == null ? '' : interp) + '</span></h5></a>');
if ( p.media_url)
{
media_post_mixin(p, i);
}
else
{
html_post_mixin(p, i);
}
_post_profile_mixin(p, i);
buf.push('</div>');
   }
  }
}).call(this);

};
if ( forums)
{
buf.push('<div');
buf.push(attrs({ "class": ('homepage') + ' ' + (activeForumId!='homepage'?'resizable forum':'') }, {"class":true}));
buf.push('>');
// iterate forums
;(function(){
  if ('number' == typeof forums.length) {
    for (var i = 0, $$l = forums.length; i < $$l; i++) {
      var f = forums[i];

buf.push('<div');
buf.push(attrs({ 'id':("forum_" + (f.id) + ""), "class": ('forum') + ' ' + (f.classes || '') }, {"class":true,"id":true}));
buf.push('><h2 class="title"><a');
buf.push(attrs({ 'href':(f.uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h2><a');
buf.push(attrs({ 'name':("forum_" + (f.id) + "") }, {"name":true}));
buf.push('></a><div class="container">');
posts_mixin(f, i);
buf.push('</div></div>');
    }
  } else {
    for (var i in forums) {
      var f = forums[i];

buf.push('<div');
buf.push(attrs({ 'id':("forum_" + (f.id) + ""), "class": ('forum') + ' ' + (f.classes || '') }, {"class":true,"id":true}));
buf.push('><h2 class="title"><a');
buf.push(attrs({ 'href':(f.uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h2><a');
buf.push(attrs({ 'name':("forum_" + (f.id) + "") }, {"name":true}));
buf.push('></a><div class="container">');
posts_mixin(f, i);
buf.push('</div></div>');
   }
  }
}).call(this);

buf.push('</div>');
}
else
{
buf.push('<p>Create a forum first<i>!</i></p>');
}
}
return buf.join("");
}
jade.templates["order-control"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="orderer"><div class="indicator"><!-- TODO -- , [\'nearest\', \'Nearby\']]-->');
var orders = ([['popular', 'Popular'], ['recent', 'Most Recent'], ['active', 'Most Active']]);
buf.push('</div><ul id="order">');
// iterate orders
;(function(){
  if ('number' == typeof orders.length) {
    for (var $index = 0, $$l = orders.length; $index < $$l; $index++) {
      var o = orders[$index];

if ( o[0] == active)
{
buf.push('<li');
buf.push(attrs({ 'data-value':(o[0]), "class": ('active') }, {"data-value":true}));
buf.push('>');
var __val__ = o[1]
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
}
else
{
buf.push('<li');
buf.push(attrs({ 'data-value':(o[0]) }, {"data-value":true}));
buf.push('>');
var __val__ = o[1]
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
}
    }
  } else {
    for (var $index in orders) {
      var o = orders[$index];

if ( o[0] == active)
{
buf.push('<li');
buf.push(attrs({ 'data-value':(o[0]), "class": ('active') }, {"data-value":true}));
buf.push('>');
var __val__ = o[1]
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
}
else
{
buf.push('<li');
buf.push(attrs({ 'data-value':(o[0]) }, {"data-value":true}));
buf.push('>');
var __val__ = o[1]
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</li>');
}
   }
  }
}).call(this);

buf.push('</ul><div class="onclick-scroll-top"></div></div>');
}
return buf.join("");
}
jade.templates["thread"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
_thread_mixin(thread);
}
return buf.join("");
}
jade.templates["nav"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
var subforum_mixin = function(f, sf, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<li class="subforum"><a');
buf.push(attrs({ 'href':(sf.uri), "class": ('mutant') + ' ' + ('title') + ' ' + ('stylish') }, {"href":true}));
buf.push('>');
var __val__ = sf.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></li>');
};
var forum_mixin = function(f, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<h3 class="title">Forums</h3>');
if ( f.forums)
{
buf.push('<ul');
buf.push(attrs({ "class": ('forum') + ' ' + ("" + (f.classes || '') + " forum-" + (activeForumId) + "") }, {"class":true}));
buf.push('>');
// iterate f.forums
;(function(){
  if ('number' == typeof f.forums.length) {
    for (var ii = 0, $$l = f.forums.length; ii < $$l; ii++) {
      var sf = f.forums[ii];

subforum_mixin(f, sf, ii);
    }
  } else {
    for (var ii in f.forums) {
      var sf = f.forums[ii];

subforum_mixin(f, sf, ii);
   }
  }
}).call(this);

buf.push('</ul>');
}
};
buf.push('<div class="create"><a');
buf.push(attrs({ 'data-edit':('true'), 'href':("" + (forum.uri) + "/new"), "class": ('mutant') + ' ' + ('no-surf') + ' ' + ('require-login') + ' ' + ('button') }, {"data-edit":true,"href":true}));
buf.push('>Create Thread</a></div><div id="thread-paginator"></div><div class="scrollable">');
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
buf.push('<ul class="threads">');
// iterate topThreads
;(function(){
  if ('number' == typeof topThreads.length) {
    for (var ii = 0, $$l = topThreads.length; ii < $$l; ii++) {
      var t = topThreads[ii];

_thread_mixin(t);
    }
  } else {
    for (var ii in topThreads) {
      var t = topThreads[ii];

_thread_mixin(t);
   }
  }
}).call(this);

buf.push('</ul></div>');
}
return buf.join("");
}
jade.templates["posts"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var _post_mixin = function(p, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), 'data-user-id':(p.user_id), 'data-post-id':(p.id), 'data-thread-id':(p.thread_id), 'data-forum-id':(p.forum_id), "class": ('post') + ' ' + (p.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true,"data-thread-id":true,"data-forum-id":true}));
buf.push('>');
if ( p.thread_uri)
{
buf.push('<h4 class="title"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h4>');
}
else
{
buf.push('<h4 class="title">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4>');
}
_post_profile_mixin(p);
buf.push('<div class="container"><span class="username">');
var __val__ = p.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><div');
buf.push(attrs({ 'data-time':(p.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = p.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="post-content">');
if ( p.html)
{
buf.push('<p class="body">');
var __val__ = p.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
}
buf.push('</div></div>');
_post_actions_mixin(p);
buf.push('<div class="reply"></div></div><div class="children">');
if ( p.posts && p.posts.length)
{
// iterate p.posts
;(function(){
  if ('number' == typeof p.posts.length) {
    for (var ii = 0, $$l = p.posts.length; ii < $$l; ii++) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
    }
  } else {
    for (var ii in p.posts) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
   }
  }
}).call(this);

}
else if ( p.morePosts)
{
buf.push('<a href="#" class="load-more">More Posts</a>');
}
buf.push('</div>');
};
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _breadcrumb_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
var path = ('');
var parts = (p.uri.split('/'));
var parts = (parts.splice(1, parts.length-2));
// iterate parts
;(function(){
  if ('number' == typeof parts.length) {
    for (var $index = 0, $$l = parts.length; $index < $$l; $index++) {
      var part = parts[$index];

if ( part != 't')
{
buf.push('<a');
buf.push(attrs({ 'href':("/" + (path) + "" + (part) + ""), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = part.replace('-', ' ')
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a><span>/</span>');
}
 path = path + part + '/'
    }
  } else {
    for (var $index in parts) {
      var part = parts[$index];

if ( part != 't')
{
buf.push('<a');
buf.push(attrs({ 'href':("/" + (path) + "" + (part) + ""), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = part.replace('-', ' ')
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a><span>/</span>');
}
 path = path + part + '/'
   }
  }
}).call(this);

buf.push('<em>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em>');
};
if ( typeof(post) !== 'undefined')
{
 if (!post.user_photo) post.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<div class="forum resizable">');
if ( page == 1)
{
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (post.id) + ""), 'data-user-id':(post.user_id), 'data-post-id':(post.id), "class": ('post') + ' ' + ('head') + ' ' + (post.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true}));
buf.push('><h3 class="title">');
var __val__ = post.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h3><a');
buf.push(attrs({ 'href':("/user/" + (post.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (post.user_photo) + "") }, {"src":true}));
buf.push('/></div><span>');
var __val__ = post.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span></a><div');
buf.push(attrs({ 'data-time':(post.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = post.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="edit-container"></div>');
if ( post.html)
{
buf.push('<div class="body">');
var __val__ = post.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</div>');
}
buf.push('<div class="reply"></div><div class="actions"><a class="stylish onclick-footer-toggle">Reply</a><a');
buf.push(attrs({ 'data-edit':(post.id), 'href':("" + (post.uri.replace(/\/\d+$/, '')) + "/edit/" + (post.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(post.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div></div>');
}
buf.push('<div class="children">');
if ( post.posts.length)
{
buf.push('<div');
buf.push(attrs({ 'data-page':(page) }, {"data-page":true}));
buf.push('>');
// iterate post.posts
;(function(){
  if ('number' == typeof post.posts.length) {
    for (var $index = 0, $$l = post.posts.length; $index < $$l; $index++) {
      var sp = post.posts[$index];

if ( sp.parent_id !== null)
{
_post_mixin(sp, 0);
}
    }
  } else {
    for (var $index in post.posts) {
      var sp = post.posts[$index];

if ( sp.parent_id !== null)
{
_post_mixin(sp, 0);
}
   }
  }
}).call(this);

buf.push('</div>');
}
else if ( post.morePosts)
{
buf.push('<a href="#">Load more posts ...</a>');
}
buf.push('</div><p class="onclick-footer-toggle">Post Reply</p></div>');
}
else
{
buf.push('<div class="forum resizable"></div>');
}
if ( typeof(post) !== 'undefined')
{
buf.push('<div id="breadcrumb" class="breadcrumb">');
_breadcrumb_mixin(post);
buf.push('</div>');
}
}
return buf.join("");
}
jade.templates["post-edit"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_edit_mixin = function(u, p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
var html_id = (p.id ? "_#{p.id}" : '');
buf.push('<div');
buf.push(attrs({ 'id':(p.is_comment ? html_id : 'post_edit'), "class": ('post-edit') + ' ' + ('onclick-submit') + ' ' + (p.is_comment ? 'comment' : '') }, {"class":true,"id":true}));
buf.push('><form');
buf.push(attrs({ 'action':("/resources/posts"), 'method':("" + (p.method || 'put') + "") }, {"action":true,"method":true}));
buf.push('><div class="tooltip"></div><div');
buf.push(attrs({ 'data-user-id':(u.id), "class": ('summary') }, {"data-user-id":true}));
buf.push('><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (u.photo || 'images/profile.jpg') + ""), "class": ('profile') + ' ' + ('photo') }, {"src":true}));
buf.push('/></div>');
if ( !p.is_comment)
{
buf.push('<input');
buf.push(attrs({ 'name':('title'), 'type':('text'), 'placeholder':('Title'), 'value':(p.title), "class": ('title') }, {"name":true,"type":true,"placeholder":true,"value":true}));
buf.push('/>');
}
buf.push('<textarea');
buf.push(attrs({ 'id':("editor" + (p.is_comment ? html_id : '') + ""), 'name':('body'), 'placeholder':('Comment ...'), "class": ('body') + ' ' + ('onshiftenter-submit') }, {"id":true,"name":true,"placeholder":true}));
buf.push('>');
var __val__ = p.body
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</textarea><input');
buf.push(attrs({ 'type':('hidden'), 'name':('id'), 'value':(p.id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('forum_id'), 'value':(p.forum_id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('parent_id'), 'value':(p.parent_id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('csrf'), 'value':(p.csrf) }, {"type":true,"name":true,"value":true}));
buf.push('/><button type="submit" name="submit" value="Save">Save</button><div class="close cancel">X</div></form><div class="preview"></div></div>');
};
if ( typeof(post) !== 'undefined')
{
_post_edit_mixin(user, post);
}
}
return buf.join("");
}
jade.templates["post-new"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="forum resizable"></div>');
}
return buf.join("");
}
jade.templates["profile"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="container"><h2>');
var __val__ = profile.name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h2><div');
buf.push(attrs({ 'data-user-id':("" + (profile.id) + ""), 'data-user-name':("" + (profile.name) + ""), "class": ('profile') }, {"data-user-id":true,"data-user-name":true}));
buf.push('><form');
buf.push(attrs({ 'action':("/resources/users/" + (profile.id) + "/avatar"), 'enctype':("multipart/form-data"), 'method':("post") }, {"action":true,"enctype":true,"method":true}));
buf.push('><div class="avatar">');
if ( profile.photo)
{
if ( profile.photo.match(/^https?:/))
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (profile.photo) + "") }, {"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (profile.photo) + "") }, {"src":true}));
buf.push('/>');
}
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/profile.jpg") }, {"src":true}));
buf.push('/>');
}
buf.push('</div><input type="file" name="avatar" style="display:none;"/></form></div><ul><li class="since"><span>Joined </span>');
var __val__ = profile.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</li><li class="count"><b>');
var __val__ = profile.human_post_count 
buf.push(null == __val__ ? "" : __val__);
buf.push('</b><span> ' + escape((interp = profile.post_count == 1 ? "post" : "posts") == null ? '' : interp) + '</span></li><li class="chat"><button title="Chat" class="onclick-chat">Private Message</button></li></ul></div>');
}
return buf.join("");
}
jade.templates["posts-by-user"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var _post_mixin = function(p, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), 'data-user-id':(p.user_id), 'data-post-id':(p.id), 'data-thread-id':(p.thread_id), 'data-forum-id':(p.forum_id), "class": ('post') + ' ' + (p.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true,"data-thread-id":true,"data-forum-id":true}));
buf.push('>');
if ( p.thread_uri)
{
buf.push('<h4 class="title"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h4>');
}
else
{
buf.push('<h4 class="title">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4>');
}
_post_profile_mixin(p);
buf.push('<div class="container"><span class="username">');
var __val__ = p.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><div');
buf.push(attrs({ 'data-time':(p.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = p.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="post-content">');
if ( p.html)
{
buf.push('<p class="body">');
var __val__ = p.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
}
buf.push('</div></div>');
_post_actions_mixin(p);
buf.push('<div class="reply"></div></div><div class="children">');
if ( p.posts && p.posts.length)
{
// iterate p.posts
;(function(){
  if ('number' == typeof p.posts.length) {
    for (var ii = 0, $$l = p.posts.length; ii < $$l; ii++) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
    }
  } else {
    for (var ii in p.posts) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
   }
  }
}).call(this);

}
else if ( p.morePosts)
{
buf.push('<a href="#" class="load-more">More Posts</a>');
}
buf.push('</div>');
};
buf.push('<div class="resizable forum">');
if ( postsByUser.length)
{
var last_thread_id = (-1);
// iterate postsByUser
;(function(){
  if ('number' == typeof postsByUser.length) {
    for (var i = 0, $$l = postsByUser.length; i < $$l; i++) {
      var p = postsByUser[i];

if ( last_thread_id != p.thread_id)
{
buf.push('<h3 class="heading"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') + ' ' + ('title') + ' ' + ('stylish') }, {"href":true}));
buf.push('> <b>' + escape((interp = p.thread_title) == null ? '' : interp) + ' </b></a><a');
buf.push(attrs({ 'href':("/user/" + (p.thread_username) + ""), "class": ('mutant') + ' ' + ('by') }, {"href":true}));
buf.push('>by <b>' + escape((interp = p.thread_username) == null ? '' : interp) + ' </b></a><a');
buf.push(attrs({ 'href':(p.forum_uri), "class": ('mutant') + ' ' + ('forum-link') }, {"href":true}));
buf.push('>in <b>' + escape((interp = p.forum_title) == null ? '' : interp) + '</b></a></h3>');
}
_post_mixin(p, i);
var last_thread_id = (p.thread_id);
    }
  } else {
    for (var i in postsByUser) {
      var p = postsByUser[i];

if ( last_thread_id != p.thread_id)
{
buf.push('<h3 class="heading"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') + ' ' + ('title') + ' ' + ('stylish') }, {"href":true}));
buf.push('> <b>' + escape((interp = p.thread_title) == null ? '' : interp) + ' </b></a><a');
buf.push(attrs({ 'href':("/user/" + (p.thread_username) + ""), "class": ('mutant') + ' ' + ('by') }, {"href":true}));
buf.push('>by <b>' + escape((interp = p.thread_username) == null ? '' : interp) + ' </b></a><a');
buf.push(attrs({ 'href':(p.forum_uri), "class": ('mutant') + ' ' + ('forum-link') }, {"href":true}));
buf.push('>in <b>' + escape((interp = p.forum_title) == null ? '' : interp) + '</b></a></h3>');
}
_post_mixin(p, i);
var last_thread_id = (p.thread_id);
   }
  }
}).call(this);

}
else
{
buf.push('<h3>Check back for my first post<i>!</i></h3>');
}
buf.push('</div>');
}
return buf.join("");
}
jade.templates["post"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var _post_mixin = function(p, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), 'data-user-id':(p.user_id), 'data-post-id':(p.id), 'data-thread-id':(p.thread_id), 'data-forum-id':(p.forum_id), "class": ('post') + ' ' + (p.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true,"data-thread-id":true,"data-forum-id":true}));
buf.push('>');
if ( p.thread_uri)
{
buf.push('<h4 class="title"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h4>');
}
else
{
buf.push('<h4 class="title">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4>');
}
_post_profile_mixin(p);
buf.push('<div class="container"><span class="username">');
var __val__ = p.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><div');
buf.push(attrs({ 'data-time':(p.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = p.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="post-content">');
if ( p.html)
{
buf.push('<p class="body">');
var __val__ = p.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
}
buf.push('</div></div>');
_post_actions_mixin(p);
buf.push('<div class="reply"></div></div><div class="children">');
if ( p.posts && p.posts.length)
{
// iterate p.posts
;(function(){
  if ('number' == typeof p.posts.length) {
    for (var ii = 0, $$l = p.posts.length; ii < $$l; ii++) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
    }
  } else {
    for (var ii in p.posts) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
   }
  }
}).call(this);

}
else if ( p.morePosts)
{
buf.push('<a href="#" class="load-more">More Posts</a>');
}
buf.push('</div>');
};
_post_mixin(post, 0);
}
return buf.join("");
}
jade.templates["admin-domains"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="domains"><form');
buf.push(attrs({ 'action':("/resources/sites/" + (siteId) + ""), 'method':("put"), "class": ('onclick-submit') }, {"action":true,"method":true}));
buf.push('><div class="domain"><label for="domain">Select a Domain</label><select id="domain" name="domain">');
// iterate site.domains
;(function(){
  if ('number' == typeof site.domains.length) {
    for (var $index = 0, $$l = site.domains.length; $index < $$l; $index++) {
      var d = site.domains[$index];

buf.push('<option');
buf.push(attrs({ 'value':(d.id) }, {"value":true}));
buf.push('>');
var __val__ = d.name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</option>');
    }
  } else {
    for (var $index in site.domains) {
      var d = site.domains[$index];

buf.push('<option');
buf.push(attrs({ 'value':(d.id) }, {"value":true}));
buf.push('>');
var __val__ = d.name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</option>');
   }
  }
}).call(this);

buf.push('</select></div><br/><fieldset><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/facebook_32.png") }, {"src":true}));
buf.push('/><legend>Facebook</legend><label for="facebook_client_id">ID</label><input');
buf.push(attrs({ 'id':("facebook_client_id"), 'type':('text'), 'name':('facebookClientId'), 'placeholder':('Facebook API ID ...'), 'value':(site.config.facebookClientId), "class": ('first') }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/><label for="facebook_client_secret">Secret</label><input');
buf.push(attrs({ 'id':("facebook_client_secret"), 'type':('text'), 'name':('facebookClientSecret'), 'placeholder':('Facebook secret ...'), 'value':(site.config.facebookClientId) }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/></fieldset><fieldset><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/twitter_32.png") }, {"src":true}));
buf.push('/><legend>Twitter</legend><label for="twitter_key">Key</label><input');
buf.push(attrs({ 'id':("twitter_key"), 'type':('text'), 'name':('twitterConsumerKey'), 'placeholder':('Twitter API key ...'), 'value':(site.config.twitterConsumerKey), "class": ('first') }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/><label for="twitter_secret">Secret</label><input');
buf.push(attrs({ 'id':("twitter_secret"), 'type':('text'), 'name':('twitterConsumerSecret'), 'placeholder':('Twitter API secret ...'), 'value':(site.config.twitterConsumerSecret) }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/></fieldset><fieldset><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/images/google_32.png") }, {"src":true}));
buf.push('/><legend>Google+</legend><label for="google_key">Key</label><input');
buf.push(attrs({ 'id':("google_key"), 'type':('text'), 'name':('googleConsumerKey'), 'placeholder':('Google+ API key ...'), 'value':(site.config.googleConsumerKey), "class": ('first') }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/><label for="google_secret">Secret</label><input');
buf.push(attrs({ 'id':("google_secret"), 'type':('text'), 'name':('googleConsumerSecret'), 'placeholder':('Google+ API secret ...'), 'value':(site.config.googleConsumerSecret) }, {"id":true,"type":true,"name":true,"placeholder":true,"value":true}));
buf.push('/></fieldset><button type="submit" value="Save">Save</button><div class="tooltip"></div><input type="hidden" name="action" value="domains"/></form></div>');
}
return buf.join("");
}
jade.templates["admin-general"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var analytics = (unescape(site.config.analytics));
buf.push('<form');
buf.push(attrs({ 'action':("/resources/sites/" + (siteId) + ""), 'method':("put"), "class": ('onclick-submit') + ' ' + ('no-focus') }, {"action":true,"method":true}));
buf.push('><fieldset><label for="name">Title</label><input');
buf.push(attrs({ 'id':('name'), 'name':('name'), 'type':('text'), 'value':(site.name), "class": ('name') }, {"id":true,"class":true,"name":true,"type":true,"value":true}));
buf.push('/><div class="break"></div><label for="posts_per_page">Posts per Page</label><input');
buf.push(attrs({ 'id':('posts_per_page'), 'name':('postsPerPage'), 'type':('text'), 'value':(site.config.postsPerPage), 'maxlength':(4), "class": ('posts-per-page') }, {"id":true,"class":true,"name":true,"type":true,"value":true,"maxlength":true}));
buf.push('/><div class="break"></div><label>Privacy</label><div class="box"><input');
buf.push(attrs({ 'id':('private'), 'type':('checkbox'), 'value':('checked'), 'name':('private'), 'checked':(site.config.private) }, {"type":true,"value":true,"name":true,"checked":true}));
buf.push('/><label for="private" class="switch-control"><div class="switch"></div></label><span class="label checked">On</span><div class="note">Hide content from search engines &amp; the public</div></div><div class="break"></div><label>Invite Only</label><div class="box"><input');
buf.push(attrs({ 'id':('invite_only'), 'type':('checkbox'), 'value':('checked'), 'name':('inviteOnly'), 'checked':(site.config.inviteOnly) }, {"type":true,"value":true,"name":true,"checked":true}));
buf.push('/><label for="invite_only" class="switch-control"><div class="switch"></div></label><span class="label checked">On</span><div class="note">Disallow the public from registering - <a href="/admin/invites" class="mutant">Invites</a></div></div><div class="break double"></div><label for="keywords">Keywords</label><textarea id="keywords" name="metaKeywords">');
var __val__ = site.config.metaKeywords
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</textarea><div class="note">Separate meta keywords with commas</div><div class="break"></div><label for="style">Style</label><textarea id="style" name="style">');
var __val__ = site.config.style
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</textarea><div class="note">Paste<a href="http://www.w3schools.com/cssref/" target="_blank">CSS</a>or <a href="http://learnboost.github.io/stylus/" target="_blank">Stylus</a>code in above</div><div class="break"></div><label for="analytics">Analytics</label><textarea id="analytics" name="analytics">');
var __val__ = analytics
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</textarea><div class="note">Paste Javascript code above, excluding &lt;script&gt; tags</div></fieldset><div class="tooltip"></div><button type="submit" value="Save">Save</button><input type="hidden" name="action" value="general"/></form>');
}
return buf.join("");
}
jade.templates["admin-invites"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<form action="/resources/users" method="post" class="onclick-submit"><fieldset><label for="emails">Emails</label><input id="emails" name="emails" type="text" class="emails clear"/><div class="note">Separated by commas</div><div class="break"></div><label for="message">Message</label><textarea id="message" name="message"></textarea></fieldset><button type="submit" value="Send">Send</button><div data-msg="Invites sent!" class="tooltip"></div><input type="hidden" name="action" value="invites"/></form>');
}
return buf.join("");
}
jade.templates["admin-nav"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div class="container"><menu><li class="general"><a href="/admin" class="mutant">General</a></li><li class="menu"><a href="/admin/menu" class="mutant">Menu</a></li><li class="invites"><a href="/admin/invites" class="mutant">Invites</a></li><li class="domains"><a href="/admin/domains" class="mutant">Domains</a></li><li class="feature upgrade"><a href="/admin/upgrade" class="mutant">PRO</a></li></menu></div>');
}
return buf.join("");
}
jade.templates["search"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var _post_mixin = function(p, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), 'data-user-id':(p.user_id), 'data-post-id':(p.id), 'data-thread-id':(p.thread_id), 'data-forum-id':(p.forum_id), "class": ('post') + ' ' + (p.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true,"data-thread-id":true,"data-forum-id":true}));
buf.push('>');
if ( p.thread_uri)
{
buf.push('<h4 class="title"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h4>');
}
else
{
buf.push('<h4 class="title">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4>');
}
_post_profile_mixin(p);
buf.push('<div class="container"><span class="username">');
var __val__ = p.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><div');
buf.push(attrs({ 'data-time':(p.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = p.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="post-content">');
if ( p.html)
{
buf.push('<p class="body">');
var __val__ = p.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
}
buf.push('</div></div>');
_post_actions_mixin(p);
buf.push('<div class="reply"></div></div><div class="children">');
if ( p.posts && p.posts.length)
{
// iterate p.posts
;(function(){
  if ('number' == typeof p.posts.length) {
    for (var ii = 0, $$l = p.posts.length; ii < $$l; ii++) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
    }
  } else {
    for (var ii in p.posts) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
   }
  }
}).call(this);

}
else if ( p.morePosts)
{
buf.push('<a href="#" class="load-more">More Posts</a>');
}
buf.push('</div>');
};
buf.push('<div id="breadcrumb" class="breadcrumb"><div id="new_hits"></div></div>');
var suffix = (elres.total == 1 ? '' : 's');
buf.push('<div class="search resizable"><em id="hit_count"><b>' + escape((interp = elres.total) == null ? '' : interp) + ' hit' + escape((interp = suffix) == null ? '' : interp) + '</b></em><span id="new_hit_count"><a href="#" onclick="showNewHits()">- <span class="count">0 </span>new!</a></span><div id="new_posts"></div>');
if ( elres.hits.length)
{
// iterate elres.hits
;(function(){
  if ('number' == typeof elres.hits.length) {
    for (var $index = 0, $$l = elres.hits.length; $index < $$l; $index++) {
      var hit = elres.hits[$index];

buf.push('<!-- always use thread title-->');
 hit._source.title = hit._source.thread_title
if ( env != 'production')
{
buf.push('<!-- show score in dev mode-->');
 hit._source.title = hit._source.title + ' (score: ' + hit._score + ' )'
}
if ( hit._source.id == hit._source.thread_id)
{
buf.push('<div class="thread-hit">');
_post_mixin(hit._source, 0);
buf.push('</div>');
}
else
{
buf.push('<div class="comment-hit">');
_post_mixin(hit._source, 0);
buf.push('</div>');
}
    }
  } else {
    for (var $index in elres.hits) {
      var hit = elres.hits[$index];

buf.push('<!-- always use thread title-->');
 hit._source.title = hit._source.thread_title
if ( env != 'production')
{
buf.push('<!-- show score in dev mode-->');
 hit._source.title = hit._source.title + ' (score: ' + hit._score + ' )'
}
if ( hit._source.id == hit._source.thread_id)
{
buf.push('<div class="thread-hit">');
_post_mixin(hit._source, 0);
buf.push('</div>');
}
else
{
buf.push('<div class="comment-hit">');
_post_mixin(hit._source, 0);
buf.push('</div>');
}
   }
  }
}).call(this);

}
else
{
buf.push('<h4>Try a more general search<i>!</i></h4>');
}
buf.push('</div>');
}
return buf.join("");
}
jade.templates["search-filters"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var forumOptions_mixin = function(forums, prefix){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
// iterate forums
;(function(){
  if ('number' == typeof forums.length) {
    for (var $index = 0, $$l = forums.length; $index < $$l; $index++) {
      var f = forums[$index];

buf.push('<option');
buf.push(attrs({ 'value':(f.id) }, {"value":true}));
buf.push('>');
var __val__ = prefix + f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</option>');
forumOptions_mixin(f.forums, '-');
    }
  } else {
    for (var $index in forums) {
      var f = forums[$index];

buf.push('<option');
buf.push(attrs({ 'value':(f.id) }, {"value":true}));
buf.push('>');
var __val__ = prefix + f.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</option>');
forumOptions_mixin(f.forums, '-');
   }
  }
}).call(this);

};
buf.push('<div id="search_filters"><div><label><h4>Filter by Forum</h4><select name="forum_id"><option value="">- All -</option>');
forumOptions_mixin(menu, '');
buf.push('</select></label></div><div><label><h4>Within a Timeframe</h4><select name="within"><option value="">- Any Time -</option><option value="day">Within Last Day</option><option value="week">Within Last Week</option><option value="month">Within Last Month</option></select></label></div></div>');
}
return buf.join("");
}
jade.templates["search-facets"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
buf.push('<div id="search_facets"><div style="height:30px"></div>');
if ( facets.forum.length > 1)
{
buf.push('<div class="facet"><div class="facet-title">Hits by Forum</div>');
// iterate facets.forum
;(function(){
  if ('number' == typeof facets.forum.length) {
    for (var $index = 0, $$l = facets.forum.length; $index < $$l; $index++) {
      var forum = facets.forum[$index];

buf.push('<a');
buf.push(attrs({ 'href':(forum.uri), "class": ('mutant') + ' ' + ('facet-hit') }, {"href":true}));
buf.push('><em>');
var __val__ = forum.hitCount
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em><span>');
var __val__ = forum.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span></a>');
    }
  } else {
    for (var $index in facets.forum) {
      var forum = facets.forum[$index];

buf.push('<a');
buf.push(attrs({ 'href':(forum.uri), "class": ('mutant') + ' ' + ('facet-hit') }, {"href":true}));
buf.push('><em>');
var __val__ = forum.hitCount
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em><span>');
var __val__ = forum.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span></a>');
   }
  }
}).call(this);

buf.push('</div>');
}
buf.push('</div>');
}
return buf.join("");
}
jade.templates["__threads"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
buf.push('<ul class="threads">');
// iterate topThreads
;(function(){
  if ('number' == typeof topThreads.length) {
    for (var ii = 0, $$l = topThreads.length; ii < $$l; ii++) {
      var t = topThreads[ii];

_thread_mixin(t);
    }
  } else {
    for (var ii in topThreads) {
      var t = topThreads[ii];

_thread_mixin(t);
   }
  }
}).call(this);

buf.push('</ul>');
}
return buf.join("");
}
jade.templates["_breadcrumb"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _breadcrumb_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
var path = ('');
var parts = (p.uri.split('/'));
var parts = (parts.splice(1, parts.length-2));
// iterate parts
;(function(){
  if ('number' == typeof parts.length) {
    for (var $index = 0, $$l = parts.length; $index < $$l; $index++) {
      var part = parts[$index];

if ( part != 't')
{
buf.push('<a');
buf.push(attrs({ 'href':("/" + (path) + "" + (part) + ""), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = part.replace('-', ' ')
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a><span>/</span>');
}
 path = path + part + '/'
    }
  } else {
    for (var $index in parts) {
      var part = parts[$index];

if ( part != 't')
{
buf.push('<a');
buf.push(attrs({ 'href':("/" + (path) + "" + (part) + ""), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = part.replace('-', ' ')
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a><span>/</span>');
}
 path = path + part + '/'
   }
  }
}).call(this);

buf.push('<em>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em>');
};
}
return buf.join("");
}
jade.templates["_post-actions"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
}
return buf.join("");
}
jade.templates["_post-edit"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_edit_mixin = function(u, p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
var html_id = (p.id ? "_#{p.id}" : '');
buf.push('<div');
buf.push(attrs({ 'id':(p.is_comment ? html_id : 'post_edit'), "class": ('post-edit') + ' ' + ('onclick-submit') + ' ' + (p.is_comment ? 'comment' : '') }, {"class":true,"id":true}));
buf.push('><form');
buf.push(attrs({ 'action':("/resources/posts"), 'method':("" + (p.method || 'put') + "") }, {"action":true,"method":true}));
buf.push('><div class="tooltip"></div><div');
buf.push(attrs({ 'data-user-id':(u.id), "class": ('summary') }, {"data-user-id":true}));
buf.push('><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (u.photo || 'images/profile.jpg') + ""), "class": ('profile') + ' ' + ('photo') }, {"src":true}));
buf.push('/></div>');
if ( !p.is_comment)
{
buf.push('<input');
buf.push(attrs({ 'name':('title'), 'type':('text'), 'placeholder':('Title'), 'value':(p.title), "class": ('title') }, {"name":true,"type":true,"placeholder":true,"value":true}));
buf.push('/>');
}
buf.push('<textarea');
buf.push(attrs({ 'id':("editor" + (p.is_comment ? html_id : '') + ""), 'name':('body'), 'placeholder':('Comment ...'), "class": ('body') + ' ' + ('onshiftenter-submit') }, {"id":true,"name":true,"placeholder":true}));
buf.push('>');
var __val__ = p.body
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</textarea><input');
buf.push(attrs({ 'type':('hidden'), 'name':('id'), 'value':(p.id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('forum_id'), 'value':(p.forum_id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('parent_id'), 'value':(p.parent_id) }, {"type":true,"name":true,"value":true}));
buf.push('/><input');
buf.push(attrs({ 'type':('hidden'), 'name':('csrf'), 'value':(p.csrf) }, {"type":true,"name":true,"value":true}));
buf.push('/><button type="submit" name="submit" value="Save">Save</button><div class="close cancel">X</div></form><div class="preview"></div></div>');
};
}
return buf.join("");
}
jade.templates["_post-profile"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
}
return buf.join("");
}
jade.templates["_post"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _post_actions_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div class="actions"><a class="stylish onclick-append-reply-ui">Comment</a><a');
buf.push(attrs({ 'data-edit':(p.id), 'href':("" + (p.uri.replace(/\/\d+$/, '')) + "/edit/" + (p.id) + ""), "class": ('stylish') + ' ' + ('edit') + ' ' + ('mutant') + ' ' + ('no-surf') }, {"data-edit":true,"href":true}));
buf.push('>Edit</a><a');
buf.push(attrs({ 'href':(p.uri), "class": ('stylish') + ' ' + ('permalink') + ' ' + ('mutant') }, {"href":true}));
buf.push('>Permalink</a><a class="stylish censor onclick-censor-post">Censor</a></div>');
};
var _post_profile_mixin = function(p){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!p.user_photo) p.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<a');
buf.push(attrs({ 'href':("/user/" + (p.user_name) + ""), "class": ('user') + ' ' + ('mutant') }, {"href":true}));
buf.push('><div class="profile photo">');
if ( p.user_photo && p.user_photo.match(/^http/))
{
buf.push('<img');
buf.push(attrs({ 'title':(p.user_name), 'src':("" + (p.user_photo) + "") }, {"title":true,"src":true}));
buf.push('/>');
}
else
{
buf.push('<img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "/" + (p.user_photo) + "") }, {"src":true}));
buf.push('/>');
}
buf.push('</div></a>');
};
var _post_mixin = function(p, i){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
buf.push('<div');
buf.push(attrs({ 'id':("post_" + (p.id) + ""), 'data-user-id':(p.user_id), 'data-post-id':(p.id), 'data-thread-id':(p.thread_id), 'data-forum-id':(p.forum_id), "class": ('post') + ' ' + (p.reason ? 'censored' : '') }, {"class":true,"id":true,"data-user-id":true,"data-post-id":true,"data-thread-id":true,"data-forum-id":true}));
buf.push('>');
if ( p.thread_uri)
{
buf.push('<h4 class="title"><a');
buf.push(attrs({ 'href':(p.thread_uri), "class": ('mutant') }, {"href":true}));
buf.push('>');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</a></h4>');
}
else
{
buf.push('<h4 class="title">');
var __val__ = p.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4>');
}
_post_profile_mixin(p);
buf.push('<div class="container"><span class="username">');
var __val__ = p.user_name
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</span><div');
buf.push(attrs({ 'data-time':(p.created_iso), "class": ('date') }, {"data-time":true}));
buf.push('>');
var __val__ = p.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</div><div class="post-content">');
if ( p.html)
{
buf.push('<p class="body">');
var __val__ = p.html
buf.push(null == __val__ ? "" : __val__);
buf.push('</p>');
}
buf.push('</div></div>');
_post_actions_mixin(p);
buf.push('<div class="reply"></div></div><div class="children">');
if ( p.posts && p.posts.length)
{
// iterate p.posts
;(function(){
  if ('number' == typeof p.posts.length) {
    for (var ii = 0, $$l = p.posts.length; ii < $$l; ii++) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
    }
  } else {
    for (var ii in p.posts) {
      var pp = p.posts[ii];

_post_mixin(pp, ii);
   }
  }
}).call(this);

}
else if ( p.morePosts)
{
buf.push('<a href="#" class="load-more">More Posts</a>');
}
buf.push('</div>');
};
}
return buf.join("");
}
jade.templates["_thread"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
}
return buf.join("");
}
jade.templates["__threads"] = function(locals, attrs, escape, rethrow, merge) {
attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;
var buf = [];
with (locals || {}) {
var interp;
var _thread_mixin = function(t){
var block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};
 if (!t.user_photo) t.user_photo = cacheUrl + 'images/profile.jpg'
buf.push('<li');
buf.push(attrs({ 'data-id':(t.id), 'data-user-id':(t.user_id), "class": ('thread') }, {"data-id":true,"data-user-id":true}));
buf.push('><a');
buf.push(attrs({ 'data-surf':(t.forum_id), 'href':(t.uri), "class": ('mutant') }, {"data-surf":true,"href":true}));
buf.push('><h4 class="title">');
var __val__ = t.title
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</h4><div class="break"></div><div class="profile photo"><img');
buf.push(attrs({ 'src':("" + (cacheUrl) + "" + (t.user_photo) + "") }, {"src":true}));
buf.push('/></div><div class="container"><span class="username">by<em>');
var __val__ = t.user_name // XXX weird things happened when I tried to turn this into an anchor
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('</em></span><span');
buf.push(attrs({ 'data-time':(t.created_iso), "class": ('created') }, {"data-time":true}));
buf.push('>');
var __val__ = t.created_human
buf.push(null == __val__ ? "" : __val__);
buf.push('</span><div class="clear"></div><span class="post-count">');
var __val__ = t.post_count
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>posts</i></span><span class="views">');
var __val__ = t.views
buf.push(escape(null == __val__ ? "" : __val__));
buf.push('<i>views</i></span></div></a></li>');
};
buf.push('<ul class="threads">');
// iterate topThreads
;(function(){
  if ('number' == typeof topThreads.length) {
    for (var ii = 0, $$l = topThreads.length; ii < $$l; ii++) {
      var t = topThreads[ii];

_thread_mixin(t);
    }
  } else {
    for (var ii in topThreads) {
      var t = topThreads[ii];

_thread_mixin(t);
   }
  }
}).call(this);

buf.push('</ul>');
}
return buf.join("");
}
},{"fs":27}],27:[function(require,module,exports){
// nothing to see here... no file methods for the browser

},{}],26:[function(require,module,exports){
if (typeof define !== 'function') { var define = require('amdefine')(module, require); }
define(function(require){ return require('./src/Component'); });

},{"./src/Component":28,"amdefine":29}],29:[function(require,module,exports){
(function(process,__filename){/** vim: et:ts=4:sw=4:sts=4
 * @license amdefine 0.0.5 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/amdefine for details
 */

/*jslint node: true */
/*global module, process */
'use strict';

var path = require('path');

/**
 * Creates a define for node.
 * @param {Object} module the "module" object that is defined by Node for the
 * current module.
 * @param {Function} [require]. Node's require function for the current module.
 * It only needs to be passed in Node versions before 0.5, when module.require
 * did not exist.
 * @returns {Function} a define function that is usable for the current node
 * module.
 */
function amdefine(module, require) {
    var defineCache = {},
        loaderCache = {},
        alreadyCalled = false,
        makeRequire, stringRequire;

    /**
     * Trims the . and .. from an array of path segments.
     * It will keep a leading path segment if a .. will become
     * the first path segment, to help with module name lookups,
     * which act like paths, but can be remapped. But the end result,
     * all paths that use this function should look normalized.
     * NOTE: this method MODIFIES the input array.
     * @param {Array} ary the array of path segments.
     */
    function trimDots(ary) {
        var i, part;
        for (i = 0; ary[i]; i+= 1) {
            part = ary[i];
            if (part === '.') {
                ary.splice(i, 1);
                i -= 1;
            } else if (part === '..') {
                if (i === 1 && (ary[2] === '..' || ary[0] === '..')) {
                    //End of the line. Keep at least one non-dot
                    //path segment at the front so it can be mapped
                    //correctly to disk. Otherwise, there is likely
                    //no path mapping for a path starting with '..'.
                    //This can still fail, but catches the most reasonable
                    //uses of ..
                    break;
                } else if (i > 0) {
                    ary.splice(i - 1, 2);
                    i -= 2;
                }
            }
        }
    }

    function normalize(name, baseName) {
        var baseParts;

        //Adjust any relative paths.
        if (name && name.charAt(0) === '.') {
            //If have a base name, try to normalize against it,
            //otherwise, assume it is a top-level require that will
            //be relative to baseUrl in the end.
            if (baseName) {
                baseParts = baseName.split('/');
                baseParts = baseParts.slice(0, baseParts.length - 1);
                baseParts = baseParts.concat(name.split('/'));
                trimDots(baseParts);
                name = baseParts.join('/');
            }
        }

        return name;
    }

    /**
     * Create the normalize() function passed to a loader plugin's
     * normalize method.
     */
    function makeNormalize(relName) {
        return function (name) {
            return normalize(name, relName);
        };
    }

    function makeLoad(id) {
        function load(value) {
            loaderCache[id] = value;
        }

        load.fromText = function (id, text) {
            //This one is difficult because the text can/probably uses
            //define, and any relative paths and requires should be relative
            //to that id was it would be found on disk. But this would require
            //bootstrapping a module/require fairly deeply from node core.
            //Not sure how best to go about that yet.
            throw new Error('amdefine does not implement load.fromText');
        };

        return load;
    }

    makeRequire = function (systemRequire, exports, module, relId) {
        function amdRequire(deps, callback) {
            if (typeof deps === 'string') {
                //Synchronous, single module require('')
                return stringRequire(systemRequire, exports, module, deps, relId);
            } else {
                //Array of dependencies with a callback.

                //Convert the dependencies to modules.
                deps = deps.map(function (depName) {
                    return stringRequire(systemRequire, exports, module, depName, relId);
                });

                //Wait for next tick to call back the require call.
                process.nextTick(function () {
                    callback.apply(null, deps);
                });
            }
        }

        amdRequire.toUrl = function (filePath) {
            if (filePath.indexOf('.') === 0) {
                return normalize(filePath, path.dirname(module.filename));
            } else {
                return filePath;
            }
        };

        return amdRequire;
    };

    //Favor explicit value, passed in if the module wants to support Node 0.4.
    require = require || function req() {
        return module.require.apply(module, arguments);
    };

    function runFactory(id, deps, factory) {
        var r, e, m, result;

        if (id) {
            e = loaderCache[id] = {};
            m = {
                id: id,
                uri: __filename,
                exports: e
            };
            r = makeRequire(require, e, m, id);
        } else {
            //Only support one define call per file
            if (alreadyCalled) {
                throw new Error('amdefine with no module ID cannot be called more than once per file.');
            }
            alreadyCalled = true;

            //Use the real variables from node
            //Use module.exports for exports, since
            //the exports in here is amdefine exports.
            e = module.exports;
            m = module;
            r = makeRequire(require, e, m, module.id);
        }

        //If there are dependencies, they are strings, so need
        //to convert them to dependency values.
        if (deps) {
            deps = deps.map(function (depName) {
                return r(depName);
            });
        }

        //Call the factory with the right dependencies.
        if (typeof factory === 'function') {
            result = factory.apply(module.exports, deps);
        } else {
            result = factory;
        }

        if (result !== undefined) {
            m.exports = result;
            if (id) {
                loaderCache[id] = m.exports;
            }
        }
    }

    stringRequire = function (systemRequire, exports, module, id, relId) {
        //Split the ID by a ! so that
        var index = id.indexOf('!'),
            originalId = id,
            prefix, plugin;

        if (index === -1) {
            id = normalize(id, relId);

            //Straight module lookup. If it is one of the special dependencies,
            //deal with it, otherwise, delegate to node.
            if (id === 'require') {
                return makeRequire(systemRequire, exports, module, relId);
            } else if (id === 'exports') {
                return exports;
            } else if (id === 'module') {
                return module;
            } else if (loaderCache.hasOwnProperty(id)) {
                return loaderCache[id];
            } else if (defineCache[id]) {
                runFactory.apply(null, defineCache[id]);
                return loaderCache[id];
            } else {
                if(systemRequire) {
                    return systemRequire(originalId);
                } else {
                    throw new Error('No module with ID: ' + id);
                }
            }
        } else {
            //There is a plugin in play.
            prefix = id.substring(0, index);
            id = id.substring(index + 1, id.length);

            plugin = stringRequire(systemRequire, exports, module, prefix, relId);

            if (plugin.normalize) {
                id = plugin.normalize(id, makeNormalize(relId));
            } else {
                //Normalize the ID normally.
                id = normalize(id, relId);
            }

            if (loaderCache[id]) {
                return loaderCache[id];
            } else {
                plugin.load(id, makeRequire(systemRequire, exports, module, relId), makeLoad(id), {});

                return loaderCache[id];
            }
        }
    };

    //Create a define function specific to the module asking for amdefine.
    function define(id, deps, factory) {
        if (Array.isArray(id)) {
            factory = deps;
            deps = id;
            id = undefined;
        } else if (typeof id !== 'string') {
            factory = id;
            id = deps = undefined;
        }

        if (deps && !Array.isArray(deps)) {
            factory = deps;
            deps = undefined;
        }

        if (!deps) {
            deps = ['require', 'exports', 'module'];
        }

        //Set up properties for this module. If an ID, then use
        //internal cache. If no ID, then use the external variables
        //for this node module.
        if (id) {
            //Put the module in deep freeze until there is a
            //require call for it.
            defineCache[id] = [id, deps, factory];
        } else {
            runFactory(id, deps, factory);
        }
    }

    //define.require, which has access to all the values in the
    //cache. Useful for AMD modules that all have IDs in the file,
    //but need to finally export a value to node based on one of those
    //IDs.
    define.require = function (id) {
        if (loaderCache[id]) {
            return loaderCache[id];
        }

        if (defineCache[id]) {
            runFactory.apply(null, defineCache[id]);
            return loaderCache[id];
        }
    };

    define.amd = {};

    return define;
}

module.exports = amdefine;

})(require("__browserify_process"),"/../node_modules/yacomponent/node_modules/amdefine/amdefine.js")
},{"path":30,"__browserify_process":20}],22:[function(require,module,exports){
var Component, ch, templates, AdminMenu;
Component = require('yacomponent');
ch = require('../app/client-helpers.ls');
templates = require('../build/component-jade.js').templates;
module.exports = AdminMenu = (function(superclass){
  var prefix, opts, prototype = extend$((import$(AdminMenu, superclass).displayName = 'AdminMenu', AdminMenu), superclass).prototype, constructor = AdminMenu;
  prefix = 'list_';
  opts = {
    handle: 'div',
    items: 'li',
    maxLevels: 2,
    tolerance: 'pointer',
    toleranceElement: '> div',
    placeholder: 'placeholder'
  };
  prototype.template = templates.AdminMenu;
  prototype.current = null;
  prototype.show = function(){
    var this$ = this;
    return setTimeout(function(){
      return this$.$.find('.col2').show(300);
    }, 300);
  };
  prototype.clone = function(item){
    var e, x$, ref$;
    console.log('clone:', item);
    e = this.$.find('.default').clone().removeClass('default').attr('id', item.id);
    x$ = e.find('input');
    x$.data('menu', (ref$ = item.data) != null ? ref$.menu : void 8);
    x$.data('title', (ref$ = item.data) != null ? ref$.title : void 8);
    x$.val((ref$ = item.data) != null ? ref$.title : void 8);
    return e;
  };
  prototype.currentStore = function(){
    var e, form, x$;
    if (!(e = this.current)) {
      return;
    }
    console.log('here');
    form = this.$.find('form');
    if (form) {
      form.find('input[name="menu"]' != null
        ? 'input[name="menu"]'
        : remove());
      x$ = e;
      x$.data('form', form.serialize());
      x$.data('title', this.current.val());
      console.log('store-menu:', e.data('menu'));
      console.log('store-title:', e.data('title'));
    }
  };
  prototype.currentRestore = function(){
    var e, form, reset, ref$, title;
    if (!(e = this.current)) {
      return;
    }
    if (form = this.$.find('form')) {
      reset = function(){
        return form.get(0).reset();
      };
      ref$ = this.current.data, form = ref$.form, title = ref$.title;
      e.val(title);
      if (menu) {
        form.deserialize(form);
        this.current.val(title);
        console.log('restored:', form);
      } else {
        reset();
      }
    }
  };
  prototype.onAttach = function(){
    var site, s, i$, ref$, len$, item, this$ = this;
    site = this.state.site();
    if (site.config.menu) {
      s = this.$.find('.sortable');
      for (i$ = 0, len$ = (ref$ = JSON.parse(site.config.menu)).length; i$ < len$; ++i$) {
        item = ref$[i$];
        console.log('parsed:', item);
        if (item.id) {
          item.id = prefix + "" + item.id;
          s.append(this.clone(item));
        }
      }
      s.nestedSortable(opts);
      setTimeout(function(){
        return s.find('input:first').focus();
      }, 200);
      this.show();
    }
    this.$.on('click', '.onclick-add', function(ev){
      var s, max, id, e, x$;
      this$.show();
      s = this$.$.find('.sortable');
      max = parseInt(maximum(map(function(it){
        return it.id.replace(prefix, '');
      })(
      s.find('li'))));
      id = !max
        ? 1
        : max + 1;
      e = this$.clone({
        id: prefix + "" + id
      });
      console.log('created:', e);
      x$ = this$.$.find('.sortable');
      x$.append(e);
      x$.nestedSortable(opts);
      x$.find('input').focus();
      this$.currentRestore;
      return false;
    });
    this.$.on('click', 'button[type="submit"]', function(ev){
      var menu, form;
      this$.currentStore();
      menu = this$.$.find('.sortable').data('mjsNestedSortable').toHierarchy();
      if (!menu.length) {
        menu = [menu];
      }
      console.log('saving-nested-sortable:', menu);
      form = this$.$.find('form');
      form.append(constructor.$('<input>').attr('type', 'hidden').attr('name', 'menu').val(JSON.stringify(menu)));
      return submitForm(ev, function(data){
        var f, t, ref$;
        f = $(this);
        t = $(form.find('.tooltip'));
        return showTooltip(t, !data.success ? data != null ? (ref$ = data.errors) != null ? ref$.join('<br>') : void 8 : void 8 : 'Saved!');
      });
    });
    this.$.on('blur', '.row', function(ev){
      return this$.currentStore();
    });
    this.$.on('change', 'form', function(ev){
      return this$.currentStore();
    });
    this.$.on('click', '.row', function(ev){
      this$.current = $(ev.target);
      return this$.currentRestore;
    });
    this.$.find('.sortable').nestedSortable(opts);
  };
  prototype.onDetach = function(){
    return this.$.off();
  };
  function AdminMenu(){
    this.onAttach = bind$(this, 'onAttach', prototype);
    this.currentRestore = bind$(this, 'currentRestore', prototype);
    this.currentStore = bind$(this, 'currentStore', prototype);
    this.clone = bind$(this, 'clone', prototype);
    this.show = bind$(this, 'show', prototype);
    AdminMenu.superclass.apply(this, arguments);
  }
  return AdminMenu;
}(Component));
function bind$(obj, key, target){
  return function(){ return (target || obj)[key].apply(obj, arguments) };
}
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"../app/client-helpers.ls":5,"yacomponent":26}],21:[function(require,module,exports){
var Component, templates, AdminUpgrade;
Component = require('yacomponent');
templates = require('../build/component-jade.js').templates;
module.exports = AdminUpgrade = (function(superclass){
  var prototype = extend$((import$(AdminUpgrade, superclass).displayName = 'AdminUpgrade', AdminUpgrade), superclass).prototype, constructor = AdminUpgrade;
  prototype.template = templates.AdminUpgrade;
  function AdminUpgrade(){
    AdminUpgrade.superclass.apply(this, arguments);
  }
  return AdminUpgrade;
}(Component));
function extend$(sub, sup){
  function fun(){} fun.prototype = (sub.superclass = sup).prototype;
  (sub.prototype = new fun).constructor = sub;
  if (typeof sup.extended == 'function') sup.extended(sub);
  return sub;
}
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
},{"../build/component-jade.js":25,"yacomponent":26}],30:[function(require,module,exports){
(function(process){function filter (xs, fn) {
    var res = [];
    for (var i = 0; i < xs.length; i++) {
        if (fn(xs[i], i, xs)) res.push(xs[i]);
    }
    return res;
}

// resolves . and .. elements in a path array with directory names there
// must be no slashes, empty elements, or device names (c:\) in the array
// (so also no leading and trailing slashes - it does not distinguish
// relative and absolute paths)
function normalizeArray(parts, allowAboveRoot) {
  // if the path tries to go above the root, `up` ends up > 0
  var up = 0;
  for (var i = parts.length; i >= 0; i--) {
    var last = parts[i];
    if (last == '.') {
      parts.splice(i, 1);
    } else if (last === '..') {
      parts.splice(i, 1);
      up++;
    } else if (up) {
      parts.splice(i, 1);
      up--;
    }
  }

  // if the path is allowed to go above the root, restore leading ..s
  if (allowAboveRoot) {
    for (; up--; up) {
      parts.unshift('..');
    }
  }

  return parts;
}

// Regex to split a filename into [*, dir, basename, ext]
// posix version
var splitPathRe = /^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;

// path.resolve([from ...], to)
// posix version
exports.resolve = function() {
var resolvedPath = '',
    resolvedAbsolute = false;

for (var i = arguments.length; i >= -1 && !resolvedAbsolute; i--) {
  var path = (i >= 0)
      ? arguments[i]
      : process.cwd();

  // Skip empty and invalid entries
  if (typeof path !== 'string' || !path) {
    continue;
  }

  resolvedPath = path + '/' + resolvedPath;
  resolvedAbsolute = path.charAt(0) === '/';
}

// At this point the path should be resolved to a full absolute path, but
// handle relative paths to be safe (might happen when process.cwd() fails)

// Normalize the path
resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {
    return !!p;
  }), !resolvedAbsolute).join('/');

  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';
};

// path.normalize(path)
// posix version
exports.normalize = function(path) {
var isAbsolute = path.charAt(0) === '/',
    trailingSlash = path.slice(-1) === '/';

// Normalize the path
path = normalizeArray(filter(path.split('/'), function(p) {
    return !!p;
  }), !isAbsolute).join('/');

  if (!path && !isAbsolute) {
    path = '.';
  }
  if (path && trailingSlash) {
    path += '/';
  }
  
  return (isAbsolute ? '/' : '') + path;
};


// posix version
exports.join = function() {
  var paths = Array.prototype.slice.call(arguments, 0);
  return exports.normalize(filter(paths, function(p, index) {
    return p && typeof p === 'string';
  }).join('/'));
};


exports.dirname = function(path) {
  var dir = splitPathRe.exec(path)[1] || '';
  var isWindows = false;
  if (!dir) {
    // No dirname
    return '.';
  } else if (dir.length === 1 ||
      (isWindows && dir.length <= 3 && dir.charAt(1) === ':')) {
    // It is just a slash or a drive letter with a slash
    return dir;
  } else {
    // It is a full dirname, strip trailing slash
    return dir.substring(0, dir.length - 1);
  }
};


exports.basename = function(path, ext) {
  var f = splitPathRe.exec(path)[2] || '';
  // TODO: make this comparison case-insensitive on windows?
  if (ext && f.substr(-1 * ext.length) === ext) {
    f = f.substr(0, f.length - ext.length);
  }
  return f;
};


exports.extname = function(path) {
  return splitPathRe.exec(path)[3] || '';
};

exports.relative = function(from, to) {
  from = exports.resolve(from).substr(1);
  to = exports.resolve(to).substr(1);

  function trim(arr) {
    var start = 0;
    for (; start < arr.length; start++) {
      if (arr[start] !== '') break;
    }

    var end = arr.length - 1;
    for (; end >= 0; end--) {
      if (arr[end] !== '') break;
    }

    if (start > end) return [];
    return arr.slice(start, end - start + 1);
  }

  var fromParts = trim(from.split('/'));
  var toParts = trim(to.split('/'));

  var length = Math.min(fromParts.length, toParts.length);
  var samePartsLength = length;
  for (var i = 0; i < length; i++) {
    if (fromParts[i] !== toParts[i]) {
      samePartsLength = i;
      break;
    }
  }

  var outputParts = [];
  for (var i = samePartsLength; i < fromParts.length; i++) {
    outputParts.push('..');
  }

  outputParts = outputParts.concat(toParts.slice(samePartsLength));

  return outputParts.join('/');
};

})(require("__browserify_process"))
},{"__browserify_process":20}],28:[function(require,module,exports){
(function(){
  var define;
  define = (typeof window != 'undefined' && window !== null ? window.define : void 8) || require('amdefine')(module, require);
  define(function(require){
    var reactivejs, dollarish, Component;
    reactivejs = require('reactivejs');
    dollarish = typeof window != 'undefined' && window !== null
      ? window.$
      : require('cheerio');
    return Component = (function(){
      Component.displayName = 'Component';
      var prototype = Component.prototype, constructor = Component;
      Component.$ = dollarish;
      Component.$R = reactivejs;
      function Component(arg$, selector, parent){
        var ref$, locals, ref1$, autoRender, autoAttach, res$, k, v;
        ref$ = arg$ != null
          ? arg$
          : {}, locals = (ref1$ = ref$.locals) != null
          ? ref1$
          : {}, autoRender = (ref1$ = ref$.autoRender) != null ? ref1$ : true, autoAttach = (ref1$ = ref$.autoAttach) != null ? ref1$ : true;
        this.selector = selector;
        this.parent = parent;
        res$ = {};
        for (k in locals) {
          v = locals[k];
          res$[k] = v != null && v._isReactive
            ? v
            : constructor.$R.state(v === void 8 ? null : v);
        }
        this.state = res$;
        if (this.selector) {
          if (this.parent) {
            this.$ = this.parent.$.find(this.selector);
          } else {
            this.$ = constructor.$(this.selector);
          }
        } else {
          this.$top = constructor.$('<div><div/></div>');
          this.$ = this.$top.find('div');
        }
        if (this.init) {
          this.init();
        }
        if (!this.parent) {
          if (autoRender) {
            this.render();
          }
          if (autoAttach) {
            this.attach();
          }
        }
      }
      prototype.isClient = typeof window != 'undefined' && window !== null;
      prototype.template = function(){
        return '';
      };
      prototype.attach = function(){
        var i$, ref$, child;
        if (!this.isClient) {
          return this;
        }
        if (this.isAttached) {
          return this;
        }
        if (this.children) {
          for (i$ in ref$ = this.children) {
            child = ref$[i$];
            child.attach();
          }
        }
        if (this.onAttach) {
          this.onAttach();
        }
        this.isAttached = true;
        return this;
      };
      prototype.detach = function(){
        var i$, ref$, child;
        if (!this.isClient) {
          return this;
        }
        if (!this.isAttached) {
          return this;
        }
        if (this.children) {
          for (i$ in ref$ = this.children) {
            child = ref$[i$];
            child.detach();
          }
        }
        if (this.onDetach) {
          this.onDetach();
        }
        this.isAttached = false;
        return this;
      };
      prototype.render = function(){
        var locals, templateOut, $dom, i$, ref$, child;
        this.$.addClass(this.constructor.name);
        locals = this.locals();
        templateOut = this.template(locals);
        if (this.mutate || this.children) {
          $dom = constructor.$('<div class="render-wrapper">' + templateOut + '</div>');
          if (this.mutate) {
            this.mutate($dom);
          }
          this.$.html($dom.html());
          if (this.children) {
            for (i$ in ref$ = this.children) {
              child = ref$[i$];
              child.$ = this.$.find(child.selector);
              child.render();
            }
          }
        } else {
          this.$.html(templateOut);
        }
        return this;
      };
      prototype.reload = function(){
        return this.detach().render().attach();
      };
      prototype.locals = function(newLocals){
        var k, v, ref$, s, results$ = {};
        if (newLocals) {
          for (k in newLocals) {
            v = newLocals[k];
            this.local(k, v);
          }
        }
        for (k in ref$ = this.state) {
          s = ref$[k];
          results$[k] = s();
        }
        return results$;
      };
      prototype.local = function(k, v){
        var existingR;
        existingR = this.state[k];
        if (v === void 8) {
          if (existingR) {
            return existingR();
          }
        } else {
          if (existingR) {
            if (existingR.val === void 8) {
              throw new Error("'" + k + "' is not reactive state, you can only set reactive state");
            } else {
              return existingR(v === void 8 ? null : v);
            }
          } else {
            this.state[k] = constructor.$R.state(v === void 8 ? null : v);
            return v;
          }
        }
      };
      prototype.html = function(wrapped){
        wrapped == null && (wrapped = true);
        return ((wrapped && this.$top) || this.$).html();
      };
      return Component;
    }());
  });
}).call(this);

},{"cheerio":19,"amdefine":29,"reactivejs":8}]},{},[2,9])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvdmFncmFudC9ub2RlX21vZHVsZXMvcHJlbHVkZS1scy9wcmVsdWRlLWJyb3dzZXItbWluLmpzIiwiL3ZhZ3JhbnQvYXBwL2xheW91dC5scyIsIi92YWdyYW50L2FwcC9wYi1lbnRyeS5scyIsIi92YWdyYW50L25vZGVfbW9kdWxlcy9yZWFjdGl2ZWpzL3NyYy9yZWFjdGl2ZS5qcyIsIi92YWdyYW50L2FwcC9jbGllbnQtaGVscGVycy5scyIsIi92YWdyYW50L2FwcC9wYWdlci5scyIsIi92YWdyYW50L25vZGVfbW9kdWxlcy9sb2Rhc2gvbG9kYXNoLmpzIiwiL3ZhZ3JhbnQvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvX2VtcHR5LmpzIiwiL3ZhZ3JhbnQvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2luc2VydC1tb2R1bGUtZ2xvYmFscy9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzIiwiL3ZhZ3JhbnQvYXBwL3BiLW11dGFudHMubHMiLCIvdmFncmFudC9hcHAvdGFza3MubHMiLCIvdmFncmFudC9hcHAvZm9ydW0tdXJscy5scyIsIi92YWdyYW50L2FwcC9pby1jbGllbnQubHMiLCIvdmFncmFudC9saWIvbXV0YW50L211dGFudC5scyIsIi92YWdyYW50L2NvbXBvbmVudC9QaG90b0Nyb3BwZXIubHMiLCIvdmFncmFudC9jb21wb25lbnQvQXV0aC5scyIsIi92YWdyYW50L2FwcC9zaGFyZWQtaGVscGVycy5scyIsIi92YWdyYW50L2NvbXBvbmVudC9CdXkubHMiLCIvdmFncmFudC9jb21wb25lbnQvUGFnaW5hdG9yLmxzIiwiL3ZhZ3JhbnQvY29tcG9uZW50L0NoYXQubHMiLCIvdmFncmFudC9hcHAvZnNtLmxzIiwiL3ZhZ3JhbnQvYnVpbGQvY29tcG9uZW50LWphZGUuanMiLCIvdmFncmFudC9idWlsZC9jbGllbnQtamFkZS5qcyIsIi92YWdyYW50L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXJlc29sdmUvYnVpbHRpbi9mcy5qcyIsIi92YWdyYW50L25vZGVfbW9kdWxlcy95YWNvbXBvbmVudC9tYWluLmpzIiwiL3ZhZ3JhbnQvbm9kZV9tb2R1bGVzL3lhY29tcG9uZW50L25vZGVfbW9kdWxlcy9hbWRlZmluZS9hbWRlZmluZS5qcyIsIi92YWdyYW50L2NvbXBvbmVudC9BZG1pbk1lbnUubHMiLCIvdmFncmFudC9jb21wb25lbnQvQWRtaW5VcGdyYWRlLmxzIiwiL3ZhZ3JhbnQvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcmVzb2x2ZS9idWlsdGluL3BhdGguanMiLCIvdmFncmFudC9ub2RlX21vZHVsZXMveWFjb21wb25lbnQvc3JjL0NvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3YySUE7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ252QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3psRUE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7O0FDRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cz1mdW5jdGlvbihuLHIsdCl7ZnVuY3Rpb24gZSh0LGkpe2lmKCFyW3RdKXtpZighblt0XSl7dmFyIG89dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighaSYmbylyZXR1cm4gbyh0LCEwKTtpZih1KXJldHVybiB1KHQsITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrdCtcIidcIil9dmFyIGE9clt0XT17ZXhwb3J0czp7fX07blt0XVswXS5jYWxsKGEuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgdT1uW3RdWzFdW3JdO3JldHVybiBlKHU/dTpyKX0sYSxhLmV4cG9ydHMpfXJldHVybiByW3RdLmV4cG9ydHN9dmFyIHU9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIGk9MDtpPHQubGVuZ3RoO2krKyllKHRbaV0pO3JldHVybiBlfSh7XCJwcmVsdWRlLWxzXCI6W2Z1bmN0aW9uKG4scix0KXtyLmV4cG9ydHM9bihcImJjbWMxZ1wiKX0se31dLGJjbWMxZzpbZnVuY3Rpb24obixyLHQpe3ZhciBlLHUsaSxvLGEsYyxmLGwscyxwPXt9LnRvU3RyaW5nO2U9bihcIi4vRnVuYy5qc1wiKTt1PW4oXCIuL0xpc3QuanNcIik7aT1uKFwiLi9PYmouanNcIik7bz1uKFwiLi9TdHIuanNcIik7YT1uKFwiLi9OdW0uanNcIik7Yz1mdW5jdGlvbihuKXtyZXR1cm4gbn07Zj1oKGZ1bmN0aW9uKG4scil7cmV0dXJuIHAuY2FsbChyKS5zbGljZSg4LC0xKT09PW59KTtsPWgoZnVuY3Rpb24obixyKXt2YXIgdCxlPVtdO2Zvcih0PTA7dDxuOysrdCl7ZS5wdXNoKHIpfXJldHVybiBlfSk7by5lbXB0eT11LmVtcHR5O28uc2xpY2U9dS5zbGljZTtvLnRha2U9dS50YWtlO28uZHJvcD11LmRyb3A7by5zcGxpdEF0PXUuc3BsaXRBdDtvLnRha2VXaGlsZT11LnRha2VXaGlsZTtvLmRyb3BXaGlsZT11LmRyb3BXaGlsZTtvLnNwYW49dS5zcGFuO28uYnJlYWtTdHI9dS5icmVha0xpc3Q7cz17RnVuYzplLExpc3Q6dSxPYmo6aSxTdHI6byxOdW06YSxpZDpjLGlzVHlwZTpmLHJlcGxpY2F0ZTpsfTtzLmVhY2g9dS5lYWNoO3MubWFwPXUubWFwO3MuZmlsdGVyPXUuZmlsdGVyO3MuY29tcGFjdD11LmNvbXBhY3Q7cy5yZWplY3Q9dS5yZWplY3Q7cy5wYXJ0aXRpb249dS5wYXJ0aXRpb247cy5maW5kPXUuZmluZDtzLmhlYWQ9dS5oZWFkO3MuZmlyc3Q9dS5maXJzdDtzLnRhaWw9dS50YWlsO3MubGFzdD11Lmxhc3Q7cy5pbml0aWFsPXUuaW5pdGlhbDtzLmVtcHR5PXUuZW1wdHk7cy5yZXZlcnNlPXUucmV2ZXJzZTtzLmRpZmZlcmVuY2U9dS5kaWZmZXJlbmNlO3MuaW50ZXJzZWN0aW9uPXUuaW50ZXJzZWN0aW9uO3MudW5pb249dS51bmlvbjtzLmNvdW50Qnk9dS5jb3VudEJ5O3MuZ3JvdXBCeT11Lmdyb3VwQnk7cy5mb2xkPXUuZm9sZDtzLmZvbGRsPXUuZm9sZGw7cy5mb2xkMT11LmZvbGQxO3MuZm9sZGwxPXUuZm9sZGwxO3MuZm9sZHI9dS5mb2xkcjtzLmZvbGRyMT11LmZvbGRyMTtzLnVuZm9sZHI9dS51bmZvbGRyO3MuYW5kTGlzdD11LmFuZExpc3Q7cy5vckxpc3Q9dS5vckxpc3Q7cy5hbnk9dS5hbnk7cy5hbGw9dS5hbGw7cy51bmlxdWU9dS51bmlxdWU7cy5zb3J0PXUuc29ydDtzLnNvcnRXaXRoPXUuc29ydFdpdGg7cy5zb3J0Qnk9dS5zb3J0Qnk7cy5zdW09dS5zdW07cy5wcm9kdWN0PXUucHJvZHVjdDtzLm1lYW49dS5tZWFuO3MuYXZlcmFnZT11LmF2ZXJhZ2U7cy5jb25jYXQ9dS5jb25jYXQ7cy5jb25jYXRNYXA9dS5jb25jYXRNYXA7cy5mbGF0dGVuPXUuZmxhdHRlbjtzLm1heGltdW09dS5tYXhpbXVtO3MubWluaW11bT11Lm1pbmltdW07cy5zY2FuPXUuc2NhbjtzLnNjYW5sPXUuc2Nhbmw7cy5zY2FuMT11LnNjYW4xO3Muc2NhbmwxPXUuc2NhbmwxO3Muc2NhbnI9dS5zY2FucjtzLnNjYW5yMT11LnNjYW5yMTtzLnNsaWNlPXUuc2xpY2U7cy50YWtlPXUudGFrZTtzLmRyb3A9dS5kcm9wO3Muc3BsaXRBdD11LnNwbGl0QXQ7cy50YWtlV2hpbGU9dS50YWtlV2hpbGU7cy5kcm9wV2hpbGU9dS5kcm9wV2hpbGU7cy5zcGFuPXUuc3BhbjtzLmJyZWFrTGlzdD11LmJyZWFrTGlzdDtzLnppcD11LnppcDtzLnppcFdpdGg9dS56aXBXaXRoO3MuemlwQWxsPXUuemlwQWxsO3MuemlwQWxsV2l0aD11LnppcEFsbFdpdGg7cy5hcHBseT1lLmFwcGx5O3MuY3Vycnk9ZS5jdXJyeTtzLmZsaXA9ZS5mbGlwO3MuZml4PWUuZml4O3Muc3BsaXQ9by5zcGxpdDtzLmpvaW49by5qb2luO3MubGluZXM9by5saW5lcztzLnVubGluZXM9by51bmxpbmVzO3Mud29yZHM9by53b3JkcztzLnVud29yZHM9by51bndvcmRzO3MuY2hhcnM9by5jaGFycztzLnVuY2hhcnM9by51bmNoYXJzO3MudmFsdWVzPWkudmFsdWVzO3Mua2V5cz1pLmtleXM7cy5wYWlyc1RvT2JqPWkucGFpcnNUb09iajtzLm9ialRvUGFpcnM9aS5vYmpUb1BhaXJzO3MubGlzdHNUb09iaj1pLmxpc3RzVG9PYmo7cy5vYmpUb0xpc3RzPWkub2JqVG9MaXN0cztzLm1heD1hLm1heDtzLm1pbj1hLm1pbjtzLm5lZ2F0ZT1hLm5lZ2F0ZTtzLmFicz1hLmFicztzLnNpZ251bT1hLnNpZ251bTtzLnF1b3Q9YS5xdW90O3MucmVtPWEucmVtO3MuZGl2PWEuZGl2O3MubW9kPWEubW9kO3MucmVjaXA9YS5yZWNpcDtzLnBpPWEucGk7cy50YXU9YS50YXU7cy5leHA9YS5leHA7cy5zcXJ0PWEuc3FydDtzLmxuPWEubG47cy5wb3c9YS5wb3c7cy5zaW49YS5zaW47cy50YW49YS50YW47cy5jb3M9YS5jb3M7cy5hY29zPWEuYWNvcztzLmFzaW49YS5hc2luO3MuYXRhbj1hLmF0YW47cy5hdGFuMj1hLmF0YW4yO3MudHJ1bmNhdGU9YS50cnVuY2F0ZTtzLnJvdW5kPWEucm91bmQ7cy5jZWlsaW5nPWEuY2VpbGluZztzLmZsb29yPWEuZmxvb3I7cy5pc0l0TmFOPWEuaXNJdE5hTjtzLmV2ZW49YS5ldmVuO3Mub2RkPWEub2RkO3MuZ2NkPWEuZ2NkO3MubGNtPWEubGNtO3MuVkVSU0lPTj1cIjEuMC4wXCI7ci5leHBvcnRzPXM7ZnVuY3Rpb24gaChuLHIpe3ZhciB0LGU9ZnVuY3Rpb24odSl7cmV0dXJuIG4ubGVuZ3RoPjE/ZnVuY3Rpb24oKXt2YXIgaT11P3UuY29uY2F0KCk6W107dD1yP3R8fHRoaXM6dGhpcztyZXR1cm4gaS5wdXNoLmFwcGx5KGksYXJndW1lbnRzKTxuLmxlbmd0aCYmYXJndW1lbnRzLmxlbmd0aD9lLmNhbGwodCxpKTpuLmFwcGx5KHQsaSl9Om59O3JldHVybiBlKCl9fSx7XCIuL0Z1bmMuanNcIjoxLFwiLi9PYmouanNcIjoyLFwiLi9OdW0uanNcIjozLFwiLi9MaXN0LmpzXCI6NCxcIi4vU3RyLmpzXCI6NX1dLDE6W2Z1bmN0aW9uKG4scix0KXt2YXIgZSx1LGksbztlPWZ1bmN0aW9uKG4pe3JldHVybiBhKG4pfTt1PWEoZnVuY3Rpb24obixyLHQpe3JldHVybiBuKHQscil9KTtpPWZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbihyLHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBuKHIocikpLmFwcGx5KG51bGwsYXJndW1lbnRzKX19KGZ1bmN0aW9uKHIsdCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG4ocihyKSkuYXBwbHkobnVsbCxhcmd1bWVudHMpfX0pfTtvPWEoZnVuY3Rpb24obixyKXtyZXR1cm4gbi5hcHBseShudWxsLHIpfSk7ci5leHBvcnRzPXtjdXJyeTplLGZsaXA6dSxmaXg6aSxhcHBseTpvfTtmdW5jdGlvbiBhKG4scil7dmFyIHQsZT1mdW5jdGlvbih1KXtyZXR1cm4gbi5sZW5ndGg+MT9mdW5jdGlvbigpe3ZhciBpPXU/dS5jb25jYXQoKTpbXTt0PXI/dHx8dGhpczp0aGlzO3JldHVybiBpLnB1c2guYXBwbHkoaSxhcmd1bWVudHMpPG4ubGVuZ3RoJiZhcmd1bWVudHMubGVuZ3RoP2UuY2FsbCh0LGkpOm4uYXBwbHkodCxpKX06bn07cmV0dXJuIGUoKX19LHt9XSwyOltmdW5jdGlvbihuLHIsdCl7dmFyIGUsdSxpLG8sYSxjLGYsbCxzLHAsaCxnLHYsbTtlPWZ1bmN0aW9uKG4pe3ZhciByLHQsZT1bXTtmb3IociBpbiBuKXt0PW5bcl07ZS5wdXNoKHQpfXJldHVybiBlfTt1PWZ1bmN0aW9uKG4pe3ZhciByLHQ9W107Zm9yKHIgaW4gbil7dC5wdXNoKHIpfXJldHVybiB0fTtpPWZ1bmN0aW9uKG4pe3ZhciByLHQsZSx1PXt9O2ZvcihyPTAsdD1uLmxlbmd0aDtyPHQ7KytyKXtlPW5bcl07dVtlWzBdXT1lWzFdfXJldHVybiB1fTtvPWZ1bmN0aW9uKG4pe3ZhciByLHQsZT1bXTtmb3IociBpbiBuKXt0PW5bcl07ZS5wdXNoKFtyLHRdKX1yZXR1cm4gZX07YT1kKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1LGksbz17fTtmb3IodD0wLGU9bi5sZW5ndGg7dDxlOysrdCl7dT10O2k9blt0XTtvW2ldPXJbdV19cmV0dXJuIG99KTtjPWZ1bmN0aW9uKG4pe3ZhciByLHQsZSx1O3I9W107dD1bXTtmb3IoZSBpbiBuKXt1PW5bZV07ci5wdXNoKGUpO3QucHVzaCh1KX1yZXR1cm5bcix0XX07Zj1mdW5jdGlvbihuKXt2YXIgcjtmb3IociBpbiBuKXtyZXR1cm4gZmFsc2V9cmV0dXJuIHRydWV9O2w9ZChmdW5jdGlvbihuLHIpe3ZhciB0LGU7Zm9yKHQgaW4gcil7ZT1yW3RdO24oZSl9cmV0dXJuIHJ9KTtzPWQoZnVuY3Rpb24obixyKXt2YXIgdCxlLHU9e307Zm9yKHQgaW4gcil7ZT1yW3RdO3VbdF09bihlKX1yZXR1cm4gdX0pO3A9ZChmdW5jdGlvbihuKXt2YXIgcix0LGU9e307Zm9yKHIgaW4gbil7dD1uW3JdO2lmKHQpe2Vbcl09dH19cmV0dXJuIGV9KTtoPWQoZnVuY3Rpb24obixyKXt2YXIgdCxlLHU9e307Zm9yKHQgaW4gcil7ZT1yW3RdO2lmKG4oZSkpe3VbdF09ZX19cmV0dXJuIHV9KTtnPWQoZnVuY3Rpb24obixyKXt2YXIgdCxlLHU9e307Zm9yKHQgaW4gcil7ZT1yW3RdO2lmKCFuKGUpKXt1W3RdPWV9fXJldHVybiB1fSk7dj1kKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1LGk7dD17fTtlPXt9O2Zvcih1IGluIHIpe2k9clt1XTsobihpKT90OmUpW3VdPWl9cmV0dXJuW3QsZV19KTttPWQoZnVuY3Rpb24obixyKXt2YXIgdCxlO2Zvcih0IGluIHIpe2U9clt0XTtpZihuKGUpKXtyZXR1cm4gZX19fSk7ci5leHBvcnRzPXt2YWx1ZXM6ZSxrZXlzOnUscGFpcnNUb09iajppLG9ialRvUGFpcnM6byxsaXN0c1RvT2JqOmEsb2JqVG9MaXN0czpjLGVtcHR5OmYsZWFjaDpsLG1hcDpzLGZpbHRlcjpoLGNvbXBhY3Q6cCxyZWplY3Q6ZyxwYXJ0aXRpb246dixmaW5kOm19O2Z1bmN0aW9uIGQobixyKXt2YXIgdCxlPWZ1bmN0aW9uKHUpe3JldHVybiBuLmxlbmd0aD4xP2Z1bmN0aW9uKCl7dmFyIGk9dT91LmNvbmNhdCgpOltdO3Q9cj90fHx0aGlzOnRoaXM7cmV0dXJuIGkucHVzaC5hcHBseShpLGFyZ3VtZW50cyk8bi5sZW5ndGgmJmFyZ3VtZW50cy5sZW5ndGg/ZS5jYWxsKHQsaSk6bi5hcHBseSh0LGkpfTpufTtyZXR1cm4gZSgpfX0se31dLDM6W2Z1bmN0aW9uKG4scix0KXt2YXIgZSx1LGksbyxhLGMsZixsLHMscCxoLGcsdixtLGQseSxqLGIseCxNLGssVyxMLHEsdyxULHosQSxOLE8sQixTO2U9SShmdW5jdGlvbihuLHIpe3JldHVybiBuPnI/bjpyfSk7dT1JKGZ1bmN0aW9uKG4scil7cmV0dXJuIG48cj9uOnJ9KTtpPWZ1bmN0aW9uKG4pe3JldHVybi1ufTtvPU1hdGguYWJzO2E9ZnVuY3Rpb24obil7aWYobjwwKXtyZXR1cm4tMX1lbHNlIGlmKG4+MCl7cmV0dXJuIDF9ZWxzZXtyZXR1cm4gMH19O2M9SShmdW5jdGlvbihuLHIpe3JldHVybn5+KG4vcil9KTtmPUkoZnVuY3Rpb24obixyKXtyZXR1cm4gbiVyfSk7bD1JKGZ1bmN0aW9uKG4scil7cmV0dXJuIE1hdGguZmxvb3Iobi9yKX0pO3M9SShmdW5jdGlvbihuLHIpe3ZhciB0O3JldHVybihuJSh0PXIpK3QpJXR9KTtwPWZ1bmN0aW9uKG4pe3JldHVybiAxL259O2g9TWF0aC5QSTtnPWgqMjt2PU1hdGguZXhwO209TWF0aC5zcXJ0O2Q9TWF0aC5sb2c7eT1JKGZ1bmN0aW9uKG4scil7cmV0dXJuIE1hdGgucG93KG4scil9KTtqPU1hdGguc2luO2I9TWF0aC50YW47eD1NYXRoLmNvcztNPU1hdGguYXNpbjtrPU1hdGguYWNvcztXPU1hdGguYXRhbjtMPUkoZnVuY3Rpb24obixyKXtyZXR1cm4gTWF0aC5hdGFuMihuLHIpfSk7cT1mdW5jdGlvbihuKXtyZXR1cm5+fm59O3c9TWF0aC5yb3VuZDtUPU1hdGguY2VpbDt6PU1hdGguZmxvb3I7QT1mdW5jdGlvbihuKXtyZXR1cm4gbiE9PW59O049ZnVuY3Rpb24obil7cmV0dXJuIG4lMj09PTB9O089ZnVuY3Rpb24obil7cmV0dXJuIG4lMiE9PTB9O0I9SShmdW5jdGlvbihuLHIpe3ZhciB0O249TWF0aC5hYnMobik7cj1NYXRoLmFicyhyKTt3aGlsZShyIT09MCl7dD1uJXI7bj1yO3I9dH1yZXR1cm4gbn0pO1M9SShmdW5jdGlvbihuLHIpe3JldHVybiBNYXRoLmFicyhNYXRoLmZsb29yKG4vQihuLHIpKnIpKX0pO3IuZXhwb3J0cz17bWF4OmUsbWluOnUsbmVnYXRlOmksYWJzOm8sc2lnbnVtOmEscXVvdDpjLHJlbTpmLGRpdjpsLG1vZDpzLHJlY2lwOnAscGk6aCx0YXU6ZyxleHA6dixzcXJ0Om0sbG46ZCxwb3c6eSxzaW46aix0YW46Yixjb3M6eCxhY29zOmssYXNpbjpNLGF0YW46VyxhdGFuMjpMLHRydW5jYXRlOnEscm91bmQ6dyxjZWlsaW5nOlQsZmxvb3I6eixpc0l0TmFOOkEsZXZlbjpOLG9kZDpPLGdjZDpCLGxjbTpTfTtmdW5jdGlvbiBJKG4scil7dmFyIHQsZT1mdW5jdGlvbih1KXtyZXR1cm4gbi5sZW5ndGg+MT9mdW5jdGlvbigpe3ZhciBpPXU/dS5jb25jYXQoKTpbXTt0PXI/dHx8dGhpczp0aGlzO3JldHVybiBpLnB1c2guYXBwbHkoaSxhcmd1bWVudHMpPG4ubGVuZ3RoJiZhcmd1bWVudHMubGVuZ3RoP2UuY2FsbCh0LGkpOm4uYXBwbHkodCxpKX06bn07cmV0dXJuIGUoKX19LHt9XSw0OltmdW5jdGlvbihuLHIsdCl7dmFyIGUsdSxpLG8sYSxjLGYsbCxzLHAsaCxnLHYsbSxkLHksaixiLHgsTSxrLFcsTCxxLHcsVCx6LEEsTixPLEIsUyxJLFAsRixFLEMsUixWLEQsRyxILEosSyxRLFUsWCxZLFosJCxfLG5yLHJyLHRyLGVyLHVyLGlyLG9yLGFyLGNyLGZyLGxyPVtdLnNsaWNlO2U9c3IoZnVuY3Rpb24obixyKXt2YXIgdCxlLHU7Zm9yKHQ9MCxlPXIubGVuZ3RoO3Q8ZTsrK3Qpe3U9clt0XTtuKHUpfXJldHVybiByfSk7dT1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdSxpPVtdO2Zvcih0PTAsZT1yLmxlbmd0aDt0PGU7Kyt0KXt1PXJbdF07aS5wdXNoKG4odSkpfXJldHVybiBpfSk7aT1zcihmdW5jdGlvbihuKXt2YXIgcix0LGUsdT1bXTtmb3Iocj0wLHQ9bi5sZW5ndGg7cjx0Oysrcil7ZT1uW3JdO2lmKGUpe3UucHVzaChlKX19cmV0dXJuIHV9KTtvPXNyKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1LGk9W107Zm9yKHQ9MCxlPXIubGVuZ3RoO3Q8ZTsrK3Qpe3U9clt0XTtpZihuKHUpKXtpLnB1c2godSl9fXJldHVybiBpfSk7YT1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdSxpPVtdO2Zvcih0PTAsZT1yLmxlbmd0aDt0PGU7Kyt0KXt1PXJbdF07aWYoIW4odSkpe2kucHVzaCh1KX19cmV0dXJuIGl9KTtjPXNyKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1LGksbzt0PVtdO2U9W107Zm9yKHU9MCxpPXIubGVuZ3RoO3U8aTsrK3Upe289clt1XTsobihvKT90OmUpLnB1c2gobyl9cmV0dXJuW3QsZV19KTtmPXNyKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1O2Zvcih0PTAsZT1yLmxlbmd0aDt0PGU7Kyt0KXt1PXJbdF07aWYobih1KSl7cmV0dXJuIHV9fX0pO2w9cz1mdW5jdGlvbihuKXtpZighbi5sZW5ndGgpe3JldHVybn1yZXR1cm4gblswXX07cD1mdW5jdGlvbihuKXtpZighbi5sZW5ndGgpe3JldHVybn1yZXR1cm4gbi5zbGljZSgxKX07aD1mdW5jdGlvbihuKXtpZighbi5sZW5ndGgpe3JldHVybn1yZXR1cm4gbltuLmxlbmd0aC0xXX07Zz1mdW5jdGlvbihuKXt2YXIgcjtyPW4ubGVuZ3RoO2lmKCFyKXtyZXR1cm59cmV0dXJuIG4uc2xpY2UoMCxyLTEpfTt2PWZ1bmN0aW9uKG4pe3JldHVybiFuLmxlbmd0aH07bT1mdW5jdGlvbihuKXtyZXR1cm4gbi5jb25jYXQoKS5yZXZlcnNlKCl9O2Q9ZnVuY3Rpb24obil7dmFyIHIsdCxlLHU7cj1bXTtmb3IodD0wLGU9bi5sZW5ndGg7dDxlOysrdCl7dT1uW3RdO2lmKCFwcih1LHIpKXtyLnB1c2godSl9fXJldHVybiByfTt5PWo9c3IoZnVuY3Rpb24obixyLHQpe3ZhciBlLHUsaTtmb3IoZT0wLHU9dC5sZW5ndGg7ZTx1OysrZSl7aT10W2VdO3I9bihyLGkpfXJldHVybiByfSk7Yj14PXNyKGZ1bmN0aW9uKG4scil7cmV0dXJuIHkobixyWzBdLHIuc2xpY2UoMSkpfSk7TT1zcihmdW5jdGlvbihuLHIsdCl7cmV0dXJuIHkobixyLHQuY29uY2F0KCkucmV2ZXJzZSgpKX0pO2s9c3IoZnVuY3Rpb24obixyKXt2YXIgdDt0PXIuY29uY2F0KCkucmV2ZXJzZSgpO3JldHVybiB5KG4sdFswXSx0LnNsaWNlKDEpKX0pO1c9c3IoZnVuY3Rpb24obixyKXt2YXIgdCxlLHU7dD1bXTtlPXI7d2hpbGUoKHU9bihlKSkhPW51bGwpe3QucHVzaCh1WzBdKTtlPXVbMV19cmV0dXJuIHR9KTtMPWZ1bmN0aW9uKG4pe3JldHVybltdLmNvbmNhdC5hcHBseShbXSxuKX07cT1zcihmdW5jdGlvbihuLHIpe3ZhciB0O3JldHVybltdLmNvbmNhdC5hcHBseShbXSxmdW5jdGlvbigpe3ZhciBlLHUsaSxvPVtdO2ZvcihlPTAsaT0odT1yKS5sZW5ndGg7ZTxpOysrZSl7dD11W2VdO28ucHVzaChuKHQpKX1yZXR1cm4gb30oKSl9KTt3PXNyKGZ1bmN0aW9uKG4pe3ZhciByO3JldHVybltdLmNvbmNhdC5hcHBseShbXSxmdW5jdGlvbigpe3ZhciB0LGUsdSxpPVtdO2Zvcih0PTAsdT0oZT1uKS5sZW5ndGg7dDx1OysrdCl7cj1lW3RdO2lmKHIubGVuZ3RoIT1udWxsKXtpLnB1c2godyhyKSl9ZWxzZXtpLnB1c2gocil9fXJldHVybiBpfSgpKX0pO1Q9ZnVuY3Rpb24obil7dmFyIHIsdCxlLHUsaSxvLGEsYztyPWxyLmNhbGwoYXJndW1lbnRzLDEpO3Q9W107bjpmb3IoZT0wLHU9bi5sZW5ndGg7ZTx1OysrZSl7aT1uW2VdO2ZvcihvPTAsYT1yLmxlbmd0aDtvPGE7KytvKXtjPXJbb107aWYocHIoaSxjKSl7Y29udGludWUgbn19dC5wdXNoKGkpfXJldHVybiB0fTt6PWZ1bmN0aW9uKG4pe3ZhciByLHQsZSx1LGksbyxhLGM7cj1sci5jYWxsKGFyZ3VtZW50cywxKTt0PVtdO246Zm9yKGU9MCx1PW4ubGVuZ3RoO2U8dTsrK2Upe2k9bltlXTtmb3Iobz0wLGE9ci5sZW5ndGg7bzxhOysrbyl7Yz1yW29dO2lmKCFwcihpLGMpKXtjb250aW51ZSBufX10LnB1c2goaSl9cmV0dXJuIHR9O0E9ZnVuY3Rpb24oKXt2YXIgbixyLHQsZSx1LGksbyxhO249bHIuY2FsbChhcmd1bWVudHMpO3I9W107Zm9yKHQ9MCxlPW4ubGVuZ3RoO3Q8ZTsrK3Qpe3U9blt0XTtmb3IoaT0wLG89dS5sZW5ndGg7aTxvOysraSl7YT11W2ldO2lmKCFwcihhLHIpKXtyLnB1c2goYSl9fX1yZXR1cm4gcn07Tj1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdSxpLG87dD17fTtmb3IoZT0wLHU9ci5sZW5ndGg7ZTx1OysrZSl7aT1yW2VdO289bihpKTtpZihvIGluIHQpe3Rbb10rPTF9ZWxzZXt0W29dPTF9fXJldHVybiB0fSk7Tz1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdSxpLG87dD17fTtmb3IoZT0wLHU9ci5sZW5ndGg7ZTx1OysrZSl7aT1yW2VdO289bihpKTtpZihvIGluIHQpe3Rbb10ucHVzaChpKX1lbHNle3Rbb109W2ldfX1yZXR1cm4gdH0pO0I9ZnVuY3Rpb24obil7dmFyIHIsdCxlO2ZvcihyPTAsdD1uLmxlbmd0aDtyPHQ7KytyKXtlPW5bcl07aWYoIWUpe3JldHVybiBmYWxzZX19cmV0dXJuIHRydWV9O1M9ZnVuY3Rpb24obil7dmFyIHIsdCxlO2ZvcihyPTAsdD1uLmxlbmd0aDtyPHQ7KytyKXtlPW5bcl07aWYoZSl7cmV0dXJuIHRydWV9fXJldHVybiBmYWxzZX07ST1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdTtmb3IodD0wLGU9ci5sZW5ndGg7dDxlOysrdCl7dT1yW3RdO2lmKG4odSkpe3JldHVybiB0cnVlfX1yZXR1cm4gZmFsc2V9KTtQPXNyKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1O2Zvcih0PTAsZT1yLmxlbmd0aDt0PGU7Kyt0KXt1PXJbdF07aWYoIW4odSkpe3JldHVybiBmYWxzZX19cmV0dXJuIHRydWV9KTtGPWZ1bmN0aW9uKG4pe3JldHVybiBuLmNvbmNhdCgpLnNvcnQoZnVuY3Rpb24obixyKXtpZihuPnIpe3JldHVybiAxfWVsc2UgaWYobjxyKXtyZXR1cm4tMX1lbHNle3JldHVybiAwfX0pfTtFPXNyKGZ1bmN0aW9uKG4scil7aWYoIXIubGVuZ3RoKXtyZXR1cm5bXX1yZXR1cm4gci5jb25jYXQoKS5zb3J0KG4pfSk7Qz1zcihmdW5jdGlvbihuLHIpe2lmKCFyLmxlbmd0aCl7cmV0dXJuW119cmV0dXJuIHIuY29uY2F0KCkuc29ydChmdW5jdGlvbihyLHQpe2lmKG4ocik+bih0KSl7cmV0dXJuIDF9ZWxzZSBpZihuKHIpPG4odCkpe3JldHVybi0xfWVsc2V7cmV0dXJuIDB9fSl9KTtSPWZ1bmN0aW9uKG4pe3ZhciByLHQsZSx1O3I9MDtmb3IodD0wLGU9bi5sZW5ndGg7dDxlOysrdCl7dT1uW3RdO3IrPXV9cmV0dXJuIHJ9O1Y9ZnVuY3Rpb24obil7dmFyIHIsdCxlLHU7cj0xO2Zvcih0PTAsZT1uLmxlbmd0aDt0PGU7Kyt0KXt1PW5bdF07cio9dX1yZXR1cm4gcn07RD1HPWZ1bmN0aW9uKG4pe3ZhciByLHQsZSx1O3I9MDt0PW4ubGVuZ3RoO2ZvcihlPTA7ZTx0OysrZSl7dT1lO3IrPW5bdV19cmV0dXJuIHIvdH07SD1mdW5jdGlvbihuKXt2YXIgcix0LGUsdSxpO3I9blswXTtmb3IodD0wLHU9KGU9bi5zbGljZSgxKSkubGVuZ3RoO3Q8dTsrK3Qpe2k9ZVt0XTtpZihpPnIpe3I9aX19cmV0dXJuIHJ9O0o9ZnVuY3Rpb24obil7dmFyIHIsdCxlLHUsaTtyPW5bMF07Zm9yKHQ9MCx1PShlPW4uc2xpY2UoMSkpLmxlbmd0aDt0PHU7Kyt0KXtpPWVbdF07aWYoaTxyKXtyPWl9fXJldHVybiByfTtLPVE9c3IoZnVuY3Rpb24obixyLHQpe3ZhciBlLHU7ZT1yO3JldHVybltyXS5jb25jYXQoZnVuY3Rpb24oKXt2YXIgcixpLG8sYT1bXTtmb3Iocj0wLG89KGk9dCkubGVuZ3RoO3I8bzsrK3Ipe3U9aVtyXTthLnB1c2goZT1uKGUsdSkpfXJldHVybiBhfSgpKX0pO1U9WD1zcihmdW5jdGlvbihuLHIpe2lmKCFyLmxlbmd0aCl7cmV0dXJufXJldHVybiBLKG4sclswXSxyLnNsaWNlKDEpKX0pO1k9c3IoZnVuY3Rpb24obixyLHQpe3Q9dC5jb25jYXQoKS5yZXZlcnNlKCk7cmV0dXJuIEsobixyLHQpLnJldmVyc2UoKX0pO1o9c3IoZnVuY3Rpb24obixyKXtpZighci5sZW5ndGgpe3JldHVybn1yPXIuY29uY2F0KCkucmV2ZXJzZSgpO3JldHVybiBLKG4sclswXSxyLnNsaWNlKDEpKS5yZXZlcnNlKCl9KTskPXNyKGZ1bmN0aW9uKG4scix0KXtyZXR1cm4gdC5zbGljZShuLHIpfSk7Xz1zcihmdW5jdGlvbihuLHIpe2lmKG48PTApe3JldHVybiByLnNsaWNlKDAsMCl9ZWxzZSBpZighci5sZW5ndGgpe3JldHVybiByfWVsc2V7cmV0dXJuIHIuc2xpY2UoMCxuKX19KTtucj1zcihmdW5jdGlvbihuLHIpe2lmKG48PTB8fCFyLmxlbmd0aCl7cmV0dXJuIHJ9ZWxzZXtyZXR1cm4gci5zbGljZShuKX19KTtycj1zcihmdW5jdGlvbihuLHIpe3JldHVybltfKG4sciksbnIobixyKV19KTt0cj1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdTt0PXIubGVuZ3RoO2lmKCF0KXtyZXR1cm4gcn1mb3IoZT0wO2U8dDsrK2Upe3U9ZTtpZighbihyW3VdKSl7YnJlYWt9fXJldHVybiByLnNsaWNlKDAsdSl9KTtlcj1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdTt0PXIubGVuZ3RoO2lmKCF0KXtyZXR1cm4gcn1mb3IoZT0wO2U8dDsrK2Upe3U9ZTtpZighbihyW3VdKSl7YnJlYWt9fXJldHVybiByLnNsaWNlKHUpfSk7dXI9c3IoZnVuY3Rpb24obixyKXtyZXR1cm5bdHIobixyKSxlcihuLHIpXX0pO2lyPXNyKGZ1bmN0aW9uKG4scil7cmV0dXJuIHVyKGhyKFtncixuXSkscil9KTtvcj1zcihmdW5jdGlvbihuLHIpe3ZhciB0LGUsdSxpLG8sYTt0PVtdO2U9ci5sZW5ndGg7Zm9yKHU9MCxpPW4ubGVuZ3RoO3U8aTsrK3Upe289dTthPW5bdV07aWYobz09PWUpe2JyZWFrfXQucHVzaChbYSxyW29dXSl9cmV0dXJuIHR9KTthcj1zcihmdW5jdGlvbihuLHIsdCl7dmFyIGUsdSxpLG8sYSxjO2U9W107dT10Lmxlbmd0aDtmb3IoaT0wLG89ci5sZW5ndGg7aTxvOysraSl7YT1pO2M9cltpXTtpZihhPT09dSl7YnJlYWt9ZS5wdXNoKG4oYyx0W2FdKSl9cmV0dXJuIGV9KTtjcj1mdW5jdGlvbigpe3ZhciBuLHIsdCxlLHUsaSxvLGEsYyxmPVtdO249bHIuY2FsbChhcmd1bWVudHMpO3I9OWU5O2Zvcih0PTAsZT1uLmxlbmd0aDt0PGU7Kyt0KXt1PW5bdF07cjw9KGk9dS5sZW5ndGgpfHwocj1pKX1mb3IodD0wO3Q8cjsrK3Qpe289dDthPVtdO2ZvcihjPTAsZT1uLmxlbmd0aDtjPGU7KytjKXt1PW5bY107YS5wdXNoKHVbb10pfWYucHVzaChhKX1yZXR1cm4gZn07ZnI9ZnVuY3Rpb24obil7dmFyIHIsdCxlLHUsaSxvLGEsYz1bXTtyPWxyLmNhbGwoYXJndW1lbnRzLDEpO3Q9OWU5O2ZvcihlPTAsdT1yLmxlbmd0aDtlPHU7KytlKXtpPXJbZV07dDw9KG89aS5sZW5ndGgpfHwodD1vKX1mb3IoZT0wO2U8dDsrK2Upe2E9ZTtjLnB1c2gobi5hcHBseShudWxsLGYoKSkpfXJldHVybiBjO2Z1bmN0aW9uIGYoKXt2YXIgbix0LGUsdT1bXTtmb3Iobj0wLGU9KHQ9cikubGVuZ3RoO248ZTsrK24pe2k9dFtuXTt1LnB1c2goaVthXSl9cmV0dXJuIHV9fTtyLmV4cG9ydHM9e2VhY2g6ZSxtYXA6dSxmaWx0ZXI6byxjb21wYWN0OmkscmVqZWN0OmEscGFydGl0aW9uOmMsZmluZDpmLGhlYWQ6bCxmaXJzdDpzLHRhaWw6cCxsYXN0OmgsaW5pdGlhbDpnLGVtcHR5OnYscmV2ZXJzZTptLGRpZmZlcmVuY2U6VCxpbnRlcnNlY3Rpb246eix1bmlvbjpBLGNvdW50Qnk6Tixncm91cEJ5Ok8sZm9sZDp5LGZvbGQxOmIsZm9sZGw6aixmb2xkbDE6eCxmb2xkcjpNLGZvbGRyMTprLHVuZm9sZHI6VyxhbmRMaXN0OkIsb3JMaXN0OlMsYW55OkksYWxsOlAsdW5pcXVlOmQsc29ydDpGLHNvcnRXaXRoOkUsc29ydEJ5OkMsc3VtOlIscHJvZHVjdDpWLG1lYW46RCxhdmVyYWdlOkcsY29uY2F0OkwsY29uY2F0TWFwOnEsZmxhdHRlbjp3LG1heGltdW06SCxtaW5pbXVtOkosc2NhbjpLLHNjYW4xOlUsc2Nhbmw6USxzY2FubDE6WCxzY2FucjpZLHNjYW5yMTpaLHNsaWNlOiQsdGFrZTpfLGRyb3A6bnIsc3BsaXRBdDpycix0YWtlV2hpbGU6dHIsZHJvcFdoaWxlOmVyLHNwYW46dXIsYnJlYWtMaXN0OmlyLHppcDpvcix6aXBXaXRoOmFyLHppcEFsbDpjcix6aXBBbGxXaXRoOmZyfTtmdW5jdGlvbiBzcihuLHIpe3ZhciB0LGU9ZnVuY3Rpb24odSl7cmV0dXJuIG4ubGVuZ3RoPjE/ZnVuY3Rpb24oKXt2YXIgaT11P3UuY29uY2F0KCk6W107dD1yP3R8fHRoaXM6dGhpcztyZXR1cm4gaS5wdXNoLmFwcGx5KGksYXJndW1lbnRzKTxuLmxlbmd0aCYmYXJndW1lbnRzLmxlbmd0aD9lLmNhbGwodCxpKTpuLmFwcGx5KHQsaSl9Om59O3JldHVybiBlKCl9ZnVuY3Rpb24gcHIobixyKXt2YXIgdD0tMSxlPXIubGVuZ3RoPj4+MDt3aGlsZSgrK3Q8ZSlpZihuPT09clt0XSYmdCBpbiByKXJldHVybiB0cnVlO3JldHVybiBmYWxzZX1mdW5jdGlvbiBocihuKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcix0PWFyZ3VtZW50cztmb3Iocj1uLmxlbmd0aDtyPjA7LS1yKXt0PVtuW3ItMV0uYXBwbHkodGhpcyx0KV19cmV0dXJuIHRbMF19fWZ1bmN0aW9uIGdyKG4pe3JldHVybiFufX0se31dLDU6W2Z1bmN0aW9uKG4scix0KXt2YXIgZSx1LGksbyxhLGMsZixsLHMscDtlPWgoZnVuY3Rpb24obixyKXtyZXR1cm4gci5zcGxpdChuKX0pO3U9aChmdW5jdGlvbihuLHIpe3JldHVybiByLmpvaW4obil9KTtpPWZ1bmN0aW9uKG4pe2lmKCFuLmxlbmd0aCl7cmV0dXJuW119cmV0dXJuIG4uc3BsaXQoXCJcXG5cIil9O289ZnVuY3Rpb24obil7cmV0dXJuIG4uam9pbihcIlxcblwiKX07YT1mdW5jdGlvbihuKXtpZighbi5sZW5ndGgpe3JldHVybltdfXJldHVybiBuLnNwbGl0KC9bIF0rLyl9O2M9ZnVuY3Rpb24obil7cmV0dXJuIG4uam9pbihcIiBcIil9O2Y9ZnVuY3Rpb24obil7cmV0dXJuIG4uc3BsaXQoXCJcIil9O2w9ZnVuY3Rpb24obil7cmV0dXJuIG4uam9pbihcIlwiKX07cz1mdW5jdGlvbihuKXtyZXR1cm4gbi5zcGxpdChcIlwiKS5yZXZlcnNlKCkuam9pbihcIlwiKX07cD1oKGZ1bmN0aW9uKG4scil7dmFyIHQsZSx1O2U9W107Zm9yKHU9MDt1PG47Kyt1KXtlLnB1c2gocil9dD1lO3JldHVybiB0LmpvaW4oXCJcIil9KTtyLmV4cG9ydHM9e3NwbGl0OmUsam9pbjp1LGxpbmVzOmksdW5saW5lczpvLHdvcmRzOmEsdW53b3JkczpjLGNoYXJzOmYsdW5jaGFyczpsLHJldmVyc2U6cyxyZXBlYXQ6cH07ZnVuY3Rpb24gaChuLHIpe3ZhciB0LGU9ZnVuY3Rpb24odSl7cmV0dXJuIG4ubGVuZ3RoPjE/ZnVuY3Rpb24oKXt2YXIgaT11P3UuY29uY2F0KCk6W107dD1yP3R8fHRoaXM6dGhpcztyZXR1cm4gaS5wdXNoLmFwcGx5KGksYXJndW1lbnRzKTxuLmxlbmd0aCYmYXJndW1lbnRzLmxlbmd0aD9lLmNhbGwodCxpKTpuLmFwcGx5KHQsaSl9Om59O3JldHVybiBlKCl9fSx7fV19LHt9LFtdKTtcbiIsInZhciAkUiwgbXV0YW50LCBjaCwgJHcsICRkLCBpc0llLCBpc01veiwgaXNPcGVyYSwgaXNUb3VjaGFibGUsIHRocmVzaG9sZCwgbGFzdFJlcUlkLCBoYXNTY3JvbGxlZCwgdGltZVVwZGF0ZXIsIHNob3dUaW1lb3V0SWQsIGhpZGVUaW1lb3V0SWQ7XG53aW5kb3cuaGVscGVycyA9IHJlcXVpcmUoJy4vc2hhcmVkLWhlbHBlcnMubHMnKTtcbndpbmRvdy5tdXRhbnRzID0gcmVxdWlyZSgnLi9wYi1tdXRhbnRzLmxzJyk7XG4kUiA9IHJlcXVpcmUoJ3JlYWN0aXZlanMnKTtcbndpbmRvdy5yVXNlciA9ICRSLnN0YXRlKCk7XG5tdXRhbnQgPSByZXF1aXJlKCcuLi9saWIvbXV0YW50L211dGFudC5scycpO1xuY2ggPSByZXF1aXJlKCcuL2NsaWVudC1oZWxwZXJzLmxzJyk7XG53aW5kb3cuQXV0aCA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudC9BdXRoLmxzJyk7XG53aW5kb3cuY29ycyA9IHtcbiAgYWpheFBhcmFtczoge1xuICAgIHhockZpZWxkczoge1xuICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlXG4gICAgfSxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbigpe30sXG4gICAgZXJyb3I6IGZ1bmN0aW9uKCl7fVxuICB9LFxuICBnZXQ6IGZ1bmN0aW9uKHVybCwgZGF0YSwgY2Ipe1xuICAgIHZhciBwYXJhbXM7XG4gICAgcGFyYW1zID0ge307XG4gICAgaW1wb3J0JChwYXJhbXMsIHRoaXMuYWpheFBhcmFtcyk7XG4gICAgcGFyYW1zLnR5cGUgPSAnR0VUJztcbiAgICBwYXJhbXMudXJsID0gdXJsO1xuICAgIHBhcmFtcy5kYXRhID0gZGF0YTtcbiAgICBpZiAoY2IpIHtcbiAgICAgIHBhcmFtcy5zdWNjZXNzID0gY2I7XG4gICAgfVxuICAgIHJldHVybiAkLmFqYXgocGFyYW1zKTtcbiAgfSxcbiAgcG9zdDogZnVuY3Rpb24odXJsLCBkYXRhLCBjYil7XG4gICAgdmFyIHBhcmFtcztcbiAgICBwYXJhbXMgPSB7fTtcbiAgICBpbXBvcnQkKHBhcmFtcywgdGhpcy5hamF4UGFyYW1zKTtcbiAgICBwYXJhbXMudHlwZSA9ICdQT1NUJztcbiAgICBwYXJhbXMudXJsID0gdXJsO1xuICAgIHBhcmFtcy5kYXRhID0gZGF0YTtcbiAgICBpZiAoY2IpIHtcbiAgICAgIHBhcmFtcy5zdWNjZXNzID0gY2I7XG4gICAgfVxuICAgIHJldHVybiAkLmFqYXgocGFyYW1zKTtcbiAgfVxufTtcbndpbmRvdy5oaW50cyA9IHtcbiAgbGFzdDoge1xuICAgIHBhdGhuYW1lOiBudWxsLFxuICAgIG11dGF0b3I6IG51bGxcbiAgfSxcbiAgY3VycmVudDoge1xuICAgIHBhdGhuYW1lOiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUsXG4gICAgbXV0YXRvcjogd2luZG93Lm11dGF0b3JcbiAgfVxufTtcbiR3ID0gJCh3aW5kb3cpO1xuJGQgPSAkKGRvY3VtZW50KTtcbmlzSWUgPSBmYWxzZSB8fCBpbiQoJ21zVHJhbnNmb3JtJywgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlKTtcbmlzTW96ID0gZmFsc2UgfHwgaW4kKCdNb3pCb3hTaXppbmcnLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUpO1xuaXNPcGVyYSA9ICEhKHdpbmRvdy5vcGVyYSAmJiB3aW5kb3cub3BlcmEudmVyc2lvbik7XG5pc1RvdWNoYWJsZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBlO1xuICB0cnkge1xuICAgIGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdUb3VjaEV2ZW50Jyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUkKSB7XG4gICAgZSA9IGUkO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufSgpO1xudGhyZXNob2xkID0gMTU7XG4kZC5vbignY2xpY2snLCAnYS5tdXRhbnQnLCBjaC5tdXRhdGUpO1xud2luZG93Lmxhc3RTdGF0ZWNoYW5nZVdhc1VzZXIgPSB0cnVlO1xubGFzdFJlcUlkID0gMDtcbkhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24oZSl7XG4gIHZhciBzdGF0ZWNoYW5nZVdhc1VzZXIsIHVybCwgcGFyYW1zLCByZWYkLCByYywgc3VyZlBhcmFtcywgcmVxSWQsIGpxeGhyO1xuICBzdGF0ZWNoYW5nZVdhc1VzZXIgPSB3aW5kb3cubGFzdFN0YXRlY2hhbmdlV2FzVXNlcjtcbiAgd2luZG93Lmxhc3RTdGF0ZWNoYW5nZVdhc1VzZXIgPSB0cnVlO1xuICB1cmwgPSBIaXN0b3J5LmdldFBhZ2VVcmwoKS5yZXBsYWNlKC9cXC8kLywgJycpO1xuICBwYXJhbXMgPSBIaXN0b3J5LmdldFN0YXRlKCkuZGF0YTtcbiAgaW1wb3J0JCh3aW5kb3cuaGludHMubGFzdCwgd2luZG93LmhpbnRzLmN1cnJlbnQpO1xuICByZWYkID0gd2luZG93LmhpbnRzLmN1cnJlbnQ7XG4gIHJlZiQucGF0aG5hbWUgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gIHJlZiQubXV0YXRvciA9IG51bGw7XG4gIGlmICh3aW5kb3cuaGludHMubGFzdC5tdXRhdG9yID09PSAnZm9ydW0nICYmICF3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUubWF0Y2goL15cXC8oYXV0aHxhZG1pbnxyZXNvdXJjZXMpLykpIHtcbiAgICByYyA9IHdpbmRvdy50YXNrcy5yZWNvbW1lbmRhdGlvbih3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUsIHdpbmRvdy5oaW50cy5sYXN0LnBhdGhuYW1lKTtcbiAgfVxuICBpZiAoIShwYXJhbXMgIT0gbnVsbCAmJiBwYXJhbXMubm9TdXJmKSkge1xuICAgIHNwaW4odHJ1ZSk7XG4gICAgc3VyZlBhcmFtcyA9IHtcbiAgICAgIF9zdXJmOiBtdXRhdG9yLFxuICAgICAgX3N1cmZEYXRhOiBwYXJhbXMgIT0gbnVsbCA/IHBhcmFtcy5zdXJmRGF0YSA6IHZvaWQgOFxuICAgIH07XG4gICAgaWYgKHJjICE9IG51bGwgJiYgKChyZWYkID0gcmMua2VlcCkgIT0gbnVsbCAmJiByZWYkLmxlbmd0aCkpIHtcbiAgICAgIHN1cmZQYXJhbXMuX3N1cmZUYXNrcyA9IHJjLmtlZXAuc29ydCgpLm1hcChmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiB0YXNrcy5jYyhpdCk7XG4gICAgICB9KS5qb2luKCcsJyk7XG4gICAgfVxuICAgIHJlcUlkID0gKytsYXN0UmVxSWQ7XG4gICAganF4aHIgPSAkLmdldCh1cmwsIHN1cmZQYXJhbXMsIGZ1bmN0aW9uKHIpe1xuICAgICAgdmFyIHJlZiQsIG9uVW5sb2FkO1xuICAgICAgaWYgKCFyLm11dGFudCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoKHJlZiQgPSByLmxvY2FscykgIT0gbnVsbCAmJiByZWYkLnRpdGxlKSB7XG4gICAgICAgICRkLmF0dHIoJ3RpdGxlJywgci5sb2NhbHMudGl0bGUpO1xuICAgICAgfVxuICAgICAgb25VbmxvYWQgPSBtdXRhbnRzW3dpbmRvdy5tdXRhdG9yXS5vblVubG9hZCB8fCBmdW5jdGlvbih3LCBuZXh0TXV0YW50LCBjYil7XG4gICAgICAgIHJldHVybiBjYihudWxsKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gb25VbmxvYWQod2luZG93LCByLm11dGFudCwgZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGxvY2FscztcbiAgICAgICAgaWYgKHJlcUlkID09PSBsYXN0UmVxSWQpIHtcbiAgICAgICAgICBsb2NhbHMgPSBpbXBvcnQkKHtcbiAgICAgICAgICAgIHN0YXRlY2hhbmdlV2FzVXNlcjogc3RhdGVjaGFuZ2VXYXNVc2VyXG4gICAgICAgICAgfSwgci5sb2NhbHMpO1xuICAgICAgICAgIHJldHVybiBtdXRhbnQucnVuKG11dGFudHNbci5tdXRhbnRdLCB7XG4gICAgICAgICAgICBsb2NhbHM6IGxvY2FscyxcbiAgICAgICAgICAgIHVzZXI6IHdpbmRvdy51c2VyXG4gICAgICAgICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIG9ubG9hZFJlc2l6YWJsZSgpO1xuICAgICAgICAgICAgd2luZG93LmhpbnRzLmN1cnJlbnQubXV0YXRvciA9IHdpbmRvdy5tdXRhdG9yO1xuICAgICAgICAgICAgcmV0dXJuIHNwaW4oZmFsc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4ganF4aHIuZmFpbChmdW5jdGlvbih4aHIsIHN0YXR1cywgZXJyb3Ipe1xuICAgICAgc2hvd1Rvb2x0aXAoJCgnI3dhcm5pbmcnKSwgXCJQYWdlIE5vdCBGb3VuZFwiLCA4MDAwKTtcbiAgICAgIEhpc3RvcnkuYmFjaygpO1xuICAgICAgcmV0dXJuIHdpbmRvdy5zcGluKGZhbHNlKTtcbiAgICB9KTtcbiAgfVxufSk7XG53aW5kb3cub25sb2FkUGVyc29uYWxpemUgPSBmdW5jdGlvbigpe1xuICB2YXIgcmVmJDtcbiAgaWYgKHdpbmRvdy51c2VyKSB7XG4gICAgJCgnLm9uY2xpY2stcHJvZmlsZScpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmhyZWYgPSBcIi91c2VyL1wiICsgd2luZG93LnVzZXIubmFtZTtcbiAgICB9KTtcbiAgICAkKCcub25jbGljay1sb2dpbicpLmhpZGUoKTtcbiAgICAkKCcub25jbGljay1sb2dvdXQnKS5zaG93KCk7XG4gICAgJCgnLm9uY2xpY2stcHJvZmlsZScpLnNob3coKTtcbiAgICBpZiAoKCh0eXBlb2YgdXNlciAhPSAndW5kZWZpbmVkJyAmJiB1c2VyICE9PSBudWxsKSAmJiAoKHJlZiQgPSB1c2VyLnJpZ2h0cykgIT0gbnVsbCAmJiByZWYkWydzdXBlciddKSkgfHwgKCh0eXBlb2YgdXNlciAhPSAndW5kZWZpbmVkJyAmJiB1c2VyICE9PSBudWxsKSAmJiAoKHJlZiQgPSB1c2VyLnJpZ2h0cykgIT0gbnVsbCAmJiByZWYkLmFkbWluKSkpIHtcbiAgICAgIHJldHVybiAkKCcuYWRtaW4tb25seScpLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICQoJy5hZG1pbi1vbmx5JykuaGlkZSgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAkKCcub25jbGljay1sb2dpbicpLnNob3coKTtcbiAgICAkKCcub25jbGljay1sb2dvdXQnKS5oaWRlKCk7XG4gICAgJCgnLm9uY2xpY2stcHJvZmlsZScpLmhpZGUoKTtcbiAgICByZXR1cm4gJCgnLmFkbWluLW9ubHknKS5oaWRlKCk7XG4gIH1cbn07XG53aW5kb3cub25sb2FkUmVzaXphYmxlID0gZnVuY3Rpb24oKXtcbiAgdmFyIGxlZnRPZmZzZXQsICRsLCAkcjtcbiAgbGVmdE9mZnNldCA9IDUwO1xuICAkbCA9ICQoJyNsZWZ0X2NvbnRlbnQnKTtcbiAgJHIgPSAkKCcjbWFpbl9jb250ZW50IC5yZXNpemFibGUnKTtcbiAgaWYgKCRyLmxlbmd0aCkge1xuICAgICRsLnJlc2l6YWJsZSh7XG4gICAgICBtaW5XaWR0aDogMjAwLFxuICAgICAgbWF4V2lkdGg6IDQ1MCxcbiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZSwgdWkpe1xuICAgICAgICAkbC50b2dnbGVDbGFzcygnd2lkZScsICRsLndpZHRoKCkgPiAzMDApO1xuICAgICAgICAkci5jc3MoJ3BhZGRpbmctbGVmdCcsIHVpLnNpemUud2lkdGggKyBsZWZ0T2Zmc2V0KTtcbiAgICAgICAgJGwuZmluZCgnLnNjcm9sbGFibGUnKS5nZXROaWNlU2Nyb2xsKCkucmVzaXplKCk7XG4gICAgICAgIHJldHVybiB3aW5kb3cuc2F2ZVVpKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgJGwuZmluZCgnLnNjcm9sbGFibGUnKS5uaWNlU2Nyb2xsKHtcbiAgICAgIGJvdW5jZXNjcm9sbDogdHJ1ZSxcbiAgICAgIGN1cnNvcmNvbG9yOiAnI2JiYicsXG4gICAgICBjdXJzb3J3aWR0aDogNixcbiAgICAgIGhpZGVjdXJzb3JkZWxheTogMTAwMCxcbiAgICAgIG1vdXNlc2Nyb2xsc3RlcDogNixcbiAgICAgIHJhaWxvZmZzZXQ6IHRydWUsXG4gICAgICByYWlscGFkZGluZzoge1xuICAgICAgICBib3R0b206IDE1MFxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAkci5jc3MoJ3BhZGRpbmctbGVmdCcsICRsLndpZHRoKCkgKyBsZWZ0T2Zmc2V0KTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuICRsLnJlc2l6YWJsZSgnZGVzdHJveScpO1xuICAgIH0gY2F0Y2ggKGUkKSB7fVxuICB9XG59O1xud2luZG93LnNjcm9sbFRvVG9wID0gZnVuY3Rpb24oY2Ipe1xuICB2YXIgJGU7XG4gIGNiID09IG51bGwgJiYgKGNiID0gZnVuY3Rpb24oKXt9KTtcbiAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuICAkZSA9ICQoJ2h0bWwsYm9keScpO1xuICAkZS5hbmltYXRlKHtcbiAgICBzY3JvbGxUb3A6IDBcbiAgfSwgMjUwLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiAkZS5hbmltYXRlKHtcbiAgICAgIHNjcm9sbFRvcDogdGhyZXNob2xkIC8gMlxuICAgIH0sIDcwLCBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuICRlLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6IDBcbiAgICAgIH0sIDU1LCBmdW5jdGlvbigpe30pO1xuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIGNiKCk7XG59O1xud2luZG93LmF3ZXNvbWVTY3JvbGxUbyA9IGZ1bmN0aW9uKGUsIGR1cmF0aW9uLCBjYil7XG4gIHZhciBtcywgb2Zmc2V0LCBkc3RTY3JvbGwsIGN1clNjcm9sbDtcbiAgY2IgPT0gbnVsbCAmJiAoY2IgPSBmdW5jdGlvbigpe30pO1xuICBlID0gJChlKTtcbiAgbXMgPSBkdXJhdGlvbiB8fCAyNTA7XG4gIG9mZnNldCA9IDEwO1xuICBpZiAoIWUubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChpc0llIHx8IGlzT3BlcmEpIHtcbiAgICBlWzBdLnNjcm9sbEludG9WaWV3KCk7XG4gICAgY2IoKTtcbiAgfSBlbHNlIHtcbiAgICBkc3RTY3JvbGwgPSBNYXRoLnJvdW5kKGUucG9zaXRpb24oKS50b3ApIC0gb2Zmc2V0O1xuICAgIGN1clNjcm9sbCA9IHdpbmRvdy5zY3JvbGxZO1xuICAgIGlmIChNYXRoLmFicyhkc3RTY3JvbGwgLSBjdXJTY3JvbGwpID4gdGhyZXNob2xkICogMikge1xuICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogZHN0U2Nyb2xsXG4gICAgICB9LCBtcywgZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgIHNjcm9sbFRvcDogZHN0U2Nyb2xsICsgdGhyZXNob2xkIC8gMlxuICAgICAgICB9LCA3MCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICBzY3JvbGxUb3A6IGRzdFNjcm9sbFxuICAgICAgICAgIH0sIDUwLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGNiKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBlO1xufTtcbmhhc1Njcm9sbGVkID0gZnVuY3Rpb24oKXtcbiAgdmFyIHN0O1xuICBzdCA9ICR3LnNjcm9sbFRvcCgpO1xuICByZXR1cm4gJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdzY3JvbGxlZCcsIHN0ID4gdGhyZXNob2xkKTtcbn07XG5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICR3Lm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiBoYXNTY3JvbGxlZCgpO1xuICB9KTtcbiAgcmV0dXJuIGhhc1Njcm9sbGVkKCk7XG59LCA2MDApO1xuJCgnaGVhZGVyLmhlYWRlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2KXtcbiAgdmFyIGI7XG4gIGlmICgkKGV2LnRhcmdldCkuaGFzQ2xhc3MoJ2hlYWRlcicpKSB7XG4gICAgYiA9ICQoJ2JvZHknKTtcbiAgICBpZiAoJHcuc2Nyb2xsVG9wKCkgPiB0aHJlc2hvbGQpIHtcbiAgICAgIGIudG9nZ2xlQ2xhc3MoJ3Njcm9sbGVkJyk7XG4gICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJCgnI3F1ZXJ5JykuZm9jdXMoKTtcbiAgICAgIH0sIDEpO1xuICAgIH1cbiAgfVxufSk7XG4kZC5vbignY2xpY2snLCAnLm9uY2xpY2stc2Nyb2xsLXRvJywgZnVuY3Rpb24oKXtcbiAgYXdlc29tZVNjcm9sbFRvKCQodGhpcykuZGF0YSgnc2Nyb2xsLXRvJykpO1xuICByZXR1cm4gZmFsc2U7XG59KTtcbiRkLm9uKCdtb3VzZWRvd24nLCAnLm9uY2xpY2stc2Nyb2xsLXRvcCcsIGZ1bmN0aW9uKCl7XG4gICQodGhpcykuYXR0cigndGl0bGUnLCAnU2Nyb2xsIHRvIFRvcCEnKTtcbiAgd2luZG93LnNjcm9sbFRvVG9wKCk7XG4gIHJldHVybiBmYWxzZTtcbn0pO1xud2luZG93LnNoYWtlRGlhbG9nID0gZnVuY3Rpb24oJGZvcm0sIHRpbWUpe1xuICB2YXIgJGZhbmN5Ym94O1xuICAkZmFuY3lib3ggPSAkZm9ybS5wYXJlbnRzKCcuZmFuY3lib3gtd3JhcDpmaXJzdCcpLnJlbW92ZUNsYXNzKCdzaGFrZScpO1xuICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIHJldHVybiAkZmFuY3lib3guYWRkQ2xhc3MoJ3NoYWtlJyk7XG4gIH0sIDEwMCk7XG59O1xuQXV0aC5hZnRlckxvZ2luID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuICQuZ2V0SlNPTignL2F1dGgvdXNlcicsIGZ1bmN0aW9uKHVzZXIpe1xuICAgIHZhciByZWYkO1xuICAgIHdpbmRvdy51c2VyID0gdXNlcjtcbiAgICBvbmxvYWRQZXJzb25hbGl6ZSgpO1xuICAgIGlmICh1c2VyICYmICgodHlwZW9mIG11dGFudHMgIT0gJ3VuZGVmaW5lZCcgJiYgbXV0YW50cyAhPT0gbnVsbCkgJiYgKChyZWYkID0gbXV0YW50c1t3aW5kb3cubXV0YXRvcl0pICE9IG51bGwgJiYgcmVmJC5vblBlcnNvbmFsaXplKSkpIHtcbiAgICAgIHNldFByb2ZpbGUodXNlci5waG90byk7XG4gICAgICByZXR1cm4gdHlwZW9mIG11dGFudHMgIT0gJ3VuZGVmaW5lZCcgJiYgbXV0YW50cyAhPT0gbnVsbCA/IChyZWYkID0gbXV0YW50c1t3aW5kb3cubXV0YXRvcl0pICE9IG51bGwgPyByZWYkLm9uUGVyc29uYWxpemUod2luZG93LCB1c2VyLCBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcmVmJDtcbiAgICAgICAgaWYgKHR5cGVvZiBzb2NrZXQgIT0gJ3VuZGVmaW5lZCcgJiYgc29ja2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgc29ja2V0LmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHlwZW9mIHNvY2tldCAhPSAndW5kZWZpbmVkJyAmJiBzb2NrZXQgIT09IG51bGwgPyAocmVmJCA9IHNvY2tldC5zb2NrZXQpICE9IG51bGwgPyByZWYkLmNvbm5lY3QoKSA6IHZvaWQgOCA6IHZvaWQgODtcbiAgICAgIH0pIDogdm9pZCA4IDogdm9pZCA4O1xuICAgIH1cbiAgfSk7XG59O1xud2luZG93LmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gIHdpbmRvdy5sb2NhdGlvbiA9ICcvYXV0aC9sb2dvdXQnO1xuICByZXR1cm4gZmFsc2U7XG59O1xuJGQub24oJ2NsaWNrJywgJy5vbmNsaWNrLWxvZ291dCcsIGZ1bmN0aW9uKCl7XG4gIHdpbmRvdy5sb2dvdXQoKTtcbiAgcmV0dXJuIGZhbHNlO1xufSk7XG4kZC5vbignY2xpY2snLCAnLnJlcXVpcmUtbG9naW4nLCBBdXRoLnJlcXVpcmVMb2dpbihmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5jbGljaztcbn0pKTtcbiRkLm9uKCdjbGljaycsICcub25jbGljay1sb2dpbicsIGZ1bmN0aW9uKCl7XG4gIEF1dGguc2hvd0xvZ2luRGlhbG9nKCk7XG4gIHJldHVybiBmYWxzZTtcbn0pO1xudGltZVVwZGF0ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgbm93O1xuICBub3cgPSBuZXcgRGF0ZTtcbiAgcmV0dXJuICQoJ1tkYXRhLXRpbWVdJykuZWFjaChmdW5jdGlvbigpe1xuICAgIHZhciAkZWwsIGQsIGVsYXBzZWQsIGhyLCBsaDtcbiAgICAkZWwgPSAkKHRoaXMpO1xuICAgIGQgPSBuZXcgRGF0ZSgkZWwuZGF0YSgndGltZScpKTtcbiAgICBlbGFwc2VkID0gKG5vdyAtIGQpIC8gMTAwMDtcbiAgICBociA9IHdpbmRvdy5oZWxwZXJzLmVsYXBzZWRUb0h1bWFuUmVhZGFibGUoZWxhcHNlZCk7XG4gICAgbGggPSAkZWwuZGF0YSgnbGFzdC1odW1hbicpO1xuICAgICRlbC5kYXRhKCdsYXN0LWh1bWFuJywgaHIpO1xuICAgIGlmICgkZWwuaGFzQ2xhc3MoJ3RpbWUtdGl0bGUnKSkge1xuICAgICAgcmV0dXJuICRlbC5hdHRyKCd0aXRsZScsIGhyLnJlcGxhY2UoLzwuKj9cXC8/Pi9nLCAnJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJGVsLmh0bWwoaHIpO1xuICAgIH1cbiAgfSk7XG59O1xuc2V0SW50ZXJ2YWwodGltZVVwZGF0ZXIsIDMwMDAwKTtcbndpbmRvdy5zcGluID0gZnVuY3Rpb24obG9hZGluZyl7XG4gIHZhciB0aW1lVW50aWxTaG93LCB0aW1lVW50aWxIaWRlLCAkYiwgc2hvdywgaGlkZTtcbiAgbG9hZGluZyA9PSBudWxsICYmIChsb2FkaW5nID0gdHJ1ZSk7XG4gIHRpbWVVbnRpbFNob3cgPSA1MDA7XG4gIHRpbWVVbnRpbEhpZGUgPSA2NTAwO1xuICBjbGVhclRpbWVvdXQoc2hvd1RpbWVvdXRJZCk7XG4gIGNsZWFyVGltZW91dChoaWRlVGltZW91dElkKTtcbiAgJGIgfHwgKCRiID0gJCgnYm9keScpKTtcbiAgc2hvdyA9IGZ1bmN0aW9uKCl7XG4gICAgJGIuYWRkQ2xhc3MoJ3dhaXRpbmcnKTtcbiAgICByZXR1cm4gaGlkZVRpbWVvdXRJZCA9IHNldFRpbWVvdXQoaGlkZSwgdGltZVVudGlsSGlkZSk7XG4gIH07XG4gIGhpZGUgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiAkYi5yZW1vdmVDbGFzcygnd2FpdGluZycpO1xuICB9O1xuICBpZiAobG9hZGluZykge1xuICAgIHJldHVybiBzaG93VGltZW91dElkID0gc2V0VGltZW91dChzaG93LCB0aW1lVW50aWxTaG93KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gaGlkZSgpO1xuICB9XG59O1xub25sb2FkUmVzaXphYmxlKCk7XG4kLmdldEpTT04oJy9hdXRoL3VzZXInLCBmdW5jdGlvbih1c2VyKXtcbiAgdmFyIG07XG4gIHdpbmRvdy51c2VyID0gdXNlcjtcbiAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIHJldHVybiB3aW5kb3cuclVzZXIod2luZG93LnVzZXIpO1xuICB9LCA1MCk7XG4gIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaC5tYXRjaCgvXlxcI3JlY292ZXI9LykpIHtcbiAgICBBdXRoLnNob3dSZXNldFBhc3N3b3JkRGlhbG9nKCk7XG4gIH1cbiAgaWYgKG0gPSB3aW5kb3cubG9jYXRpb24uaGFzaC5tYXRjaCgvXlxcI2ludmFsaWQ9KC4rKS8pKSB7XG4gICAgQXV0aC5zaG93SW5mb0RpYWxvZyhcIldlbGNvbWUgYmFjayBcIiArIG1bMV0gKyBcIiFcIik7XG4gIH1cbiAgc3dpdGNoICh3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuICBjYXNlICcjaW52YWxpZCc6XG4gICAgQXV0aC5zaG93SW5mb0RpYWxvZygnSW52YWxpZCBpbnZpdGUgY29kZSEnKTtcbiAgICBicmVhaztcbiAgY2FzZSAnI3ZhbGlkYXRlJzpcbiAgICBBdXRoLmFmdGVyTG9naW4oKTtcbiAgICBicmVhaztcbiAgY2FzZSAnI29uY2UnOlxuICAgIEF1dGgubG9naW5XaXRoVG9rZW4oKTtcbiAgfVxuICBvbmxvYWRQZXJzb25hbGl6ZSgpO1xuICBpZiAod2luZG93LmluaXRpYWxNdXRhbnQpIHtcbiAgICByZXR1cm4gbXV0YW50LnJ1bihtdXRhbnRzW3dpbmRvdy5pbml0aWFsTXV0YW50XSwge1xuICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgIHVzZXI6IHdpbmRvdy51c2VyXG4gICAgfSwgZnVuY3Rpb24oKXt9KTtcbiAgfVxufSk7XG5mdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICByZXR1cm4gb2JqO1xufVxuZnVuY3Rpb24gaW4kKHgsIGFycil7XG4gIHZhciBpID0gLTEsIGwgPSBhcnIubGVuZ3RoID4+PiAwO1xuICB3aGlsZSAoKytpIDwgbCkgaWYgKHggPT09IGFycltpXSAmJiBpIGluIGFycikgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn0iLCIoZnVuY3Rpb24oZ2xvYmFsKXt2YXIgQnV5LCBQYWdpbmF0b3IsICR3LCAkZCwgbGVmdE9mZnNldCwgc2VwLCBhcHBlbmRSZXBseVVpLCBjZW5zb3IsIHN1Ym1pdCwgY2tTdWJtaXQsIHBvc3RTdWJtaXQsIHN1Ym1pdFNlbGVjdG9ycywgY2xlYW51cE91dHB1dCwgc3Vic2NyaWJlLCB0aGlzJCA9IHRoaXM7XG53aW5kb3cuX18gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbndpbmRvdy5DaGF0ID0gcmVxdWlyZSgnLi4vY29tcG9uZW50L0NoYXQubHMnKTtcbndpbmRvdy5BdXRoID0gcmVxdWlyZSgnLi4vY29tcG9uZW50L0F1dGgubHMnKTtcbndpbmRvdy5QYWdlciA9IHJlcXVpcmUoJy4vcGFnZXIubHMnKTtcbndpbmRvdy5mdXJsID0gcmVxdWlyZSgnLi9mb3J1bS11cmxzLmxzJyk7XG53aW5kb3cudGFza3MgPSByZXF1aXJlKCcuL3Rhc2tzLmxzJyk7XG53aW5kb3cuaW9jID0gcmVxdWlyZSgnLi9pby1jbGllbnQubHMnKTtcbndpbmRvdy5QaG90b0Nyb3BwZXIgPSByZXF1aXJlKCcuLi9jb21wb25lbnQvUGhvdG9Dcm9wcGVyLmxzJyk7XG5pbXBvcnQkKGdsb2JhbCwgcmVxdWlyZSgncHJlbHVkZS1scy9wcmVsdWRlLWJyb3dzZXItbWluJykoJ3ByZWx1ZGUtbHMnKSk7XG5pbXBvcnQkKGdsb2JhbCwgcmVxdWlyZSgnLi9zaGFyZWQtaGVscGVycy5scycpKTtcbmltcG9ydCQoZ2xvYmFsLCByZXF1aXJlKCcuL2NsaWVudC1oZWxwZXJzLmxzJykpO1xuQnV5ID0gcmVxdWlyZSgnLi4vY29tcG9uZW50L0J1eS5scycpO1xuUGFnaW5hdG9yID0gcmVxdWlyZSgnLi4vY29tcG9uZW50L1BhZ2luYXRvci5scycpO1xuJHcgPSAkKHdpbmRvdyk7XG4kZCA9ICQoZG9jdW1lbnQpO1xubGVmdE9mZnNldCA9IDUwO1xuc2VwID0gJy0nO1xud2luZG93LnNhdmVVaSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBtaW5XaWR0aCwgdywgcywgcmVmJCwgXywgcHJldiwgdmFscztcbiAgbWluV2lkdGggPSAyMDA7XG4gIHcgPSAkKCcjbGVmdF9jb250ZW50Jykud2lkdGgoKTtcbiAgcyA9ICQuY29va2llKCdzJyk7XG4gIGlmIChzKSB7XG4gICAgcmVmJCA9IHMuc3BsaXQoc2VwKSwgXyA9IHJlZiRbMF0sIF8gPSByZWYkWzFdLCBwcmV2ID0gcmVmJFsyXTtcbiAgfVxuICB3ID0gdyA+IG1pbldpZHRoXG4gICAgPyB3XG4gICAgOiBwcmV2IHx8IG1pbldpZHRoO1xuICB2YWxzID0gWyQoJ2JvZHknKS5oYXNDbGFzcygnY29sbGFwc2VkJykgPyAxIDogMCwgd107XG4gIHJldHVybiAkLmNvb2tpZSgncycsIHZhbHMuam9pbihzZXApLCB7XG4gICAgcGF0aDogJy8nLFxuICAgIHNlY3VyZTogdHJ1ZVxuICB9KTtcbn07XG53aW5kb3cubG9hZFVpID0gZnVuY3Rpb24oKXtcbiAgdmFyIHMsICRsLCByZWYkLCBjb2xsYXBzZWQsIHc7XG4gIHMgPSAkLmNvb2tpZSgncycpO1xuICAkbCA9ICQoJyNsZWZ0X2NvbnRlbnQnKTtcbiAgaWYgKHMpIHtcbiAgICByZWYkID0gcy5zcGxpdChzZXApLCBjb2xsYXBzZWQgPSByZWYkWzBdLCB3ID0gcmVmJFsxXTtcbiAgICBpZiAoY29sbGFwc2VkID09PSAnMScgJiYgISQoJ2h0bWwnKS5oYXNDbGFzcygnYWRtaW4nKSkge1xuICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdjb2xsYXBzZWQnKTtcbiAgICAgICRsLmZpbmQoJy5zY3JvbGxhYmxlJykuZ2V0TmljZVNjcm9sbCgpLnJlc2l6ZSgpO1xuICAgIH1cbiAgICB3ID0gcGFyc2VJbnQodyk7XG4gICAgJGwudHJhbnNpdGlvbih7XG4gICAgICB3aWR0aDogd1xuICAgIH0sIDUwMCwgJ2Vhc2VPdXRFeHBvJywgZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXRXaWRlKCk7XG4gICAgfSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuICQoJyNtYWluX2NvbnRlbnQgLnJlc2l6YWJsZScpLnRyYW5zaXRpb24oe1xuICAgICAgICBwYWRkaW5nTGVmdDogdyArIGxlZnRPZmZzZXRcbiAgICAgIH0sIDQ1MCwgJ3NuYXAnKTtcbiAgICB9LCAzMDApO1xuICB9XG4gIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgc2V0V2lkZSgpO1xuICAgIHJldHVybiBhbGlnbkJyZWFkY3J1bWIoKTtcbiAgfSwgNTAwKTtcbn07XG4kdy5yZXNpemUoX18uZGVib3VuY2UoZnVuY3Rpb24oKXtcbiAgJC53YXlwb2ludHMoJ3JlZnJlc2gnKTtcbiAgcmVzcG9uZFJlc2l6ZSgpO1xuICByZXR1cm4gYWxpZ25CcmVhZGNydW1iKCk7XG59LCA4MDApKTtcbmFwcGVuZFJlcGx5VWkgPSBmdW5jdGlvbihldil7XG4gIHZhciAkcDtcbiAgJHAgPSAkKGV2LnRhcmdldCkucGFyZW50cygnLnBvc3Q6Zmlyc3QnKTtcbiAgaWYgKCEkcC5maW5kKCcucmVwbHkgLnBvc3QtZWRpdDp2aXNpYmxlJykubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlbmRlckFuZEFwcGVuZCh3aW5kb3csICRwLmZpbmQoJy5yZXBseTpmaXJzdCcpLCAncG9zdC1lZGl0Jywge1xuICAgICAgcG9zdDoge1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZm9ydW1faWQ6ICRwLmRhdGEoJ2ZvcnVtLWlkJykgfHwgd2luZG93LmFjdGl2ZUZvcnVtSWQsXG4gICAgICAgIHBhcmVudF9pZDogJHAuZGF0YSgncG9zdC1pZCcpLFxuICAgICAgICBpc19jb21tZW50OiB0cnVlXG4gICAgICB9XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiAkcC5maW5kKCd0ZXh0YXJlYVtuYW1lPVwiYm9keVwiXScpLmZvY3VzKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICRwLmZpbmQoJy5yZXBseSAuY2FuY2VsJykuY2xpY2soKTtcbiAgfVxufTtcbmNlbnNvciA9IGZ1bmN0aW9uKGV2KXtcbiAgdmFyICRwLCBwb3N0SWQ7XG4gICRwID0gJChldi50YXJnZXQpLnBhcmVudHMoJy5wb3N0OmZpcnN0Jyk7XG4gIHBvc3RJZCA9ICRwLmRhdGEoJ3Bvc3QtaWQnKTtcbiAgcmV0dXJuICQucG9zdChcIi9yZXNvdXJjZXMvcG9zdHMvXCIgKyBwb3N0SWQgKyBcIi9jZW5zb3JcIiwgZnVuY3Rpb24ocil7XG4gICAgaWYgKHIgIT0gbnVsbCAmJiByLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiAkcC5hZGRDbGFzcygnY2Vuc29yZWQnKTtcbiAgICB9XG4gIH0pO1xufTtcbmxvYWRVaSgpO1xuc2V0VGltZW91dChmdW5jdGlvbigpe1xuICByZXR1cm4gJCgnZm9vdGVyJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xufSwgMjUwMCk7XG4kKCcjcXVlcnknKS5mb2N1cygpLnNlbGVjdCgpO1xud2luZG93LiR1aSA9ICQoe30pO1xud2luZG93LnJTZWFyY2hvcHRzID0gJFIuc3RhdGUod2luZG93LnNlYXJjaG9wdHMpO1xud2luZG93LnJTb2NrZXQgPSAkUi5zdGF0ZSgpO1xuKGZ1bmN0aW9uKCl7XG4gIHZhciBibGFja2xpc3Q7XG4gIGJsYWNrbGlzdCA9IHtcbiAgICA5OiAxLFxuICAgIDE3OiAxLFxuICAgIDE4OiAxLFxuICAgIDI3OiAxLFxuICAgIDMyOiAxLFxuICAgIDM3OiAxLFxuICAgIDM4OiAxLFxuICAgIDM5OiAxLFxuICAgIDQwOiAxLFxuICAgIDIyNDogMVxuICB9O1xuICByZXR1cm4gJGQub24oJ2tleXVwJywgJyNxdWVyeScsIF9fLmRlYm91bmNlKGZ1bmN0aW9uKGl0KXtcbiAgICB2YXIgcSwgc3VibWl0VHlwZSwgbmV3b3B0cywgcmVmJDtcbiAgICBxID0gJCh0aGlzKS52YWwoKTtcbiAgICBpZiAoIWJsYWNrbGlzdFtpdC53aGljaF0pIHtcbiAgICAgIGlmIChpdC53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgc3VibWl0VHlwZSA9ICdoYXJkJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN1Ym1pdFR5cGUgPSAnc29mdCc7XG4gICAgICB9XG4gICAgICBuZXdvcHRzID0gKHJlZiQgPSBpbXBvcnQkKHt9LCB3aW5kb3cuc2VhcmNob3B0cyksIHJlZiQucSA9IHEsIHJlZiQuc3VibWl0VHlwZSA9IHN1Ym1pdFR5cGUsIHJlZiQpO1xuICAgICAgZGVsZXRlIG5ld29wdHMucGFnZTtcbiAgICAgIHJldHVybiByU2VhcmNob3B0cyhuZXdvcHRzKTtcbiAgICB9XG4gIH0sIDUwMCkpO1xufSkoKTtcbiRkLm9uKCdjaGFuZ2UnLCAnI3NlYXJjaF9maWx0ZXJzIFtuYW1lPWZvcnVtX2lkXScsIGZ1bmN0aW9uKCl7XG4gIHZhciBzdWJtaXRUeXBlLCBmb3J1bV9pZCwgbmV3b3B0cywgcmVmJDtcbiAgc3VibWl0VHlwZSA9ICdzb2Z0JztcbiAgZm9ydW1faWQgPSAkKHRoaXMpLnZhbCgpO1xuICBuZXdvcHRzID0gKHJlZiQgPSBpbXBvcnQkKHt9LCB3aW5kb3cuc2VhcmNob3B0cyksIHJlZiQuZm9ydW1faWQgPSBmb3J1bV9pZCwgcmVmJC5zdWJtaXRUeXBlID0gc3VibWl0VHlwZSwgcmVmJCk7XG4gIGRlbGV0ZSBuZXdvcHRzLnBhZ2U7XG4gIHJTZWFyY2hvcHRzKG5ld29wdHMpO1xuICByZXR1cm4gZmFsc2U7XG59KTtcbiRkLm9uKCdjaGFuZ2UnLCAnI3NlYXJjaF9maWx0ZXJzIFtuYW1lPXdpdGhpbl0nLCBmdW5jdGlvbihpdCl7XG4gIHZhciBzdWJtaXRUeXBlLCB3aXRoaW4sIG5ld29wdHMsIHJlZiQ7XG4gIGNvbnNvbGUubG9nKGl0KTtcbiAgc3VibWl0VHlwZSA9ICdzb2Z0JztcbiAgd2l0aGluID0gJCh0aGlzKS52YWwoKTtcbiAgbmV3b3B0cyA9IChyZWYkID0gaW1wb3J0JCh7fSwgd2luZG93LnNlYXJjaG9wdHMpLCByZWYkLndpdGhpbiA9IHdpdGhpbiwgcmVmJC5zdWJtaXRUeXBlID0gc3VibWl0VHlwZSwgcmVmJCk7XG4gIGRlbGV0ZSBuZXdvcHRzLnBhZ2U7XG4gIHJTZWFyY2hvcHRzKG5ld29wdHMpO1xuICByZXR1cm4gZmFsc2U7XG59KTtcbiRSKGZ1bmN0aW9uKHNvcHRzKXtcbiAgdmFyIHBhcnNlciwgdXJpLCBzaG91bGRTZWFyY2gsIHNob3VsZFJlcGxhY2UsIGssIHYsIHFzO1xuICBwYXJzZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIHBhcnNlci5ocmVmID0gSGlzdG9yeS5nZXRTdGF0ZSgpLnVybDtcbiAgdXJpID0gcGFyc2VyLnBhdGhuYW1lO1xuICBzaG91bGRTZWFyY2ggPSBzb3B0cy5zdWJtaXRUeXBlID09PSAnaGFyZCcgfHwgdXJpID09PSAnL3NlYXJjaCc7XG4gIHNob3VsZFJlcGxhY2UgPSBzb3B0cy5zdWJtaXRUeXBlID09PSAnc29mdCc7XG4gIGRlbGV0ZSBzb3B0cy5zdWJtaXRUeXBlO1xuICAoZnVuY3Rpb24oKXtcbiAgICB2YXIgcmVmJCwgcmVzdWx0cyQgPSBbXTtcbiAgICBmb3IgKGsgaW4gcmVmJCA9IHNvcHRzKSB7XG4gICAgICB2ID0gcmVmJFtrXTtcbiAgICAgIGlmICghdikge1xuICAgICAgICByZXN1bHRzJC5wdXNoKGspO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cyQ7XG4gIH0oKSkubWFwKGZ1bmN0aW9uKGl0KXtcbiAgICB2YXIgcmVmJDtcbiAgICByZXR1cm4gcmVmJCA9IHNvcHRzW2l0XSwgZGVsZXRlIHNvcHRzW2l0XSwgcmVmJDtcbiAgfSk7XG4gIGlmIChzaG91bGRTZWFyY2gpIHtcbiAgICBxcyA9ICQucGFyYW0oc29wdHMpO1xuICAgIHVyaSA9IFwiL3NlYXJjaFwiICsgKHFzID8gJz8nIDogJycpICsgcXM7XG4gICAgd2luZG93Lmxhc3RTdGF0ZWNoYW5nZVdhc1VzZXIgPSBmYWxzZTtcbiAgICBpZiAoc2hvdWxkUmVwbGFjZSkge1xuICAgICAgcmV0dXJuIEhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCAnJywgdXJpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIEhpc3RvcnkucHVzaFN0YXRlKHt9LCAnJywgdXJpKTtcbiAgICB9XG4gIH1cbn0pLmJpbmRUbyhyU2VhcmNob3B0cyk7XG4kdWkub24oJ3RocmVhZC1jcmVhdGUnLCBmdW5jdGlvbihlLCB0aHJlYWQpe1xuICBjb25zb2xlLmluZm8oJ3RocmVhZC1jcmVhdGUnLCB0aHJlYWQpO1xuICByZXR1cm4gcmVuZGVyQW5kUHJlcGVuZCh3aW5kb3csICQoJyNsZWZ0X2NvbnRhaW5lciAudGhyZWFkcycpLCAndGhyZWFkJywge1xuICAgIHRocmVhZDogdGhyZWFkXG4gIH0sIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuICQoJyNsZWZ0X2NvbnRhaW5lciAudGhyZWFkcyBkaXYuZmFkZWluIGxpJykudW53cmFwKCk7XG4gIH0pO1xufSk7XG4kdWkub24oJ25hdi10b3AtcG9zdHMnLCBmdW5jdGlvbihlLCB0aHJlYWRzKXtcbiAgcmV0dXJuIGNvbnNvbGUuaW5mbygnc3R1YicsIHRocmVhZHMpO1xufSk7XG4kZC5vbignY2xpY2snLCAnLmNyZWF0ZSAubm8tc3VyZicsIEF1dGgucmVxdWlyZUxvZ2luKGZ1bmN0aW9uKGV2KXtcbiAgdmFyIGU7XG4gICQoJyNtYWluX2NvbnRlbnQgLmZvcnVtJykuaHRtbCgnJyk7XG4gIGUgPSAkKGV2LnRhcmdldCk7XG4gIHJldHVybiBlZGl0UG9zdChlLmRhdGEoJ2VkaXQnKSwge1xuICAgIGZvcnVtX2lkOiB3aW5kb3cuYWN0aXZlRm9ydW1JZFxuICB9KTtcbn0pKTtcbiRkLm9uKCdjbGljaycsICcuZWRpdC5uby1zdXJmJywgQXV0aC5yZXF1aXJlTG9naW4oZnVuY3Rpb24oZXYpe1xuICByZXR1cm4gZWRpdFBvc3QoJChldi50YXJnZXQpLmRhdGEoJ2VkaXQnKSk7XG59KSk7XG4kZC5vbignY2xpY2snLCAnLm9uY2xpY2stc3VibWl0IC5jYW5jZWwnLCBmdW5jdGlvbihldil7XG4gIHZhciBmLCBtZXRhO1xuICBmID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJy5wb3N0LWVkaXQnKTtcbiAgZi5oaWRlKDM1MCwgJ2Vhc2VPdXRFeHBvJyk7XG4gIG1ldGEgPSBmdXJsLnBhcnNlKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSk7XG4gIHN3aXRjaCAobWV0YS50eXBlKSB7XG4gIGNhc2UgJ25ldy10aHJlYWQnOlxuICAgIEhpc3RvcnkuYmFjaygpO1xuICAgIGJyZWFrO1xuICBkZWZhdWx0OlxuICAgIHJlbW92ZUVkaXRpbmdVcmwobWV0YSk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufSk7XG5zdWJtaXQgPSBBdXRoLnJlcXVpcmVMb2dpbihmdW5jdGlvbihldil7XG4gIHJldHVybiBzdWJtaXRGb3JtKGV2LCBmdW5jdGlvbihkYXRhKXtcbiAgICB2YXIgZiwgcCwgdCwgcmVmJCwgbWV0YTtcbiAgICBmID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJy5wb3N0LWVkaXQnKTtcbiAgICBwID0gZi5jbG9zZXN0KCcuZWRpdGluZycpO1xuICAgIHQgPSAkKGYuZmluZCgnLnRvb2x0aXAnKSk7XG4gICAgaWYgKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgIHNob3dUb29sdGlwKHQsIGRhdGEgIT0gbnVsbCA/IChyZWYkID0gZGF0YS5lcnJvcnMpICE9IG51bGwgPyByZWYkLmpvaW4oJzxicj4nKSA6IHZvaWQgOCA6IHZvaWQgOCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHAuZmluZCgnLnRpdGxlJykuaHRtbCgocmVmJCA9IGRhdGFbMF0pICE9IG51bGwgPyByZWYkLnRpdGxlIDogdm9pZCA4KTtcbiAgICAgIHAuZmluZCgnLmJvZHknKS5odG1sKChyZWYkID0gZGF0YVswXSkgIT0gbnVsbCA/IHJlZiQuYm9keSA6IHZvaWQgOCk7XG4gICAgICBmLnJlbW92ZUNsYXNzKCdmYWRlaW4nKS5oaWRlKDIwMCk7XG4gICAgICBtZXRhID0gZnVybC5wYXJzZSh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpO1xuICAgICAgd2luZG93Lmxhc3RTdGF0ZWNoYW5nZVdhc1VzZXIgPSBmYWxzZTtcbiAgICAgIHN3aXRjaCAobWV0YS50eXBlKSB7XG4gICAgICBjYXNlICduZXctdGhyZWFkJzpcbiAgICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBkYXRhLnVyaSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZWRpdCc6XG4gICAgICAgIHJlbW92ZUVkaXRpbmdVcmwobWV0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG59KTtcbmNrU3VibWl0ID0gQXV0aC5yZXF1aXJlTG9naW4oZnVuY3Rpb24oZXYpe1xuICBja1N1Ym1pdEZvcm0oe1xuICAgIGVsZW1lbnQ6IHtcbiAgICAgICQ6IHtcbiAgICAgICAgaWQ6ICdlZGl0b3InXG4gICAgICB9XG4gICAgfVxuICB9LCBmdW5jdGlvbihkYXRhKXtcbiAgICByZXR1cm4gcG9zdFN1Y2Nlc3MoZXYsIGRhdGEpO1xuICB9KTtcbiAgcmV0dXJuIGZhbHNlO1xufSk7XG5wb3N0U3VibWl0ID0gQXV0aC5yZXF1aXJlTG9naW4oZnVuY3Rpb24oZXYpe1xuICBzdWJtaXRGb3JtKGV2LCBmdW5jdGlvbihkYXRhKXtcbiAgICByZXR1cm4gcG9zdFN1Y2Nlc3MoZXYsIGRhdGEpO1xuICB9KTtcbiAgcmV0dXJuIGZhbHNlO1xufSk7XG5zdWJtaXRTZWxlY3RvcnMgPSBbXCJodG1sLnByb2ZpbGUgLm9uY2xpY2stc3VibWl0IGJ1dHRvblt0eXBlPSdzdWJtaXQnXVwiLCBcImh0bWwuZm9ydW0gLm9uY2xpY2stc3VibWl0IGJ1dHRvblt0eXBlPSdzdWJtaXQnXVwiLCBcImh0bWwuc2VhcmNoIC5vbmNsaWNrLXN1Ym1pdCBidXR0b25bdHlwZT0nc3VibWl0J11cIl07XG4kZC5vbignY2xpY2snLCBzdWJtaXRTZWxlY3RvcnMuam9pbignLCAnKSwgcG9zdFN1Ym1pdCk7XG4kZC5vbigna2V5ZG93bicsICcub25zaGlmdGVudGVyLXN1Ym1pdCcsIGZ1bmN0aW9uKGl0KXtcbiAgaWYgKGl0LndoaWNoID09PSAxMyAmJiBpdC5zaGlmdEtleSkge1xuICAgIHJldHVybiBwb3N0U3VibWl0KGl0KTtcbiAgfVxufSk7XG4kZC5vbignY2xpY2snLCAnLm9uY2xpY2stYXBwZW5kLXJlcGx5LXVpJywgQXV0aC5yZXF1aXJlTG9naW4oYXBwZW5kUmVwbHlVaSkpO1xuJGQub24oJ2NsaWNrJywgJy5vbmNsaWNrLWNlbnNvci1wb3N0JywgQXV0aC5yZXF1aXJlTG9naW4oY2Vuc29yKSk7XG4kZC5vbignY2xpY2snLCAnaHRtbCBoZWFkZXIgLm1lbnUgYS50aXRsZScsIG11dGF0ZSk7XG4kZC5vbignY2xpY2snLCAnaGVhZGVyIC5vbmNsaWNrLWNsb3NlJywgZnVuY3Rpb24oZSl7XG4gICQoJyNxdWVyeScpLnZhbCgnJykuZm9jdXMoKTtcbiAgcmV0dXJuIEhpc3RvcnkuYmFjaygpO1xufSk7XG4kZC5vbignY2xpY2snLCAnI2hhbmRsZScsIGZ1bmN0aW9uKCl7XG4gIHZhciAkbDtcbiAgJGwgPSAkKCcjbGVmdF9jb250ZW50Jyk7XG4gICQoJ2JvZHknKS50b2dnbGVDbGFzcygnY29sbGFwc2VkJyk7XG4gICQoJyNtYWluX2NvbnRlbnQgLnJlc2l6YWJsZScpLmNzcygncGFkZGluZy1sZWZ0JywgJGwud2lkdGgoKSArIGxlZnRPZmZzZXQpO1xuICByZXR1cm4gc2F2ZVVpKCk7XG59KTtcbmlmICgodHlwZW9mIG1vY2hhICE9ICd1bmRlZmluZWQnICYmIG1vY2hhICE9PSBudWxsKSAmJiB3aW5kb3cubG9jYXRpb24uc2VhcmNoLm1hdGNoKC90ZXN0PTEvKSkge1xuICBjbGVhbnVwT3V0cHV0ID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgbW9jaGFDc3NFbDtcbiAgICAkKCdib2R5ID4gKjpub3QoI21vY2hhKScpLnJlbW92ZSgpO1xuICAgIG1vY2hhQ3NzRWwgPSAkKFwiPGxpbmsgcmVsPVxcXCJzdHlsZXNoZWV0XFxcIiB0eXBlPVxcXCJ0ZXh0L2Nzc1xcXCIgaHJlZj1cXFwiXCIgKyB3aW5kb3cuY2FjaGVVcmwgKyBcIi9sb2NhbC9tb2NoYS5jc3NcXFwiPlwiKTtcbiAgICByZXR1cm4gJCgnaGVhZCcpLmFwcGVuZChtb2NoYUNzc0VsKTtcbiAgfTtcbiAgbW9jaGEuc2V0dXAoJ2JkZCcpO1xuICAkLmdldFNjcmlwdCh3aW5kb3cuY2FjaGVVcmwgKyBcIi90ZXN0cy90ZXN0MS5qc1wiLCBmdW5jdGlvbigpe1xuICAgIHZhciBydW47XG4gICAgcnVuID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBtb2NoYS5ydW4oY2xlYW51cE91dHB1dCk7XG4gICAgfTtcbiAgICByZXR1cm4gc2V0VGltZW91dChydW4sIDIwMDApO1xuICB9KTtcbn1cbiRkLm9uKCdjbGljaycsICcub25jbGljay1jaGF0JywgQXV0aC5yZXF1aXJlTG9naW4oZnVuY3Rpb24oZXYpe1xuICB2YXIgcHJvZmlsZU5hbWUsIGYsICRwLCB0O1xuICBwcm9maWxlTmFtZSA9ICQoJ2Rpdi5wcm9maWxlOmZpcnN0JykuZGF0YSgndXNlci1uYW1lJyk7XG4gIGYgPSB1c2VyO1xuICAkcCA9ICQoJ2Rpdi5wcm9maWxlOmZpcnN0Jyk7XG4gIHQgPSB7XG4gICAgaWQ6ICRwLmRhdGEoJ3VzZXItaWQnKSxcbiAgICBuYW1lOiAkcC5kYXRhKCd1c2VyLW5hbWUnKSxcbiAgICBwaG90bzogJHAuZmluZCgnaW1nJykuYXR0cignc3JjJylcbiAgfTtcbiAgcmV0dXJuIENoYXQuc3RhcnQoW2YsIHRdKTtcbn0pKTtcbiRkLm9uKCdjbGljaycsICdodG1sLmFkbWluIC5vbmNsaWNrLXN1Ym1pdCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXScsIGZ1bmN0aW9uKGV2KXtcbiAgcmV0dXJuIHN1Ym1pdEZvcm0oZXYsIGZ1bmN0aW9uKGRhdGEpe1xuICAgIHZhciBmLCB0LCBpbnB1dHMsIGssIHYsIGkkLCBsZW4kLCBlO1xuICAgIGYgPSAkKHRoaXMpO1xuICAgIHQgPSAkKGYuZmluZCgnLnRvb2x0aXAnKSk7XG4gICAgaW5wdXRzID0ge1xuICAgICAgc2F2ZWQ6IGYuZmluZCgnaW5wdXQsIHRleHRhcmVhJylcbiAgICB9O1xuICAgIGlmICghZi5oYXNDbGFzcygnbm8tZm9jdXMnKSkge1xuICAgICAgZi5maW5kKCdpbnB1dDpmaXJzdCcpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgfVxuICAgIGlmIChkYXRhICE9IG51bGwgJiYgZGF0YS5zdWNjZXNzKSB7XG4gICAgICBzaG93VG9vbHRpcCh0LCB0LmRhdGEoJ21zZycpIHx8ICdTYXZlZCEnKTtcbiAgICAgIGZvciAoayBpbiBpbnB1dHMpIHtcbiAgICAgICAgdiA9IGlucHV0c1trXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSB2Lmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgZSA9IHZbaSRdO1xuICAgICAgICAgIGUgPSAkKGUpO1xuICAgICAgICAgIGUuYWRkQ2xhc3Moayk7XG4gICAgICAgICAgaWYgKGUuaGFzQ2xhc3MoJ2NsZWFyJykpIHtcbiAgICAgICAgICAgIGUudmFsKCcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBrLCByZWYkLCB2LCBscmVzdWx0JCwgaSQsIGxlbiQsIGUsIHJlc3VsdHMkID0gW107XG4gICAgICAgIGZvciAoayBpbiByZWYkID0gaW5wdXRzKSB7XG4gICAgICAgICAgdiA9IHJlZiRba107XG4gICAgICAgICAgbHJlc3VsdCQgPSBbXTtcbiAgICAgICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IHYubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICAgIGUgPSB2W2kkXTtcbiAgICAgICAgICAgIGxyZXN1bHQkLnB1c2goJChlKS5yZW1vdmVDbGFzcyhrKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdHMkLnB1c2gobHJlc3VsdCQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzJDtcbiAgICAgIH0sIDMwMDApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gc2hvd1Rvb2x0aXAodCwgZGF0YSAhPSBudWxsID8gZGF0YS5tc2cgOiB2b2lkIDgpO1xuICAgIH1cbiAgfSk7XG59KTtcbiRkLm9uKCdjaGFuZ2UnLCAnaHRtbC5hZG1pbiAuZG9tYWluJywgZnVuY3Rpb24oKXtcbiAgdmFyIGlkLCBkb21haW4sIGkkLCByZWYkLCBsZW4kLCBrLCByZXN1bHRzJCA9IFtdO1xuICBpZCA9IHBhcnNlSW50KCQoJy5kb21haW4gb3B0aW9uOnNlbGVjdGVkJykudmFsKCkpO1xuICBkb21haW4gPSBmaW5kKGZ1bmN0aW9uKGl0KXtcbiAgICByZXR1cm4gaXQuaWQgPT09IGlkO1xuICB9LCBzaXRlLmRvbWFpbnMpO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gWydmYWNlYm9va0NsaWVudElkJywgJ2ZhY2Vib29rQ2xpZW50U2VjcmV0JywgJ3R3aXR0ZXJDb25zdW1lcktleScsICd0d2l0dGVyQ29uc3VtZXJTZWNyZXQnLCAnZ29vZ2xlQ29uc3VtZXJLZXknLCAnZ29vZ2xlQ29uc3VtZXJTZWNyZXQnXSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICBrID0gcmVmJFtpJF07XG4gICAgcmVzdWx0cyQucHVzaCgkKFwiW25hbWU9J1wiICsgayArIFwiJ11cIikudmFsKGRvbWFpbi5jb25maWdba10pKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59KTtcbnN1YnNjcmliZSA9IGZ1bmN0aW9uKHdoYXQpe1xuICBpZiAoIWluJCh3aGF0LCBzaXRlLnN1YnNjcmlwdGlvbnMpKSB7XG4gICAgZG9CdXkod2hhdCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuJGQub24oJ2NsaWNrJywgJ2h0bWwuYWRtaW4gI3ByaXZhdGUnLCBmdW5jdGlvbigpe1xuICByZXR1cm4gc3Vic2NyaWJlKCdwcml2YXRlJyk7XG59KTtcbiRkLm9uKCdjbGljaycsICdodG1sLmFkbWluICNhbmFseXRpY3MnLCBmdW5jdGlvbigpe1xuICByZXR1cm4gc3Vic2NyaWJlKCdhbmFseXRpY3MnKTtcbn0pO1xud2luZG93LmNvbXBvbmVudCA9IHt9O1xuJGQub24oJ2NsaWNrJywgJy5vbmNsaWNrLWJ1eScsIGZ1bmN0aW9uKGV2KXtcbiAgcmV0dXJuIGRvQnV5KCQoZXYudGFyZ2V0KS5kYXRhKCdwcm9kdWN0JykpO1xufSk7XG53aW5kb3cuZG9CdXkgPSBmdW5jdGlvbihwcm9kdWN0SWQpe1xuICBpZiAoIXByb2R1Y3RJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIndpbmRvdy5kby1idXkgbXVzdCBzcGVjaWZ5IGEgcHJvZHVjdC1pZFwiKTtcbiAgfVxuICByZXR1cm4gbGF6eUxvYWRGYW5jeWJveChmdW5jdGlvbigpe1xuICAgIHJldHVybiAkLmdldCgnL3Jlc291cmNlcy9wcm9kdWN0cy8nICsgcHJvZHVjdElkLCBmdW5jdGlvbihwcm9kdWN0KXtcbiAgICAgIHZhciBsb2NhbHMsIHJlZiQsIGI7XG4gICAgICBsb2NhbHMgPSB7XG4gICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QsXG4gICAgICAgIGNhcmROZWVkZWQ6ICEoKHJlZiQgPSB3aW5kb3cuc2l0ZSkgIT0gbnVsbCAmJiByZWYkLmhhc19zdHJpcGUpXG4gICAgICB9O1xuICAgICAgYiA9IChyZWYkID0gd2luZG93LmNvbXBvbmVudCkgIT0gbnVsbCA/IHJlZiQuYnV5IDogdm9pZCA4O1xuICAgICAgaWYgKGIpIHtcbiAgICAgICAgYi5kZXRhY2goKTtcbiAgICAgIH1cbiAgICAgIGIgPSB3aW5kb3cuY29tcG9uZW50LmJ1eSA9IG5ldyBCdXkoe1xuICAgICAgICBsb2NhbHM6IGxvY2Fsc1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gJC5mYW5jeWJveChiLiQsIGZhbmN5Ym94UGFyYW1zKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgcmV0dXJuIG9iajtcbn1cbmZ1bmN0aW9uIGluJCh4LCBhcnIpe1xuICB2YXIgaSA9IC0xLCBsID0gYXJyLmxlbmd0aCA+Pj4gMDtcbiAgd2hpbGUgKCsraSA8IGwpIGlmICh4ID09PSBhcnJbaV0gJiYgaSBpbiBhcnIpIHJldHVybiB0cnVlO1xuICByZXR1cm4gZmFsc2U7XG59XG59KSh3aW5kb3cpIiwiKGZ1bmN0aW9uKCkge1xuICB2YXIgZGVmYXVsdENvbnRleHQgPSB0aGlzO1xuICB2YXIgX19pZCA9IDA7XG5cbiAgZnVuY3Rpb24gJFIoZm5jLCBjb250ZXh0KSB7XG4gICAgICB2YXIgcmYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGRpcnR5Tm9kZXMgPSB0b3BvKHJmKTtcbiAgICAgICAgdmFyIHYgPSBkaXJ0eU5vZGVzWzBdLnJ1bi5hcHBseShyZiwgYXJndW1lbnRzKTtcbiAgICAgICAgZGlydHlOb2Rlcy5zbGljZSgxKS5mb3JFYWNoKGZ1bmN0aW9uIChuKSB7IG4ucnVuKCkgfSApO1xuICAgICAgICByZXR1cm4gdjtcbiAgICAgIH07XG4gICAgICByZi5pZCA9IF9faWQrKztcbiAgICAgIHJmLmNvbnRleHQgPSBjb250ZXh0IHx8IGRlZmF1bHRDb250ZXh0O1xuICAgICAgcmYuZm5jID0gZm5jO1xuICAgICAgcmYuZGVwZW5kZW50cyA9IFtdO1xuICAgICAgcmYuZGVwZW5kZW5jaWVzID0gW107XG4gICAgICByZi5tZW1vID0gJFIuZW1wdHk7XG4gICAgICByZXR1cm4gJFIuZXh0ZW5kKHJmLCByZWFjdGl2ZUV4dGVuc2lvbnMsICRSLnBsdWdpbkV4dGVuc2lvbnMpO1xuICB9XG4gICRSLl8gPSB7fTtcbiAgJFIuZW1wdHkgPSB7fTtcbiAgJFIuc3RhdGUgPSBmdW5jdGlvbiAoaW5pdGlhbCkge1xuICAgIHZhciByRm5jID0gJFIoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy52YWwgPSBhcmd1bWVudHNbMF07XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy52YWw7XG4gICAgfSlcbiAgICByRm5jLmNvbnRleHQgPSByRm5jO1xuICAgIHJGbmMudmFsID0gaW5pdGlhbDtcbiAgICByZXR1cm4gckZuYztcbiAgfVxuICAkUi5leHRlbmQgPSBmdW5jdGlvbihvKSB7XG4gICAgdmFyIGV4dGVuc2lvbnMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgIGV4dGVuc2lvbnMuZm9yRWFjaChmdW5jdGlvbiAoZXh0ZW5zaW9uKSB7XG4gICAgICBpZiAoZXh0ZW5zaW9uKSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gZXh0ZW5zaW9uKSB7IG9bcHJvcF0gPSBleHRlbnNpb25bcHJvcF0gfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBvO1xuICB9O1xuICAkUi5wbHVnaW5FeHRlbnNpb25zID0ge31cblxuICB2YXIgcmVhY3RpdmVFeHRlbnNpb25zID0ge1xuICAgIF9pc1JlYWN0aXZlOiB0cnVlLFxuICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmZuYy50b1N0cmluZygpIH0sXG4gICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubWVtbyA9PT0gJFIuZW1wdHkgPyB0aGlzLnJ1bigpIDogdGhpcy5tZW1vIH0sXG4gICAgcnVuOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB1bmJvdW5kQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gdGhpcy5tZW1vID0gdGhpcy5mbmMuYXBwbHkodGhpcy5jb250ZXh0LCB0aGlzLmFyZ3VtZW50TGlzdCh1bmJvdW5kQXJncykpO1xuICAgIH0sXG4gICAgYmluZFRvOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBuZXdEZXBlbmRlbmNpZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLm1hcCh3cmFwKTtcbiAgICAgIHZhciBvbGREZXBlbmRlbmNpZXMgPSB0aGlzLmRlcGVuZGVuY2llcztcblxuICAgICAgb2xkRGVwZW5kZW5jaWVzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKGQgIT09ICRSLl8pIHsgZC5yZW1vdmVEZXBlbmRlbnQodGhpcykgfVxuICAgICAgfSwgdGhpcyk7XG5cbiAgICAgIG5ld0RlcGVuZGVuY2llcy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChkICE9PSAkUi5fKSB7IGQuYWRkRGVwZW5kZW50KHRoaXMpIH1cbiAgICAgIH0sIHRoaXMpO1xuXG4gICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IG5ld0RlcGVuZGVuY2llcztcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgcmVtb3ZlRGVwZW5kZW50OiBmdW5jdGlvbihyRm5jKSB7XG4gICAgICB0aGlzLmRlcGVuZGVudHMgPSB0aGlzLmRlcGVuZGVudHMuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkICE9PSByRm5jIH0pO1xuICAgIH0sXG4gICAgYWRkRGVwZW5kZW50OiBmdW5jdGlvbihyRm5jKSB7XG4gICAgICBpZiAoIXRoaXMuZGVwZW5kZW50cy5zb21lKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkID09PSByRm5jIH0pKSB7XG4gICAgICAgIHRoaXMuZGVwZW5kZW50cy5wdXNoKHJGbmMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgYXJndW1lbnRMaXN0OiBmdW5jdGlvbih1bmJvdW5kQXJncykge1xuICAgICAgcmV0dXJuIHRoaXMuZGVwZW5kZW5jaWVzLm1hcChmdW5jdGlvbihkZXBlbmRlbmN5KSB7XG4gICAgICAgIGlmIChkZXBlbmRlbmN5ID09PSAkUi5fKSB7XG4gICAgICAgICAgcmV0dXJuIHVuYm91bmRBcmdzLnNoaWZ0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGVwZW5kZW5jeS5faXNSZWFjdGl2ZSkge1xuICAgICAgICAgIHJldHVybiBkZXBlbmRlbmN5LmdldCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pLmNvbmNhdCh1bmJvdW5kQXJncyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSAkUjtcbiAgfSBlbHNlIHtcbiAgICBkZWZhdWx0Q29udGV4dC4kUiA9ICRSO1xuICB9XG5cbiAgLy9Qcml2YXRlXG4gIGZ1bmN0aW9uIHRvcG8ocm9vdEZuYykge1xuICAgIHZhciBleHBsb3JlZCA9IHt9O1xuICAgIGZ1bmN0aW9uIHNlYXJjaChyRm5jKSB7XG4gICAgICBpZiAoZXhwbG9yZWRbckZuYy5pZF0pIHsgcmV0dXJuIFtdIH1cbiAgICAgIGV4cGxvcmVkW3JGbmMuaWRdID0gdHJ1ZTtcbiAgICAgIHJldHVybiByRm5jLmRlcGVuZGVudHMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGRlcCkgeyByZXR1cm4gYWNjLmNvbmNhdChzZWFyY2goZGVwKSl9LFtdKS5jb25jYXQockZuYyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlYXJjaChyb290Rm5jKS5yZXZlcnNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwKHYpIHtcbiAgICByZXR1cm4gdiAmJiAodi5faXNSZWFjdGl2ZSB8fCB2ID09ICRSLl8pID8gdiA6ICRSKGZ1bmN0aW9uICgpIHtyZXR1cm4gdn0pO1xuICB9XG59KSgpO1xuIiwidmFyIHBvc3RTdWNjZXNzLCBja1N1Ym1pdEZvcm0sIHN1Ym1pdEZvcm0sIHNldElubGluZUVkaXRvciwgZm9jdXMsIHJlbmRlciwgdG9nZ2xlUG9zdCwgZWRpdFBvc3QsIGxvYWRDc3NDYWNoZSwgbG9hZENzcywgbGF6eUxvYWQsIGxhenlMb2FkRGVzZXJpYWxpemUsIGxhenlMb2FkTmVzdGVkU29ydGFibGUsIGxhenlMb2FkSHRtbDVVcGxvYWRlciwgbGF6eUxvYWRKY3JvcCwgbGF6eUxvYWRFZGl0b3IsIGxhenlMb2FkRmFuY3lib3gsIGxhenlMb2FkU29ja2V0aW8sIGZhbmN5Ym94UGFyYW1zLCByZXNwb25kUmVzaXplLCBzZXRXaWRlLCBhbGlnbkJyZWFkY3J1bWIsIHJlbW92ZUVkaXRpbmdVcmwsIG11dGF0ZSwgdGltZXJzLCBzaG93VG9vbHRpcCwgc3dpdGNoQW5kRm9jdXMsIHNldE9ubGluZVVzZXIsIHNldFByb2ZpbGUsIG91dCQgPSB0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyAmJiBleHBvcnRzIHx8IHRoaXMsIHRoaXMkID0gdGhpcztcbm91dCQucG9zdFN1Y2Nlc3MgPSBwb3N0U3VjY2VzcyA9IGZ1bmN0aW9uKGV2LCBkYXRhKXtcbiAgdmFyIGYsIHAsIHQsIHJlZiQsIG1ldGE7XG4gIGYgPSAkKGV2LnRhcmdldCkuY2xvc2VzdCgnLnBvc3QtZWRpdCcpO1xuICBwID0gZi5jbG9zZXN0KCcuZWRpdGluZycpO1xuICB0ID0gJChmLmZpbmQoJy50b29sdGlwJykpO1xuICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgIHNob3dUb29sdGlwKHQsIGRhdGEgIT0gbnVsbCA/IChyZWYkID0gZGF0YS5lcnJvcnMpICE9IG51bGwgPyByZWYkLmpvaW4oJzxicj4nKSA6IHZvaWQgOCA6IHZvaWQgOCk7XG4gIH0gZWxzZSB7XG4gICAgcC5maW5kKCcudGl0bGUnKS5odG1sKChyZWYkID0gZGF0YVswXSkgIT0gbnVsbCA/IHJlZiQudGl0bGUgOiB2b2lkIDgpO1xuICAgIHAuZmluZCgnLmJvZHknKS5odG1sKChyZWYkID0gZGF0YVswXSkgIT0gbnVsbCA/IHJlZiQuYm9keSA6IHZvaWQgOCk7XG4gICAgZi5yZW1vdmVDbGFzcygnZmFkZWluJykuaGlkZSgzMDApO1xuICAgIG1ldGEgPSBmdXJsLnBhcnNlKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSk7XG4gICAgd2luZG93Lmxhc3RTdGF0ZWNoYW5nZVdhc1VzZXIgPSBmYWxzZTtcbiAgICBzd2l0Y2ggKG1ldGEudHlwZSkge1xuICAgIGNhc2UgJ25ldy10aHJlYWQnOlxuICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBkYXRhLnVyaSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdlZGl0JzpcbiAgICAgIHJlbW92ZUVkaXRpbmdVcmwobWV0YSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5vdXQkLmNrU3VibWl0Rm9ybSA9IGNrU3VibWl0Rm9ybSA9IGZ1bmN0aW9uKGUpe1xuICB2YXIgZWRpdG9yLCByZWYkLCBldiwgJHA7XG4gIGVkaXRvciA9IGUgIT0gbnVsbCA/IChyZWYkID0gZS5lbGVtZW50KSAhPSBudWxsID8gcmVmJC4kIDogdm9pZCA4IDogdm9pZCA4O1xuICBldiA9IHtcbiAgICB0YXJnZXQ6IGVkaXRvclxuICB9O1xuICBpZiAoIShlZGl0b3IgIT0gbnVsbCAmJiBlZGl0b3IuaWQpKSB7XG4gICAgJHAgPSAkKGVkaXRvcikuY2xvc2VzdCgnLnBvc3QnKTtcbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgIHVybDogJy9yZXNvdXJjZXMvcG9zdHMvJyArICRwLmRhdGEoJ3Bvc3QtaWQnKSxcbiAgICAgIHR5cGU6ICdwdXQnLFxuICAgICAgZGF0YToge1xuICAgICAgICBpZDogJHAuZGF0YSgncG9zdC1pZCcpLFxuICAgICAgICBmb3J1bV9pZDogJHAuZGF0YSgnZm9ydW0taWQnKSxcbiAgICAgICAgcGFyZW50X2lkOiAkcC5kYXRhKCd0aHJlYWQtaWQnKSxcbiAgICAgICAgYm9keTogZS5nZXREYXRhKClcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgZS5maXJlKCdibHVyJyk7XG4gICAgICAgIHJldHVybiAkcC5maW5kKCdbY29udGVudEVkaXRhYmxlPXRydWVdJykuYmx1cigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBzdWJtaXRGb3JtKGV2LCBmdW5jdGlvbihkYXRhKXtcbiAgICAgIHBvc3RTdWNjZXNzKGV2LCBkYXRhKTtcbiAgICAgICQoJ2Zvb3RlcicpLnJlbW92ZUNsYXNzKCdleHBhbmRlZCcpO1xuICAgICAgcmV0dXJuICQoJyNwb3N0X25ldyAuZmFkZWluJykucmVtb3ZlKCk7XG4gICAgfSk7XG4gIH1cbn07XG5vdXQkLnN1Ym1pdEZvcm0gPSBzdWJtaXRGb3JtID0gZnVuY3Rpb24oZXYsIGZuKXtcbiAgdmFyICRmLCAkcywgYm9keSwgZSwgcmVmJCwgaW5wdXQ7XG4gICRmID0gJChldi50YXJnZXQpLmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgJHMgPSAkKCRmLmZpbmQoJ1t0eXBlPXN1Ym1pdF06Zmlyc3QnKSk7XG4gIGlmICgkcykge1xuICAgICRzLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gIH1cbiAgYm9keSA9ICRmLmZpbmQoJ3RleHRhcmVhLmJvZHknKTtcbiAgZSA9IHR5cGVvZiBDS0VESVRPUiAhPSAndW5kZWZpbmVkJyAmJiBDS0VESVRPUiAhPT0gbnVsbCA/IChyZWYkID0gQ0tFRElUT1IuaW5zdGFuY2VzKSAhPSBudWxsID8gcmVmJFtib2R5LmF0dHIoJ2lkJyldIDogdm9pZCA4IDogdm9pZCA4O1xuICBpZiAoZSkge1xuICAgIGlucHV0ID0gZS5nZXREYXRhKCk7XG4gICAgaWYgKGlucHV0ICE9IG51bGwgJiYgaW5wdXQubGVuZ3RoKSB7XG4gICAgICBib2R5LnZhbChpbnB1dCk7XG4gICAgICBlLnNldERhdGEoJycpO1xuICAgIH1cbiAgfVxuICAkLmFqYXgoe1xuICAgIHVybDogJGYuYXR0cignYWN0aW9uJyksXG4gICAgdHlwZTogJGYuYXR0cignbWV0aG9kJyksXG4gICAgZGF0YTogJGYuc2VyaWFsaXplKCksXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICRzLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICBpZiAoJCgnZm9vdGVyJykuaGFzQ2xhc3MoJ2V4cGFuZGVkJykpIHtcbiAgICAgICAgJCgnLm9uY2xpY2stZm9vdGVyLXRvZ2dsZTpmaXJzdCcpLmNsaWNrKCk7XG4gICAgICB9XG4gICAgICBpZiAoZm4pIHtcbiAgICAgICAgcmV0dXJuIGZuLmNhbGwoJGYsIGRhdGEpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgJHMucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgIHJldHVybiBzaG93VG9vbHRpcCgkKCRmLmZpbmQoJy50b29sdGlwJykpLCBkYXRhICE9IG51bGwgPyBkYXRhLm1zZyA6IHZvaWQgOCkgfHwgJ1RyeSBhZ2FpbiEnO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmYWxzZTtcbn07XG5vdXQkLnNldElubGluZUVkaXRvciA9IHNldElubGluZUVkaXRvciA9IGZ1bmN0aW9uKHVzZXJJZCl7XG4gICQoXCIucG9zdFtkYXRhLXVzZXItaWQ9XCIgKyB1c2VySWQgKyBcIl0gLnBvc3QtY29udGVudFwiKS5hdHRyKCdjb250ZW50RWRpdGFibGUnLCB0cnVlKTtcbiAgcmV0dXJuIGxhenlMb2FkRWRpdG9yKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGkkLCByZWYkLCBsZW4kLCBlO1xuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBDS0VESVRPUi5pbnN0YW5jZXMpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICBlID0gcmVmJFtpJF07XG4gICAgICBlLmRlc3Ryb3kodHJ1ZSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gQ0tFRElUT1IuaW5saW5lQWxsKCk7XG4gICAgfSBjYXRjaCAoZSQpIHt9XG4gIH0pO1xufTtcbmZvY3VzID0gZnVuY3Rpb24oJGUpe1xuICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIHJldHVybiAkZS5maW5kKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvY3VzKCk7XG4gIH0sIDEwKTtcbn07XG5yZW5kZXIgPSBmdW5jdGlvbihzZWwsIGxvY2FscywgY2Ipe1xuICB2YXIgJGU7XG4gIGNiID09IG51bGwgJiYgKGNiID0gZnVuY3Rpb24oKXt9KTtcbiAgJGUgPSAkKHNlbCk7XG4gIHJldHVybiByZW5kZXJBbmRBcHBlbmQod2luZG93LCBzZWwsICdwb3N0LWVkaXQnLCB7XG4gICAgdXNlcjogdXNlcixcbiAgICBwb3N0OiBsb2NhbHNcbiAgfSwgZnVuY3Rpb24oJGUpe1xuICAgIGNiKCk7XG4gICAgcmV0dXJuIGZvY3VzKCRlKTtcbiAgfSk7XG59O1xub3V0JC50b2dnbGVQb3N0ID0gdG9nZ2xlUG9zdCA9IGZ1bmN0aW9uKGV2KXtcbiAgdmFyIGRhdGEsIGU7XG4gIGlmICghJChldiAhPSBudWxsID8gZXYudGFyZ2V0IDogdm9pZCA4KS5oYXNDbGFzcygnb25jbGljay1mb290ZXItdG9nZ2xlJykpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF1c2VyKSB7XG4gICAgQXV0aC5zaG93TG9naW5EaWFsb2coKTtcbiAgICByZXR1cm47XG4gIH1cbiAgZGF0YSA9IHtcbiAgICBhY3Rpb246ICcvcmVzb3VyY2VzL3Bvc3RzJyxcbiAgICBtZXRob2Q6ICdwb3N0J1xuICB9O1xuICBlID0gJCgnZm9vdGVyJyk7XG4gIGlmIChlLmhhc0NsYXNzKCdleHBhbmRlZCcpKSB7XG4gICAgZS5yZW1vdmVDbGFzcygnZXhwYW5kZWQnKTtcbiAgICByZXR1cm4gJCgnI3Bvc3RfbmV3IC5mYWRlaW4nKS5yZW1vdmUoKTtcbiAgfSBlbHNlIHtcbiAgICBlLmFkZENsYXNzKCdleHBhbmRlZCcpO1xuICAgIHJldHVybiByZW5kZXIoJyNwb3N0X25ldycsIGRhdGEsIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gbGF6eUxvYWRFZGl0b3IoZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKCFDS0VESVRPUi5pbnN0YW5jZXMucG9zdF9uZXcpIHtcbiAgICAgICAgICBDS0VESVRPUi5yZXBsYWNlKCQoJyNwb3N0X25ldyB0ZXh0YXJlYScpWzBdKTtcbiAgICAgICAgfVxuICAgICAgICBlLmZpbmQoJ2Zvcm0ucG9zdC1uZXcgaW5wdXRbbmFtZT1cImZvcnVtX2lkXCJdJykudmFsKHdpbmRvdy5hY3RpdmVGb3J1bUlkKTtcbiAgICAgICAgcmV0dXJuIGUuZmluZCgnZm9ybS5wb3N0LW5ldyBpbnB1dFtuYW1lPVwicGFyZW50X2lkXCJdJykudmFsKHdpbmRvdy5hY3RpdmVUaHJlYWRJZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufTtcbm91dCQuZWRpdFBvc3QgPSBlZGl0UG9zdCA9IGZ1bmN0aW9uKGlkLCBkYXRhKXtcbiAgdmFyIHNlbCwgZTtcbiAgZGF0YSA9PSBudWxsICYmIChkYXRhID0ge30pO1xuICBpZiAoaWQgPT09IHRydWUpIHtcbiAgICBzY3JvbGxUb1RvcCgpO1xuICAgIGRhdGEuYWN0aW9uID0gJy9yZXNvdXJjZXMvcG9zdHMnO1xuICAgIGRhdGEubWV0aG9kID0gJ3Bvc3QnO1xuICAgIHJldHVybiByZW5kZXIoJy5mb3J1bScsIGRhdGEsIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gbGF6eUxvYWRFZGl0b3IoZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIENLRURJVE9SLnJlcGxhY2UoJCgnI2VkaXRvcicpWzBdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHNlbCA9IFwiI3Bvc3RfXCIgKyBpZDtcbiAgICBlID0gJChzZWwpO1xuICAgIGlmICghZS5maW5kKFwiI3Bvc3RfZWRpdF9cIiArIGlkICsgXCI6dmlzaWJsZVwiKS5sZW5ndGgpIHtcbiAgICAgIHJldHVybiAkLmdldChcIi9yZXNvdXJjZXMvcG9zdHMvXCIgKyBpZCwgZnVuY3Rpb24ocCl7XG4gICAgICAgIHJlbmRlcihzZWwsIHApO1xuICAgICAgICByZXR1cm4gZS5hZGRDbGFzcygnZWRpdGluZycpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmb2N1cyhlKTtcbiAgICB9XG4gIH1cbn07XG5sb2FkQ3NzQ2FjaGUgPSB7fTtcbmxvYWRDc3MgPSBmdW5jdGlvbihocmVmKXtcbiAgaWYgKGxvYWRDc3NDYWNoZVtocmVmXSkge1xuICAgIHJldHVybjtcbiAgfVxuICAkKCdoZWFkJykuYXBwZW5kKCQoJzxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiB0eXBlPVwidGV4dC9jc3NcIj4nKS5hdHRyKCdocmVmJywgaHJlZikpO1xuICByZXR1cm4gbG9hZENzc0NhY2hlW2hyZWZdID0gdHJ1ZTtcbn07XG5vdXQkLmxhenlMb2FkID0gbGF6eUxvYWQgPSBmdW5jdGlvbih0ZXN0LCBzY3JpcHQsIGNzcywgY2Ipe1xuICB2YXIgYjtcbiAgYiA9ICQoJ2JvZHknKTtcbiAgYi5hZGRDbGFzcygnd2FpdGluZycpO1xuICBpZiAoIXRlc3QoKSkge1xuICAgIGlmIChjc3MpIHtcbiAgICAgIGxvYWRDc3MoY3NzKTtcbiAgICB9XG4gICAgcmV0dXJuIGhlYWRqcyhzY3JpcHQsIGZ1bmN0aW9uKCl7XG4gICAgICBiLnJlbW92ZUNsYXNzKCd3YWl0aW5nJyk7XG4gICAgICByZXR1cm4gY2IoKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBiLnJlbW92ZUNsYXNzKCd3YWl0aW5nJyk7XG4gICAgcmV0dXJuIGNiKCk7XG4gIH1cbn07XG5vdXQkLmxhenlMb2FkRGVzZXJpYWxpemUgPSBsYXp5TG9hZERlc2VyaWFsaXplID0gZnVuY3Rpb24oY2Ipe1xuICByZXR1cm4gbGF6eUxvYWQoZnVuY3Rpb24oKXtcbiAgICB2YXIgcmVmJDtcbiAgICByZXR1cm4gKHJlZiQgPSB3aW5kb3cuJCgpLmRlc2VyaWFsaXplKSAhPSBudWxsID8gcmVmJC5sZW5ndGggOiB2b2lkIDg7XG4gIH0sIGNhY2hlVXJsICsgXCIvbG9jYWwvanF1ZXJ5LmRlc2VyaWFsaXplLm1pbi5qc1wiLCBudWxsLCBjYik7XG59O1xub3V0JC5sYXp5TG9hZE5lc3RlZFNvcnRhYmxlID0gbGF6eUxvYWROZXN0ZWRTb3J0YWJsZSA9IGZ1bmN0aW9uKGNiKXtcbiAgcmV0dXJuIGxhenlMb2FkKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHJlZiQ7XG4gICAgcmV0dXJuIChyZWYkID0gd2luZG93LiQoKS5uZXN0ZWRTb3J0YWJsZSkgIT0gbnVsbCA/IHJlZiQubGVuZ3RoIDogdm9pZCA4O1xuICB9LCBjYWNoZVVybCArIFwiL2xvY2FsL2pxdWVyeS5tanMubmVzdGVkU29ydGFibGUuanNcIiwgbnVsbCwgY2IpO1xufTtcbm91dCQubGF6eUxvYWRIdG1sNVVwbG9hZGVyID0gbGF6eUxvYWRIdG1sNVVwbG9hZGVyID0gZnVuY3Rpb24oY2Ipe1xuICByZXR1cm4gbGF6eUxvYWQoZnVuY3Rpb24oKXtcbiAgICB2YXIgcmVmJDtcbiAgICByZXR1cm4gKHJlZiQgPSB3aW5kb3cuJCgpLmh0bWw1VXBsb2FkZXIpICE9IG51bGwgPyByZWYkLmxlbmd0aCA6IHZvaWQgODtcbiAgfSwgY2FjaGVVcmwgKyBcIi9sb2NhbC9qcXVlcnkuaHRtbDV1cGxvYWRlci5qc1wiLCBjYWNoZVVybCArIFwiL2xvY2FsL2VkaXRvci9za2lucy9tb29uby9lZGl0b3IuY3NzXCIsIGNiKTtcbn07XG5vdXQkLmxhenlMb2FkSmNyb3AgPSBsYXp5TG9hZEpjcm9wID0gZnVuY3Rpb24oY2Ipe1xuICByZXR1cm4gbGF6eUxvYWQoZnVuY3Rpb24oKXtcbiAgICB2YXIgcmVmJDtcbiAgICByZXR1cm4gKHJlZiQgPSB3aW5kb3cuJCgpLkpjcm9wKSAhPSBudWxsID8gcmVmJC5sZW5ndGggOiB2b2lkIDg7XG4gIH0sIGNhY2hlVXJsICsgXCIvamNyb3AvanMvanF1ZXJ5Lkpjcm9wLm1pbi5qc1wiLCBjYWNoZVVybCArIFwiL2pjcm9wL2Nzcy9qcXVlcnkuSmNyb3AubWluLmNzc1wiLCBjYik7XG59O1xub3V0JC5sYXp5TG9hZEVkaXRvciA9IGxhenlMb2FkRWRpdG9yID0gZnVuY3Rpb24oY2Ipe1xuICByZXR1cm4gbGF6eUxvYWQoZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdHlwZW9mIENLRURJVE9SICE9ICd1bmRlZmluZWQnICYmIENLRURJVE9SICE9PSBudWxsID8gQ0tFRElUT1IudmVyc2lvbiA6IHZvaWQgODtcbiAgfSwgY2FjaGVVcmwgKyBcIi9sb2NhbC9lZGl0b3IvY2tlZGl0b3IuanNcIiwgbnVsbCwgY2IpO1xufTtcbm91dCQubGF6eUxvYWRGYW5jeWJveCA9IGxhenlMb2FkRmFuY3lib3ggPSBmdW5jdGlvbihjYil7XG4gIHJldHVybiBsYXp5TG9hZChmdW5jdGlvbigpe1xuICAgIHZhciByZWYkO1xuICAgIHJldHVybiAocmVmJCA9IHdpbmRvdy4kKCkuZmFuY3lib3gpICE9IG51bGwgPyByZWYkLmxlbmd0aCA6IHZvaWQgODtcbiAgfSwgY2FjaGVVcmwgKyBcIi9mYW5jeWJveC9qcXVlcnkuZmFuY3lib3gucGFjay5qc1wiLCBjYWNoZVVybCArIFwiL2ZhbmN5Ym94L2pxdWVyeS5mYW5jeWJveC5jc3NcIiwgY2IpO1xufTtcbm91dCQubGF6eUxvYWRTb2NrZXRpbyA9IGxhenlMb2FkU29ja2V0aW8gPSBmdW5jdGlvbihjYil7XG4gIHJldHVybiBsYXp5TG9hZChmdW5jdGlvbigpe1xuICAgIHJldHVybiB3aW5kb3cuaW87XG4gIH0sIFwiL3NvY2tldC5pby9zb2NrZXQuaW8uanNcIiwgbnVsbCwgY2IpO1xufTtcbm91dCQuZmFuY3lib3hQYXJhbXMgPSBmYW5jeWJveFBhcmFtcyA9IHtcbiAgY2xvc2VFZmZlY3Q6ICdlbGFzdGljJyxcbiAgY2xvc2VTcGVlZDogMjAwLFxuICBjbG9zZUVhc2luZzogJ2Vhc2VPdXRFeHBvJyxcbiAgb3BlbkVmZmVjdDogJ2ZhZGUnLFxuICBvcGVuU3BlZWQ6IDQ1MFxufTtcbm91dCQucmVzcG9uZFJlc2l6ZSA9IHJlc3BvbmRSZXNpemUgPSBmdW5jdGlvbigpe1xuICB2YXIgdztcbiAgdyA9ICQod2luZG93KTtcbiAgaWYgKHdpbmRvdy5tdXRhdG9yICE9PSAnYWRtaW4nKSB7XG4gICAgaWYgKHcud2lkdGgoKSA8PSA4MDApIHtcbiAgICAgIHJldHVybiAkKCdib2R5JykuYWRkQ2xhc3MoJ2NvbGxhcHNlZCcpO1xuICAgIH1cbiAgfVxufTtcbm91dCQuc2V0V2lkZSA9IHNldFdpZGUgPSBmdW5jdGlvbigpe1xuICB2YXIgbDtcbiAgbCA9ICQoJyNsZWZ0X2NvbnRlbnQnKTtcbiAgcmV0dXJuIGwudG9nZ2xlQ2xhc3MoJ3dpZGUnLCBsLndpZHRoKCkgPiAzMDApO1xufTtcbm91dCQuYWxpZ25CcmVhZGNydW1iID0gYWxpZ25CcmVhZGNydW1iID0gZnVuY3Rpb24oKXtcbiAgdmFyIGIsIG0sIGwsIHBvcztcbiAgYiA9ICQoJyNicmVhZGNydW1iJyk7XG4gIG0gPSAkKCcjbWFpbl9jb250ZW50Jyk7XG4gIGwgPSAkKCcjbGVmdF9jb250ZW50Jyk7XG4gIHBvcyA9IChtLndpZHRoKCkgLSBiLndpZHRoKCkpIC8gMjtcbiAgcmV0dXJuIGIudHJhbnNpdGlvbih7XG4gICAgbGVmdDogcG9zIDwgbC53aWR0aCgpID8gbC53aWR0aCgpIDogcG9zXG4gIH0sIDMwMCwgJ2Vhc2VPdXRFeHBvJyk7XG59O1xub3V0JC5yZW1vdmVFZGl0aW5nVXJsID0gcmVtb3ZlRWRpdGluZ1VybCA9IGZ1bmN0aW9uKG1ldGEpe1xuICByZXR1cm4gSGlzdG9yeS5yZXBsYWNlU3RhdGUoe1xuICAgIG5vU3VyZjogdHJ1ZVxuICB9LCAnJywgbWV0YS50aHJlYWRVcmkpO1xufTtcbm91dCQubXV0YXRlID0gbXV0YXRlID0gZnVuY3Rpb24oKXtcbiAgdmFyICRlLCBocmVmLCBwYXJhbXM7XG4gICRlID0gJCh0aGlzKTtcbiAgaWYgKCRlLmhhc0NsYXNzKCdyZXF1aXJlLWxvZ2luJykgJiYgIXVzZXIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaHJlZiA9ICRlLmF0dHIoJ2hyZWYnKTtcbiAgaWYgKCFocmVmKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChocmVmICE9IG51bGwgJiYgaHJlZi5tYXRjaCgvIy8pKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcGFyYW1zID0ge307XG4gIGlmICgkZS5oYXNDbGFzcygnbm8tc3VyZicpKSB7XG4gICAgcGFyYW1zLm5vU3VyZiA9IHRydWU7XG4gIH1cbiAgcGFyYW1zLnN1cmZEYXRhID0gJGUuZGF0YSgnc3VyZicpIHx8IHdpbmRvdy5zdXJmRGF0YSB8fCB2b2lkIDg7XG4gIHdpbmRvdy5sYXN0U3RhdGVjaGFuZ2VXYXNVc2VyID0gZmFsc2U7XG4gIEhpc3RvcnkucHVzaFN0YXRlKHBhcmFtcywgJycsIGhyZWYpO1xuICByZXR1cm4gZmFsc2U7XG59O1xudGltZXJzID0ge307XG5vdXQkLnNob3dUb29sdGlwID0gc2hvd1Rvb2x0aXAgPSBmdW5jdGlvbigkdG9vbHRpcCwgbXNnLCBkdXJhdGlvbil7XG4gIHZhciB0aW1lcjtcbiAgZHVyYXRpb24gPT0gbnVsbCAmJiAoZHVyYXRpb24gPSA0MDAwKTtcbiAgaWYgKCEobXNnICE9IG51bGwgJiYgbXNnLmxlbmd0aCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdGltZXIgPSB0aW1lcnNbbXNnXTtcbiAgaWYgKHRpbWVyKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgfVxuICAkdG9vbHRpcC5odG1sKG1zZykuYWRkQ2xhc3MoJ2hvdmVyJyk7XG4gIHJldHVybiB0aW1lcnNbbXNnXSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICB0aW1lcnNbbXNnXSA9IHZvaWQgODtcbiAgICByZXR1cm4gJHRvb2x0aXAucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gIH0sIGR1cmF0aW9uKTtcbn07XG5vdXQkLnN3aXRjaEFuZEZvY3VzID0gc3dpdGNoQW5kRm9jdXMgPSBmdW5jdGlvbihyZW1vdmUsIGFkZCwgZm9jdXNPbil7XG4gIHZhciAkZTtcbiAgJGUgPSAkKCcuZmFuY3lib3gtd3JhcCcpO1xuICAkZS5yZW1vdmVDbGFzcyhyZW1vdmUgKyBcIiBzaGFrZSBzbGlkZVwiKS5hZGRDbGFzcyhhZGQpO1xuICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICRlLmFkZENsYXNzKCdzbGlkZScpO1xuICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gJChmb2N1c09uKS5mb2N1cygpO1xuICAgIH0sIDI1MCk7XG4gIH0sIDUwKTtcbn07XG5vdXQkLnNldE9ubGluZVVzZXIgPSBzZXRPbmxpbmVVc2VyID0gZnVuY3Rpb24oaWQpe1xuICB2YXIgeCQ7XG4gIHgkID0gJChcIltkYXRhLXVzZXItaWQ9XCIgKyBpZCArIFwiXSAucHJvZmlsZS5waG90b1wiKTtcbiAgeCQuYWRkQ2xhc3MoJ29ubGluZScpO1xuICB4JC5hdHRyKCd0aXRsZScsICdPbmxpbmUhJyk7XG4gIHJldHVybiB4JDtcbn07XG5vdXQkLnNldFByb2ZpbGUgPSBzZXRQcm9maWxlID0gZnVuY3Rpb24oc3JjKXtcbiAgdmFyIHgkLCB5JDtcbiAgeCQgPSAkKCcucGhvdG8nKTtcbiAgeCQuYXR0cignaHJlZicsIFwiL3VzZXIvXCIgKyB1c2VyLm5hbWUpO1xuICB4JC5hZGRDbGFzcygnb25saW5lJyk7XG4gIHkkID0gJCgnI3Byb2ZpbGUnKTtcbiAgeSQub24oJ2xvYWQnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiAkKCcucHJvZmlsZScpLnNob3coKTtcbiAgfSk7XG4gIHkkLmF0dHIoJ3NyYycsIHdpbmRvdy5jYWNoZVVybCArIHNyYyk7XG4gIHJldHVybiB5JDtcbn07IiwiLypcblxuIyMgQW4gRXhwZXJpbWVudCBpbiBQYWdpbmF0aW9uXG5cbi0gSXQgd2FudHMgdG8gZmlsbCBhbGwgKG9yIG1vc3QpIG9mIHRoZSBkaXNwbGF5ZWQgaGVpZ2h0IG9mIHRoZSBhcmVhIGl0cyBjb250cm9sbGluZy5cbi0gSXQgc2hvdWxkIGJlIHJlbGF0aXZlbHkgbmFycm93LlxuLSBDbGlja2luZyBvbiBpdCB3aWxsIGNoYW5nZSB3aGF0IHBhZ2UgeW91J3JlIG9uLlxuICAtIFRoZSBwYWdlIG51bWJlciBpcyBjYWxjdWxhdGVkIHByb3BvcnRpb25hbGx5IHRvIHRoZSBoZWlnaHQgb2YgdGhlIHBhZ2VyIHJlbGF0aXZlIHRvIHRoZSBudW1iZXIgb2YgcGFnZXMuXG4tIEhvdmVyaW5nIG92ZXIgaXQgY291bGQgcHJvdmlkZSBpbmZvIG9uIHdoYXQgcGFnZSB5b3UnbGwgZ28gdG8gaWYgeW91IGNsaWNrIHRoZXJlLlxuICAtIEhvd2V2ZXIsIG1hbnkgdG91Y2ggZGV2aWNlcyBhcmUgdW5hYmxlIHRvIGhvdmVyLiAgV2hhdCB0byBkbz9cbiAgICBodHRwOi8vdXguc3RhY2tleGNoYW5nZS5jb20vcXVlc3Rpb25zLzk3MC93aGF0LWFyZS1zb21lLWFsdGVybmF0aXZlcy10by1ob3Zlci1vbi10b3VjaC1iYXNlZC1kZXZpY2VzXG5cblxuLSBJdCBoYXMgdG8gd29yayBvbiB0aGUgc2VydmVyIHNpZGUsIHRvby5cblxuIyMjIEhUTUwgU3RydWN0dXJlXG5cbiAgI3BhZ2VyXG4gICAgLmZpcnN0XG4gICAgLmN1cnJlbnRcbiAgICAubGFzdFxuXG4qL1xudmFyIGluZGljYXRvckhlaWdodCwgaW5kaWNhdG9yVG9wLCBwYWdlRnJvbUNsaWNrSGVpZ2h0LCBQYWdlcjtcbmluZGljYXRvckhlaWdodCA9IGZ1bmN0aW9uKHBhZ2VzLCBoZWlnaHQpe1xuICByZXR1cm4gTWF0aC5mbG9vcihoZWlnaHQgLyBwYWdlcyk7XG59O1xuaW5kaWNhdG9yVG9wID0gZnVuY3Rpb24ocGFnZSwgaUhlaWdodCl7XG4gIHJldHVybiAocGFnZSAtIDEpICogaUhlaWdodDtcbn07XG5wYWdlRnJvbUNsaWNrSGVpZ2h0ID0gZnVuY3Rpb24oY2xpY2tIZWlnaHQsIGlIZWlnaHQpe1xuICB2YXIgZjtcbiAgZiA9IE1hdGguY2VpbChjbGlja0hlaWdodCAvIGlIZWlnaHQpO1xuICBpZiAoZiA9PT0gMCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmO1xuICB9XG59O1xubW9kdWxlLmV4cG9ydHMgPSBQYWdlciA9IChmdW5jdGlvbigpe1xuICBQYWdlci5kaXNwbGF5TmFtZSA9ICdQYWdlcic7XG4gIHZhciBwcm90b3R5cGUgPSBQYWdlci5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gUGFnZXI7XG4gIGZ1bmN0aW9uIFBhZ2VyKGlkLCBvcHRpb25zKXtcbiAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLm9uUmVzaXplUmVJbml0ID0gYmluZCQodGhpcywgJ29uUmVzaXplUmVJbml0JywgcHJvdG90eXBlKTtcbiAgICB0aGlzLm9uQ2xpY2tTZXRQYWdlID0gYmluZCQodGhpcywgJ29uQ2xpY2tTZXRQYWdlJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnNldE5leHRBbmRQcmV2aW91c0xpbmtzID0gYmluZCQodGhpcywgJ3NldE5leHRBbmRQcmV2aW91c0xpbmtzJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnByZXZpb3VzUGFnZSA9IGJpbmQkKHRoaXMsICdwcmV2aW91c1BhZ2UnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMubmV4dFBhZ2UgPSBiaW5kJCh0aGlzLCAnbmV4dFBhZ2UnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMuc2V0UGFnZSA9IGJpbmQkKHRoaXMsICdzZXRQYWdlJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnVybEZvclBhZ2UgPSBiaW5kJCh0aGlzLCAndXJsRm9yUGFnZScsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5sYXN0ID0gb3B0aW9ucy5sYXN0O1xuICAgIHRoaXMuY3VycmVudCA9IHBhcnNlSW50KG9wdGlvbnMuY3VycmVudCkgfHwgMTtcbiAgICB0aGlzLmZvcnVtSWQgPSBvcHRpb25zLmZvcnVtSWQ7XG4gICAgdGhpcy4kZWwgPSAkKHRoaXMuaWQpO1xuICAgIHRoaXMuaW5pdCgpO1xuICAgIHRoaXMuJGVsLmNsaWNrKHRoaXMub25DbGlja1NldFBhZ2UpO1xuICAgIHRoaXMuJGVsLmZpbmQoJy5jdXJyZW50JykuZHJhZ2dhYmxlKHtcbiAgICAgIGF4aXM6ICd5JyxcbiAgICAgIGNvbnRhaW5tZW50OiAncGFyZW50JyxcbiAgICAgIGdyaWQ6IFswLCB0aGlzLmluZGljYXRvckhlaWdodF0sXG4gICAgICBkcmFnOiBmdW5jdGlvbihldiwgdWkpe1xuICAgICAgICB2YXIgcGFnZTtcbiAgICAgICAgcmV0dXJuIHBhZ2UgPSBwYWdlRnJvbUNsaWNrSGVpZ2h0KHVpLnBvc2l0aW9uLnRvcCArIE1hdGguZmxvb3IodGhpcyQuaW5kaWNhdG9ySGVpZ2h0IC8gMiksIHRoaXMkLmluZGljYXRvckhlaWdodCk7XG4gICAgICB9LFxuICAgICAgc3RvcDogZnVuY3Rpb24oZXYsIHVpKXtcbiAgICAgICAgdmFyIHBhZ2U7XG4gICAgICAgIHBhZ2UgPSBwYWdlRnJvbUNsaWNrSGVpZ2h0KHVpLnBvc2l0aW9uLnRvcCArIE1hdGguZmxvb3IodGhpcyQuaW5kaWNhdG9ySGVpZ2h0IC8gMiksIHRoaXMkLmluZGljYXRvckhlaWdodCk7XG4gICAgICAgIHJldHVybiB0aGlzJC5zZXRQYWdlKHBhZ2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuJGVsLmZpbmQoJ2EucHJldmlvdXMnKS5jbGljayhmdW5jdGlvbihldil7XG4gICAgICB0aGlzJC5wcmV2aW91c1BhZ2UoKTtcbiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgdGhpcy4kZWwuZmluZCgnYS5uZXh0JykuY2xpY2soZnVuY3Rpb24oZXYpe1xuICAgICAgdGhpcyQubmV4dFBhZ2UoKTtcbiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgJCh3aW5kb3cpLnJlc2l6ZSh0aGlzLm9uUmVzaXplUmVJbml0KTtcbiAgfVxuICBwcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCl7XG4gICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdwYWdpbmF0b3InLCB0aGlzLmxhc3QgPiAxKTtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuJGVsLmhlaWdodCgpO1xuICAgIHRoaXMuaW5kaWNhdG9ySGVpZ2h0ID0gaW5kaWNhdG9ySGVpZ2h0KHRoaXMubGFzdCwgdGhpcy5oZWlnaHQpO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZmluZCgnLmN1cnJlbnQnKS5kcmFnZ2FibGUoJ29wdGlvbicsICdncmlkJywgWzAsIHRoaXMuaW5kaWNhdG9ySGVpZ2h0XSk7XG4gICAgfSBjYXRjaCAoZSQpIHt9XG4gIH07XG4gIHByb3RvdHlwZS51cmxGb3JQYWdlID0gZnVuY3Rpb24obil7XG4gICAgdmFyIGhyZWYsIGJhc2U7XG4gICAgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcbiAgICBiYXNlID0gaHJlZi5yZXBsYWNlKC9cXC9wYWdlXFwvLiokLywgJycpO1xuICAgIGlmIChuID09PSAxKSB7XG4gICAgICByZXR1cm4gYmFzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGJhc2UgKyBcIi9wYWdlL1wiICsgbjtcbiAgICB9XG4gIH07XG4gIHByb3RvdHlwZS5zZXRQYWdlID0gZnVuY3Rpb24obiwgdXNlSGlzdG9yeSl7XG4gICAgdmFyIHQ7XG4gICAgdXNlSGlzdG9yeSA9PSBudWxsICYmICh1c2VIaXN0b3J5ID0gdHJ1ZSk7XG4gICAgdGhpcy5jdXJyZW50ID0gbiA+IHRoaXMubGFzdCA/IHRoaXMubGFzdCA6IG47XG4gICAgdGhpcy4kZWwuZmluZCgnLmN1cnJlbnQnKS5jc3Moe1xuICAgICAgdG9wOiBpbmRpY2F0b3JUb3AodGhpcy5jdXJyZW50LCB0aGlzLmluZGljYXRvckhlaWdodCksXG4gICAgICBoZWlnaHQ6IHRoaXMuaW5kaWNhdG9ySGVpZ2h0XG4gICAgfSk7XG4gICAgaWYgKHVzZUhpc3RvcnkpIHtcbiAgICAgIEhpc3RvcnkucHVzaFN0YXRlKHtcbiAgICAgICAgc3VyZkRhdGE6IHdpbmRvdy5zdXJmRGF0YVxuICAgICAgfSwgJycsIHRoaXMudXJsRm9yUGFnZSh0aGlzLmN1cnJlbnQpKTtcbiAgICB9XG4gICAgdGhpcy5zZXROZXh0QW5kUHJldmlvdXNMaW5rcygpO1xuICAgIHQgPSB0aGlzLiRlbC5maW5kKCcudG9vbHRpcCcpO1xuICAgIHJldHVybiBzaG93VG9vbHRpcCh0LCBcIlBhZ2UgXCIgKyB0aGlzLmN1cnJlbnQpO1xuICB9O1xuICBwcm90b3R5cGUubmV4dFBhZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmICh0aGlzLmN1cnJlbnQgPCB0aGlzLmxhc3QpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFBhZ2UocGFyc2VJbnQodGhpcy5jdXJyZW50KSArIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUucHJldmlvdXNQYWdlID0gZnVuY3Rpb24oKXtcbiAgICBpZiAodGhpcy5jdXJyZW50ID4gMSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0UGFnZSh0aGlzLmN1cnJlbnQgLSAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgcHJvdG90eXBlLnNldE5leHRBbmRQcmV2aW91c0xpbmtzID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLiRlbC5maW5kKCdhLnByZXZpb3VzJykuYXR0cignaHJlZicsIHRoaXMudXJsRm9yUGFnZSh0aGlzLmN1cnJlbnQgLSAxIHx8IDEpKTtcbiAgICB0aGlzLiRlbC5maW5kKCdhLm5leHQnKS5hdHRyKCdocmVmJywgdGhpcy51cmxGb3JQYWdlKE1hdGgubWluKHRoaXMubGFzdCwgcGFyc2VJbnQodGhpcy5jdXJyZW50KSArIDEpKSk7XG4gICAgc3dpdGNoICh0aGlzLmN1cnJlbnQpIHtcbiAgICBjYXNlIDE6XG4gICAgICB0aGlzLiRlbC5maW5kKCdhLnBhZ2UucHJldmlvdXMnKS5oaWRlKCk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZmluZCgnYS5wYWdlLm5leHQnKS5zaG93KCk7XG4gICAgY2FzZSB0aGlzLmxhc3Q6XG4gICAgICB0aGlzLiRlbC5maW5kKCdhLnBhZ2UucHJldmlvdXMnKS5zaG93KCk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZmluZCgnYS5wYWdlLm5leHQnKS5oaWRlKCk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKCdhLnBhZ2UnKS5zaG93KCk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUub25DbGlja1NldFBhZ2UgPSBmdW5jdGlvbihldil7XG4gICAgdmFyIHksIGR5LCBwYWdlO1xuICAgIHdpbmRvdy5ldiA9IGV2O1xuICAgIHkgPSBmdW5jdGlvbihldiwgJGVsKXtcbiAgICAgIHZhciBkeTtcbiAgICAgIGR5ID0gZXYucGFnZVkgLSBwYXJzZUludCgkZWwuY3NzKCdwYWRkaW5nLXRvcCcpKSAtICRlbC5vZmZzZXQoKS50b3A7XG4gICAgICBpZiAoZHkgPCAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSBlbHNlIGlmIChkeSA+ICRlbC5oZWlnaHQoKSkge1xuICAgICAgICByZXR1cm4gJGVsLmhlaWdodCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGR5O1xuICAgICAgfVxuICAgIH07XG4gICAgZHkgPSB5KGV2LCB0aGlzLiRlbCk7XG4gICAgcGFnZSA9IHBhZ2VGcm9tQ2xpY2tIZWlnaHQoZHksIHRoaXMuaW5kaWNhdG9ySGVpZ2h0KTtcbiAgICByZXR1cm4gdGhpcy5zZXRQYWdlKHBhZ2UpO1xuICB9O1xuICBwcm90b3R5cGUub25SZXNpemVSZUluaXQgPSBmdW5jdGlvbihldil7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgcmV0dXJuIHRoaXMuc2V0UGFnZSh0aGlzLmN1cnJlbnQsIGZhbHNlKTtcbiAgfTtcbiAgcmV0dXJuIFBhZ2VyO1xufSgpKTtcblBhZ2VyLmluZGljYXRvckhlaWdodCA9IGluZGljYXRvckhlaWdodDtcblBhZ2VyLmluZGljYXRvclRvcCA9IGluZGljYXRvclRvcDtcblBhZ2VyLnBhZ2VGcm9tQ2xpY2tIZWlnaHQgPSBwYWdlRnJvbUNsaWNrSGVpZ2h0O1xuZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG59IiwiKGZ1bmN0aW9uKGdsb2JhbCl7LyohXG4gKiBMby1EYXNoIDEuMC4wLXJjLjMgPGh0dHA6Ly9sb2Rhc2guY29tPlxuICogKGMpIDIwMTIgSm9obi1EYXZpZCBEYWx0b24gPGh0dHA6Ly9hbGx5b3VjYW5sZWV0LmNvbS8+XG4gKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuNC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZz5cbiAqIChjKSAyMDA5LTIwMTIgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIEluYy5cbiAqIEF2YWlsYWJsZSB1bmRlciBNSVQgbGljZW5zZSA8aHR0cDovL2xvZGFzaC5jb20vbGljZW5zZT5cbiAqL1xuOyhmdW5jdGlvbih3aW5kb3csIHVuZGVmaW5lZCkge1xuXG4gIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZXhwb3J0c2AgKi9cbiAgdmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cztcblxuICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgYW5kIHVzZSBpdCBhcyBgd2luZG93YCAqL1xuICB2YXIgZnJlZUdsb2JhbCA9IHR5cGVvZiBnbG9iYWwgPT0gJ29iamVjdCcgJiYgZ2xvYmFsO1xuICBpZiAoZnJlZUdsb2JhbC5nbG9iYWwgPT09IGZyZWVHbG9iYWwpIHtcbiAgICB3aW5kb3cgPSBmcmVlR2xvYmFsO1xuICB9XG5cbiAgLyoqIFVzZWQgZm9yIGFycmF5IGFuZCBvYmplY3QgbWV0aG9kIHJlZmVyZW5jZXMgKi9cbiAgdmFyIGFycmF5UmVmID0gW10sXG4gICAgICAvLyBhdm9pZCBhIENsb3N1cmUgQ29tcGlsZXIgYnVnIGJ5IGNyZWF0aXZlbHkgY3JlYXRpbmcgYW4gb2JqZWN0XG4gICAgICBvYmplY3RSZWYgPSBuZXcgZnVuY3Rpb24oKXt9O1xuXG4gIC8qKiBVc2VkIHRvIGdlbmVyYXRlIHVuaXF1ZSBJRHMgKi9cbiAgdmFyIGlkQ291bnRlciA9IDA7XG5cbiAgLyoqIFVzZWQgaW50ZXJuYWxseSB0byBpbmRpY2F0ZSB2YXJpb3VzIHRoaW5ncyAqL1xuICB2YXIgaW5kaWNhdG9yT2JqZWN0ID0gb2JqZWN0UmVmO1xuXG4gIC8qKiBVc2VkIGJ5IGBjYWNoZWRDb250YWluc2AgYXMgdGhlIGRlZmF1bHQgc2l6ZSB3aGVuIG9wdGltaXphdGlvbnMgYXJlIGVuYWJsZWQgZm9yIGxhcmdlIGFycmF5cyAqL1xuICB2YXIgbGFyZ2VBcnJheVNpemUgPSAzMDtcblxuICAvKiogVXNlZCB0byByZXN0b3JlIHRoZSBvcmlnaW5hbCBgX2AgcmVmZXJlbmNlIGluIGBub0NvbmZsaWN0YCAqL1xuICB2YXIgb2xkRGFzaCA9IHdpbmRvdy5fO1xuXG4gIC8qKiBVc2VkIHRvIGRldGVjdCB0ZW1wbGF0ZSBkZWxpbWl0ZXIgdmFsdWVzIHRoYXQgcmVxdWlyZSBhIHdpdGgtc3RhdGVtZW50ICovXG4gIHZhciByZUNvbXBsZXhEZWxpbWl0ZXIgPSAvWy0/Kz0hfiolJl48Pnx7KFxcL118XFxbXFxEfFxcYig/OmRlbGV0ZXxpbnxpbnN0YW5jZW9mfG5ld3x0eXBlb2Z8dm9pZClcXGIvO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIEhUTUwgZW50aXRpZXMgKi9cbiAgdmFyIHJlRXNjYXBlZEh0bWwgPSAvJig/OmFtcHxsdHxndHxxdW90fCN4MjcpOy9nO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIGVtcHR5IHN0cmluZyBsaXRlcmFscyBpbiBjb21waWxlZCB0ZW1wbGF0ZSBzb3VyY2UgKi9cbiAgdmFyIHJlRW1wdHlTdHJpbmdMZWFkaW5nID0gL1xcYl9fcCBcXCs9ICcnOy9nLFxuICAgICAgcmVFbXB0eVN0cmluZ01pZGRsZSA9IC9cXGIoX19wIFxcKz0pICcnIFxcKy9nLFxuICAgICAgcmVFbXB0eVN0cmluZ1RyYWlsaW5nID0gLyhfX2VcXCguKj9cXCl8XFxiX190XFwpKSBcXCtcXG4nJzsvZztcblxuICAvKiogVXNlZCB0byBtYXRjaCByZWdleHAgZmxhZ3MgZnJvbSB0aGVpciBjb2VyY2VkIHN0cmluZyB2YWx1ZXMgKi9cbiAgdmFyIHJlRmxhZ3MgPSAvXFx3KiQvO1xuXG4gIC8qKiBVc2VkIHRvIGluc2VydCB0aGUgZGF0YSBvYmplY3QgdmFyaWFibGUgaW50byBjb21waWxlZCB0ZW1wbGF0ZSBzb3VyY2UgKi9cbiAgdmFyIHJlSW5zZXJ0VmFyaWFibGUgPSAvKD86X19lfF9fdCA9IClcXChcXHMqKD8hW1xcZFxcc1wiJ118dGhpc1xcLikvZztcblxuICAvKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlICovXG4gIHZhciByZU5hdGl2ZSA9IFJlZ0V4cCgnXicgK1xuICAgIChvYmplY3RSZWYudmFsdWVPZiArICcnKVxuICAgICAgLnJlcGxhY2UoL1suKis/Xj0hOiR7fSgpfFtcXF1cXC9cXFxcXS9nLCAnXFxcXCQmJylcbiAgICAgIC5yZXBsYWNlKC92YWx1ZU9mfGZvciBbXlxcXV0rL2csICcuKz8nKSArICckJ1xuICApO1xuXG4gIC8qKlxuICAgKiBVc2VkIHRvIG1hdGNoIEVTNiB0ZW1wbGF0ZSBkZWxpbWl0ZXJzXG4gICAqIGh0dHA6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLTcuOC42XG4gICAqL1xuICB2YXIgcmVFc1RlbXBsYXRlID0gL1xcJFxceygoPzooPz1cXFxcPylcXFxcP1tcXHNcXFNdKSo/KX0vZztcblxuICAvKiogVXNlZCB0byBtYXRjaCBcImludGVycG9sYXRlXCIgdGVtcGxhdGUgZGVsaW1pdGVycyAqL1xuICB2YXIgcmVJbnRlcnBvbGF0ZSA9IC88JT0oW1xcc1xcU10rPyklPi9nO1xuXG4gIC8qKiBVc2VkIHRvIGVuc3VyZSBjYXB0dXJpbmcgb3JkZXIgb2YgdGVtcGxhdGUgZGVsaW1pdGVycyAqL1xuICB2YXIgcmVOb01hdGNoID0gLygkXikvO1xuXG4gIC8qKiBVc2VkIHRvIG1hdGNoIEhUTUwgY2hhcmFjdGVycyAqL1xuICB2YXIgcmVVbmVzY2FwZWRIdG1sID0gL1smPD5cIiddL2c7XG5cbiAgLyoqIFVzZWQgdG8gbWF0Y2ggdW5lc2NhcGVkIGNoYXJhY3RlcnMgaW4gY29tcGlsZWQgc3RyaW5nIGxpdGVyYWxzICovXG4gIHZhciByZVVuZXNjYXBlZFN0cmluZyA9IC9bJ1xcblxcclxcdFxcdTIwMjhcXHUyMDI5XFxcXF0vZztcblxuICAvKiogVXNlZCB0byBmaXggdGhlIEpTY3JpcHQgW1tEb250RW51bV1dIGJ1ZyAqL1xuICB2YXIgc2hhZG93ZWQgPSBbXG4gICAgJ2NvbnN0cnVjdG9yJywgJ2hhc093blByb3BlcnR5JywgJ2lzUHJvdG90eXBlT2YnLCAncHJvcGVydHlJc0VudW1lcmFibGUnLFxuICAgICd0b0xvY2FsZVN0cmluZycsICd0b1N0cmluZycsICd2YWx1ZU9mJ1xuICBdO1xuXG4gIC8qKiBVc2VkIHRvIG1ha2UgdGVtcGxhdGUgc291cmNlVVJMcyBlYXNpZXIgdG8gaWRlbnRpZnkgKi9cbiAgdmFyIHRlbXBsYXRlQ291bnRlciA9IDA7XG5cbiAgLyoqIE5hdGl2ZSBtZXRob2Qgc2hvcnRjdXRzICovXG4gIHZhciBjZWlsID0gTWF0aC5jZWlsLFxuICAgICAgY29uY2F0ID0gYXJyYXlSZWYuY29uY2F0LFxuICAgICAgZmxvb3IgPSBNYXRoLmZsb29yLFxuICAgICAgZ2V0UHJvdG90eXBlT2YgPSByZU5hdGl2ZS50ZXN0KGdldFByb3RvdHlwZU9mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKSAmJiBnZXRQcm90b3R5cGVPZixcbiAgICAgIGhhc093blByb3BlcnR5ID0gb2JqZWN0UmVmLmhhc093blByb3BlcnR5LFxuICAgICAgcHVzaCA9IGFycmF5UmVmLnB1c2gsXG4gICAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IG9iamVjdFJlZi5wcm9wZXJ0eUlzRW51bWVyYWJsZSxcbiAgICAgIHRvU3RyaW5nID0gb2JqZWN0UmVmLnRvU3RyaW5nO1xuXG4gIC8qIE5hdGl2ZSBtZXRob2Qgc2hvcnRjdXRzIGZvciBtZXRob2RzIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzICovXG4gIHZhciBuYXRpdmVCaW5kID0gcmVOYXRpdmUudGVzdChuYXRpdmVCaW5kID0gc2xpY2UuYmluZCkgJiYgbmF0aXZlQmluZCxcbiAgICAgIG5hdGl2ZUlzQXJyYXkgPSByZU5hdGl2ZS50ZXN0KG5hdGl2ZUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KSAmJiBuYXRpdmVJc0FycmF5LFxuICAgICAgbmF0aXZlSXNGaW5pdGUgPSB3aW5kb3cuaXNGaW5pdGUsXG4gICAgICBuYXRpdmVJc05hTiA9IHdpbmRvdy5pc05hTixcbiAgICAgIG5hdGl2ZUtleXMgPSByZU5hdGl2ZS50ZXN0KG5hdGl2ZUtleXMgPSBPYmplY3Qua2V5cykgJiYgbmF0aXZlS2V5cyxcbiAgICAgIG5hdGl2ZU1heCA9IE1hdGgubWF4LFxuICAgICAgbmF0aXZlTWluID0gTWF0aC5taW4sXG4gICAgICBuYXRpdmVSYW5kb20gPSBNYXRoLnJhbmRvbTtcblxuICAvKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHNob3J0Y3V0cyAqL1xuICB2YXIgYXJnc0NsYXNzID0gJ1tvYmplY3QgQXJndW1lbnRzXScsXG4gICAgICBhcnJheUNsYXNzID0gJ1tvYmplY3QgQXJyYXldJyxcbiAgICAgIGJvb2xDbGFzcyA9ICdbb2JqZWN0IEJvb2xlYW5dJyxcbiAgICAgIGRhdGVDbGFzcyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICAgIGZ1bmNDbGFzcyA9ICdbb2JqZWN0IEZ1bmN0aW9uXScsXG4gICAgICBudW1iZXJDbGFzcyA9ICdbb2JqZWN0IE51bWJlcl0nLFxuICAgICAgb2JqZWN0Q2xhc3MgPSAnW29iamVjdCBPYmplY3RdJyxcbiAgICAgIHJlZ2V4cENsYXNzID0gJ1tvYmplY3QgUmVnRXhwXScsXG4gICAgICBzdHJpbmdDbGFzcyA9ICdbb2JqZWN0IFN0cmluZ10nO1xuXG4gIC8qKiBEZXRlY3QgdmFyaW91cyBlbnZpcm9ubWVudHMgKi9cbiAgdmFyIGlzSWVPcGVyYSA9ICEhd2luZG93LmF0dGFjaEV2ZW50LFxuICAgICAgaXNWOCA9IG5hdGl2ZUJpbmQgJiYgIS9cXG58dHJ1ZS8udGVzdChuYXRpdmVCaW5kICsgaXNJZU9wZXJhKTtcblxuICAvKiBEZXRlY3QgaWYgYEZ1bmN0aW9uI2JpbmRgIGV4aXN0cyBhbmQgaXMgaW5mZXJyZWQgdG8gYmUgZmFzdCAoYWxsIGJ1dCBWOCkgKi9cbiAgdmFyIGlzQmluZEZhc3QgPSBuYXRpdmVCaW5kICYmICFpc1Y4O1xuXG4gIC8qIERldGVjdCBpZiBgT2JqZWN0LmtleXNgIGV4aXN0cyBhbmQgaXMgaW5mZXJyZWQgdG8gYmUgZmFzdCAoSUUsIE9wZXJhLCBWOCkgKi9cbiAgdmFyIGlzS2V5c0Zhc3QgPSBuYXRpdmVLZXlzICYmIChpc0llT3BlcmEgfHwgaXNWOCk7XG5cbiAgLyoqXG4gICAqIERldGVjdCB0aGUgSlNjcmlwdCBbW0RvbnRFbnVtXV0gYnVnOlxuICAgKlxuICAgKiBJbiBJRSA8IDkgYW4gb2JqZWN0cyBvd24gcHJvcGVydGllcywgc2hhZG93aW5nIG5vbi1lbnVtZXJhYmxlIG9uZXMsIGFyZVxuICAgKiBtYWRlIG5vbi1lbnVtZXJhYmxlIGFzIHdlbGwuXG4gICAqL1xuICB2YXIgaGFzRG9udEVudW1CdWc7XG5cbiAgLyoqIERldGVjdCBpZiBvd24gcHJvcGVydGllcyBhcmUgaXRlcmF0ZWQgYWZ0ZXIgaW5oZXJpdGVkIHByb3BlcnRpZXMgKElFIDwgOSkgKi9cbiAgdmFyIGl0ZXJhdGVzT3duTGFzdDtcblxuICAvKipcbiAgICogRGV0ZWN0IGlmIGBBcnJheSNzaGlmdGAgYW5kIGBBcnJheSNzcGxpY2VgIGF1Z21lbnQgYXJyYXktbGlrZSBvYmplY3RzXG4gICAqIGluY29ycmVjdGx5OlxuICAgKlxuICAgKiBGaXJlZm94IDwgMTAsIElFIGNvbXBhdGliaWxpdHkgbW9kZSwgYW5kIElFIDwgOSBoYXZlIGJ1Z2d5IEFycmF5IGBzaGlmdCgpYFxuICAgKiBhbmQgYHNwbGljZSgpYCBmdW5jdGlvbnMgdGhhdCBmYWlsIHRvIHJlbW92ZSB0aGUgbGFzdCBlbGVtZW50LCBgdmFsdWVbMF1gLFxuICAgKiBvZiBhcnJheS1saWtlIG9iamVjdHMgZXZlbiB0aG91Z2ggdGhlIGBsZW5ndGhgIHByb3BlcnR5IGlzIHNldCB0byBgMGAuXG4gICAqIFRoZSBgc2hpZnQoKWAgbWV0aG9kIGlzIGJ1Z2d5IGluIElFIDggY29tcGF0aWJpbGl0eSBtb2RlLCB3aGlsZSBgc3BsaWNlKClgXG4gICAqIGlzIGJ1Z2d5IHJlZ2FyZGxlc3Mgb2YgbW9kZSBpbiBJRSA8IDkgYW5kIGJ1Z2d5IGluIGNvbXBhdGliaWxpdHkgbW9kZSBpbiBJRSA5LlxuICAgKi9cbiAgdmFyIGhhc09iamVjdFNwbGljZUJ1ZyA9IChoYXNPYmplY3RTcGxpY2VCdWcgPSB7ICcwJzogMSwgJ2xlbmd0aCc6IDEgfSxcbiAgICBhcnJheVJlZi5zcGxpY2UuY2FsbChoYXNPYmplY3RTcGxpY2VCdWcsIDAsIDEpLCBoYXNPYmplY3RTcGxpY2VCdWdbMF0pO1xuXG4gIC8qKiBEZXRlY3QgaWYgYW4gYGFyZ3VtZW50c2Agb2JqZWN0J3MgaW5kZXhlcyBhcmUgbm9uLWVudW1lcmFibGUgKElFIDwgOSkgKi9cbiAgdmFyIG5vbkVudW1BcmdzID0gdHJ1ZTtcblxuICAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHByb3BzID0gW107XG4gICAgZnVuY3Rpb24gY3RvcigpIHsgdGhpcy54ID0gMTsgfVxuICAgIGN0b3IucHJvdG90eXBlID0geyAndmFsdWVPZic6IDEsICd5JzogMSB9O1xuICAgIGZvciAodmFyIHByb3AgaW4gbmV3IGN0b3IpIHsgcHJvcHMucHVzaChwcm9wKTsgfVxuICAgIGZvciAocHJvcCBpbiBhcmd1bWVudHMpIHsgbm9uRW51bUFyZ3MgPSAhcHJvcDsgfVxuXG4gICAgaGFzRG9udEVudW1CdWcgPSAhL3ZhbHVlT2YvLnRlc3QocHJvcHMpO1xuICAgIGl0ZXJhdGVzT3duTGFzdCA9IHByb3BzWzBdICE9ICd4JztcbiAgfSgxKSk7XG5cbiAgLyoqIERldGVjdCBpZiBgYXJndW1lbnRzYCBvYmplY3RzIGFyZSBgT2JqZWN0YCBvYmplY3RzIChhbGwgYnV0IE9wZXJhIDwgMTAuNSkgKi9cbiAgdmFyIGFyZ3NBcmVPYmplY3RzID0gYXJndW1lbnRzLmNvbnN0cnVjdG9yID09IE9iamVjdDtcblxuICAvKiogRGV0ZWN0IGlmIGBhcmd1bWVudHNgIG9iamVjdHMgW1tDbGFzc11dIGlzIHVucmVzb2x2YWJsZSAoRmlyZWZveCA8IDQsIElFIDwgOSkgKi9cbiAgdmFyIG5vQXJnc0NsYXNzID0gIWlzQXJndW1lbnRzKGFyZ3VtZW50cyk7XG5cbiAgLyoqXG4gICAqIERldGVjdCBsYWNrIG9mIHN1cHBvcnQgZm9yIGFjY2Vzc2luZyBzdHJpbmcgY2hhcmFjdGVycyBieSBpbmRleDpcbiAgICpcbiAgICogSUUgPCA4IGNhbid0IGFjY2VzcyBjaGFyYWN0ZXJzIGJ5IGluZGV4IGFuZCBJRSA4IGNhbiBvbmx5IGFjY2Vzc1xuICAgKiBjaGFyYWN0ZXJzIGJ5IGluZGV4IG9uIHN0cmluZyBsaXRlcmFscy5cbiAgICovXG4gIHZhciBub0NoYXJCeUluZGV4ID0gKCd4J1swXSArIE9iamVjdCgneCcpWzBdKSAhPSAneHgnO1xuXG4gIC8qKlxuICAgKiBEZXRlY3QgaWYgYSBub2RlJ3MgW1tDbGFzc11dIGlzIHVucmVzb2x2YWJsZSAoSUUgPCA5KVxuICAgKiBhbmQgdGhhdCB0aGUgSlMgZW5naW5lIHdvbid0IGVycm9yIHdoZW4gYXR0ZW1wdGluZyB0byBjb2VyY2UgYW4gb2JqZWN0IHRvXG4gICAqIGEgc3RyaW5nIHdpdGhvdXQgYSBgdG9TdHJpbmdgIHByb3BlcnR5IHZhbHVlIG9mIGB0eXBlb2ZgIFwiZnVuY3Rpb25cIi5cbiAgICovXG4gIHRyeSB7XG4gICAgdmFyIG5vTm9kZUNsYXNzID0gKHsgJ3RvU3RyaW5nJzogMCB9ICsgJycsIHRvU3RyaW5nLmNhbGwoZG9jdW1lbnQpID09IG9iamVjdENsYXNzKTtcbiAgfSBjYXRjaChlKSB7IH1cblxuICAvKipcbiAgICogRGV0ZWN0IGlmIHNvdXJjZVVSTCBzeW50YXggaXMgdXNhYmxlIHdpdGhvdXQgZXJyb3Jpbmc6XG4gICAqXG4gICAqIFRoZSBKUyBlbmdpbmUgZW1iZWRkZWQgaW4gQWRvYmUgcHJvZHVjdHMgd2lsbCB0aHJvdyBhIHN5bnRheCBlcnJvciB3aGVuXG4gICAqIGl0IGVuY291bnRlcnMgYSBzaW5nbGUgbGluZSBjb21tZW50IGJlZ2lubmluZyB3aXRoIHRoZSBgQGAgc3ltYm9sLlxuICAgKlxuICAgKiBUaGUgSlMgZW5naW5lIGluIE5hcndoYWwgd2lsbCBnZW5lcmF0ZSB0aGUgZnVuY3Rpb24gYGZ1bmN0aW9uIGFub255bW91cygpey8vfWBcbiAgICogYW5kIHRocm93IGEgc3ludGF4IGVycm9yLlxuICAgKlxuICAgKiBBdm9pZCBjb21tZW50cyBiZWdpbm5pbmcgYEBgIHN5bWJvbHMgaW4gSUUgYmVjYXVzZSB0aGV5IGFyZSBwYXJ0IG9mIGl0c1xuICAgKiBub24tc3RhbmRhcmQgY29uZGl0aW9uYWwgY29tcGlsYXRpb24gc3VwcG9ydC5cbiAgICogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5LzEyMWh6dGszKHY9dnMuOTQpLmFzcHhcbiAgICovXG4gIHRyeSB7XG4gICAgdmFyIHVzZVNvdXJjZVVSTCA9IChGdW5jdGlvbignLy9AJykoKSwgIWlzSWVPcGVyYSk7XG4gIH0gY2F0Y2goZSkgeyB9XG5cbiAgLyoqIFVzZWQgdG8gaWRlbnRpZnkgb2JqZWN0IGNsYXNzaWZpY2F0aW9ucyB0aGF0IGBfLmNsb25lYCBzdXBwb3J0cyAqL1xuICB2YXIgY2xvbmVhYmxlQ2xhc3NlcyA9IHt9O1xuICBjbG9uZWFibGVDbGFzc2VzW2Z1bmNDbGFzc10gPSBmYWxzZTtcbiAgY2xvbmVhYmxlQ2xhc3Nlc1thcmdzQ2xhc3NdID0gY2xvbmVhYmxlQ2xhc3Nlc1thcnJheUNsYXNzXSA9XG4gIGNsb25lYWJsZUNsYXNzZXNbYm9vbENsYXNzXSA9IGNsb25lYWJsZUNsYXNzZXNbZGF0ZUNsYXNzXSA9XG4gIGNsb25lYWJsZUNsYXNzZXNbbnVtYmVyQ2xhc3NdID0gY2xvbmVhYmxlQ2xhc3Nlc1tvYmplY3RDbGFzc10gPVxuICBjbG9uZWFibGVDbGFzc2VzW3JlZ2V4cENsYXNzXSA9IGNsb25lYWJsZUNsYXNzZXNbc3RyaW5nQ2xhc3NdID0gdHJ1ZTtcblxuICAvKiogVXNlZCB0byBsb29rdXAgYSBidWlsdC1pbiBjb25zdHJ1Y3RvciBieSBbW0NsYXNzXV0gKi9cbiAgdmFyIGN0b3JCeUNsYXNzID0ge307XG4gIGN0b3JCeUNsYXNzW2FycmF5Q2xhc3NdID0gQXJyYXk7XG4gIGN0b3JCeUNsYXNzW2Jvb2xDbGFzc10gPSBCb29sZWFuO1xuICBjdG9yQnlDbGFzc1tkYXRlQ2xhc3NdID0gRGF0ZTtcbiAgY3RvckJ5Q2xhc3Nbb2JqZWN0Q2xhc3NdID0gT2JqZWN0O1xuICBjdG9yQnlDbGFzc1tudW1iZXJDbGFzc10gPSBOdW1iZXI7XG4gIGN0b3JCeUNsYXNzW3JlZ2V4cENsYXNzXSA9IFJlZ0V4cDtcbiAgY3RvckJ5Q2xhc3Nbc3RyaW5nQ2xhc3NdID0gU3RyaW5nO1xuXG4gIC8qKiBVc2VkIHRvIGRldGVybWluZSBpZiB2YWx1ZXMgYXJlIG9mIHRoZSBsYW5ndWFnZSB0eXBlIE9iamVjdCAqL1xuICB2YXIgb2JqZWN0VHlwZXMgPSB7XG4gICAgJ2Jvb2xlYW4nOiBmYWxzZSxcbiAgICAnZnVuY3Rpb24nOiB0cnVlLFxuICAgICdvYmplY3QnOiB0cnVlLFxuICAgICdudW1iZXInOiBmYWxzZSxcbiAgICAnc3RyaW5nJzogZmFsc2UsXG4gICAgJ3VuZGVmaW5lZCc6IGZhbHNlXG4gIH07XG5cbiAgLyoqIFVzZWQgdG8gZXNjYXBlIGNoYXJhY3RlcnMgZm9yIGluY2x1c2lvbiBpbiBjb21waWxlZCBzdHJpbmcgbGl0ZXJhbHMgKi9cbiAgdmFyIHN0cmluZ0VzY2FwZXMgPSB7XG4gICAgJ1xcXFwnOiAnXFxcXCcsXG4gICAgXCInXCI6IFwiJ1wiLFxuICAgICdcXG4nOiAnbicsXG4gICAgJ1xccic6ICdyJyxcbiAgICAnXFx0JzogJ3QnLFxuICAgICdcXHUyMDI4JzogJ3UyMDI4JyxcbiAgICAnXFx1MjAyOSc6ICd1MjAyOSdcbiAgfTtcblxuICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGBsb2Rhc2hgIG9iamVjdCwgdGhhdCB3cmFwcyB0aGUgZ2l2ZW4gYHZhbHVlYCwgdG8gZW5hYmxlXG4gICAqIG1ldGhvZCBjaGFpbmluZy5cbiAgICpcbiAgICogVGhlIGNoYWluYWJsZSB3cmFwcGVyIGZ1bmN0aW9ucyBhcmU6XG4gICAqIGBhZnRlcmAsIGBhc3NpZ25gLCBgYmluZGAsIGBiaW5kQWxsYCwgYGJpbmRLZXlgLCBgY2hhaW5gLCBgY29tcGFjdGAsIGBjb21wb3NlYCxcbiAgICogYGNvbmNhdGAsIGBjb3VudEJ5YCwgYGRlYm91bmNlYCwgYGRlZmF1bHRzYCwgYGRlZmVyYCwgYGRlbGF5YCwgYGRpZmZlcmVuY2VgLFxuICAgKiBgZmlsdGVyYCwgYGZsYXR0ZW5gLCBgZm9yRWFjaGAsIGBmb3JJbmAsIGBmb3JPd25gLCBgZnVuY3Rpb25zYCwgYGdyb3VwQnlgLFxuICAgKiBgaW5pdGlhbGAsIGBpbnRlcnNlY3Rpb25gLCBgaW52ZXJ0YCwgYGludm9rZWAsIGBrZXlzYCwgYG1hcGAsIGBtYXhgLCBgbWVtb2l6ZWAsXG4gICAqIGBtZXJnZWAsIGBtaW5gLCBgb2JqZWN0YCwgYG9taXRgLCBgb25jZWAsIGBwYWlyc2AsIGBwYXJ0aWFsYCwgYHBpY2tgLCBgcGx1Y2tgLFxuICAgKiBgcHVzaGAsIGByYW5nZWAsIGByZWplY3RgLCBgcmVzdGAsIGByZXZlcnNlYCwgYHNodWZmbGVgLCBgc2xpY2VgLCBgc29ydGAsXG4gICAqIGBzb3J0QnlgLCBgc3BsaWNlYCwgYHRhcGAsIGB0aHJvdHRsZWAsIGB0aW1lc2AsIGB0b0FycmF5YCwgYHVuaW9uYCwgYHVuaXFgLFxuICAgKiBgdW5zaGlmdGAsIGB2YWx1ZXNgLCBgd2hlcmVgLCBgd2l0aG91dGAsIGB3cmFwYCwgYW5kIGB6aXBgXG4gICAqXG4gICAqIFRoZSBub24tY2hhaW5hYmxlIHdyYXBwZXIgZnVuY3Rpb25zIGFyZTpcbiAgICogYGNsb25lYCwgYGNsb25lRGVlcGAsIGBjb250YWluc2AsIGBlc2NhcGVgLCBgZXZlcnlgLCBgZmluZGAsIGBoYXNgLCBgaWRlbnRpdHlgLFxuICAgKiBgaW5kZXhPZmAsIGBpc0FyZ3VtZW50c2AsIGBpc0FycmF5YCwgYGlzQm9vbGVhbmAsIGBpc0RhdGVgLCBgaXNFbGVtZW50YCwgYGlzRW1wdHlgLFxuICAgKiBgaXNFcXVhbGAsIGBpc0Zpbml0ZWAsIGBpc0Z1bmN0aW9uYCwgYGlzTmFOYCwgYGlzTnVsbGAsIGBpc051bWJlcmAsIGBpc09iamVjdGAsXG4gICAqIGBpc1BsYWluT2JqZWN0YCwgYGlzUmVnRXhwYCwgYGlzU3RyaW5nYCwgYGlzVW5kZWZpbmVkYCwgYGpvaW5gLCBgbGFzdEluZGV4T2ZgLFxuICAgKiBgbWl4aW5gLCBgbm9Db25mbGljdGAsIGBwb3BgLCBgcmFuZG9tYCwgYHJlZHVjZWAsIGByZWR1Y2VSaWdodGAsIGByZXN1bHRgLFxuICAgKiBgc2hpZnRgLCBgc2l6ZWAsIGBzb21lYCwgYHNvcnRlZEluZGV4YCwgYHRlbXBsYXRlYCwgYHVuZXNjYXBlYCwgYW5kIGB1bmlxdWVJZGBcbiAgICpcbiAgICogVGhlIHdyYXBwZXIgZnVuY3Rpb25zIGBmaXJzdGAgYW5kIGBsYXN0YCByZXR1cm4gd3JhcHBlZCB2YWx1ZXMgd2hlbiBgbmAgaXNcbiAgICogcGFzc2VkLCBvdGhlcndpc2UgdGhleSByZXR1cm4gdW53cmFwcGVkIHZhbHVlcy5cbiAgICpcbiAgICogQG5hbWUgX1xuICAgKiBAY29uc3RydWN0b3JcbiAgICogQGNhdGVnb3J5IENoYWluaW5nXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwIGluIGEgYGxvZGFzaGAgaW5zdGFuY2UuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYSBgbG9kYXNoYCBpbnN0YW5jZS5cbiAgICovXG4gIGZ1bmN0aW9uIGxvZGFzaCh2YWx1ZSkge1xuICAgIC8vIGV4aXQgZWFybHkgaWYgYWxyZWFkeSB3cmFwcGVkLCBldmVuIGlmIHdyYXBwZWQgYnkgYSBkaWZmZXJlbnQgYGxvZGFzaGAgY29uc3RydWN0b3JcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnICYmIHZhbHVlLl9fd3JhcHBlZF9fKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIC8vIGFsbG93IGludm9raW5nIGBsb2Rhc2hgIHdpdGhvdXQgdGhlIGBuZXdgIG9wZXJhdG9yXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGxvZGFzaCkpIHtcbiAgICAgIHJldHVybiBuZXcgbG9kYXNoKHZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5fX3dyYXBwZWRfXyA9IHZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzIHVzZWQgYnkgTG8tRGFzaCBhcmUgc2ltaWxhciB0byB0aG9zZSBpblxuICAgKiBlbWJlZGRlZCBSdWJ5IChFUkIpLiBDaGFuZ2UgdGhlIGZvbGxvd2luZyB0ZW1wbGF0ZSBzZXR0aW5ncyB0byB1c2UgYWx0ZXJuYXRpdmVcbiAgICogZGVsaW1pdGVycy5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAdHlwZSBPYmplY3RcbiAgICovXG4gIGxvZGFzaC50ZW1wbGF0ZVNldHRpbmdzID0ge1xuXG4gICAgLyoqXG4gICAgICogVXNlZCB0byBkZXRlY3QgYGRhdGFgIHByb3BlcnR5IHZhbHVlcyB0byBiZSBIVE1MLWVzY2FwZWQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5nc1xuICAgICAqIEB0eXBlIFJlZ0V4cFxuICAgICAqL1xuICAgICdlc2NhcGUnOiAvPCUtKFtcXHNcXFNdKz8pJT4vZyxcblxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZGV0ZWN0IGNvZGUgdG8gYmUgZXZhbHVhdGVkLlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBtZW1iZXJPZiBfLnRlbXBsYXRlU2V0dGluZ3NcbiAgICAgKiBAdHlwZSBSZWdFeHBcbiAgICAgKi9cbiAgICAnZXZhbHVhdGUnOiAvPCUoW1xcc1xcU10rPyklPi9nLFxuXG4gICAgLyoqXG4gICAgICogVXNlZCB0byBkZXRlY3QgYGRhdGFgIHByb3BlcnR5IHZhbHVlcyB0byBpbmplY3QuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5nc1xuICAgICAqIEB0eXBlIFJlZ0V4cFxuICAgICAqL1xuICAgICdpbnRlcnBvbGF0ZSc6IHJlSW50ZXJwb2xhdGUsXG5cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIHJlZmVyZW5jZSB0aGUgZGF0YSBvYmplY3QgaW4gdGhlIHRlbXBsYXRlIHRleHQuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQG1lbWJlck9mIF8udGVtcGxhdGVTZXR0aW5nc1xuICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAqL1xuICAgICd2YXJpYWJsZSc6ICcnXG4gIH07XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLyoqXG4gICAqIFRoZSB0ZW1wbGF0ZSB1c2VkIHRvIGNyZWF0ZSBpdGVyYXRvciBmdW5jdGlvbnMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JlY3R9IGRhdGEgVGhlIGRhdGEgb2JqZWN0IHVzZWQgdG8gcG9wdWxhdGUgdGhlIHRleHQuXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IFJldHVybnMgdGhlIGludGVycG9sYXRlZCB0ZXh0LlxuICAgKi9cbiAgdmFyIGl0ZXJhdG9yVGVtcGxhdGUgPSB0ZW1wbGF0ZShcbiAgICAvLyBjb25kaXRpb25hbCBzdHJpY3QgbW9kZVxuICAgIFwiPCUgaWYgKG9iai51c2VTdHJpY3QpIHsgJT4ndXNlIHN0cmljdCc7XFxuPCUgfSAlPlwiICtcblxuICAgIC8vIHRoZSBgaXRlcmF0ZWVgIG1heSBiZSByZWFzc2lnbmVkIGJ5IHRoZSBgdG9wYCBzbmlwcGV0XG4gICAgJ3ZhciBpbmRleCwgaXRlcmF0ZWUgPSA8JT0gZmlyc3RBcmcgJT4sICcgK1xuICAgIC8vIGFzc2lnbiB0aGUgYHJlc3VsdGAgdmFyaWFibGUgYW4gaW5pdGlhbCB2YWx1ZVxuICAgICdyZXN1bHQgPSA8JT0gZmlyc3RBcmcgJT47XFxuJyArXG4gICAgLy8gZXhpdCBlYXJseSBpZiB0aGUgZmlyc3QgYXJndW1lbnQgaXMgZmFsc2V5XG4gICAgJ2lmICghPCU9IGZpcnN0QXJnICU+KSByZXR1cm4gcmVzdWx0O1xcbicgK1xuICAgIC8vIGFkZCBjb2RlIGJlZm9yZSB0aGUgaXRlcmF0aW9uIGJyYW5jaGVzXG4gICAgJzwlPSB0b3AgJT47XFxuJyArXG5cbiAgICAvLyBhcnJheS1saWtlIGl0ZXJhdGlvbjpcbiAgICAnPCUgaWYgKGFycmF5TG9vcCkgeyAlPicgK1xuICAgICd2YXIgbGVuZ3RoID0gaXRlcmF0ZWUubGVuZ3RoOyBpbmRleCA9IC0xO1xcbicgK1xuICAgIFwiaWYgKHR5cGVvZiBsZW5ndGggPT0gJ251bWJlcicpIHtcIiArXG5cbiAgICAvLyBhZGQgc3VwcG9ydCBmb3IgYWNjZXNzaW5nIHN0cmluZyBjaGFyYWN0ZXJzIGJ5IGluZGV4IGlmIG5lZWRlZFxuICAgICcgIDwlIGlmIChub0NoYXJCeUluZGV4KSB7ICU+XFxuJyArXG4gICAgJyAgaWYgKGlzU3RyaW5nKGl0ZXJhdGVlKSkge1xcbicgK1xuICAgIFwiICAgIGl0ZXJhdGVlID0gaXRlcmF0ZWUuc3BsaXQoJycpXFxuXCIgK1xuICAgICcgIH0nICtcbiAgICAnICA8JSB9ICU+XFxuJyArXG5cbiAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIGFycmF5LWxpa2UgdmFsdWVcbiAgICAnICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xcbicgK1xuICAgICcgICAgPCU9IGFycmF5TG9vcCAlPlxcbicgK1xuICAgICcgIH1cXG4nICtcbiAgICAnfVxcbicgK1xuICAgICdlbHNlIHsnICtcblxuICAgIC8vIG9iamVjdCBpdGVyYXRpb246XG4gICAgLy8gYWRkIHN1cHBvcnQgZm9yIGl0ZXJhdGluZyBvdmVyIGBhcmd1bWVudHNgIG9iamVjdHMgaWYgbmVlZGVkXG4gICAgJyAgPCUgIH0gZWxzZSBpZiAobm9uRW51bUFyZ3MpIHsgJT5cXG4nICtcbiAgICAnICB2YXIgbGVuZ3RoID0gaXRlcmF0ZWUubGVuZ3RoOyBpbmRleCA9IC0xO1xcbicgK1xuICAgICcgIGlmIChsZW5ndGggJiYgaXNBcmd1bWVudHMoaXRlcmF0ZWUpKSB7XFxuJyArXG4gICAgJyAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xcbicgK1xuICAgIFwiICAgICAgaW5kZXggKz0gJyc7XFxuXCIgK1xuICAgICcgICAgICA8JT0gb2JqZWN0TG9vcCAlPlxcbicgK1xuICAgICcgICAgfVxcbicgK1xuICAgICcgIH0gZWxzZSB7JyArXG4gICAgJyAgPCUgfSAlPicgK1xuXG4gICAgLy8gRmlyZWZveCA8IDMuNiwgT3BlcmEgPiA5LjUwIC0gT3BlcmEgPCAxMS42MCwgYW5kIFNhZmFyaSA8IDUuMVxuICAgIC8vIChpZiB0aGUgcHJvdG90eXBlIG9yIGEgcHJvcGVydHkgb24gdGhlIHByb3RvdHlwZSBoYXMgYmVlbiBzZXQpXG4gICAgLy8gaW5jb3JyZWN0bHkgc2V0cyBhIGZ1bmN0aW9uJ3MgYHByb3RvdHlwZWAgcHJvcGVydHkgW1tFbnVtZXJhYmxlXV1cbiAgICAvLyB2YWx1ZSB0byBgdHJ1ZWAuIEJlY2F1c2Ugb2YgdGhpcyBMby1EYXNoIHN0YW5kYXJkaXplcyBvbiBza2lwcGluZ1xuICAgIC8vIHRoZSB0aGUgYHByb3RvdHlwZWAgcHJvcGVydHkgb2YgZnVuY3Rpb25zIHJlZ2FyZGxlc3Mgb2YgaXRzXG4gICAgLy8gW1tFbnVtZXJhYmxlXV0gdmFsdWUuXG4gICAgJyAgPCUgaWYgKCFoYXNEb250RW51bUJ1ZykgeyAlPlxcbicgK1xuICAgIFwiICB2YXIgc2tpcFByb3RvID0gdHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicgJiYgXFxuXCIgK1xuICAgIFwiICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoaXRlcmF0ZWUsICdwcm90b3R5cGUnKTtcXG5cIiArXG4gICAgJyAgPCUgfSAlPicgK1xuXG4gICAgLy8gaXRlcmF0ZSBvd24gcHJvcGVydGllcyB1c2luZyBgT2JqZWN0LmtleXNgIGlmIGl0J3MgZmFzdFxuICAgICcgIDwlIGlmIChpc0tleXNGYXN0ICYmIHVzZUhhcykgeyAlPlxcbicgK1xuICAgICcgIHZhciBvd25JbmRleCA9IC0xLFxcbicgK1xuICAgICcgICAgICBvd25Qcm9wcyA9IG9iamVjdFR5cGVzW3R5cGVvZiBpdGVyYXRlZV0gPyBuYXRpdmVLZXlzKGl0ZXJhdGVlKSA6IFtdLFxcbicgK1xuICAgICcgICAgICBsZW5ndGggPSBvd25Qcm9wcy5sZW5ndGg7XFxuXFxuJyArXG4gICAgJyAgd2hpbGUgKCsrb3duSW5kZXggPCBsZW5ndGgpIHtcXG4nICtcbiAgICAnICAgIGluZGV4ID0gb3duUHJvcHNbb3duSW5kZXhdO1xcbicgK1xuICAgIFwiICAgIDwlIGlmICghaGFzRG9udEVudW1CdWcpIHsgJT5pZiAoIShza2lwUHJvdG8gJiYgaW5kZXggPT0gJ3Byb3RvdHlwZScpKSB7XFxuICA8JSB9ICU+XCIgK1xuICAgICcgICAgPCU9IG9iamVjdExvb3AgJT5cXG4nICtcbiAgICAnICAgIDwlIGlmICghaGFzRG9udEVudW1CdWcpIHsgJT59XFxuPCUgfSAlPicgK1xuICAgICcgIH0nICtcblxuICAgIC8vIGVsc2UgdXNpbmcgYSBmb3ItaW4gbG9vcFxuICAgICcgIDwlIH0gZWxzZSB7ICU+XFxuJyArXG4gICAgJyAgZm9yIChpbmRleCBpbiBpdGVyYXRlZSkgezwlJyArXG4gICAgJyAgICBpZiAoIWhhc0RvbnRFbnVtQnVnIHx8IHVzZUhhcykgeyAlPlxcbiAgICBpZiAoPCUnICtcbiAgICBcIiAgICAgIGlmICghaGFzRG9udEVudW1CdWcpIHsgJT4hKHNraXBQcm90byAmJiBpbmRleCA9PSAncHJvdG90eXBlJyk8JSB9XCIgK1xuICAgICcgICAgICBpZiAoIWhhc0RvbnRFbnVtQnVnICYmIHVzZUhhcykgeyAlPiAmJiA8JSB9JyArXG4gICAgJyAgICAgIGlmICh1c2VIYXMpIHsgJT5oYXNPd25Qcm9wZXJ0eS5jYWxsKGl0ZXJhdGVlLCBpbmRleCk8JSB9JyArXG4gICAgJyAgICAlPikgeycgK1xuICAgICcgICAgPCUgfSAlPlxcbicgK1xuICAgICcgICAgPCU9IG9iamVjdExvb3AgJT47JyArXG4gICAgJyAgICA8JSBpZiAoIWhhc0RvbnRFbnVtQnVnIHx8IHVzZUhhcykgeyAlPlxcbiAgICB9PCUgfSAlPlxcbicgK1xuICAgICcgIH0nICtcbiAgICAnICA8JSB9ICU+JyArXG5cbiAgICAvLyBCZWNhdXNlIElFIDwgOSBjYW4ndCBzZXQgdGhlIGBbW0VudW1lcmFibGVdXWAgYXR0cmlidXRlIG9mIGFuXG4gICAgLy8gZXhpc3RpbmcgcHJvcGVydHkgYW5kIHRoZSBgY29uc3RydWN0b3JgIHByb3BlcnR5IG9mIGEgcHJvdG90eXBlXG4gICAgLy8gZGVmYXVsdHMgdG8gbm9uLWVudW1lcmFibGUsIExvLURhc2ggc2tpcHMgdGhlIGBjb25zdHJ1Y3RvcmBcbiAgICAvLyBwcm9wZXJ0eSB3aGVuIGl0IGluZmVycyBpdCdzIGl0ZXJhdGluZyBvdmVyIGEgYHByb3RvdHlwZWAgb2JqZWN0LlxuICAgICcgIDwlIGlmIChoYXNEb250RW51bUJ1ZykgeyAlPlxcblxcbicgK1xuICAgICcgIHZhciBjdG9yID0gaXRlcmF0ZWUuY29uc3RydWN0b3I7XFxuJyArXG4gICAgJyAgICA8JSBmb3IgKHZhciBrID0gMDsgayA8IDc7IGsrKykgeyAlPlxcbicgK1xuICAgIFwiICBpbmRleCA9ICc8JT0gc2hhZG93ZWRba10gJT4nO1xcblwiICtcbiAgICAnICBpZiAoPCUnICtcbiAgICBcIiAgICAgIGlmIChzaGFkb3dlZFtrXSA9PSAnY29uc3RydWN0b3InKSB7XCIgK1xuICAgICcgICAgICAgICU+IShjdG9yICYmIGN0b3IucHJvdG90eXBlID09PSBpdGVyYXRlZSkgJiYgPCUnICtcbiAgICAnICAgICAgfSAlPmhhc093blByb3BlcnR5LmNhbGwoaXRlcmF0ZWUsIGluZGV4KSkge1xcbicgK1xuICAgICcgICAgPCU9IG9iamVjdExvb3AgJT5cXG4nICtcbiAgICAnICB9JyArXG4gICAgJyAgICA8JSB9ICU+JyArXG4gICAgJyAgPCUgfSAlPicgK1xuICAgICcgIDwlIGlmIChhcnJheUxvb3AgfHwgbm9uRW51bUFyZ3MpIHsgJT5cXG59PCUgfSAlPlxcbicgK1xuXG4gICAgLy8gYWRkIGNvZGUgdG8gdGhlIGJvdHRvbSBvZiB0aGUgaXRlcmF0aW9uIGZ1bmN0aW9uXG4gICAgJzwlPSBib3R0b20gJT47XFxuJyArXG4gICAgLy8gZmluYWxseSwgcmV0dXJuIHRoZSBgcmVzdWx0YFxuICAgICdyZXR1cm4gcmVzdWx0J1xuICApO1xuXG4gIC8qKiBSZXVzYWJsZSBpdGVyYXRvciBvcHRpb25zIGZvciBgYXNzaWduYCBhbmQgYGRlZmF1bHRzYCAqL1xuICB2YXIgYXNzaWduSXRlcmF0b3JPcHRpb25zID0ge1xuICAgICdhcmdzJzogJ29iamVjdCwgc291cmNlLCBndWFyZCcsXG4gICAgJ3RvcCc6XG4gICAgICBcImZvciAodmFyIGFyZ3NJbmRleCA9IDEsIGFyZ3NMZW5ndGggPSB0eXBlb2YgZ3VhcmQgPT0gJ251bWJlcicgPyAyIDogYXJndW1lbnRzLmxlbmd0aDsgYXJnc0luZGV4IDwgYXJnc0xlbmd0aDsgYXJnc0luZGV4KyspIHtcXG5cIiArXG4gICAgICAnICBpZiAoKGl0ZXJhdGVlID0gYXJndW1lbnRzW2FyZ3NJbmRleF0pKSB7JyxcbiAgICAnb2JqZWN0TG9vcCc6ICdyZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWVbaW5kZXhdJyxcbiAgICAnYm90dG9tJzogJyAgfVxcbn0nXG4gIH07XG5cbiAgLyoqXG4gICAqIFJldXNhYmxlIGl0ZXJhdG9yIG9wdGlvbnMgc2hhcmVkIGJ5IGBlYWNoYCwgYGZvckluYCwgYW5kIGBmb3JPd25gLlxuICAgKi9cbiAgdmFyIGVhY2hJdGVyYXRvck9wdGlvbnMgPSB7XG4gICAgJ2FyZ3MnOiAnY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcnLFxuICAgICd0b3AnOiBcImNhbGxiYWNrID0gY2FsbGJhY2sgJiYgdHlwZW9mIHRoaXNBcmcgPT0gJ3VuZGVmaW5lZCcgPyBjYWxsYmFjayA6IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnKVwiLFxuICAgICdhcnJheUxvb3AnOiAnaWYgKGNhbGxiYWNrKGl0ZXJhdGVlW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pID09PSBmYWxzZSkgcmV0dXJuIHJlc3VsdCcsXG4gICAgJ29iamVjdExvb3AnOiAnaWYgKGNhbGxiYWNrKGl0ZXJhdGVlW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pID09PSBmYWxzZSkgcmV0dXJuIHJlc3VsdCdcbiAgfTtcblxuICAvKiogUmV1c2FibGUgaXRlcmF0b3Igb3B0aW9ucyBmb3IgYGZvckluYCBhbmQgYGZvck93bmAgKi9cbiAgdmFyIGZvck93bkl0ZXJhdG9yT3B0aW9ucyA9IHtcbiAgICAnYXJyYXlMb29wJzogbnVsbFxuICB9O1xuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gb3B0aW1pemVkIHRvIHNlYXJjaCBsYXJnZSBhcnJheXMgZm9yIGEgZ2l2ZW4gYHZhbHVlYCxcbiAgICogc3RhcnRpbmcgYXQgYGZyb21JbmRleGAsIHVzaW5nIHN0cmljdCBlcXVhbGl0eSBmb3IgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzZWFyY2guXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLlxuICAgKiBAcGFyYW0ge051bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbGFyZ2VTaXplPTMwXSBUaGUgbGVuZ3RoIGF0IHdoaWNoIGFuIGFycmF5IGlzIGNvbnNpZGVyZWQgbGFyZ2UuXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuXG4gICAqL1xuICBmdW5jdGlvbiBjYWNoZWRDb250YWlucyhhcnJheSwgZnJvbUluZGV4LCBsYXJnZVNpemUpIHtcbiAgICBmcm9tSW5kZXggfHwgKGZyb21JbmRleCA9IDApO1xuXG4gICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgaXNMYXJnZSA9IChsZW5ndGggLSBmcm9tSW5kZXgpID49IChsYXJnZVNpemUgfHwgbGFyZ2VBcnJheVNpemUpO1xuXG4gICAgaWYgKGlzTGFyZ2UpIHtcbiAgICAgIHZhciBjYWNoZSA9IHt9LFxuICAgICAgICAgIGluZGV4ID0gZnJvbUluZGV4IC0gMTtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgLy8gbWFudWFsbHkgY29lcmNlIGB2YWx1ZWAgdG8gYSBzdHJpbmcgYmVjYXVzZSBgaGFzT3duUHJvcGVydHlgLCBpbiBzb21lXG4gICAgICAgIC8vIG9sZGVyIHZlcnNpb25zIG9mIEZpcmVmb3gsIGNvZXJjZXMgb2JqZWN0cyBpbmNvcnJlY3RseVxuICAgICAgICB2YXIga2V5ID0gYXJyYXlbaW5kZXhdICsgJyc7XG4gICAgICAgIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGNhY2hlLCBrZXkpID8gY2FjaGVba2V5XSA6IChjYWNoZVtrZXldID0gW10pKS5wdXNoKGFycmF5W2luZGV4XSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKGlzTGFyZ2UpIHtcbiAgICAgICAgdmFyIGtleSA9IHZhbHVlICsgJyc7XG4gICAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGNhY2hlLCBrZXkpICYmIGluZGV4T2YoY2FjaGVba2V5XSwgdmFsdWUpID4gLTE7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkgPiAtMTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXNlZCBieSBgXy5tYXhgIGFuZCBgXy5taW5gIGFzIHRoZSBkZWZhdWx0IGBjYWxsYmFja2Agd2hlbiBhIGdpdmVuXG4gICAqIGBjb2xsZWN0aW9uYCBpcyBhIHN0cmluZyB2YWx1ZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSBjaGFyYWN0ZXIgdG8gaW5zcGVjdC5cbiAgICogQHJldHVybnMge051bWJlcn0gUmV0dXJucyB0aGUgY29kZSB1bml0IG9mIGdpdmVuIGNoYXJhY3Rlci5cbiAgICovXG4gIGZ1bmN0aW9uIGNoYXJBdENhbGxiYWNrKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLmNoYXJDb2RlQXQoMCk7XG4gIH1cblxuICAvKipcbiAgICogVXNlZCBieSBgc29ydEJ5YCB0byBjb21wYXJlIHRyYW5zZm9ybWVkIGBjb2xsZWN0aW9uYCB2YWx1ZXMsIHN0YWJsZSBzb3J0aW5nXG4gICAqIHRoZW0gaW4gYXNjZW5kaW5nIG9yZGVyLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gYSBUaGUgb2JqZWN0IHRvIGNvbXBhcmUgdG8gYGJgLlxuICAgKiBAcGFyYW0ge09iamVjdH0gYiBUaGUgb2JqZWN0IHRvIGNvbXBhcmUgdG8gYGFgLlxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIHRoZSBzb3J0IG9yZGVyIGluZGljYXRvciBvZiBgMWAgb3IgYC0xYC5cbiAgICovXG4gIGZ1bmN0aW9uIGNvbXBhcmVBc2NlbmRpbmcoYSwgYikge1xuICAgIHZhciBhaSA9IGEuaW5kZXgsXG4gICAgICAgIGJpID0gYi5pbmRleDtcblxuICAgIGEgPSBhLmNyaXRlcmlhO1xuICAgIGIgPSBiLmNyaXRlcmlhO1xuXG4gICAgLy8gZW5zdXJlIGEgc3RhYmxlIHNvcnQgaW4gVjggYW5kIG90aGVyIGVuZ2luZXNcbiAgICAvLyBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvdjgvaXNzdWVzL2RldGFpbD9pZD05MFxuICAgIGlmIChhICE9PSBiKSB7XG4gICAgICBpZiAoYSA+IGIgfHwgdHlwZW9mIGEgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgICBpZiAoYSA8IGIgfHwgdHlwZW9mIGIgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYWkgPCBiaSA/IC0xIDogMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCwgd2hlbiBjYWxsZWQsIGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGB0aGlzYFxuICAgKiBiaW5kaW5nIG9mIGB0aGlzQXJnYCBhbmQgcHJlcGVuZHMgYW55IGBwYXJ0YWlsQXJnc2AgdG8gdGhlIGFyZ3VtZW50cyBwYXNzZWRcbiAgICogdG8gdGhlIGJvdW5kIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYmluZCBvciB0aGUgbWV0aG9kIG5hbWUuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGZ1bmNgLlxuICAgKiBAcGFyYW0ge0FycmF5fSBwYXJ0aWFsQXJncyBBbiBhcnJheSBvZiBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGJvdW5kIGZ1bmN0aW9uLlxuICAgKi9cbiAgZnVuY3Rpb24gY3JlYXRlQm91bmQoZnVuYywgdGhpc0FyZywgcGFydGlhbEFyZ3MpIHtcbiAgICB2YXIgaXNGdW5jID0gaXNGdW5jdGlvbihmdW5jKSxcbiAgICAgICAgaXNQYXJ0aWFsID0gIXBhcnRpYWxBcmdzLFxuICAgICAgICBrZXkgPSB0aGlzQXJnO1xuXG4gICAgLy8ganVnZ2xlIGFyZ3VtZW50c1xuICAgIGlmIChpc1BhcnRpYWwpIHtcbiAgICAgIHBhcnRpYWxBcmdzID0gdGhpc0FyZztcbiAgICB9XG4gICAgaWYgKCFpc0Z1bmMpIHtcbiAgICAgIHRoaXNBcmcgPSBmdW5jO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJvdW5kKCkge1xuICAgICAgLy8gYEZ1bmN0aW9uI2JpbmRgIHNwZWNcbiAgICAgIC8vIGh0dHA6Ly9lczUuZ2l0aHViLmNvbS8jeDE1LjMuNC41XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cyxcbiAgICAgICAgICB0aGlzQmluZGluZyA9IGlzUGFydGlhbCA/IHRoaXMgOiB0aGlzQXJnO1xuXG4gICAgICBpZiAoIWlzRnVuYykge1xuICAgICAgICBmdW5jID0gdGhpc0FyZ1trZXldO1xuICAgICAgfVxuICAgICAgaWYgKHBhcnRpYWxBcmdzLmxlbmd0aCkge1xuICAgICAgICBhcmdzID0gYXJncy5sZW5ndGhcbiAgICAgICAgICA/IHBhcnRpYWxBcmdzLmNvbmNhdChzbGljZShhcmdzKSlcbiAgICAgICAgICA6IHBhcnRpYWxBcmdzO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBib3VuZCkge1xuICAgICAgICAvLyBlbnN1cmUgYG5ldyBib3VuZGAgaXMgYW4gaW5zdGFuY2Ugb2YgYGJvdW5kYCBhbmQgYGZ1bmNgXG4gICAgICAgIG5vb3AucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7XG4gICAgICAgIHRoaXNCaW5kaW5nID0gbmV3IG5vb3A7XG4gICAgICAgIG5vb3AucHJvdG90eXBlID0gbnVsbDtcblxuICAgICAgICAvLyBtaW1pYyB0aGUgY29uc3RydWN0b3IncyBgcmV0dXJuYCBiZWhhdmlvclxuICAgICAgICAvLyBodHRwOi8vZXM1LmdpdGh1Yi5jb20vI3gxMy4yLjJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gaXNPYmplY3QocmVzdWx0KSA/IHJlc3VsdCA6IHRoaXNCaW5kaW5nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpO1xuICAgIH1cbiAgICByZXR1cm4gYm91bmQ7XG4gIH1cblxuICAvKipcbiAgICogUHJvZHVjZXMgYW4gaXRlcmF0aW9uIGNhbGxiYWNrIGJvdW5kIHRvIGFuIG9wdGlvbmFsIGB0aGlzQXJnYC4gSWYgYGZ1bmNgIGlzXG4gICAqIGEgcHJvcGVydHkgbmFtZSwgdGhlIGNhbGxiYWNrIHdpbGwgcmV0dXJuIHRoZSBwcm9wZXJ0eSB2YWx1ZSBmb3IgYSBnaXZlbiBlbGVtZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gW2Z1bmM9aWRlbnRpdHl8cHJvcGVydHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyXG4gICAqIGl0ZXJhdGlvbiBvciBwcm9wZXJ0eSBuYW1lIHRvIHF1ZXJ5LlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbYWNjdW11bGF0aW5nXSBVc2VkIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGxiYWNrIHNob3VsZFxuICAgKiAgYWNjZXB0IGFuIGBhY2N1bXVsYXRvcmAgYXJndW1lbnQuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBhIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKi9cbiAgZnVuY3Rpb24gY3JlYXRlQ2FsbGJhY2soZnVuYywgdGhpc0FyZywgYWNjdW11bGF0aW5nKSB7XG4gICAgaWYgKCFmdW5jKSB7XG4gICAgICByZXR1cm4gaWRlbnRpdHk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICAgIHJldHVybiBvYmplY3RbZnVuY107XG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXNBcmcgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmIChhY2N1bXVsYXRpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIG9iamVjdCkge1xuICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgb2JqZWN0KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIG9iamVjdCkge1xuICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIHZhbHVlLCBpbmRleCwgb2JqZWN0KTtcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBmdW5jO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgY29tcGlsZWQgaXRlcmF0aW9uIGZ1bmN0aW9ucy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zMSwgb3B0aW9uczIsIC4uLl0gVGhlIGNvbXBpbGUgb3B0aW9ucyBvYmplY3QocykuXG4gICAqICB1c2VIYXMgLSBBIGJvb2xlYW4gdG8gc3BlY2lmeSB1c2luZyBgaGFzT3duUHJvcGVydHlgIGNoZWNrcyBpbiB0aGUgb2JqZWN0IGxvb3AuXG4gICAqICBhcmdzIC0gQSBzdHJpbmcgb2YgY29tbWEgc2VwYXJhdGVkIGFyZ3VtZW50cyB0aGUgaXRlcmF0aW9uIGZ1bmN0aW9uIHdpbGwgYWNjZXB0LlxuICAgKiAgdG9wIC0gQSBzdHJpbmcgb2YgY29kZSB0byBleGVjdXRlIGJlZm9yZSB0aGUgaXRlcmF0aW9uIGJyYW5jaGVzLlxuICAgKiAgYXJyYXlMb29wIC0gQSBzdHJpbmcgb2YgY29kZSB0byBleGVjdXRlIGluIHRoZSBhcnJheSBsb29wLlxuICAgKiAgb2JqZWN0TG9vcCAtIEEgc3RyaW5nIG9mIGNvZGUgdG8gZXhlY3V0ZSBpbiB0aGUgb2JqZWN0IGxvb3AuXG4gICAqICBib3R0b20gLSBBIHN0cmluZyBvZiBjb2RlIHRvIGV4ZWN1dGUgYWZ0ZXIgdGhlIGl0ZXJhdGlvbiBicmFuY2hlcy5cbiAgICpcbiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBjb21waWxlZCBmdW5jdGlvbi5cbiAgICovXG4gIGZ1bmN0aW9uIGNyZWF0ZUl0ZXJhdG9yKCkge1xuICAgIHZhciBkYXRhID0ge1xuICAgICAgJ2FycmF5TG9vcCc6ICcnLFxuICAgICAgJ2JvdHRvbSc6ICcnLFxuICAgICAgJ2hhc0RvbnRFbnVtQnVnJzogaGFzRG9udEVudW1CdWcsXG4gICAgICAnaXNLZXlzRmFzdCc6IGlzS2V5c0Zhc3QsXG4gICAgICAnb2JqZWN0TG9vcCc6ICcnLFxuICAgICAgJ25vbkVudW1BcmdzJzogbm9uRW51bUFyZ3MsXG4gICAgICAnbm9DaGFyQnlJbmRleCc6IG5vQ2hhckJ5SW5kZXgsXG4gICAgICAnc2hhZG93ZWQnOiBzaGFkb3dlZCxcbiAgICAgICd0b3AnOiAnJyxcbiAgICAgICd1c2VIYXMnOiB0cnVlXG4gICAgfTtcblxuICAgIC8vIG1lcmdlIG9wdGlvbnMgaW50byBhIHRlbXBsYXRlIGRhdGEgb2JqZWN0XG4gICAgZm9yICh2YXIgb2JqZWN0LCBpbmRleCA9IDA7IG9iamVjdCA9IGFyZ3VtZW50c1tpbmRleF07IGluZGV4KyspIHtcbiAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgZGF0YVtrZXldID0gb2JqZWN0W2tleV07XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgIGRhdGEuZmlyc3RBcmcgPSAvXlteLF0rLy5leGVjKGFyZ3MpWzBdO1xuXG4gICAgLy8gY3JlYXRlIHRoZSBmdW5jdGlvbiBmYWN0b3J5XG4gICAgdmFyIGZhY3RvcnkgPSBGdW5jdGlvbihcbiAgICAgICAgJ2NyZWF0ZUNhbGxiYWNrLCBoYXNPd25Qcm9wZXJ0eSwgaXNBcmd1bWVudHMsIGlzU3RyaW5nLCBvYmplY3RUeXBlcywgJyArXG4gICAgICAgICduYXRpdmVLZXlzLCBwcm9wZXJ0eUlzRW51bWVyYWJsZScsXG4gICAgICAncmV0dXJuIGZ1bmN0aW9uKCcgKyBhcmdzICsgJykge1xcbicgKyBpdGVyYXRvclRlbXBsYXRlKGRhdGEpICsgJ1xcbn0nXG4gICAgKTtcbiAgICAvLyByZXR1cm4gdGhlIGNvbXBpbGVkIGZ1bmN0aW9uXG4gICAgcmV0dXJuIGZhY3RvcnkoXG4gICAgICBjcmVhdGVDYWxsYmFjaywgaGFzT3duUHJvcGVydHksIGlzQXJndW1lbnRzLCBpc1N0cmluZywgb2JqZWN0VHlwZXMsXG4gICAgICBuYXRpdmVLZXlzLCBwcm9wZXJ0eUlzRW51bWVyYWJsZVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQSBmdW5jdGlvbiBjb21waWxlZCB0byBpdGVyYXRlIGBhcmd1bWVudHNgIG9iamVjdHMsIGFycmF5cywgb2JqZWN0cywgYW5kXG4gICAqIHN0cmluZ3MgY29uc2lzdGVubHkgYWNyb3NzIGVudmlyb25tZW50cywgZXhlY3V0aW5nIHRoZSBgY2FsbGJhY2tgIGZvciBlYWNoXG4gICAqIGVsZW1lbnQgaW4gdGhlIGBjb2xsZWN0aW9uYC4gVGhlIGBjYWxsYmFja2AgaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkXG4gICAqIHdpdGggdGhyZWUgYXJndW1lbnRzOyAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuIENhbGxiYWNrcyBtYXkgZXhpdFxuICAgKiBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrPWlkZW50aXR5XSBUaGUgZnVuY3Rpb24gY2FsbGVkIHBlciBpdGVyYXRpb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGNhbGxiYWNrYC5cbiAgICogQHJldHVybnMge0FycmF5fE9iamVjdHxTdHJpbmd9IFJldHVybnMgYGNvbGxlY3Rpb25gLlxuICAgKi9cbiAgdmFyIGVhY2ggPSBjcmVhdGVJdGVyYXRvcihlYWNoSXRlcmF0b3JPcHRpb25zKTtcblxuICAvKipcbiAgICogVXNlZCBieSBgdGVtcGxhdGVgIHRvIGVzY2FwZSBjaGFyYWN0ZXJzIGZvciBpbmNsdXNpb24gaW4gY29tcGlsZWRcbiAgICogc3RyaW5nIGxpdGVyYWxzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gbWF0Y2ggVGhlIG1hdGNoZWQgY2hhcmFjdGVyIHRvIGVzY2FwZS5cbiAgICogQHJldHVybnMge1N0cmluZ30gUmV0dXJucyB0aGUgZXNjYXBlZCBjaGFyYWN0ZXIuXG4gICAqL1xuICBmdW5jdGlvbiBlc2NhcGVTdHJpbmdDaGFyKG1hdGNoKSB7XG4gICAgcmV0dXJuICdcXFxcJyArIHN0cmluZ0VzY2FwZXNbbWF0Y2hdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgYnkgYGVzY2FwZWAgdG8gY29udmVydCBjaGFyYWN0ZXJzIHRvIEhUTUwgZW50aXRpZXMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBtYXRjaCBUaGUgbWF0Y2hlZCBjaGFyYWN0ZXIgdG8gZXNjYXBlLlxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBSZXR1cm5zIHRoZSBlc2NhcGVkIGNoYXJhY3Rlci5cbiAgICovXG4gIGZ1bmN0aW9uIGVzY2FwZUh0bWxDaGFyKG1hdGNoKSB7XG4gICAgcmV0dXJuIGh0bWxFc2NhcGVzW21hdGNoXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIERPTSBub2RlIGluIElFIDwgOS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB2YWx1ZWAgaXMgYSBET00gbm9kZSwgZWxzZSBgZmFsc2VgLlxuICAgKi9cbiAgZnVuY3Rpb24gaXNOb2RlKHZhbHVlKSB7XG4gICAgLy8gSUUgPCA5IHByZXNlbnRzIERPTSBub2RlcyBhcyBgT2JqZWN0YCBvYmplY3RzIGV4Y2VwdCB0aGV5IGhhdmUgYHRvU3RyaW5nYFxuICAgIC8vIG1ldGhvZHMgdGhhdCBhcmUgYHR5cGVvZmAgXCJzdHJpbmdcIiBhbmQgc3RpbGwgY2FuIGNvZXJjZSBub2RlcyB0byBzdHJpbmdzXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZS50b1N0cmluZyAhPSAnZnVuY3Rpb24nICYmIHR5cGVvZiAodmFsdWUgKyAnJykgPT0gJ3N0cmluZyc7XG4gIH1cblxuICAvKipcbiAgICogQSBuby1vcGVyYXRpb24gZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBub29wKCkge1xuICAgIC8vIG5vIG9wZXJhdGlvbiBwZXJmb3JtZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBTbGljZXMgdGhlIGBjb2xsZWN0aW9uYCBmcm9tIHRoZSBgc3RhcnRgIGluZGV4IHVwIHRvLCBidXQgbm90IGluY2x1ZGluZyxcbiAgICogdGhlIGBlbmRgIGluZGV4LlxuICAgKlxuICAgKiBOb3RlOiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQsIGluc3RlYWQgb2YgYEFycmF5I3NsaWNlYCwgdG8gc3VwcG9ydCBub2RlIGxpc3RzXG4gICAqIGluIElFIDwgOSBhbmQgdG8gZW5zdXJlIGRlbnNlIGFycmF5cyBhcmUgcmV0dXJuZWQuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBzbGljZS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0IFRoZSBzdGFydCBpbmRleC5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGVuZCBUaGUgZW5kIGluZGV4LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheS5cbiAgICovXG4gIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7XG4gICAgc3RhcnQgfHwgKHN0YXJ0ID0gMCk7XG4gICAgaWYgKHR5cGVvZiBlbmQgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGVuZCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDtcbiAgICB9XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGVuZCAtIHN0YXJ0IHx8IDAsXG4gICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCA8IDAgPyAwIDogbGVuZ3RoKTtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbc3RhcnQgKyBpbmRleF07XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVXNlZCBieSBgdW5lc2NhcGVgIHRvIGNvbnZlcnQgSFRNTCBlbnRpdGllcyB0byBjaGFyYWN0ZXJzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gbWF0Y2ggVGhlIG1hdGNoZWQgY2hhcmFjdGVyIHRvIHVuZXNjYXBlLlxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBSZXR1cm5zIHRoZSB1bmVzY2FwZWQgY2hhcmFjdGVyLlxuICAgKi9cbiAgZnVuY3Rpb24gdW5lc2NhcGVIdG1sQ2hhcihtYXRjaCkge1xuICAgIHJldHVybiBodG1sVW5lc2NhcGVzW21hdGNoXTtcbiAgfVxuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8qKlxuICAgKiBBc3NpZ25zIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMgb2Ygc291cmNlIG9iamVjdChzKSB0byB0aGUgYGRlc3RpbmF0aW9uYFxuICAgKiBvYmplY3QuIFN1YnNlcXVlbnQgc291cmNlcyB3aWxsIG92ZXJ3cml0ZSBwcm9wZXJ5IGFzc2lnbm1lbnRzIG9mIHByZXZpb3VzXG4gICAqIHNvdXJjZXMuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGFsaWFzIGV4dGVuZFxuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc291cmNlMSwgc291cmNlMiwgLi4uXSBUaGUgc291cmNlIG9iamVjdHMuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5hc3NpZ24oeyAnbmFtZSc6ICdtb2UnIH0sIHsgJ2FnZSc6IDQwIH0pO1xuICAgKiAvLyA9PiB7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9XG4gICAqL1xuICB2YXIgYXNzaWduID0gY3JlYXRlSXRlcmF0b3IoYXNzaWduSXRlcmF0b3JPcHRpb25zKTtcblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBgdmFsdWVgIGlzIGFuIGBhcmd1bWVudHNgIG9iamVjdCwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiAoZnVuY3Rpb24oKSB7IHJldHVybiBfLmlzQXJndW1lbnRzKGFyZ3VtZW50cyk7IH0pKDEsIDIsIDMpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNBcmd1bWVudHMoWzEsIDIsIDNdKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIGlzQXJndW1lbnRzKHZhbHVlKSB7XG4gICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodmFsdWUpID09IGFyZ3NDbGFzcztcbiAgfVxuICAvLyBmYWxsYmFjayBmb3IgYnJvd3NlcnMgdGhhdCBjYW4ndCBkZXRlY3QgYGFyZ3VtZW50c2Agb2JqZWN0cyBieSBbW0NsYXNzXV1cbiAgaWYgKG5vQXJnc0NsYXNzKSB7XG4gICAgaXNBcmd1bWVudHMgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID8gaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpIDogZmFsc2U7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdGVyYXRlcyBvdmVyIGBvYmplY3RgJ3Mgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLCBleGVjdXRpbmdcbiAgICogdGhlIGBjYWxsYmFja2AgZm9yIGVhY2ggcHJvcGVydHkuIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmRcbiAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBrZXksIG9iamVjdCkuIENhbGxiYWNrcyBtYXkgZXhpdCBpdGVyYXRpb25cbiAgICogZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2s9aWRlbnRpdHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBmdW5jdGlvbiBEb2cobmFtZSkge1xuICAgKiAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAqIH1cbiAgICpcbiAgICogRG9nLnByb3RvdHlwZS5iYXJrID0gZnVuY3Rpb24oKSB7XG4gICAqICAgYWxlcnQoJ1dvb2YsIHdvb2YhJyk7XG4gICAqIH07XG4gICAqXG4gICAqIF8uZm9ySW4obmV3IERvZygnRGFnbnknKSwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgKiAgIGFsZXJ0KGtleSk7XG4gICAqIH0pO1xuICAgKiAvLyA9PiBhbGVydHMgJ25hbWUnIGFuZCAnYmFyaycgKG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICAgKi9cbiAgdmFyIGZvckluID0gY3JlYXRlSXRlcmF0b3IoZWFjaEl0ZXJhdG9yT3B0aW9ucywgZm9yT3duSXRlcmF0b3JPcHRpb25zLCB7XG4gICAgJ3VzZUhhcyc6IGZhbHNlXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBJdGVyYXRlcyBvdmVyIGFuIG9iamVjdCdzIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMsIGV4ZWN1dGluZyB0aGUgYGNhbGxiYWNrYFxuICAgKiBmb3IgZWFjaCBwcm9wZXJ0eS4gVGhlIGBjYWxsYmFja2AgaXMgYm91bmQgdG8gYHRoaXNBcmdgIGFuZCBpbnZva2VkIHdpdGggdGhyZWVcbiAgICogYXJndW1lbnRzOyAodmFsdWUsIGtleSwgb2JqZWN0KS4gQ2FsbGJhY2tzIG1heSBleGl0IGl0ZXJhdGlvbiBlYXJseSBieSBleHBsaWNpdGx5XG4gICAqIHJldHVybmluZyBgZmFsc2VgLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFjaz1pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uZm9yT3duKHsgJzAnOiAnemVybycsICcxJzogJ29uZScsICdsZW5ndGgnOiAyIH0sIGZ1bmN0aW9uKG51bSwga2V5KSB7XG4gICAqICAgYWxlcnQoa2V5KTtcbiAgICogfSk7XG4gICAqIC8vID0+IGFsZXJ0cyAnMCcsICcxJywgYW5kICdsZW5ndGgnIChvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICovXG4gIHZhciBmb3JPd24gPSBjcmVhdGVJdGVyYXRvcihlYWNoSXRlcmF0b3JPcHRpb25zLCBmb3JPd25JdGVyYXRvck9wdGlvbnMpO1xuXG4gIC8qKlxuICAgKiBBIGZhbGxiYWNrIGltcGxlbWVudGF0aW9uIG9mIGBpc1BsYWluT2JqZWN0YCB0aGF0IGNoZWNrcyBpZiBhIGdpdmVuIGB2YWx1ZWBcbiAgICogaXMgYW4gb2JqZWN0IGNyZWF0ZWQgYnkgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yLCBhc3N1bWluZyBvYmplY3RzIGNyZWF0ZWRcbiAgICogYnkgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yIGhhdmUgbm8gaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydGllcyBhbmQgdGhhdFxuICAgKiB0aGVyZSBhcmUgbm8gYE9iamVjdC5wcm90b3R5cGVgIGV4dGVuc2lvbnMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAgICovXG4gIGZ1bmN0aW9uIHNoaW1Jc1BsYWluT2JqZWN0KHZhbHVlKSB7XG4gICAgLy8gYXZvaWQgbm9uLW9iamVjdHMgYW5kIGZhbHNlIHBvc2l0aXZlcyBmb3IgYGFyZ3VtZW50c2Agb2JqZWN0c1xuICAgIHZhciByZXN1bHQgPSBmYWxzZTtcbiAgICBpZiAoISh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLy8gY2hlY2sgdGhhdCB0aGUgY29uc3RydWN0b3IgaXMgYE9iamVjdGAgKGkuZS4gYE9iamVjdCBpbnN0YW5jZW9mIE9iamVjdGApXG4gICAgdmFyIGN0b3IgPSB2YWx1ZS5jb25zdHJ1Y3RvcjtcbiAgICBpZiAoKCFpc0Z1bmN0aW9uKGN0b3IpICYmICghbm9Ob2RlQ2xhc3MgfHwgIWlzTm9kZSh2YWx1ZSkpKSB8fCBjdG9yIGluc3RhbmNlb2YgY3Rvcikge1xuICAgICAgLy8gSUUgPCA5IGl0ZXJhdGVzIGluaGVyaXRlZCBwcm9wZXJ0aWVzIGJlZm9yZSBvd24gcHJvcGVydGllcy4gSWYgdGhlIGZpcnN0XG4gICAgICAvLyBpdGVyYXRlZCBwcm9wZXJ0eSBpcyBhbiBvYmplY3QncyBvd24gcHJvcGVydHkgdGhlbiB0aGVyZSBhcmUgbm8gaW5oZXJpdGVkXG4gICAgICAvLyBlbnVtZXJhYmxlIHByb3BlcnRpZXMuXG4gICAgICBpZiAoaXRlcmF0ZXNPd25MYXN0KSB7XG4gICAgICAgIGZvckluKHZhbHVlLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHtcbiAgICAgICAgICByZXN1bHQgPSAhaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBJbiBtb3N0IGVudmlyb25tZW50cyBhbiBvYmplY3QncyBvd24gcHJvcGVydGllcyBhcmUgaXRlcmF0ZWQgYmVmb3JlXG4gICAgICAvLyBpdHMgaW5oZXJpdGVkIHByb3BlcnRpZXMuIElmIHRoZSBsYXN0IGl0ZXJhdGVkIHByb3BlcnR5IGlzIGFuIG9iamVjdCdzXG4gICAgICAvLyBvd24gcHJvcGVydHkgdGhlbiB0aGVyZSBhcmUgbm8gaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydGllcy5cbiAgICAgIGZvckluKHZhbHVlLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgIHJlc3VsdCA9IGtleTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gZmFsc2UgfHwgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgcmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGZhbGxiYWNrIGltcGxlbWVudGF0aW9uIG9mIGBPYmplY3Qua2V5c2AgdGhhdCBwcm9kdWNlcyBhbiBhcnJheSBvZiB0aGVcbiAgICogZ2l2ZW4gb2JqZWN0J3Mgb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuXG4gICAqL1xuICBmdW5jdGlvbiBzaGltS2V5cyhvYmplY3QpIHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgZm9yT3duKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gY29udmVydCBjaGFyYWN0ZXJzIHRvIEhUTUwgZW50aXRpZXM6XG4gICAqXG4gICAqIFRob3VnaCB0aGUgYD5gIGNoYXJhY3RlciBpcyBlc2NhcGVkIGZvciBzeW1tZXRyeSwgY2hhcmFjdGVycyBsaWtlIGA+YCBhbmQgYC9gXG4gICAqIGRvbid0IHJlcXVpcmUgZXNjYXBpbmcgaW4gSFRNTCBhbmQgaGF2ZSBubyBzcGVjaWFsIG1lYW5pbmcgdW5sZXNzIHRoZXkncmUgcGFydFxuICAgKiBvZiBhIHRhZyBvciBhbiB1bnF1b3RlZCBhdHRyaWJ1dGUgdmFsdWUuXG4gICAqIGh0dHA6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2FtYmlndW91cy1hbXBlcnNhbmRzICh1bmRlciBcInNlbWktcmVsYXRlZCBmdW4gZmFjdFwiKVxuICAgKi9cbiAgdmFyIGh0bWxFc2NhcGVzID0ge1xuICAgICcmJzogJyZhbXA7JyxcbiAgICAnPCc6ICcmbHQ7JyxcbiAgICAnPic6ICcmZ3Q7JyxcbiAgICAnXCInOiAnJnF1b3Q7JyxcbiAgICBcIidcIjogJyYjeDI3OydcbiAgfTtcblxuICAvKiogVXNlZCB0byBjb252ZXJ0IEhUTUwgZW50aXRpZXMgdG8gY2hhcmFjdGVycyAqL1xuICB2YXIgaHRtbFVuZXNjYXBlcyA9IGludmVydChodG1sRXNjYXBlcyk7XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgdmFsdWVgLiBJZiBgZGVlcGAgaXMgYHRydWVgLCBuZXN0ZWQgb2JqZWN0cyB3aWxsIGFsc29cbiAgICogYmUgY2xvbmVkLCBvdGhlcndpc2UgdGhleSB3aWxsIGJlIGFzc2lnbmVkIGJ5IHJlZmVyZW5jZS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gZGVlcCBBIGZsYWcgdG8gaW5kaWNhdGUgYSBkZWVwIGNsb25lLlxuICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gSW50ZXJuYWxseSB1c2VkIHRvIGFsbG93IHRoaXMgbWV0aG9kIHRvIHdvcmsgd2l0aFxuICAgKiAgb3RoZXJzIGxpa2UgYF8ubWFwYCB3aXRob3V0IHVzaW5nIHRoZWlyIGNhbGxiYWNrIGBpbmRleGAgYXJndW1lbnQgZm9yIGBkZWVwYC5cbiAgICogQHBhcmFtLSB7QXJyYXl9IFtzdGFja0E9W11dIEludGVybmFsbHkgdXNlZCB0byB0cmFjayB0cmF2ZXJzZWQgc291cmNlIG9iamVjdHMuXG4gICAqIEBwYXJhbS0ge0FycmF5fSBbc3RhY2tCPVtdXSBJbnRlcm5hbGx5IHVzZWQgdG8gYXNzb2NpYXRlIGNsb25lcyB3aXRoIHRoZWlyXG4gICAqICBzb3VyY2UgY291bnRlcnBhcnRzLlxuICAgKiBAcmV0dXJucyB7TWl4ZWR9IFJldHVybnMgdGhlIGNsb25lZCBgdmFsdWVgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgc3Rvb2dlcyA9IFtcbiAgICogICB7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9LFxuICAgKiAgIHsgJ25hbWUnOiAnbGFycnknLCAnYWdlJzogNTAgfSxcbiAgICogICB7ICduYW1lJzogJ2N1cmx5JywgJ2FnZSc6IDYwIH1cbiAgICogXTtcbiAgICpcbiAgICogdmFyIHNoYWxsb3cgPSBfLmNsb25lKHN0b29nZXMpO1xuICAgKiBzaGFsbG93WzBdID09PSBzdG9vZ2VzWzBdO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIHZhciBkZWVwID0gXy5jbG9uZShzdG9vZ2VzLCB0cnVlKTtcbiAgICogZGVlcFswXSA9PT0gc3Rvb2dlc1swXTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIGNsb25lKHZhbHVlLCBkZWVwLCBndWFyZCwgc3RhY2tBLCBzdGFja0IpIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBpZiAoZ3VhcmQpIHtcbiAgICAgIGRlZXAgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gaW5zcGVjdCBbW0NsYXNzXV1cbiAgICB2YXIgaXNPYmogPSBpc09iamVjdCh2YWx1ZSk7XG4gICAgaWYgKGlzT2JqKSB7XG4gICAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbCh2YWx1ZSk7XG4gICAgICBpZiAoIWNsb25lYWJsZUNsYXNzZXNbY2xhc3NOYW1lXSB8fCAobm9Ob2RlQ2xhc3MgJiYgaXNOb2RlKHZhbHVlKSkpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgICAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSk7XG4gICAgfVxuICAgIC8vIHNoYWxsb3cgY2xvbmVcbiAgICBpZiAoIWlzT2JqIHx8ICFkZWVwKSB7XG4gICAgICByZXR1cm4gaXNPYmpcbiAgICAgICAgPyAoaXNBcnIgPyBzbGljZSh2YWx1ZSkgOiBhc3NpZ24oe30sIHZhbHVlKSlcbiAgICAgICAgOiB2YWx1ZTtcbiAgICB9XG4gICAgdmFyIGN0b3IgPSBjdG9yQnlDbGFzc1tjbGFzc05hbWVdO1xuICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7XG4gICAgICBjYXNlIGJvb2xDbGFzczpcbiAgICAgIGNhc2UgZGF0ZUNsYXNzOlxuICAgICAgICByZXR1cm4gbmV3IGN0b3IoK3ZhbHVlKTtcblxuICAgICAgY2FzZSBudW1iZXJDbGFzczpcbiAgICAgIGNhc2Ugc3RyaW5nQ2xhc3M6XG4gICAgICAgIHJldHVybiBuZXcgY3Rvcih2YWx1ZSk7XG5cbiAgICAgIGNhc2UgcmVnZXhwQ2xhc3M6XG4gICAgICAgIHJldHVybiBjdG9yKHZhbHVlLnNvdXJjZSwgcmVGbGFncy5leGVjKHZhbHVlKSk7XG4gICAgfVxuICAgIC8vIGNoZWNrIGZvciBjaXJjdWxhciByZWZlcmVuY2VzIGFuZCByZXR1cm4gY29ycmVzcG9uZGluZyBjbG9uZVxuICAgIHN0YWNrQSB8fCAoc3RhY2tBID0gW10pO1xuICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pO1xuXG4gICAgdmFyIGxlbmd0aCA9IHN0YWNrQS5sZW5ndGg7XG4gICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICBpZiAoc3RhY2tBW2xlbmd0aF0gPT0gdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHN0YWNrQltsZW5ndGhdO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBpbml0IGNsb25lZCBvYmplY3RcbiAgICB2YXIgcmVzdWx0ID0gaXNBcnIgPyBjdG9yKHZhbHVlLmxlbmd0aCkgOiB7fTtcblxuICAgIC8vIGFkZCB0aGUgc291cmNlIHZhbHVlIHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0c1xuICAgIC8vIGFuZCBhc3NvY2lhdGUgaXQgd2l0aCBpdHMgY2xvbmVcbiAgICBzdGFja0EucHVzaCh2YWx1ZSk7XG4gICAgc3RhY2tCLnB1c2gocmVzdWx0KTtcblxuICAgIC8vIHJlY3Vyc2l2ZWx5IHBvcHVsYXRlIGNsb25lIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cylcbiAgICAoaXNBcnIgPyBmb3JFYWNoIDogZm9yT3duKSh2YWx1ZSwgZnVuY3Rpb24ob2JqVmFsdWUsIGtleSkge1xuICAgICAgcmVzdWx0W2tleV0gPSBjbG9uZShvYmpWYWx1ZSwgZGVlcCwgbnVsbCwgc3RhY2tBLCBzdGFja0IpO1xuICAgIH0pO1xuXG4gICAgLy8gYWRkIGFycmF5IHByb3BlcnRpZXMgYXNzaWduZWQgYnkgYFJlZ0V4cCNleGVjYFxuICAgIGlmIChpc0Fycikge1xuICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdpbmRleCcpKSB7XG4gICAgICAgIHJlc3VsdC5pbmRleCA9IHZhbHVlLmluZGV4O1xuICAgICAgfVxuICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdpbnB1dCcpKSB7XG4gICAgICAgIHJlc3VsdC5pbnB1dCA9IHZhbHVlLmlucHV0O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBkZWVwIGNsb25lIG9mIGB2YWx1ZWAuIEZ1bmN0aW9ucyBhbmQgRE9NIG5vZGVzIGFyZSAqKm5vdCoqIGNsb25lZC5cbiAgICogVGhlIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgYXJndW1lbnRzYCBvYmplY3RzIGFuZCBvYmplY3RzIGNyZWF0ZWQgYnlcbiAgICogY29uc3RydWN0b3JzIG90aGVyIHRoYW4gYE9iamVjdGAgYXJlIGNsb25lZCB0byBwbGFpbiBgT2JqZWN0YCBvYmplY3RzLlxuICAgKlxuICAgKiBOb3RlOiBUaGlzIGZ1bmN0aW9uIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlIHN0cnVjdHVyZWQgY2xvbmUgYWxnb3JpdGhtLlxuICAgKiBTZWUgaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDUvY29tbW9uLWRvbS1pbnRlcmZhY2VzLmh0bWwjaW50ZXJuYWwtc3RydWN0dXJlZC1jbG9uaW5nLWFsZ29yaXRobS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZGVlcCBjbG9uZS5cbiAgICogQHJldHVybnMge01peGVkfSBSZXR1cm5zIHRoZSBkZWVwIGNsb25lZCBgdmFsdWVgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgc3Rvb2dlcyA9IFtcbiAgICogICB7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9LFxuICAgKiAgIHsgJ25hbWUnOiAnbGFycnknLCAnYWdlJzogNTAgfSxcbiAgICogICB7ICduYW1lJzogJ2N1cmx5JywgJ2FnZSc6IDYwIH1cbiAgICogXTtcbiAgICpcbiAgICogdmFyIGRlZXAgPSBfLmNsb25lRGVlcChzdG9vZ2VzKTtcbiAgICogZGVlcFswXSA9PT0gc3Rvb2dlc1swXTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIGNsb25lRGVlcCh2YWx1ZSkge1xuICAgIHJldHVybiBjbG9uZSh2YWx1ZSwgdHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQXNzaWducyBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzIG9mIHNvdXJjZSBvYmplY3QocykgdG8gdGhlIGBkZXN0aW5hdGlvbmBcbiAgICogb2JqZWN0IGZvciBhbGwgYGRlc3RpbmF0aW9uYCBwcm9wZXJ0aWVzIHRoYXQgcmVzb2x2ZSB0byBgbnVsbGAvYHVuZGVmaW5lZGAuXG4gICAqIE9uY2UgYSBwcm9wZXJ0eSBpcyBzZXQsIGFkZGl0aW9uYWwgZGVmYXVsdHMgb2YgdGhlIHNhbWUgcHJvcGVydHkgd2lsbCBiZVxuICAgKiBpZ25vcmVkLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICogQHBhcmFtIHtPYmplY3R9IFtkZWZhdWx0MSwgZGVmYXVsdDIsIC4uLl0gVGhlIGRlZmF1bHQgb2JqZWN0cy5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgaWNlQ3JlYW0gPSB7ICdmbGF2b3InOiAnY2hvY29sYXRlJyB9O1xuICAgKiBfLmRlZmF1bHRzKGljZUNyZWFtLCB7ICdmbGF2b3InOiAndmFuaWxsYScsICdzcHJpbmtsZXMnOiAncmFpbmJvdycgfSk7XG4gICAqIC8vID0+IHsgJ2ZsYXZvcic6ICdjaG9jb2xhdGUnLCAnc3ByaW5rbGVzJzogJ3JhaW5ib3cnIH1cbiAgICovXG4gIHZhciBkZWZhdWx0cyA9IGNyZWF0ZUl0ZXJhdG9yKGFzc2lnbkl0ZXJhdG9yT3B0aW9ucywge1xuICAgICdvYmplY3RMb29wJzogJ2lmIChyZXN1bHRbaW5kZXhdID09IG51bGwpICcgKyBhc3NpZ25JdGVyYXRvck9wdGlvbnMub2JqZWN0TG9vcFxuICB9KTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHNvcnRlZCBhcnJheSBvZiBhbGwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLCBvd24gYW5kIGluaGVyaXRlZCxcbiAgICogb2YgYG9iamVjdGAgdGhhdCBoYXZlIGZ1bmN0aW9uIHZhbHVlcy5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAYWxpYXMgbWV0aG9kc1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIHRoYXQgaGF2ZSBmdW5jdGlvbiB2YWx1ZXMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uZnVuY3Rpb25zKF8pO1xuICAgKiAvLyA9PiBbJ2FsbCcsICdhbnknLCAnYmluZCcsICdiaW5kQWxsJywgJ2Nsb25lJywgJ2NvbXBhY3QnLCAnY29tcG9zZScsIC4uLl1cbiAgICovXG4gIGZ1bmN0aW9uIGZ1bmN0aW9ucyhvYmplY3QpIHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgZm9ySW4ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICBpZiAoaXNGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0LnNvcnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIHNwZWNpZmllZCBvYmplY3QgYHByb3BlcnR5YCBleGlzdHMgYW5kIGlzIGEgZGlyZWN0IHByb3BlcnR5LFxuICAgKiBpbnN0ZWFkIG9mIGFuIGluaGVyaXRlZCBwcm9wZXJ0eS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2hlY2suXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eSBUaGUgcHJvcGVydHkgdG8gY2hlY2sgZm9yLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYga2V5IGlzIGEgZGlyZWN0IHByb3BlcnR5LCBlbHNlIGBmYWxzZWAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uaGFzKHsgJ2EnOiAxLCAnYic6IDIsICdjJzogMyB9LCAnYicpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqL1xuICBmdW5jdGlvbiBoYXMob2JqZWN0LCBwcm9wZXJ0eSkge1xuICAgIHJldHVybiBvYmplY3QgPyBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpIDogZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgb2YgdGhlIGludmVydGVkIGtleXMgYW5kIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gYG9iamVjdGAuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGludmVydC5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3JlYXRlZCBpbnZlcnRlZCBvYmplY3QuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqICBfLmludmVydCh7ICdmaXJzdCc6ICdNb2UnLCAnc2Vjb25kJzogJ0xhcnJ5JywgJ3RoaXJkJzogJ0N1cmx5JyB9KTtcbiAgICogLy8gPT4geyAnTW9lJzogJ2ZpcnN0JywgJ0xhcnJ5JzogJ3NlY29uZCcsICdDdXJseSc6ICd0aGlyZCcgfSAob3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gICAqL1xuICBmdW5jdGlvbiBpbnZlcnQob2JqZWN0KSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGZvck93bihvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgIHJlc3VsdFt2YWx1ZV0gPSBrZXk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhbiBhcnJheS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBhbiBhcnJheSwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiAoZnVuY3Rpb24oKSB7IHJldHVybiBfLmlzQXJyYXkoYXJndW1lbnRzKTsgfSkoKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICpcbiAgICogXy5pc0FycmF5KFsxLCAyLCAzXSk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIHZhciBpc0FycmF5ID0gbmF0aXZlSXNBcnJheSB8fCBmdW5jdGlvbih2YWx1ZSkge1xuICAgIC8vIGBpbnN0YW5jZW9mYCBtYXkgY2F1c2UgYSBtZW1vcnkgbGVhayBpbiBJRSA3IGlmIGB2YWx1ZWAgaXMgYSBob3N0IG9iamVjdFxuICAgIC8vIGh0dHA6Ly9hamF4aWFuLmNvbS9hcmNoaXZlcy93b3JraW5nLWFyb3VuZy10aGUtaW5zdGFuY2VvZi1tZW1vcnktbGVha1xuICAgIHJldHVybiAoYXJnc0FyZU9iamVjdHMgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgfHwgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gYXJyYXlDbGFzcztcbiAgfTtcblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBib29sZWFuIChgdHJ1ZWAgb3IgYGZhbHNlYCkgdmFsdWUuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB2YWx1ZWAgaXMgYSBib29sZWFuIHZhbHVlLCBlbHNlIGBmYWxzZWAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uaXNCb29sZWFuKG51bGwpO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNCb29sZWFuKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBmYWxzZSB8fCB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PSBib29sQ2xhc3M7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBkYXRlLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBgdmFsdWVgIGlzIGEgZGF0ZSwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzRGF0ZShuZXcgRGF0ZSk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIGZ1bmN0aW9uIGlzRGF0ZSh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgfHwgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gZGF0ZUNsYXNzO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgRE9NIGVsZW1lbnQuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB2YWx1ZWAgaXMgYSBET00gZWxlbWVudCwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzRWxlbWVudChkb2N1bWVudC5ib2R5KTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNFbGVtZW50KHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlID8gdmFsdWUubm9kZVR5cGUgPT09IDEgOiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBlbXB0eS4gQXJyYXlzLCBzdHJpbmdzLCBvciBgYXJndW1lbnRzYCBvYmplY3RzIHdpdGggYVxuICAgKiBsZW5ndGggb2YgYDBgIGFuZCBvYmplY3RzIHdpdGggbm8gb3duIGVudW1lcmFibGUgcHJvcGVydGllcyBhcmUgY29uc2lkZXJlZFxuICAgKiBcImVtcHR5XCIuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBgdmFsdWVgIGlzIGVtcHR5LCBlbHNlIGBmYWxzZWAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uaXNFbXB0eShbMSwgMiwgM10pO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKlxuICAgKiBfLmlzRW1wdHkoe30pO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNFbXB0eSgnJyk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIGZ1bmN0aW9uIGlzRW1wdHkodmFsdWUpIHtcbiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbCh2YWx1ZSksXG4gICAgICAgIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcblxuICAgIGlmICgoY2xhc3NOYW1lID09IGFycmF5Q2xhc3MgfHwgY2xhc3NOYW1lID09IHN0cmluZ0NsYXNzIHx8XG4gICAgICAgIGNsYXNzTmFtZSA9PSBhcmdzQ2xhc3MgfHwgKG5vQXJnc0NsYXNzICYmIGlzQXJndW1lbnRzKHZhbHVlKSkpIHx8XG4gICAgICAgIChjbGFzc05hbWUgPT0gb2JqZWN0Q2xhc3MgJiYgdHlwZW9mIGxlbmd0aCA9PSAnbnVtYmVyJyAmJiBpc0Z1bmN0aW9uKHZhbHVlLnNwbGljZSkpKSB7XG4gICAgICByZXR1cm4gIWxlbmd0aDtcbiAgICB9XG4gICAgZm9yT3duKHZhbHVlLCBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAocmVzdWx0ID0gZmFsc2UpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybXMgYSBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZVxuICAgKiBlcXVpdmFsZW50IHRvIGVhY2ggb3RoZXIuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gYSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAgICogQHBhcmFtIHtNaXhlZH0gYiBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAgICogQHBhcmFtLSB7T2JqZWN0fSBbc3RhY2tBPVtdXSBJbnRlcm5hbGx5IHVzZWQgdHJhY2sgdHJhdmVyc2VkIGBhYCBvYmplY3RzLlxuICAgKiBAcGFyYW0tIHtPYmplY3R9IFtzdGFja0I9W11dIEludGVybmFsbHkgdXNlZCB0cmFjayB0cmF2ZXJzZWQgYGJgIG9iamVjdHMuXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXV2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIG1vZSA9IHsgJ25hbWUnOiAnbW9lJywgJ2x1Y2t5TnVtYmVycyc6IFsxMywgMjcsIDM0XSB9O1xuICAgKiB2YXIgY2xvbmUgPSB7ICduYW1lJzogJ21vZScsICdsdWNreU51bWJlcnMnOiBbMTMsIDI3LCAzNF0gfTtcbiAgICpcbiAgICogbW9lID09IGNsb25lO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKlxuICAgKiBfLmlzRXF1YWwobW9lLCBjbG9uZSk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIGZ1bmN0aW9uIGlzRXF1YWwoYSwgYiwgc3RhY2tBLCBzdGFja0IpIHtcbiAgICAvLyBleGl0IGVhcmx5IGZvciBpZGVudGljYWwgdmFsdWVzXG4gICAgaWYgKGEgPT09IGIpIHtcbiAgICAgIC8vIHRyZWF0IGArMGAgdnMuIGAtMGAgYXMgbm90IGVxdWFsXG4gICAgICByZXR1cm4gYSAhPT0gMCB8fCAoMSAvIGEgPT0gMSAvIGIpO1xuICAgIH1cbiAgICAvLyBhIHN0cmljdCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIGBudWxsID09IHVuZGVmaW5lZGBcbiAgICBpZiAoYSA9PSBudWxsIHx8IGIgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfVxuICAgIC8vIGNvbXBhcmUgW1tDbGFzc11dIG5hbWVzXG4gICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSksXG4gICAgICAgIG90aGVyTmFtZSA9IHRvU3RyaW5nLmNhbGwoYik7XG5cbiAgICBpZiAoY2xhc3NOYW1lID09IGFyZ3NDbGFzcykge1xuICAgICAgY2xhc3NOYW1lID0gb2JqZWN0Q2xhc3M7XG4gICAgfVxuICAgIGlmIChvdGhlck5hbWUgPT0gYXJnc0NsYXNzKSB7XG4gICAgICBvdGhlck5hbWUgPSBvYmplY3RDbGFzcztcbiAgICB9XG4gICAgaWYgKGNsYXNzTmFtZSAhPSBvdGhlck5hbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgc3dpdGNoIChjbGFzc05hbWUpIHtcbiAgICAgIGNhc2UgYm9vbENsYXNzOlxuICAgICAgY2FzZSBkYXRlQ2xhc3M6XG4gICAgICAgIC8vIGNvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtYmVycywgZGF0ZXMgdG8gbWlsbGlzZWNvbmRzIGFuZCBib29sZWFuc1xuICAgICAgICAvLyB0byBgMWAgb3IgYDBgLCB0cmVhdGluZyBpbnZhbGlkIGRhdGVzIGNvZXJjZWQgdG8gYE5hTmAgYXMgbm90IGVxdWFsXG4gICAgICAgIHJldHVybiArYSA9PSArYjtcblxuICAgICAgY2FzZSBudW1iZXJDbGFzczpcbiAgICAgICAgLy8gdHJlYXQgYE5hTmAgdnMuIGBOYU5gIGFzIGVxdWFsXG4gICAgICAgIHJldHVybiBhICE9ICthXG4gICAgICAgICAgPyBiICE9ICtiXG4gICAgICAgICAgLy8gYnV0IHRyZWF0IGArMGAgdnMuIGAtMGAgYXMgbm90IGVxdWFsXG4gICAgICAgICAgOiAoYSA9PSAwID8gKDEgLyBhID09IDEgLyBiKSA6IGEgPT0gK2IpO1xuXG4gICAgICBjYXNlIHJlZ2V4cENsYXNzOlxuICAgICAgY2FzZSBzdHJpbmdDbGFzczpcbiAgICAgICAgLy8gY29lcmNlIHJlZ2V4ZXMgdG8gc3RyaW5ncyAoaHR0cDovL2VzNS5naXRodWIuY29tLyN4MTUuMTAuNi40KVxuICAgICAgICAvLyB0cmVhdCBzdHJpbmcgcHJpbWl0aXZlcyBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBvYmplY3QgaW5zdGFuY2VzIGFzIGVxdWFsXG4gICAgICAgIHJldHVybiBhID09IGIgKyAnJztcbiAgICB9XG4gICAgdmFyIGlzQXJyID0gY2xhc3NOYW1lID09IGFycmF5Q2xhc3M7XG4gICAgaWYgKCFpc0Fycikge1xuICAgICAgLy8gdW53cmFwIGFueSBgbG9kYXNoYCB3cmFwcGVkIHZhbHVlc1xuICAgICAgaWYgKGEuX193cmFwcGVkX18gfHwgYi5fX3dyYXBwZWRfXykge1xuICAgICAgICByZXR1cm4gaXNFcXVhbChhLl9fd3JhcHBlZF9fIHx8IGEsIGIuX193cmFwcGVkX18gfHwgYik7XG4gICAgICB9XG4gICAgICAvLyBleGl0IGZvciBmdW5jdGlvbnMgYW5kIERPTSBub2Rlc1xuICAgICAgaWYgKGNsYXNzTmFtZSAhPSBvYmplY3RDbGFzcyB8fCAobm9Ob2RlQ2xhc3MgJiYgKGlzTm9kZShhKSB8fCBpc05vZGUoYikpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBpbiBvbGRlciB2ZXJzaW9ucyBvZiBPcGVyYSwgYGFyZ3VtZW50c2Agb2JqZWN0cyBoYXZlIGBBcnJheWAgY29uc3RydWN0b3JzXG4gICAgICB2YXIgY3RvckEgPSAhYXJnc0FyZU9iamVjdHMgJiYgaXNBcmd1bWVudHMoYSkgPyBPYmplY3QgOiBhLmNvbnN0cnVjdG9yLFxuICAgICAgICAgIGN0b3JCID0gIWFyZ3NBcmVPYmplY3RzICYmIGlzQXJndW1lbnRzKGIpID8gT2JqZWN0IDogYi5jb25zdHJ1Y3RvcjtcblxuICAgICAgLy8gbm9uIGBPYmplY3RgIG9iamVjdCBpbnN0YW5jZXMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1YWxcbiAgICAgIGlmIChjdG9yQSAhPSBjdG9yQiAmJiAhKFxuICAgICAgICAgICAgaXNGdW5jdGlvbihjdG9yQSkgJiYgY3RvckEgaW5zdGFuY2VvZiBjdG9yQSAmJlxuICAgICAgICAgICAgaXNGdW5jdGlvbihjdG9yQikgJiYgY3RvckIgaW5zdGFuY2VvZiBjdG9yQlxuICAgICAgICAgICkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBhc3N1bWUgY3ljbGljIHN0cnVjdHVyZXMgYXJlIGVxdWFsXG4gICAgLy8gdGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjFcbiAgICAvLyBzZWN0aW9uIDE1LjEyLjMsIGFic3RyYWN0IG9wZXJhdGlvbiBgSk9gIChodHRwOi8vZXM1LmdpdGh1Yi5jb20vI3gxNS4xMi4zKVxuICAgIHN0YWNrQSB8fCAoc3RhY2tBID0gW10pO1xuICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pO1xuXG4gICAgdmFyIGxlbmd0aCA9IHN0YWNrQS5sZW5ndGg7XG4gICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICBpZiAoc3RhY2tBW2xlbmd0aF0gPT0gYSkge1xuICAgICAgICByZXR1cm4gc3RhY2tCW2xlbmd0aF0gPT0gYjtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIHJlc3VsdCA9IHRydWUsXG4gICAgICAgIHNpemUgPSAwO1xuXG4gICAgLy8gYWRkIGBhYCBhbmQgYGJgIHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0c1xuICAgIHN0YWNrQS5wdXNoKGEpO1xuICAgIHN0YWNrQi5wdXNoKGIpO1xuXG4gICAgLy8gcmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKVxuICAgIGlmIChpc0Fycikge1xuICAgICAgLy8gY29tcGFyZSBsZW5ndGhzIHRvIGRldGVybWluZSBpZiBhIGRlZXAgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnlcbiAgICAgIHNpemUgPSBhLmxlbmd0aDtcbiAgICAgIHJlc3VsdCA9IHNpemUgPT0gYi5sZW5ndGg7XG5cbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgLy8gZGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllc1xuICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7XG4gICAgICAgICAgaWYgKCEocmVzdWx0ID0gaXNFcXVhbChhW3NpemVdLCBiW3NpemVdLCBzdGFja0EsIHN0YWNrQikpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8vIGRlZXAgY29tcGFyZSBvYmplY3RzIHVzaW5nIGBmb3JJbmAsIGluc3RlYWQgb2YgYGZvck93bmAsIHRvIGF2b2lkIGBPYmplY3Qua2V5c2BcbiAgICAvLyB3aGljaCwgaW4gdGhpcyBjYXNlLCBpcyBtb3JlIGNvc3RseVxuICAgIGZvckluKGEsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGEpIHtcbiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGEsIGtleSkpIHtcbiAgICAgICAgLy8gY291bnQgdGhlIG51bWJlciBvZiBwcm9wZXJ0aWVzLlxuICAgICAgICBzaXplKys7XG4gICAgICAgIC8vIGRlZXAgY29tcGFyZSBlYWNoIHByb3BlcnR5IHZhbHVlLlxuICAgICAgICByZXR1cm4gKHJlc3VsdCA9IGhhc093blByb3BlcnR5LmNhbGwoYiwga2V5KSAmJiBpc0VxdWFsKHZhbHVlLCBiW2tleV0sIHN0YWNrQSwgc3RhY2tCKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICAvLyBlbnN1cmUgYm90aCBvYmplY3RzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXNcbiAgICAgIGZvckluKGIsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGIpIHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoYiwga2V5KSkge1xuICAgICAgICAgIC8vIGBzaXplYCB3aWxsIGJlIGAtMWAgaWYgYGJgIGhhcyBtb3JlIHByb3BlcnRpZXMgdGhhbiBgYWBcbiAgICAgICAgICByZXR1cm4gKHJlc3VsdCA9IC0tc2l6ZSA+IC0xKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMsIG9yIGNhbiBiZSBjb2VyY2VkIHRvLCBhIGZpbml0ZSBudW1iZXIuXG4gICAqXG4gICAqIE5vdGU6IFRoaXMgaXMgbm90IHRoZSBzYW1lIGFzIG5hdGl2ZSBgaXNGaW5pdGVgLCB3aGljaCB3aWxsIHJldHVybiB0cnVlIGZvclxuICAgKiBib29sZWFucyBhbmQgZW1wdHkgc3RyaW5ncy4gU2VlIGh0dHA6Ly9lczUuZ2l0aHViLmNvbS8jeDE1LjEuMi41LlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBgdmFsdWVgIGlzIGEgZmluaXRlIG51bWJlciwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzRmluaXRlKC0xMDEpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNGaW5pdGUoJzEwJyk7XG4gICAqIC8vID0+IHRydWVcbiAgICpcbiAgICogXy5pc0Zpbml0ZSh0cnVlKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICpcbiAgICogXy5pc0Zpbml0ZSgnJyk7XG4gICAqIC8vID0+IGZhbHNlXG4gICAqXG4gICAqIF8uaXNGaW5pdGUoSW5maW5pdHkpO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNGaW5pdGUodmFsdWUpIHtcbiAgICByZXR1cm4gbmF0aXZlSXNGaW5pdGUodmFsdWUpICYmICFuYXRpdmVJc05hTihwYXJzZUZsb2F0KHZhbHVlKSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBmdW5jdGlvbi5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBhIGZ1bmN0aW9uLCBlbHNlIGBmYWxzZWAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uaXNGdW5jdGlvbihfKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJztcbiAgfVxuICAvLyBmYWxsYmFjayBmb3Igb2xkZXIgdmVyc2lvbnMgb2YgQ2hyb21lIGFuZCBTYWZhcmlcbiAgaWYgKGlzRnVuY3Rpb24oL3gvKSkge1xuICAgIGlzRnVuY3Rpb24gPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgRnVuY3Rpb24gfHwgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gZnVuY0NsYXNzO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgdGhlIGxhbmd1YWdlIHR5cGUgb2YgT2JqZWN0LlxuICAgKiAoZS5nLiBhcnJheXMsIGZ1bmN0aW9ucywgb2JqZWN0cywgcmVnZXhlcywgYG5ldyBOdW1iZXIoMClgLCBhbmQgYG5ldyBTdHJpbmcoJycpYClcbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pc09iamVjdCh7fSk7XG4gICAqIC8vID0+IHRydWVcbiAgICpcbiAgICogXy5pc09iamVjdChbMSwgMiwgM10pO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNPYmplY3QoMSk7XG4gICAqIC8vID0+IGZhbHNlXG4gICAqL1xuICBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkge1xuICAgIC8vIGNoZWNrIGlmIHRoZSB2YWx1ZSBpcyB0aGUgRUNNQVNjcmlwdCBsYW5ndWFnZSB0eXBlIG9mIE9iamVjdFxuICAgIC8vIGh0dHA6Ly9lczUuZ2l0aHViLmNvbS8jeDhcbiAgICAvLyBhbmQgYXZvaWQgYSBWOCBidWdcbiAgICAvLyBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0yMjkxXG4gICAgcmV0dXJuIHZhbHVlID8gb2JqZWN0VHlwZXNbdHlwZW9mIHZhbHVlXSA6IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBOYU5gLlxuICAgKlxuICAgKiBOb3RlOiBUaGlzIGlzIG5vdCB0aGUgc2FtZSBhcyBuYXRpdmUgYGlzTmFOYCwgd2hpY2ggd2lsbCByZXR1cm4gYHRydWVgIGZvclxuICAgKiBgdW5kZWZpbmVkYCBhbmQgb3RoZXIgdmFsdWVzLiBTZWUgaHR0cDovL2VzNS5naXRodWIuY29tLyN4MTUuMS4yLjQuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB2YWx1ZWAgaXMgYE5hTmAsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pc05hTihOYU4pO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNOYU4obmV3IE51bWJlcihOYU4pKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKlxuICAgKiBpc05hTih1bmRlZmluZWQpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uaXNOYU4odW5kZWZpbmVkKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIGlzTmFOKHZhbHVlKSB7XG4gICAgLy8gYE5hTmAgYXMgYSBwcmltaXRpdmUgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBpcyBub3QgZXF1YWwgdG8gaXRzZWxmXG4gICAgLy8gKHBlcmZvcm0gdGhlIFtbQ2xhc3NdXSBjaGVjayBmaXJzdCB0byBhdm9pZCBlcnJvcnMgd2l0aCBzb21lIGhvc3Qgb2JqZWN0cyBpbiBJRSlcbiAgICByZXR1cm4gaXNOdW1iZXIodmFsdWUpICYmIHZhbHVlICE9ICt2YWx1ZVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBgbnVsbGAsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pc051bGwobnVsbCk7XG4gICAqIC8vID0+IHRydWVcbiAgICpcbiAgICogXy5pc051bGwodW5kZWZpbmVkKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIGlzTnVsbCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIG51bWJlci5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBhIG51bWJlciwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzTnVtYmVyKDguNCAqIDUpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqL1xuICBmdW5jdGlvbiBpc051bWJlcih2YWx1ZSkge1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgfHwgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gbnVtYmVyQ2xhc3M7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGEgZ2l2ZW4gYHZhbHVlYCBpcyBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUgYE9iamVjdGAgY29uc3RydWN0b3IuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBmdW5jdGlvbiBTdG9vZ2UobmFtZSwgYWdlKSB7XG4gICAqICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICogICB0aGlzLmFnZSA9IGFnZTtcbiAgICogfVxuICAgKlxuICAgKiBfLmlzUGxhaW5PYmplY3QobmV3IFN0b29nZSgnbW9lJywgNDApKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICpcbiAgICogXy5pc1BsYWluT2JqZWN0KFsxLCAyLCAzXSk7XG4gICAqIC8vID0+IGZhbHNlXG4gICAqXG4gICAqIF8uaXNQbGFpbk9iamVjdCh7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9KTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgdmFyIGlzUGxhaW5PYmplY3QgPSAhZ2V0UHJvdG90eXBlT2YgPyBzaGltSXNQbGFpbk9iamVjdCA6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgaWYgKCEodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2YXIgdmFsdWVPZiA9IHZhbHVlLnZhbHVlT2YsXG4gICAgICAgIG9ialByb3RvID0gdHlwZW9mIHZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyAmJiAob2JqUHJvdG8gPSBnZXRQcm90b3R5cGVPZih2YWx1ZU9mKSkgJiYgZ2V0UHJvdG90eXBlT2Yob2JqUHJvdG8pO1xuXG4gICAgcmV0dXJuIG9ialByb3RvXG4gICAgICA/IHZhbHVlID09IG9ialByb3RvIHx8IChnZXRQcm90b3R5cGVPZih2YWx1ZSkgPT0gb2JqUHJvdG8gJiYgIWlzQXJndW1lbnRzKHZhbHVlKSlcbiAgICAgIDogc2hpbUlzUGxhaW5PYmplY3QodmFsdWUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzUmVnRXhwKC9tb2UvKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNSZWdFeHAodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBSZWdFeHAgfHwgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gcmVnZXhwQ2xhc3M7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBzdHJpbmcuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IE9iamVjdHNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB2YWx1ZWAgaXMgYSBzdHJpbmcsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pc1N0cmluZygnbW9lJyk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIGZ1bmN0aW9uIGlzU3RyaW5nKHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PSBzdHJpbmdDbGFzcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYCwgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmlzVW5kZWZpbmVkKHZvaWQgMCk7XG4gICAqIC8vID0+IHRydWVcbiAgICovXG4gIGZ1bmN0aW9uIGlzVW5kZWZpbmVkKHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAndW5kZWZpbmVkJztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IGNvbXBvc2VkIG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmtleXMoeyAnb25lJzogMSwgJ3R3byc6IDIsICd0aHJlZSc6IDMgfSk7XG4gICAqIC8vID0+IFsnb25lJywgJ3R3bycsICd0aHJlZSddIChvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICovXG4gIHZhciBrZXlzID0gIW5hdGl2ZUtleXMgPyBzaGltS2V5cyA6IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgIC8vIGF2b2lkIGl0ZXJhdGluZyBvdmVyIHRoZSBgcHJvdG90eXBlYCBwcm9wZXJ0eVxuICAgIHJldHVybiB0eXBlb2Ygb2JqZWN0ID09ICdmdW5jdGlvbicgJiYgcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChvYmplY3QsICdwcm90b3R5cGUnKVxuICAgICAgPyBzaGltS2V5cyhvYmplY3QpXG4gICAgICA6IChpc09iamVjdChvYmplY3QpID8gbmF0aXZlS2V5cyhvYmplY3QpIDogW10pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBNZXJnZXMgZW51bWVyYWJsZSBwcm9wZXJ0aWVzIG9mIHRoZSBzb3VyY2Ugb2JqZWN0KHMpIGludG8gdGhlIGBkZXN0aW5hdGlvbmBcbiAgICogb2JqZWN0LiBTdWJzZXF1ZW50IHNvdXJjZXMgd2lsbCBvdmVyd3JpdGUgcHJvcGVyeSBhc3NpZ25tZW50cyBvZiBwcmV2aW91c1xuICAgKiBzb3VyY2VzLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAgICogQHBhcmFtIHtPYmplY3R9IFtzb3VyY2UxLCBzb3VyY2UyLCAuLi5dIFRoZSBzb3VyY2Ugb2JqZWN0cy5cbiAgICogQHBhcmFtLSB7T2JqZWN0fSBbaW5kaWNhdG9yXSBJbnRlcm5hbGx5IHVzZWQgdG8gaW5kaWNhdGUgdGhhdCB0aGUgYHN0YWNrYFxuICAgKiAgYXJndW1lbnQgaXMgYW4gYXJyYXkgb2YgdHJhdmVyc2VkIG9iamVjdHMgaW5zdGVhZCBvZiBhbm90aGVyIHNvdXJjZSBvYmplY3QuXG4gICAqIEBwYXJhbS0ge0FycmF5fSBbc3RhY2tBPVtdXSBJbnRlcm5hbGx5IHVzZWQgdG8gdHJhY2sgdHJhdmVyc2VkIHNvdXJjZSBvYmplY3RzLlxuICAgKiBAcGFyYW0tIHtBcnJheX0gW3N0YWNrQj1bXV0gSW50ZXJuYWxseSB1c2VkIHRvIGFzc29jaWF0ZSB2YWx1ZXMgd2l0aCB0aGVpclxuICAgKiAgc291cmNlIGNvdW50ZXJwYXJ0cy5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgc3Rvb2dlcyA9IFtcbiAgICogICB7ICduYW1lJzogJ21vZScgfSxcbiAgICogICB7ICduYW1lJzogJ2xhcnJ5JyB9XG4gICAqIF07XG4gICAqXG4gICAqIHZhciBhZ2VzID0gW1xuICAgKiAgIHsgJ2FnZSc6IDQwIH0sXG4gICAqICAgeyAnYWdlJzogNTAgfVxuICAgKiBdO1xuICAgKlxuICAgKiBfLm1lcmdlKHN0b29nZXMsIGFnZXMpO1xuICAgKiAvLyA9PiBbeyAnbmFtZSc6ICdtb2UnLCAnYWdlJzogNDAgfSwgeyAnbmFtZSc6ICdsYXJyeScsICdhZ2UnOiA1MCB9XVxuICAgKi9cbiAgZnVuY3Rpb24gbWVyZ2Uob2JqZWN0LCBzb3VyY2UsIGluZGljYXRvcikge1xuICAgIHZhciBhcmdzID0gYXJndW1lbnRzLFxuICAgICAgICBpbmRleCA9IDAsXG4gICAgICAgIGxlbmd0aCA9IDIsXG4gICAgICAgIHN0YWNrQSA9IGFyZ3NbM10sXG4gICAgICAgIHN0YWNrQiA9IGFyZ3NbNF07XG5cbiAgICBpZiAoaW5kaWNhdG9yICE9PSBpbmRpY2F0b3JPYmplY3QpIHtcbiAgICAgIHN0YWNrQSA9IFtdO1xuICAgICAgc3RhY2tCID0gW107XG5cbiAgICAgIC8vIHdvcmsgd2l0aCBgXy5yZWR1Y2VgIGJ5IG9ubHkgdXNpbmcgaXRzIGNhbGxiYWNrIGBhY2N1bXVsYXRvcmAgYW5kIGB2YWx1ZWAgYXJndW1lbnRzXG4gICAgICBpZiAodHlwZW9mIGluZGljYXRvciAhPSAnbnVtYmVyJykge1xuICAgICAgICBsZW5ndGggPSBhcmdzLmxlbmd0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGZvck93bihhcmdzW2luZGV4XSwgZnVuY3Rpb24oc291cmNlLCBrZXkpIHtcbiAgICAgICAgdmFyIGZvdW5kLCBpc0FyciwgdmFsdWU7XG4gICAgICAgIGlmIChzb3VyY2UgJiYgKChpc0FyciA9IGlzQXJyYXkoc291cmNlKSkgfHwgaXNQbGFpbk9iamVjdChzb3VyY2UpKSkge1xuICAgICAgICAgIC8vIGF2b2lkIG1lcmdpbmcgcHJldmlvdXNseSBtZXJnZWQgY3ljbGljIHNvdXJjZXNcbiAgICAgICAgICB2YXIgc3RhY2tMZW5ndGggPSBzdGFja0EubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlIChzdGFja0xlbmd0aC0tKSB7XG4gICAgICAgICAgICBmb3VuZCA9IHN0YWNrQVtzdGFja0xlbmd0aF0gPT0gc291cmNlO1xuICAgICAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgICAgIG9iamVjdFtrZXldID0gc3RhY2tCW3N0YWNrTGVuZ3RoXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBhZGQgYHNvdXJjZWAgYW5kIGFzc29jaWF0ZWQgYHZhbHVlYCB0byB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHNcbiAgICAgICAgICAgIHN0YWNrQS5wdXNoKHNvdXJjZSk7XG4gICAgICAgICAgICBzdGFja0IucHVzaCh2YWx1ZSA9ICh2YWx1ZSA9IG9iamVjdFtrZXldLCBpc0FycilcbiAgICAgICAgICAgICAgPyAoaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFtdKVxuICAgICAgICAgICAgICA6IChpc1BsYWluT2JqZWN0KHZhbHVlKSA/IHZhbHVlIDoge30pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gcmVjdXJzaXZlbHkgbWVyZ2Ugb2JqZWN0cyBhbmQgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cylcbiAgICAgICAgICAgIG9iamVjdFtrZXldID0gbWVyZ2UodmFsdWUsIHNvdXJjZSwgaW5kaWNhdG9yT2JqZWN0LCBzdGFja0EsIHN0YWNrQik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHNvdXJjZSAhPSBudWxsKSB7XG4gICAgICAgICAgb2JqZWN0W2tleV0gPSBzb3VyY2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gb2JqZWN0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBzaGFsbG93IGNsb25lIG9mIGBvYmplY3RgIGV4Y2x1ZGluZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAqIFByb3BlcnR5IG5hbWVzIG1heSBiZSBzcGVjaWZpZWQgYXMgaW5kaXZpZHVhbCBhcmd1bWVudHMgb3IgYXMgYXJyYXlzIG9mXG4gICAqIHByb3BlcnR5IG5hbWVzLiBJZiBgY2FsbGJhY2tgIGlzIHBhc3NlZCwgaXQgd2lsbCBiZSBleGVjdXRlZCBmb3IgZWFjaCBwcm9wZXJ0eVxuICAgKiBpbiB0aGUgYG9iamVjdGAsIG9taXR0aW5nIHRoZSBwcm9wZXJ0aWVzIGBjYWxsYmFja2AgcmV0dXJucyB0cnV0aHkgZm9yLiBUaGVcbiAgICogYGNhbGxiYWNrYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwga2V5LCBvYmplY3QpLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBjYWxsYmFja3xbcHJvcDEsIHByb3AyLCAuLi5dIFRoZSBwcm9wZXJ0aWVzIHRvIG9taXRcbiAgICogIG9yIHRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCB3aXRob3V0IHRoZSBvbWl0dGVkIHByb3BlcnRpZXMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8ub21pdCh7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCwgJ3VzZXJpZCc6ICdtb2UxJyB9LCAndXNlcmlkJyk7XG4gICAqIC8vID0+IHsgJ25hbWUnOiAnbW9lJywgJ2FnZSc6IDQwIH1cbiAgICpcbiAgICogXy5vbWl0KHsgJ25hbWUnOiAnbW9lJywgJ19oaW50JzogJ2tudWNrbGVoZWFkJywgJ19zZWVkJzogJzk2YzRlYicgfSwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgKiAgIHJldHVybiBrZXkuY2hhckF0KDApID09ICdfJztcbiAgICogfSk7XG4gICAqIC8vID0+IHsgJ25hbWUnOiAnbW9lJyB9XG4gICAqL1xuICBmdW5jdGlvbiBvbWl0KG9iamVjdCwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICB2YXIgaXNGdW5jID0gdHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicsXG4gICAgICAgIHJlc3VsdCA9IHt9O1xuXG4gICAgaWYgKGlzRnVuYykge1xuICAgICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBwcm9wcyA9IGNvbmNhdC5hcHBseShhcnJheVJlZiwgYXJndW1lbnRzKTtcbiAgICB9XG4gICAgZm9ySW4ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHtcbiAgICAgIGlmIChpc0Z1bmNcbiAgICAgICAgICAgID8gIWNhbGxiYWNrKHZhbHVlLCBrZXksIG9iamVjdClcbiAgICAgICAgICAgIDogaW5kZXhPZihwcm9wcywga2V5LCAxKSA8IDBcbiAgICAgICAgICApIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB0d28gZGltZW5zaW9uYWwgYXJyYXkgb2YgdGhlIGdpdmVuIG9iamVjdCdzIGtleS12YWx1ZSBwYWlycyxcbiAgICogaS5lLiBgW1trZXkxLCB2YWx1ZTFdLCBba2V5MiwgdmFsdWUyXV1gLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgbmV3IGFycmF5IG9mIGtleS12YWx1ZSBwYWlycy5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5wYWlycyh7ICdtb2UnOiAzMCwgJ2xhcnJ5JzogNDAsICdjdXJseSc6IDUwIH0pO1xuICAgKiAvLyA9PiBbWydtb2UnLCAzMF0sIFsnbGFycnknLCA0MF0sIFsnY3VybHknLCA1MF1dIChvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICovXG4gIGZ1bmN0aW9uIHBhaXJzKG9iamVjdCkge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBmb3JPd24ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICByZXN1bHQucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHNoYWxsb3cgY2xvbmUgb2YgYG9iamVjdGAgY29tcG9zZWQgb2YgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgKiBQcm9wZXJ0eSBuYW1lcyBtYXkgYmUgc3BlY2lmaWVkIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzIG9yIGFzIGFycmF5cyBvZlxuICAgKiBwcm9wZXJ0eSBuYW1lcy4gSWYgYGNhbGxiYWNrYCBpcyBwYXNzZWQsIGl0IHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggcHJvcGVydHlcbiAgICogaW4gdGhlIGBvYmplY3RgLCBwaWNraW5nIHRoZSBwcm9wZXJ0aWVzIGBjYWxsYmFja2AgcmV0dXJucyB0cnV0aHkgZm9yLiBUaGVcbiAgICogYGNhbGxiYWNrYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwga2V5LCBvYmplY3QpLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBPYmplY3RzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHNvdXJjZSBvYmplY3QuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBjYWxsYmFja3xbcHJvcDEsIHByb3AyLCAuLi5dIFRoZSBwcm9wZXJ0aWVzIHRvIHBpY2tcbiAgICogIG9yIHRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb21wb3NlZCBvZiB0aGUgcGlja2VkIHByb3BlcnRpZXMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8ucGljayh7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCwgJ3VzZXJpZCc6ICdtb2UxJyB9LCAnbmFtZScsICdhZ2UnKTtcbiAgICogLy8gPT4geyAnbmFtZSc6ICdtb2UnLCAnYWdlJzogNDAgfVxuICAgKlxuICAgKiBfLnBpY2soeyAnbmFtZSc6ICdtb2UnLCAnX2hpbnQnOiAna251Y2tsZWhlYWQnLCAnX3NlZWQnOiAnOTZjNGViJyB9LCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAqICAgcmV0dXJuIGtleS5jaGFyQXQoMCkgIT0gJ18nO1xuICAgKiB9KTtcbiAgICogLy8gPT4geyAnbmFtZSc6ICdtb2UnIH1cbiAgICovXG4gIGZ1bmN0aW9uIHBpY2sob2JqZWN0LCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBpbmRleCA9IDAsXG4gICAgICAgICAgcHJvcHMgPSBjb25jYXQuYXBwbHkoYXJyYXlSZWYsIGFyZ3VtZW50cyksXG4gICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdO1xuICAgICAgICBpZiAoa2V5IGluIG9iamVjdCkge1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gb2JqZWN0W2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG4gICAgICBmb3JJbihvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iamVjdCkge1xuICAgICAgICBpZiAoY2FsbGJhY2sodmFsdWUsIGtleSwgb2JqZWN0KSkge1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gYXJyYXkgY29tcG9zZWQgb2YgdGhlIG93biBlbnVtZXJhYmxlIHByb3BlcnR5IHZhbHVlcyBvZiBgb2JqZWN0YC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgT2JqZWN0c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy52YWx1ZXMoeyAnb25lJzogMSwgJ3R3byc6IDIsICd0aHJlZSc6IDMgfSk7XG4gICAqIC8vID0+IFsxLCAyLCAzXVxuICAgKi9cbiAgZnVuY3Rpb24gdmFsdWVzKG9iamVjdCkge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBmb3JPd24ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGEgZ2l2ZW4gYHRhcmdldGAgZWxlbWVudCBpcyBwcmVzZW50IGluIGEgYGNvbGxlY3Rpb25gIHVzaW5nIHN0cmljdFxuICAgKiBlcXVhbGl0eSBmb3IgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuIElmIGBmcm9tSW5kZXhgIGlzIG5lZ2F0aXZlLCBpdCBpcyB1c2VkXG4gICAqIGFzIHRoZSBvZmZzZXQgZnJvbSB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBpbmNsdWRlXG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge01peGVkfSB0YXJnZXQgVGhlIHZhbHVlIHRvIGNoZWNrIGZvci5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcm9tSW5kZXg9MF0gVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGB0YXJnZXRgIGVsZW1lbnQgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5jb250YWlucyhbMSwgMiwgM10sIDEpO1xuICAgKiAvLyA9PiB0cnVlXG4gICAqXG4gICAqIF8uY29udGFpbnMoWzEsIDIsIDNdLCAxLCAyKTtcbiAgICogLy8gPT4gZmFsc2VcbiAgICpcbiAgICogXy5jb250YWlucyh7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9LCAnbW9lJyk7XG4gICAqIC8vID0+IHRydWVcbiAgICpcbiAgICogXy5jb250YWlucygnY3VybHknLCAndXInKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gY29udGFpbnMoY29sbGVjdGlvbiwgdGFyZ2V0LCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbiA/IGNvbGxlY3Rpb24ubGVuZ3RoIDogMCxcbiAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG5cbiAgICBmcm9tSW5kZXggPSAoZnJvbUluZGV4IDwgMCA/IG5hdGl2ZU1heCgwLCBsZW5ndGggKyBmcm9tSW5kZXgpIDogZnJvbUluZGV4KSB8fCAwO1xuICAgIGlmICh0eXBlb2YgbGVuZ3RoID09ICdudW1iZXInKSB7XG4gICAgICByZXN1bHQgPSAoaXNTdHJpbmcoY29sbGVjdGlvbilcbiAgICAgICAgPyBjb2xsZWN0aW9uLmluZGV4T2YodGFyZ2V0LCBmcm9tSW5kZXgpXG4gICAgICAgIDogaW5kZXhPZihjb2xsZWN0aW9uLCB0YXJnZXQsIGZyb21JbmRleClcbiAgICAgICkgPiAtMTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICBpZiAoKytpbmRleCA+PSBmcm9tSW5kZXgpIHtcbiAgICAgICAgICByZXR1cm4gIShyZXN1bHQgPSB2YWx1ZSA9PT0gdGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgb2Yga2V5cyByZXR1cm5lZCBmcm9tIHJ1bm5pbmcgZWFjaCBlbGVtZW50IG9mXG4gICAqIGBjb2xsZWN0aW9uYCB0aHJvdWdoIGEgYGNhbGxiYWNrYC4gVGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgb2YgZWFjaCBrZXkgaXNcbiAgICogdGhlIG51bWJlciBvZiB0aW1lcyB0aGUga2V5IHdhcyByZXR1cm5lZCBieSBgY2FsbGJhY2tgLiBUaGUgYGNhbGxiYWNrYCBpc1xuICAgKiBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICogVGhlIGBjYWxsYmFja2AgYXJndW1lbnQgbWF5IGFsc28gYmUgdGhlIG5hbWUgb2YgYSBwcm9wZXJ0eSB0byBjb3VudCBieSAoZS5nLiAnbGVuZ3RoJykuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBjYWxsYmFja3xwcm9wZXJ0eSBUaGUgZnVuY3Rpb24gY2FsbGVkIHBlciBpdGVyYXRpb25cbiAgICogIG9yIHByb3BlcnR5IG5hbWUgdG8gY291bnQgYnkuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGNhbGxiYWNrYC5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY29tcG9zZWQgYWdncmVnYXRlIG9iamVjdC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5jb3VudEJ5KFs0LjMsIDYuMSwgNi40XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiBNYXRoLmZsb29yKG51bSk7IH0pO1xuICAgKiAvLyA9PiB7ICc0JzogMSwgJzYnOiAyIH1cbiAgICpcbiAgICogXy5jb3VudEJ5KFs0LjMsIDYuMSwgNi40XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiB0aGlzLmZsb29yKG51bSk7IH0sIE1hdGgpO1xuICAgKiAvLyA9PiB7ICc0JzogMSwgJzYnOiAyIH1cbiAgICpcbiAgICogXy5jb3VudEJ5KFsnb25lJywgJ3R3bycsICd0aHJlZSddLCAnbGVuZ3RoJyk7XG4gICAqIC8vID0+IHsgJzMnOiAyLCAnNSc6IDEgfVxuICAgKi9cbiAgZnVuY3Rpb24gY291bnRCeShjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBjYWxsYmFjayA9IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnKTtcblxuICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGtleSwgY29sbGVjdGlvbikge1xuICAgICAga2V5ID0gY2FsbGJhY2sodmFsdWUsIGtleSwgY29sbGVjdGlvbik7XG4gICAgICAoaGFzT3duUHJvcGVydHkuY2FsbChyZXN1bHQsIGtleSkgPyByZXN1bHRba2V5XSsrIDogcmVzdWx0W2tleV0gPSAxKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgYGNhbGxiYWNrYCByZXR1cm5zIGEgdHJ1dGh5IHZhbHVlIGZvciAqKmFsbCoqIGVsZW1lbnRzIG9mIGFcbiAgICogYGNvbGxlY3Rpb25gLiBUaGUgYGNhbGxiYWNrYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZVxuICAgKiBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAYWxpYXMgYWxsXG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2s9aWRlbnRpdHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYWxsIGVsZW1lbnRzIHBhc3MgdGhlIGNhbGxiYWNrIGNoZWNrLFxuICAgKiAgZWxzZSBgZmFsc2VgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmV2ZXJ5KFt0cnVlLCAxLCBudWxsLCAneWVzJ10sIEJvb2xlYW4pO1xuICAgKiAvLyA9PiBmYWxzZVxuICAgKi9cbiAgZnVuY3Rpb24gZXZlcnkoY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcbiAgICBjYWxsYmFjayA9IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnKTtcblxuICAgIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgaWYgKCEocmVzdWx0ID0gISFjYWxsYmFjayhjb2xsZWN0aW9uW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiAocmVzdWx0ID0gISFjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4YW1pbmVzIGVhY2ggZWxlbWVudCBpbiBhIGBjb2xsZWN0aW9uYCwgcmV0dXJuaW5nIGFuIGFycmF5IG9mIGFsbCBlbGVtZW50c1xuICAgKiB0aGUgYGNhbGxiYWNrYCByZXR1cm5zIHRydXRoeSBmb3IuIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmRcbiAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBzZWxlY3RcbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFjaz1pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBhcnJheSBvZiBlbGVtZW50cyB0aGF0IHBhc3NlZCB0aGUgY2FsbGJhY2sgY2hlY2suXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBldmVucyA9IF8uZmlsdGVyKFsxLCAyLCAzLCA0LCA1LCA2XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiBudW0gJSAyID09IDA7IH0pO1xuICAgKiAvLyA9PiBbMiwgNCwgNl1cbiAgICovXG4gIGZ1bmN0aW9uIGZpbHRlcihjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBjYWxsYmFjayA9IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnKTtcblxuICAgIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pKSB7XG4gICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gY29sbGVjdGlvbltpbmRleF07XG4gICAgICAgIGlmIChjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGFtaW5lcyBlYWNoIGVsZW1lbnQgaW4gYSBgY29sbGVjdGlvbmAsIHJldHVybmluZyB0aGUgZmlyc3Qgb25lIHRoZSBgY2FsbGJhY2tgXG4gICAqIHJldHVybnMgdHJ1dGh5IGZvci4gVGhlIGZ1bmN0aW9uIHJldHVybnMgYXMgc29vbiBhcyBpdCBmaW5kcyBhbiBhY2NlcHRhYmxlXG4gICAqIGVsZW1lbnQsIGFuZCBkb2VzIG5vdCBpdGVyYXRlIG92ZXIgdGhlIGVudGlyZSBgY29sbGVjdGlvbmAuIFRoZSBgY2FsbGJhY2tgIGlzXG4gICAqIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBkZXRlY3RcbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFjaz1pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyB0aGUgZWxlbWVudCB0aGF0IHBhc3NlZCB0aGUgY2FsbGJhY2sgY2hlY2ssXG4gICAqICBlbHNlIGB1bmRlZmluZWRgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgZXZlbiA9IF8uZmluZChbMSwgMiwgMywgNCwgNSwgNl0sIGZ1bmN0aW9uKG51bSkgeyByZXR1cm4gbnVtICUgMiA9PSAwOyB9KTtcbiAgICogLy8gPT4gMlxuICAgKi9cbiAgZnVuY3Rpb24gZmluZChjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQ7XG4gICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG5cbiAgICBmb3JFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgaWYgKGNhbGxiYWNrKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikpIHtcbiAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEl0ZXJhdGVzIG92ZXIgYSBgY29sbGVjdGlvbmAsIGV4ZWN1dGluZyB0aGUgYGNhbGxiYWNrYCBmb3IgZWFjaCBlbGVtZW50IGluXG4gICAqIHRoZSBgY29sbGVjdGlvbmAuIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlXG4gICAqIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLiBDYWxsYmFja3MgbWF5IGV4aXQgaXRlcmF0aW9uIGVhcmx5XG4gICAqIGJ5IGV4cGxpY2l0bHkgcmV0dXJuaW5nIGBmYWxzZWAuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGFsaWFzIGVhY2hcbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFjaz1pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R8U3RyaW5nfSBSZXR1cm5zIGBjb2xsZWN0aW9uYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXyhbMSwgMiwgM10pLmZvckVhY2goYWxlcnQpLmpvaW4oJywnKTtcbiAgICogLy8gPT4gYWxlcnRzIGVhY2ggbnVtYmVyIGFuZCByZXR1cm5zICcxLDIsMydcbiAgICpcbiAgICogXy5mb3JFYWNoKHsgJ29uZSc6IDEsICd0d28nOiAyLCAndGhyZWUnOiAzIH0sIGFsZXJ0KTtcbiAgICogLy8gPT4gYWxlcnRzIGVhY2ggbnVtYmVyIHZhbHVlIChvcmRlciBpcyBub3QgZ3VhcmFudGVlZClcbiAgICovXG4gIGZ1bmN0aW9uIGZvckVhY2goY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIHRoaXNBcmcgPT0gJ3VuZGVmaW5lZCcgJiYgaXNBcnJheShjb2xsZWN0aW9uKSkge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7XG5cbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayhjb2xsZWN0aW9uW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pID09PSBmYWxzZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVhY2goY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpO1xuICAgIH1cbiAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIG9iamVjdCBjb21wb3NlZCBvZiBrZXlzIHJldHVybmVkIGZyb20gcnVubmluZyBlYWNoIGVsZW1lbnQgb2ZcbiAgICogYGNvbGxlY3Rpb25gIHRocm91Z2ggYSBgY2FsbGJhY2tgLiBUaGUgY29ycmVzcG9uZGluZyB2YWx1ZSBvZiBlYWNoIGtleSBpcyBhblxuICAgKiBhcnJheSBvZiBlbGVtZW50cyBwYXNzZWQgdG8gYGNhbGxiYWNrYCB0aGF0IHJldHVybmVkIHRoZSBrZXkuIFRoZSBgY2FsbGJhY2tgXG4gICAqIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgKiBUaGUgYGNhbGxiYWNrYCBhcmd1bWVudCBtYXkgYWxzbyBiZSB0aGUgbmFtZSBvZiBhIHByb3BlcnR5IHRvIGdyb3VwIGJ5IChlLmcuICdsZW5ndGgnKS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IGNhbGxiYWNrfHByb3BlcnR5IFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvblxuICAgKiAgb3IgcHJvcGVydHkgbmFtZSB0byBncm91cCBieS5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjb21wb3NlZCBhZ2dyZWdhdGUgb2JqZWN0LlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmdyb3VwQnkoWzQuMiwgNi4xLCA2LjRdLCBmdW5jdGlvbihudW0pIHsgcmV0dXJuIE1hdGguZmxvb3IobnVtKTsgfSk7XG4gICAqIC8vID0+IHsgJzQnOiBbNC4yXSwgJzYnOiBbNi4xLCA2LjRdIH1cbiAgICpcbiAgICogXy5ncm91cEJ5KFs0LjIsIDYuMSwgNi40XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiB0aGlzLmZsb29yKG51bSk7IH0sIE1hdGgpO1xuICAgKiAvLyA9PiB7ICc0JzogWzQuMl0sICc2JzogWzYuMSwgNi40XSB9XG4gICAqXG4gICAqIF8uZ3JvdXBCeShbJ29uZScsICd0d28nLCAndGhyZWUnXSwgJ2xlbmd0aCcpO1xuICAgKiAvLyA9PiB7ICczJzogWydvbmUnLCAndHdvJ10sICc1JzogWyd0aHJlZSddIH1cbiAgICovXG4gIGZ1bmN0aW9uIGdyb3VwQnkoY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG5cbiAgICBmb3JFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHtcbiAgICAgIGtleSA9IGNhbGxiYWNrKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pO1xuICAgICAgKGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0gOiByZXN1bHRba2V5XSA9IFtdKS5wdXNoKHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEludm9rZXMgdGhlIG1ldGhvZCBuYW1lZCBieSBgbWV0aG9kTmFtZWAgb24gZWFjaCBlbGVtZW50IGluIHRoZSBgY29sbGVjdGlvbmAsXG4gICAqIHJldHVybmluZyBhbiBhcnJheSBvZiB0aGUgcmVzdWx0cyBvZiBlYWNoIGludm9rZWQgbWV0aG9kLiBBZGRpdGlvbmFsIGFyZ3VtZW50c1xuICAgKiB3aWxsIGJlIHBhc3NlZCB0byBlYWNoIGludm9rZWQgbWV0aG9kLiBJZiBgbWV0aG9kTmFtZWAgaXMgYSBmdW5jdGlvbiBpdCB3aWxsXG4gICAqIGJlIGludm9rZWQgZm9yLCBhbmQgYHRoaXNgIGJvdW5kIHRvLCBlYWNoIGVsZW1lbnQgaW4gdGhlIGBjb2xsZWN0aW9uYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IG1ldGhvZE5hbWUgVGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB0byBpbnZva2Ugb3JcbiAgICogIHRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFthcmcxLCBhcmcyLCAuLi5dIEFyZ3VtZW50cyB0byBpbnZva2UgdGhlIG1ldGhvZCB3aXRoLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgYXJyYXkgb2YgdGhlIHJlc3VsdHMgb2YgZWFjaCBpbnZva2VkIG1ldGhvZC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pbnZva2UoW1s1LCAxLCA3XSwgWzMsIDIsIDFdXSwgJ3NvcnQnKTtcbiAgICogLy8gPT4gW1sxLCA1LCA3XSwgWzEsIDIsIDNdXVxuICAgKlxuICAgKiBfLmludm9rZShbMTIzLCA0NTZdLCBTdHJpbmcucHJvdG90eXBlLnNwbGl0LCAnJyk7XG4gICAqIC8vID0+IFtbJzEnLCAnMicsICczJ10sIFsnNCcsICc1JywgJzYnXV1cbiAgICovXG4gIGZ1bmN0aW9uIGludm9rZShjb2xsZWN0aW9uLCBtZXRob2ROYW1lKSB7XG4gICAgdmFyIGFyZ3MgPSBzbGljZShhcmd1bWVudHMsIDIpLFxuICAgICAgICBpc0Z1bmMgPSB0eXBlb2YgbWV0aG9kTmFtZSA9PSAnZnVuY3Rpb24nLFxuICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJlc3VsdC5wdXNoKChpc0Z1bmMgPyBtZXRob2ROYW1lIDogdmFsdWVbbWV0aG9kTmFtZV0pLmFwcGx5KHZhbHVlLCBhcmdzKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHZhbHVlcyBieSBydW5uaW5nIGVhY2ggZWxlbWVudCBpbiB0aGUgYGNvbGxlY3Rpb25gXG4gICAqIHRocm91Z2ggYSBgY2FsbGJhY2tgLiBUaGUgYGNhbGxiYWNrYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aFxuICAgKiB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAYWxpYXMgY29sbGVjdFxuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrPWlkZW50aXR5XSBUaGUgZnVuY3Rpb24gY2FsbGVkIHBlciBpdGVyYXRpb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGNhbGxiYWNrYC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIHRoZSByZXN1bHRzIG9mIGVhY2ggYGNhbGxiYWNrYCBleGVjdXRpb24uXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8ubWFwKFsxLCAyLCAzXSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiBudW0gKiAzOyB9KTtcbiAgICogLy8gPT4gWzMsIDYsIDldXG4gICAqXG4gICAqIF8ubWFwKHsgJ29uZSc6IDEsICd0d28nOiAyLCAndGhyZWUnOiAzIH0sIGZ1bmN0aW9uKG51bSkgeyByZXR1cm4gbnVtICogMzsgfSk7XG4gICAqIC8vID0+IFszLCA2LCA5XSAob3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gICAqL1xuICBmdW5jdGlvbiBtYXAoY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbiA/IGNvbGxlY3Rpb24ubGVuZ3RoIDogMCxcbiAgICAgICAgcmVzdWx0ID0gQXJyYXkodHlwZW9mIGxlbmd0aCA9PSAnbnVtYmVyJyA/IGxlbmd0aCA6IDApO1xuXG4gICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG4gICAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikpIHtcbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFtpbmRleF0gPSBjYWxsYmFjayhjb2xsZWN0aW9uW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBlYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmVzdWx0WysraW5kZXhdID0gY2FsbGJhY2sodmFsdWUsIGtleSwgY29sbGVjdGlvbik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIG1heGltdW0gdmFsdWUgb2YgYW4gYGFycmF5YC4gSWYgYGNhbGxiYWNrYCBpcyBwYXNzZWQsXG4gICAqIGl0IHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggdmFsdWUgaW4gdGhlIGBhcnJheWAgdG8gZ2VuZXJhdGUgdGhlXG4gICAqIGNyaXRlcmlvbiBieSB3aGljaCB0aGUgdmFsdWUgaXMgcmFua2VkLiBUaGUgYGNhbGxiYWNrYCBpcyBib3VuZCB0b1xuICAgKiBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7TWl4ZWR9IFJldHVybnMgdGhlIG1heGltdW0gdmFsdWUuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBzdG9vZ2VzID0gW1xuICAgKiAgIHsgJ25hbWUnOiAnbW9lJywgJ2FnZSc6IDQwIH0sXG4gICAqICAgeyAnbmFtZSc6ICdsYXJyeScsICdhZ2UnOiA1MCB9LFxuICAgKiAgIHsgJ25hbWUnOiAnY3VybHknLCAnYWdlJzogNjAgfVxuICAgKiBdO1xuICAgKlxuICAgKiBfLm1heChzdG9vZ2VzLCBmdW5jdGlvbihzdG9vZ2UpIHsgcmV0dXJuIHN0b29nZS5hZ2U7IH0pO1xuICAgKiAvLyA9PiB7ICduYW1lJzogJ2N1cmx5JywgJ2FnZSc6IDYwIH07XG4gICAqL1xuICBmdW5jdGlvbiBtYXgoY29sbGVjdGlvbiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICB2YXIgY29tcHV0ZWQgPSAtSW5maW5pdHksXG4gICAgICAgIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBjb2xsZWN0aW9uLmxlbmd0aCA6IDAsXG4gICAgICAgIHJlc3VsdCA9IGNvbXB1dGVkO1xuXG4gICAgaWYgKGNhbGxiYWNrIHx8ICFpc0FycmF5KGNvbGxlY3Rpb24pKSB7XG4gICAgICBjYWxsYmFjayA9ICFjYWxsYmFjayAmJiBpc1N0cmluZyhjb2xsZWN0aW9uKVxuICAgICAgICA/IGNoYXJBdENhbGxiYWNrXG4gICAgICAgIDogY3JlYXRlQ2FsbGJhY2soY2FsbGJhY2ssIHRoaXNBcmcpO1xuXG4gICAgICBlYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICB2YXIgY3VycmVudCA9IGNhbGxiYWNrKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICAgIGlmIChjdXJyZW50ID4gY29tcHV0ZWQpIHtcbiAgICAgICAgICBjb21wdXRlZCA9IGN1cnJlbnQ7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICBpZiAoY29sbGVjdGlvbltpbmRleF0gPiByZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSBjb2xsZWN0aW9uW2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgbWluaW11bSB2YWx1ZSBvZiBhbiBgYXJyYXlgLiBJZiBgY2FsbGJhY2tgIGlzIHBhc3NlZCxcbiAgICogaXQgd2lsbCBiZSBleGVjdXRlZCBmb3IgZWFjaCB2YWx1ZSBpbiB0aGUgYGFycmF5YCB0byBnZW5lcmF0ZSB0aGVcbiAgICogY3JpdGVyaW9uIGJ5IHdoaWNoIHRoZSB2YWx1ZSBpcyByYW5rZWQuIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYFxuICAgKiBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyB0aGUgbWluaW11bSB2YWx1ZS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5taW4oWzEwLCA1LCAxMDAsIDIsIDEwMDBdKTtcbiAgICogLy8gPT4gMlxuICAgKi9cbiAgZnVuY3Rpb24gbWluKGNvbGxlY3Rpb24sIGNhbGxiYWNrLCB0aGlzQXJnKSB7XG4gICAgdmFyIGNvbXB1dGVkID0gSW5maW5pdHksXG4gICAgICAgIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBjb2xsZWN0aW9uLmxlbmd0aCA6IDAsXG4gICAgICAgIHJlc3VsdCA9IGNvbXB1dGVkO1xuXG4gICAgaWYgKGNhbGxiYWNrIHx8ICFpc0FycmF5KGNvbGxlY3Rpb24pKSB7XG4gICAgICBjYWxsYmFjayA9ICFjYWxsYmFjayAmJiBpc1N0cmluZyhjb2xsZWN0aW9uKVxuICAgICAgICA/IGNoYXJBdENhbGxiYWNrXG4gICAgICAgIDogY3JlYXRlQ2FsbGJhY2soY2FsbGJhY2ssIHRoaXNBcmcpO1xuXG4gICAgICBlYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICB2YXIgY3VycmVudCA9IGNhbGxiYWNrKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICAgIGlmIChjdXJyZW50IDwgY29tcHV0ZWQpIHtcbiAgICAgICAgICBjb21wdXRlZCA9IGN1cnJlbnQ7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICBpZiAoY29sbGVjdGlvbltpbmRleF0gPCByZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSBjb2xsZWN0aW9uW2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgdmFsdWUgb2YgYSBzcGVjaWZpZWQgcHJvcGVydHkgZnJvbSBhbGwgZWxlbWVudHMgaW5cbiAgICogdGhlIGBjb2xsZWN0aW9uYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5IFRoZSBwcm9wZXJ0eSB0byBwbHVjay5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIHN0b29nZXMgPSBbXG4gICAqICAgeyAnbmFtZSc6ICdtb2UnLCAnYWdlJzogNDAgfSxcbiAgICogICB7ICduYW1lJzogJ2xhcnJ5JywgJ2FnZSc6IDUwIH0sXG4gICAqICAgeyAnbmFtZSc6ICdjdXJseScsICdhZ2UnOiA2MCB9XG4gICAqIF07XG4gICAqXG4gICAqIF8ucGx1Y2soc3Rvb2dlcywgJ25hbWUnKTtcbiAgICogLy8gPT4gWydtb2UnLCAnbGFycnknLCAnY3VybHknXVxuICAgKi9cbiAgZnVuY3Rpb24gcGx1Y2soY29sbGVjdGlvbiwgcHJvcGVydHkpIHtcbiAgICByZXR1cm4gbWFwKGNvbGxlY3Rpb24sIHByb3BlcnR5ICsgJycpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJvaWxzIGRvd24gYSBgY29sbGVjdGlvbmAgdG8gYSBzaW5nbGUgdmFsdWUuIFRoZSBpbml0aWFsIHN0YXRlIG9mIHRoZVxuICAgKiByZWR1Y3Rpb24gaXMgYGFjY3VtdWxhdG9yYCBhbmQgZWFjaCBzdWNjZXNzaXZlIHN0ZXAgb2YgaXQgc2hvdWxkIGJlIHJldHVybmVkXG4gICAqIGJ5IHRoZSBgY2FsbGJhY2tgLiBUaGUgYGNhbGxiYWNrYCBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCA0XG4gICAqIGFyZ3VtZW50czsgZm9yIGFycmF5cyB0aGV5IGFyZSAoYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBmb2xkbCwgaW5qZWN0XG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2s9aWRlbnRpdHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW2FjY3VtdWxhdG9yXSBJbml0aWFsIHZhbHVlIG9mIHRoZSBhY2N1bXVsYXRvci5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7TWl4ZWR9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgc3VtID0gXy5yZWR1Y2UoWzEsIDIsIDNdLCBmdW5jdGlvbihtZW1vLCBudW0pIHsgcmV0dXJuIG1lbW8gKyBudW07IH0pO1xuICAgKiAvLyA9PiA2XG4gICAqL1xuICBmdW5jdGlvbiByZWR1Y2UoY29sbGVjdGlvbiwgY2FsbGJhY2ssIGFjY3VtdWxhdG9yLCB0aGlzQXJnKSB7XG4gICAgdmFyIG5vYWNjdW0gPSBhcmd1bWVudHMubGVuZ3RoIDwgMztcbiAgICBjYWxsYmFjayA9IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnLCBpbmRpY2F0b3JPYmplY3QpO1xuXG4gICAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikpIHtcbiAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoO1xuXG4gICAgICBpZiAobm9hY2N1bSkge1xuICAgICAgICBhY2N1bXVsYXRvciA9IGNvbGxlY3Rpb25bKytpbmRleF07XG4gICAgICB9XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICBhY2N1bXVsYXRvciA9IGNhbGxiYWNrKGFjY3VtdWxhdG9yLCBjb2xsZWN0aW9uW2luZGV4XSwgaW5kZXgsIGNvbGxlY3Rpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBlYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICBhY2N1bXVsYXRvciA9IG5vYWNjdW1cbiAgICAgICAgICA/IChub2FjY3VtID0gZmFsc2UsIHZhbHVlKVxuICAgICAgICAgIDogY2FsbGJhY2soYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbilcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHJpZ2h0LWFzc29jaWF0aXZlIHZlcnNpb24gb2YgYF8ucmVkdWNlYC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAYWxpYXMgZm9sZHJcbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFjaz1pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBwZXIgaXRlcmF0aW9uLlxuICAgKiBAcGFyYW0ge01peGVkfSBbYWNjdW11bGF0b3JdIEluaXRpYWwgdmFsdWUgb2YgdGhlIGFjY3VtdWxhdG9yLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBsaXN0ID0gW1swLCAxXSwgWzIsIDNdLCBbNCwgNV1dO1xuICAgKiB2YXIgZmxhdCA9IF8ucmVkdWNlUmlnaHQobGlzdCwgZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYS5jb25jYXQoYik7IH0sIFtdKTtcbiAgICogLy8gPT4gWzQsIDUsIDIsIDMsIDAsIDFdXG4gICAqL1xuICBmdW5jdGlvbiByZWR1Y2VSaWdodChjb2xsZWN0aW9uLCBjYWxsYmFjaywgYWNjdW11bGF0b3IsIHRoaXNBcmcpIHtcbiAgICB2YXIgaXRlcmF0ZWUgPSBjb2xsZWN0aW9uLFxuICAgICAgICBsZW5ndGggPSBjb2xsZWN0aW9uID8gY29sbGVjdGlvbi5sZW5ndGggOiAwLFxuICAgICAgICBub2FjY3VtID0gYXJndW1lbnRzLmxlbmd0aCA8IDM7XG5cbiAgICBpZiAodHlwZW9mIGxlbmd0aCAhPSAnbnVtYmVyJykge1xuICAgICAgdmFyIHByb3BzID0ga2V5cyhjb2xsZWN0aW9uKTtcbiAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDtcbiAgICB9IGVsc2UgaWYgKG5vQ2hhckJ5SW5kZXggJiYgaXNTdHJpbmcoY29sbGVjdGlvbikpIHtcbiAgICAgIGl0ZXJhdGVlID0gY29sbGVjdGlvbi5zcGxpdCgnJyk7XG4gICAgfVxuICAgIGNhbGxiYWNrID0gY3JlYXRlQ2FsbGJhY2soY2FsbGJhY2ssIHRoaXNBcmcsIGluZGljYXRvck9iamVjdCk7XG4gICAgZm9yRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgIGluZGV4ID0gcHJvcHMgPyBwcm9wc1stLWxlbmd0aF0gOiAtLWxlbmd0aDtcbiAgICAgIGFjY3VtdWxhdG9yID0gbm9hY2N1bVxuICAgICAgICA/IChub2FjY3VtID0gZmFsc2UsIGl0ZXJhdGVlW2luZGV4XSlcbiAgICAgICAgOiBjYWxsYmFjayhhY2N1bXVsYXRvciwgaXRlcmF0ZWVbaW5kZXhdLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBvcHBvc2l0ZSBvZiBgXy5maWx0ZXJgLCB0aGlzIG1ldGhvZCByZXR1cm5zIHRoZSB2YWx1ZXMgb2YgYVxuICAgKiBgY29sbGVjdGlvbmAgdGhhdCBgY2FsbGJhY2tgIGRvZXMgKipub3QqKiByZXR1cm4gdHJ1dGh5IGZvci5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrPWlkZW50aXR5XSBUaGUgZnVuY3Rpb24gY2FsbGVkIHBlciBpdGVyYXRpb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aGlzQXJnXSBUaGUgYHRoaXNgIGJpbmRpbmcgb2YgYGNhbGxiYWNrYC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGFycmF5IG9mIGVsZW1lbnRzIHRoYXQgZGlkICoqbm90KiogcGFzcyB0aGVcbiAgICogIGNhbGxiYWNrIGNoZWNrLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgb2RkcyA9IF8ucmVqZWN0KFsxLCAyLCAzLCA0LCA1LCA2XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiBudW0gJSAyID09IDA7IH0pO1xuICAgKiAvLyA9PiBbMSwgMywgNV1cbiAgICovXG4gIGZ1bmN0aW9uIHJlamVjdChjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIGNhbGxiYWNrID0gY3JlYXRlQ2FsbGJhY2soY2FsbGJhY2ssIHRoaXNBcmcpO1xuICAgIHJldHVybiBmaWx0ZXIoY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICByZXR1cm4gIWNhbGxiYWNrKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBzaHVmZmxlZCBgYXJyYXlgIHZhbHVlcywgdXNpbmcgYSB2ZXJzaW9uIG9mIHRoZVxuICAgKiBGaXNoZXItWWF0ZXMgc2h1ZmZsZS4gU2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVyLVlhdGVzX3NodWZmbGUuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBzaHVmZmxlLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgc2h1ZmZsZWQgY29sbGVjdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5zaHVmZmxlKFsxLCAyLCAzLCA0LCA1LCA2XSk7XG4gICAqIC8vID0+IFs0LCAxLCA2LCAzLCA1LCAyXVxuICAgKi9cbiAgZnVuY3Rpb24gc2h1ZmZsZShjb2xsZWN0aW9uKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIHJlc3VsdCA9IEFycmF5KGNvbGxlY3Rpb24gPyBjb2xsZWN0aW9uLmxlbmd0aCA6IDApO1xuXG4gICAgZm9yRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgdmFyIHJhbmQgPSBmbG9vcihuYXRpdmVSYW5kb20oKSAqICgrK2luZGV4ICsgMSkpO1xuICAgICAgcmVzdWx0W2luZGV4XSA9IHJlc3VsdFtyYW5kXTtcbiAgICAgIHJlc3VsdFtyYW5kXSA9IHZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgc2l6ZSBvZiB0aGUgYGNvbGxlY3Rpb25gIGJ5IHJldHVybmluZyBgY29sbGVjdGlvbi5sZW5ndGhgIGZvciBhcnJheXNcbiAgICogYW5kIGFycmF5LWxpa2Ugb2JqZWN0cyBvciB0aGUgbnVtYmVyIG9mIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMgZm9yIG9iamVjdHMuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IENvbGxlY3Rpb25zXG4gICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fFN0cmluZ30gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpbnNwZWN0LlxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIGBjb2xsZWN0aW9uLmxlbmd0aGAgb3IgbnVtYmVyIG9mIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uc2l6ZShbMSwgMl0pO1xuICAgKiAvLyA9PiAyXG4gICAqXG4gICAqIF8uc2l6ZSh7ICdvbmUnOiAxLCAndHdvJzogMiwgJ3RocmVlJzogMyB9KTtcbiAgICogLy8gPT4gM1xuICAgKlxuICAgKiBfLnNpemUoJ2N1cmx5Jyk7XG4gICAqIC8vID0+IDVcbiAgICovXG4gIGZ1bmN0aW9uIHNpemUoY29sbGVjdGlvbikge1xuICAgIHZhciBsZW5ndGggPSBjb2xsZWN0aW9uID8gY29sbGVjdGlvbi5sZW5ndGggOiAwO1xuICAgIHJldHVybiB0eXBlb2YgbGVuZ3RoID09ICdudW1iZXInID8gbGVuZ3RoIDoga2V5cyhjb2xsZWN0aW9uKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBgY2FsbGJhY2tgIHJldHVybnMgYSB0cnV0aHkgdmFsdWUgZm9yICoqYW55KiogZWxlbWVudCBvZiBhXG4gICAqIGBjb2xsZWN0aW9uYC4gVGhlIGZ1bmN0aW9uIHJldHVybnMgYXMgc29vbiBhcyBpdCBmaW5kcyBwYXNzaW5nIHZhbHVlLCBhbmRcbiAgICogZG9lcyBub3QgaXRlcmF0ZSBvdmVyIHRoZSBlbnRpcmUgYGNvbGxlY3Rpb25gLiBUaGUgYGNhbGxiYWNrYCBpcyBib3VuZCB0b1xuICAgKiBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAYWxpYXMgYW55XG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2s9aWRlbnRpdHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW55IGVsZW1lbnQgcGFzc2VzIHRoZSBjYWxsYmFjayBjaGVjayxcbiAgICogIGVsc2UgYGZhbHNlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5zb21lKFtudWxsLCAwLCAneWVzJywgZmFsc2VdLCBCb29sZWFuKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gc29tZShjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQ7XG4gICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG5cbiAgICBpZiAoaXNBcnJheShjb2xsZWN0aW9uKSkge1xuICAgICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7XG5cbiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICAgIGlmICgocmVzdWx0ID0gY2FsbGJhY2soY29sbGVjdGlvbltpbmRleF0sIGluZGV4LCBjb2xsZWN0aW9uKSkpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBlYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICByZXR1cm4gIShyZXN1bHQgPSBjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gISFyZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBhcnJheSwgc3RhYmxlIHNvcnRlZCBpbiBhc2NlbmRpbmcgb3JkZXIgYnkgdGhlIHJlc3VsdHMgb2ZcbiAgICogcnVubmluZyBlYWNoIGVsZW1lbnQgb2YgYGNvbGxlY3Rpb25gIHRocm91Z2ggYSBgY2FsbGJhY2tgLiBUaGUgYGNhbGxiYWNrYFxuICAgKiBpcyBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCB0aHJlZSBhcmd1bWVudHM7ICh2YWx1ZSwgaW5kZXh8a2V5LCBjb2xsZWN0aW9uKS5cbiAgICogVGhlIGBjYWxsYmFja2AgYXJndW1lbnQgbWF5IGFsc28gYmUgdGhlIG5hbWUgb2YgYSBwcm9wZXJ0eSB0byBzb3J0IGJ5IChlLmcuICdsZW5ndGgnKS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGl0ZXJhdGUgb3Zlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IGNhbGxiYWNrfHByb3BlcnR5IFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvblxuICAgKiAgb3IgcHJvcGVydHkgbmFtZSB0byBzb3J0IGJ5LlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBjYWxsYmFja2AuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBhcnJheSBvZiBzb3J0ZWQgZWxlbWVudHMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uc29ydEJ5KFsxLCAyLCAzXSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiBNYXRoLnNpbihudW0pOyB9KTtcbiAgICogLy8gPT4gWzMsIDEsIDJdXG4gICAqXG4gICAqIF8uc29ydEJ5KFsxLCAyLCAzXSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiB0aGlzLnNpbihudW0pOyB9LCBNYXRoKTtcbiAgICogLy8gPT4gWzMsIDEsIDJdXG4gICAqXG4gICAqIF8uc29ydEJ5KFsnbGFycnknLCAnYnJlbmRhbicsICdtb2UnXSwgJ2xlbmd0aCcpO1xuICAgKiAvLyA9PiBbJ21vZScsICdsYXJyeScsICdicmVuZGFuJ11cbiAgICovXG4gIGZ1bmN0aW9uIHNvcnRCeShjb2xsZWN0aW9uLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBjYWxsYmFjayA9IGNyZWF0ZUNhbGxiYWNrKGNhbGxiYWNrLCB0aGlzQXJnKTtcblxuICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICdjcml0ZXJpYSc6IGNhbGxiYWNrKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbiksXG4gICAgICAgICdpbmRleCc6IGluZGV4LFxuICAgICAgICAndmFsdWUnOiB2YWx1ZVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB2YXIgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDtcbiAgICByZXN1bHQuc29ydChjb21wYXJlQXNjZW5kaW5nKTtcbiAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgIHJlc3VsdFtsZW5ndGhdID0gcmVzdWx0W2xlbmd0aF0udmFsdWU7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgdGhlIGBjb2xsZWN0aW9uYCB0byBhbiBhcnJheS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIGNvbnZlcnQuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGNvbnZlcnRlZCBhcnJheS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogKGZ1bmN0aW9uKCkgeyByZXR1cm4gXy50b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7IH0pKDEsIDIsIDMsIDQpO1xuICAgKiAvLyA9PiBbMiwgMywgNF1cbiAgICovXG4gIGZ1bmN0aW9uIHRvQXJyYXkoY29sbGVjdGlvbikge1xuICAgIHZhciBsZW5ndGggPSBjb2xsZWN0aW9uID8gY29sbGVjdGlvbi5sZW5ndGggOiAwO1xuICAgIGlmICh0eXBlb2YgbGVuZ3RoID09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gbm9DaGFyQnlJbmRleCAmJiBpc1N0cmluZyhjb2xsZWN0aW9uKVxuICAgICAgICA/IGNvbGxlY3Rpb24uc3BsaXQoJycpXG4gICAgICAgIDogc2xpY2UoY29sbGVjdGlvbik7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZXMoY29sbGVjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogRXhhbWluZXMgZWFjaCBlbGVtZW50IGluIGEgYGNvbGxlY3Rpb25gLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgYWxsIGVsZW1lbnRzXG4gICAqIHRoYXQgY29udGFpbiB0aGUgZ2l2ZW4gYHByb3BlcnRpZXNgLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdHxTdHJpbmd9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBmaWx0ZXIgYnkuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBhcnJheSBvZiBlbGVtZW50cyB0aGF0IGNvbnRhaW4gdGhlIGdpdmVuIGBwcm9wZXJ0aWVzYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIHN0b29nZXMgPSBbXG4gICAqICAgeyAnbmFtZSc6ICdtb2UnLCAnYWdlJzogNDAgfSxcbiAgICogICB7ICduYW1lJzogJ2xhcnJ5JywgJ2FnZSc6IDUwIH0sXG4gICAqICAgeyAnbmFtZSc6ICdjdXJseScsICdhZ2UnOiA2MCB9XG4gICAqIF07XG4gICAqXG4gICAqIF8ud2hlcmUoc3Rvb2dlcywgeyAnYWdlJzogNDAgfSk7XG4gICAqIC8vID0+IFt7ICduYW1lJzogJ21vZScsICdhZ2UnOiA0MCB9XVxuICAgKi9cbiAgZnVuY3Rpb24gd2hlcmUoY29sbGVjdGlvbiwgcHJvcGVydGllcykge1xuICAgIHZhciBwcm9wcyA9IGtleXMocHJvcGVydGllcyk7XG4gICAgcmV0dXJuIGZpbHRlcihjb2xsZWN0aW9uLCBmdW5jdGlvbihvYmplY3QpIHtcbiAgICAgIHZhciBsZW5ndGggPSBwcm9wcy5sZW5ndGg7XG4gICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG9iamVjdFtwcm9wc1tsZW5ndGhdXSA9PT0gcHJvcGVydGllc1twcm9wc1tsZW5ndGhdXTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuICEhcmVzdWx0O1xuICAgIH0pO1xuICB9XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgZmFsc2V5IHZhbHVlcyBvZiBgYXJyYXlgIHJlbW92ZWQuIFRoZSB2YWx1ZXNcbiAgICogYGZhbHNlYCwgYG51bGxgLCBgMGAsIGBcIlwiYCwgYHVuZGVmaW5lZGAgYW5kIGBOYU5gIGFyZSBhbGwgZmFsc2V5LlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbXBhY3QuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBmaWx0ZXJlZCBhcnJheS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5jb21wYWN0KFswLCAxLCBmYWxzZSwgMiwgJycsIDNdKTtcbiAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAqL1xuICBmdW5jdGlvbiBjb21wYWN0KGFycmF5KSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCxcbiAgICAgICAgcmVzdWx0ID0gW107XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGBhcnJheWAgZWxlbWVudHMgbm90IHByZXNlbnQgaW4gdGhlIG90aGVyIGFycmF5c1xuICAgKiB1c2luZyBzdHJpY3QgZXF1YWxpdHkgZm9yIGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHByb2Nlc3MuXG4gICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheTEsIGFycmF5MiwgLi4uXSBBcnJheXMgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBhcnJheSBvZiBgYXJyYXlgIGVsZW1lbnRzIG5vdCBwcmVzZW50IGluIHRoZVxuICAgKiAgb3RoZXIgYXJyYXlzLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmRpZmZlcmVuY2UoWzEsIDIsIDMsIDQsIDVdLCBbNSwgMiwgMTBdKTtcbiAgICogLy8gPT4gWzEsIDMsIDRdXG4gICAqL1xuICBmdW5jdGlvbiBkaWZmZXJlbmNlKGFycmF5KSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCxcbiAgICAgICAgZmxhdHRlbmVkID0gY29uY2F0LmFwcGx5KGFycmF5UmVmLCBhcmd1bWVudHMpLFxuICAgICAgICBjb250YWlucyA9IGNhY2hlZENvbnRhaW5zKGZsYXR0ZW5lZCwgbGVuZ3RoKSxcbiAgICAgICAgcmVzdWx0ID0gW107XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgaWYgKCFjb250YWlucyh2YWx1ZSkpIHtcbiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgdGhlIGBhcnJheWAuIFBhc3MgYG5gIHRvIHJldHVybiB0aGUgZmlyc3QgYG5gXG4gICAqIGVsZW1lbnRzIG9mIHRoZSBgYXJyYXlgLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBoZWFkLCB0YWtlXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgKiBAcGFyYW0ge051bWJlcn0gW25dIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gcmV0dXJuLlxuICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gSW50ZXJuYWxseSB1c2VkIHRvIGFsbG93IHRoaXMgbWV0aG9kIHRvIHdvcmsgd2l0aFxuICAgKiAgb3RoZXJzIGxpa2UgYF8ubWFwYCB3aXRob3V0IHVzaW5nIHRoZWlyIGNhbGxiYWNrIGBpbmRleGAgYXJndW1lbnQgZm9yIGBuYC5cbiAgICogQHJldHVybnMge01peGVkfSBSZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50LCBvciBhbiBhcnJheSBvZiB0aGUgZmlyc3QgYG5gXG4gICAqICBlbGVtZW50cywgb2YgYGFycmF5YC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5maXJzdChbNSwgNCwgMywgMiwgMV0pO1xuICAgKiAvLyA9PiA1XG4gICAqL1xuICBmdW5jdGlvbiBmaXJzdChhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICBpZiAoYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gICAgICByZXR1cm4gKG4gPT0gbnVsbCB8fCBndWFyZClcbiAgICAgICAgPyBhcnJheVswXVxuICAgICAgICA6IHNsaWNlKGFycmF5LCAwLCBuYXRpdmVNaW4obmF0aXZlTWF4KDAsIG4pLCBsZW5ndGgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmxhdHRlbnMgYSBuZXN0ZWQgYXJyYXkgKHRoZSBuZXN0aW5nIGNhbiBiZSB0byBhbnkgZGVwdGgpLiBJZiBgc2hhbGxvd2AgaXNcbiAgICogdHJ1dGh5LCBgYXJyYXlgIHdpbGwgb25seSBiZSBmbGF0dGVuZWQgYSBzaW5nbGUgbGV2ZWwuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFjdC5cbiAgICogQHBhcmFtIHtCb29sZWFufSBzaGFsbG93IEEgZmxhZyB0byBpbmRpY2F0ZSBvbmx5IGZsYXR0ZW5pbmcgYSBzaW5nbGUgbGV2ZWwuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBmbGF0dGVuZWQgYXJyYXkuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uZmxhdHRlbihbMSwgWzJdLCBbMywgW1s0XV1dXSk7XG4gICAqIC8vID0+IFsxLCAyLCAzLCA0XTtcbiAgICpcbiAgICogXy5mbGF0dGVuKFsxLCBbMl0sIFszLCBbWzRdXV1dLCB0cnVlKTtcbiAgICogLy8gPT4gWzEsIDIsIDMsIFtbNF1dXTtcbiAgICovXG4gIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXksIHNoYWxsb3cpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLFxuICAgICAgICByZXN1bHQgPSBbXTtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07XG5cbiAgICAgIC8vIHJlY3Vyc2l2ZWx5IGZsYXR0ZW4gYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cylcbiAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkge1xuICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdCwgc2hhbGxvdyA/IHZhbHVlIDogZmxhdHRlbih2YWx1ZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGluZGV4IGF0IHdoaWNoIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGB2YWx1ZWAgaXMgZm91bmQgdXNpbmdcbiAgICogc3RyaWN0IGVxdWFsaXR5IGZvciBjb21wYXJpc29ucywgaS5lLiBgPT09YC4gSWYgdGhlIGBhcnJheWAgaXMgYWxyZWFkeVxuICAgKiBzb3J0ZWQsIHBhc3NpbmcgYHRydWVgIGZvciBgZnJvbUluZGV4YCB3aWxsIHJ1biBhIGZhc3RlciBiaW5hcnkgc2VhcmNoLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNlYXJjaC5cbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSB7Qm9vbGVhbnxOdW1iZXJ9IFtmcm9tSW5kZXg9MF0gVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tIG9yIGB0cnVlYCB0b1xuICAgKiAgcGVyZm9ybSBhIGJpbmFyeSBzZWFyY2ggb24gYSBzb3J0ZWQgYGFycmF5YC5cbiAgICogQHJldHVybnMge051bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUgb3IgYC0xYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pbmRleE9mKFsxLCAyLCAzLCAxLCAyLCAzXSwgMik7XG4gICAqIC8vID0+IDFcbiAgICpcbiAgICogXy5pbmRleE9mKFsxLCAyLCAzLCAxLCAyLCAzXSwgMiwgMyk7XG4gICAqIC8vID0+IDRcbiAgICpcbiAgICogXy5pbmRleE9mKFsxLCAxLCAyLCAyLCAzLCAzXSwgMiwgdHJ1ZSk7XG4gICAqIC8vID0+IDJcbiAgICovXG4gIGZ1bmN0aW9uIGluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwO1xuXG4gICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggPT0gJ251bWJlcicpIHtcbiAgICAgIGluZGV4ID0gKGZyb21JbmRleCA8IDAgPyBuYXRpdmVNYXgoMCwgbGVuZ3RoICsgZnJvbUluZGV4KSA6IGZyb21JbmRleCB8fCAwKSAtIDE7XG4gICAgfSBlbHNlIGlmIChmcm9tSW5kZXgpIHtcbiAgICAgIGluZGV4ID0gc29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKTtcbiAgICAgIHJldHVybiBhcnJheVtpbmRleF0gPT09IHZhbHVlID8gaW5kZXggOiAtMTtcbiAgICB9XG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmIChhcnJheVtpbmRleF0gPT09IHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGJ1dCB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAuIFBhc3MgYG5gIHRvIGV4Y2x1ZGUgdGhlIGxhc3QgYG5gXG4gICAqIGVsZW1lbnRzIGZyb20gdGhlIHJlc3VsdC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQXJyYXlzXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gZXhjbHVkZS5cbiAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEludGVybmFsbHkgdXNlZCB0byBhbGxvdyB0aGlzIG1ldGhvZCB0byB3b3JrIHdpdGhcbiAgICogIG90aGVycyBsaWtlIGBfLm1hcGAgd2l0aG91dCB1c2luZyB0aGVpciBjYWxsYmFjayBgaW5kZXhgIGFyZ3VtZW50IGZvciBgbmAuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhbGwgYnV0IHRoZSBsYXN0IGVsZW1lbnQsIG9yIGBuYCBlbGVtZW50cywgb2YgYGFycmF5YC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pbml0aWFsKFszLCAyLCAxXSk7XG4gICAqIC8vID0+IFszLCAyXVxuICAgKi9cbiAgZnVuY3Rpb24gaW5pdGlhbChhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICBpZiAoIWFycmF5KSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gICAgbiA9IG4gPT0gbnVsbCB8fCBndWFyZCA/IDEgOiBuIHx8IDA7XG4gICAgcmV0dXJuIHNsaWNlKGFycmF5LCAwLCBuYXRpdmVNaW4obmF0aXZlTWF4KDAsIGxlbmd0aCAtIG4pLCBsZW5ndGgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlcyB0aGUgaW50ZXJzZWN0aW9uIG9mIGFsbCB0aGUgcGFzc2VkLWluIGFycmF5cyB1c2luZyBzdHJpY3QgZXF1YWxpdHlcbiAgICogZm9yIGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5MSwgYXJyYXkyLCAuLi5dIEFycmF5cyB0byBwcm9jZXNzLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgYXJyYXkgb2YgdW5pcXVlIGVsZW1lbnRzIHRoYXQgYXJlIHByZXNlbnRcbiAgICogIGluICoqYWxsKiogb2YgdGhlIGFycmF5cy5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5pbnRlcnNlY3Rpb24oWzEsIDIsIDNdLCBbMTAxLCAyLCAxLCAxMF0sIFsyLCAxXSk7XG4gICAqIC8vID0+IFsxLCAyXVxuICAgKi9cbiAgZnVuY3Rpb24gaW50ZXJzZWN0aW9uKGFycmF5KSB7XG4gICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgIGFyZ3NMZW5ndGggPSBhcmdzLmxlbmd0aCxcbiAgICAgICAgY2FjaGUgPSB7ICcwJzoge30gfSxcbiAgICAgICAgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLFxuICAgICAgICBpc0xhcmdlID0gbGVuZ3RoID49IDEwMCxcbiAgICAgICAgcmVzdWx0ID0gW10sXG4gICAgICAgIHNlZW4gPSByZXN1bHQ7XG5cbiAgICBvdXRlcjpcbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgaWYgKGlzTGFyZ2UpIHtcbiAgICAgICAgdmFyIGtleSA9IHZhbHVlICsgJyc7XG4gICAgICAgIHZhciBpbml0ZWQgPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKGNhY2hlWzBdLCBrZXkpXG4gICAgICAgICAgPyAhKHNlZW4gPSBjYWNoZVswXVtrZXldKVxuICAgICAgICAgIDogKHNlZW4gPSBjYWNoZVswXVtrZXldID0gW10pO1xuICAgICAgfVxuICAgICAgaWYgKGluaXRlZCB8fCBpbmRleE9mKHNlZW4sIHZhbHVlKSA8IDApIHtcbiAgICAgICAgaWYgKGlzTGFyZ2UpIHtcbiAgICAgICAgICBzZWVuLnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhcmdzSW5kZXggPSBhcmdzTGVuZ3RoO1xuICAgICAgICB3aGlsZSAoLS1hcmdzSW5kZXgpIHtcbiAgICAgICAgICBpZiAoIShjYWNoZVthcmdzSW5kZXhdIHx8IChjYWNoZVthcmdzSW5kZXhdID0gY2FjaGVkQ29udGFpbnMoYXJnc1thcmdzSW5kZXhdLCAwLCAxMDApKSkodmFsdWUpKSB7XG4gICAgICAgICAgICBjb250aW51ZSBvdXRlcjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGxhc3QgZWxlbWVudCBvZiB0aGUgYGFycmF5YC4gUGFzcyBgbmAgdG8gcmV0dXJuIHRoZSBsYXN0IGBuYFxuICAgKiBlbGVtZW50cyBvZiB0aGUgYGFycmF5YC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgQXJyYXlzXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtuXSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIHRvIHJldHVybi5cbiAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEludGVybmFsbHkgdXNlZCB0byBhbGxvdyB0aGlzIG1ldGhvZCB0byB3b3JrIHdpdGhcbiAgICogIG90aGVycyBsaWtlIGBfLm1hcGAgd2l0aG91dCB1c2luZyB0aGVpciBjYWxsYmFjayBgaW5kZXhgIGFyZ3VtZW50IGZvciBgbmAuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyB0aGUgbGFzdCBlbGVtZW50LCBvciBhbiBhcnJheSBvZiB0aGUgbGFzdCBgbmBcbiAgICogIGVsZW1lbnRzLCBvZiBgYXJyYXlgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmxhc3QoWzMsIDIsIDFdKTtcbiAgICogLy8gPT4gMVxuICAgKi9cbiAgZnVuY3Rpb24gbGFzdChhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICBpZiAoYXJyYXkpIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gICAgICByZXR1cm4gKG4gPT0gbnVsbCB8fCBndWFyZCkgPyBhcnJheVtsZW5ndGggLSAxXSA6IHNsaWNlKGFycmF5LCBuYXRpdmVNYXgoMCwgbGVuZ3RoIC0gbikpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGB2YWx1ZWAgaXMgZm91bmQgdXNpbmcgc3RyaWN0XG4gICAqIGVxdWFsaXR5IGZvciBjb21wYXJpc29ucywgaS5lLiBgPT09YC4gSWYgYGZyb21JbmRleGAgaXMgbmVnYXRpdmUsIGl0IGlzIHVzZWRcbiAgICogYXMgdGhlIG9mZnNldCBmcm9tIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2VhcmNoLlxuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcm9tSW5kZXg9YXJyYXkubGVuZ3RoLTFdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS5cbiAgICogQHJldHVybnMge051bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUgb3IgYC0xYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5sYXN0SW5kZXhPZihbMSwgMiwgMywgMSwgMiwgM10sIDIpO1xuICAgKiAvLyA9PiA0XG4gICAqXG4gICAqIF8ubGFzdEluZGV4T2YoWzEsIDIsIDMsIDEsIDIsIDNdLCAyLCAzKTtcbiAgICogLy8gPT4gMVxuICAgKi9cbiAgZnVuY3Rpb24gbGFzdEluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7XG4gICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggPT0gJ251bWJlcicpIHtcbiAgICAgIGluZGV4ID0gKGZyb21JbmRleCA8IDAgPyBuYXRpdmVNYXgoMCwgaW5kZXggKyBmcm9tSW5kZXgpIDogbmF0aXZlTWluKGZyb21JbmRleCwgaW5kZXggLSAxKSkgKyAxO1xuICAgIH1cbiAgICB3aGlsZSAoaW5kZXgtLSkge1xuICAgICAgaWYgKGFycmF5W2luZGV4XSA9PT0gdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBvYmplY3QgY29tcG9zZWQgZnJvbSBhcnJheXMgb2YgYGtleXNgIGFuZCBgdmFsdWVzYC4gUGFzcyBlaXRoZXJcbiAgICogYSBzaW5nbGUgdHdvIGRpbWVuc2lvbmFsIGFycmF5LCBpLmUuIGBbW2tleTEsIHZhbHVlMV0sIFtrZXkyLCB2YWx1ZTJdXWAsIG9yXG4gICAqIHR3byBhcnJheXMsIG9uZSBvZiBga2V5c2AgYW5kIG9uZSBvZiBjb3JyZXNwb25kaW5nIGB2YWx1ZXNgLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0ga2V5cyBUaGUgYXJyYXkgb2Yga2V5cy5cbiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlcz1bXV0gVGhlIGFycmF5IG9mIHZhbHVlcy5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgY29tcG9zZWQgb2YgdGhlIGdpdmVuIGtleXMgYW5kXG4gICAqICBjb3JyZXNwb25kaW5nIHZhbHVlcy5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5vYmplY3QoWydtb2UnLCAnbGFycnknLCAnY3VybHknXSwgWzMwLCA0MCwgNTBdKTtcbiAgICogLy8gPT4geyAnbW9lJzogMzAsICdsYXJyeSc6IDQwLCAnY3VybHknOiA1MCB9XG4gICAqL1xuICBmdW5jdGlvbiBvYmplY3Qoa2V5cywgdmFsdWVzKSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGtleXMgPyBrZXlzLmxlbmd0aCA6IDAsXG4gICAgICAgIHJlc3VsdCA9IHt9O1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIHZhciBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICAgIGlmICh2YWx1ZXMpIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZXNbaW5kZXhdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2tleVswXV0gPSBrZXlbMV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBudW1iZXJzIChwb3NpdGl2ZSBhbmQvb3IgbmVnYXRpdmUpIHByb2dyZXNzaW5nIGZyb21cbiAgICogYHN0YXJ0YCB1cCB0byBidXQgbm90IGluY2x1ZGluZyBgc3RvcGAuIFRoaXMgbWV0aG9kIGlzIGEgcG9ydCBvZiBQeXRob24nc1xuICAgKiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZSBodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge051bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBvZiB0aGUgcmFuZ2UuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBlbmQgVGhlIGVuZCBvZiB0aGUgcmFuZ2UuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbc3RlcD0xXSBUaGUgdmFsdWUgdG8gaW5jcmVtZW50IG9yIGRlc2NyZW1lbnQgYnkuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyByYW5nZSBhcnJheS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5yYW5nZSgxMCk7XG4gICAqIC8vID0+IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5XVxuICAgKlxuICAgKiBfLnJhbmdlKDEsIDExKTtcbiAgICogLy8gPT4gWzEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwXVxuICAgKlxuICAgKiBfLnJhbmdlKDAsIDMwLCA1KTtcbiAgICogLy8gPT4gWzAsIDUsIDEwLCAxNSwgMjAsIDI1XVxuICAgKlxuICAgKiBfLnJhbmdlKDAsIC0xMCwgLTEpO1xuICAgKiAvLyA9PiBbMCwgLTEsIC0yLCAtMywgLTQsIC01LCAtNiwgLTcsIC04LCAtOV1cbiAgICpcbiAgICogXy5yYW5nZSgwKTtcbiAgICogLy8gPT4gW11cbiAgICovXG4gIGZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXApIHtcbiAgICBzdGFydCA9ICtzdGFydCB8fCAwO1xuICAgIHN0ZXAgPSArc3RlcCB8fCAxO1xuXG4gICAgaWYgKGVuZCA9PSBudWxsKSB7XG4gICAgICBlbmQgPSBzdGFydDtcbiAgICAgIHN0YXJ0ID0gMDtcbiAgICB9XG4gICAgLy8gdXNlIGBBcnJheShsZW5ndGgpYCBzbyBWOCB3aWxsIGF2b2lkIHRoZSBzbG93ZXIgXCJkaWN0aW9uYXJ5XCIgbW9kZVxuICAgIC8vIGh0dHA6Ly95b3V0dS5iZS9YQXFJcEdVOFpaayN0PTE3bTI1c1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoMCwgY2VpbCgoZW5kIC0gc3RhcnQpIC8gc3RlcCkpLFxuICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBzdGFydDtcbiAgICAgIHN0YXJ0ICs9IHN0ZXA7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG9wcG9zaXRlIG9mIGBfLmluaXRpYWxgLCB0aGlzIG1ldGhvZCBnZXRzIGFsbCBidXQgdGhlIGZpcnN0IHZhbHVlIG9mXG4gICAqIGBhcnJheWAuIFBhc3MgYG5gIHRvIGV4Y2x1ZGUgdGhlIGZpcnN0IGBuYCB2YWx1ZXMgZnJvbSB0aGUgcmVzdWx0LlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyBkcm9wLCB0YWlsXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LlxuICAgKiBAcGFyYW0ge051bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBleGNsdWRlLlxuICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gSW50ZXJuYWxseSB1c2VkIHRvIGFsbG93IHRoaXMgbWV0aG9kIHRvIHdvcmsgd2l0aFxuICAgKiAgb3RoZXJzIGxpa2UgYF8ubWFwYCB3aXRob3V0IHVzaW5nIHRoZWlyIGNhbGxiYWNrIGBpbmRleGAgYXJndW1lbnQgZm9yIGBuYC5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGFsbCBidXQgdGhlIGZpcnN0IGVsZW1lbnQsIG9yIGBuYCBlbGVtZW50cywgb2YgYGFycmF5YC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5yZXN0KFszLCAyLCAxXSk7XG4gICAqIC8vID0+IFsyLCAxXVxuICAgKi9cbiAgZnVuY3Rpb24gcmVzdChhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICByZXR1cm4gc2xpY2UoYXJyYXksIChuID09IG51bGwgfHwgZ3VhcmQpID8gMSA6IG5hdGl2ZU1heCgwLCBuKSk7XG4gIH1cblxuICAvKipcbiAgICogVXNlcyBhIGJpbmFyeSBzZWFyY2ggdG8gZGV0ZXJtaW5lIHRoZSBzbWFsbGVzdCBpbmRleCBhdCB3aGljaCB0aGUgYHZhbHVlYFxuICAgKiBzaG91bGQgYmUgaW5zZXJ0ZWQgaW50byBgYXJyYXlgIGluIG9yZGVyIHRvIG1haW50YWluIHRoZSBzb3J0IG9yZGVyIG9mIHRoZVxuICAgKiBzb3J0ZWQgYGFycmF5YC4gSWYgYGNhbGxiYWNrYCBpcyBwYXNzZWQsIGl0IHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGB2YWx1ZWAgYW5kXG4gICAqIGVhY2ggZWxlbWVudCBpbiBgYXJyYXlgIHRvIGNvbXB1dGUgdGhlaXIgc29ydCByYW5raW5nLiBUaGUgYGNhbGxiYWNrYCBpc1xuICAgKiBib3VuZCB0byBgdGhpc0FyZ2AgYW5kIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ7ICh2YWx1ZSkuIFRoZSBgY2FsbGJhY2tgXG4gICAqIGFyZ3VtZW50IG1heSBhbHNvIGJlIHRoZSBuYW1lIG9mIGEgcHJvcGVydHkgdG8gb3JkZXIgYnkuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb258U3RyaW5nfSBbY2FsbGJhY2s9aWRlbnRpdHl8cHJvcGVydHldIFRoZSBmdW5jdGlvbiBjYWxsZWRcbiAgICogIHBlciBpdGVyYXRpb24gb3IgcHJvcGVydHkgbmFtZSB0byBvcmRlciBieS5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgdmFsdWUgc2hvdWxkIGJlIGluc2VydGVkXG4gICAqICBpbnRvIGBhcnJheWAuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8uc29ydGVkSW5kZXgoWzIwLCAzMCwgNTBdLCA0MCk7XG4gICAqIC8vID0+IDJcbiAgICpcbiAgICogXy5zb3J0ZWRJbmRleChbeyAneCc6IDIwIH0sIHsgJ3gnOiAzMCB9LCB7ICd4JzogNTAgfV0sIHsgJ3gnOiA0MCB9LCAneCcpO1xuICAgKiAvLyA9PiAyXG4gICAqXG4gICAqIHZhciBkaWN0ID0ge1xuICAgKiAgICd3b3JkVG9OdW1iZXInOiB7ICd0d2VudHknOiAyMCwgJ3RoaXJ0eSc6IDMwLCAnZm91cnR5JzogNDAsICdmaWZ0eSc6IDUwIH1cbiAgICogfTtcbiAgICpcbiAgICogXy5zb3J0ZWRJbmRleChbJ3R3ZW50eScsICd0aGlydHknLCAnZmlmdHknXSwgJ2ZvdXJ0eScsIGZ1bmN0aW9uKHdvcmQpIHtcbiAgICogICByZXR1cm4gZGljdC53b3JkVG9OdW1iZXJbd29yZF07XG4gICAqIH0pO1xuICAgKiAvLyA9PiAyXG4gICAqXG4gICAqIF8uc29ydGVkSW5kZXgoWyd0d2VudHknLCAndGhpcnR5JywgJ2ZpZnR5J10sICdmb3VydHknLCBmdW5jdGlvbih3b3JkKSB7XG4gICAqICAgcmV0dXJuIHRoaXMud29yZFRvTnVtYmVyW3dvcmRdO1xuICAgKiB9LCBkaWN0KTtcbiAgICogLy8gPT4gMlxuICAgKi9cbiAgZnVuY3Rpb24gc29ydGVkSW5kZXgoYXJyYXksIHZhbHVlLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciBsb3cgPSAwLFxuICAgICAgICBoaWdoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiBsb3c7XG5cbiAgICAvLyBleHBsaWNpdGx5IHJlZmVyZW5jZSBgaWRlbnRpdHlgIGZvciBiZXR0ZXIgaW5saW5pbmcgaW4gRmlyZWZveFxuICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgPyBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZykgOiBpZGVudGl0eTtcbiAgICB2YWx1ZSA9IGNhbGxiYWNrKHZhbHVlKTtcblxuICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7XG4gICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+PiAxO1xuICAgICAgY2FsbGJhY2soYXJyYXlbbWlkXSkgPCB2YWx1ZVxuICAgICAgICA/IGxvdyA9IG1pZCArIDFcbiAgICAgICAgOiBoaWdoID0gbWlkO1xuICAgIH1cbiAgICByZXR1cm4gbG93O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGVzIHRoZSB1bmlvbiBvZiB0aGUgcGFzc2VkLWluIGFycmF5cyB1c2luZyBzdHJpY3QgZXF1YWxpdHkgZm9yXG4gICAqIGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBBcnJheXNcbiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5MSwgYXJyYXkyLCAuLi5dIEFycmF5cyB0byBwcm9jZXNzLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgYXJyYXkgb2YgdW5pcXVlIHZhbHVlcywgaW4gb3JkZXIsIHRoYXQgYXJlXG4gICAqICBwcmVzZW50IGluIG9uZSBvciBtb3JlIG9mIHRoZSBhcnJheXMuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8udW5pb24oWzEsIDIsIDNdLCBbMTAxLCAyLCAxLCAxMF0sIFsyLCAxXSk7XG4gICAqIC8vID0+IFsxLCAyLCAzLCAxMDEsIDEwXVxuICAgKi9cbiAgZnVuY3Rpb24gdW5pb24oKSB7XG4gICAgcmV0dXJuIHVuaXEoY29uY2F0LmFwcGx5KGFycmF5UmVmLCBhcmd1bWVudHMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZHVwbGljYXRlLXZhbHVlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYGFycmF5YCB1c2luZyBzdHJpY3QgZXF1YWxpdHlcbiAgICogZm9yIGNvbXBhcmlzb25zLCBpLmUuIGA9PT1gLiBJZiB0aGUgYGFycmF5YCBpcyBhbHJlYWR5IHNvcnRlZCwgcGFzc2luZyBgdHJ1ZWBcbiAgICogZm9yIGBpc1NvcnRlZGAgd2lsbCBydW4gYSBmYXN0ZXIgYWxnb3JpdGhtLiBJZiBgY2FsbGJhY2tgIGlzIHBhc3NlZCwgZWFjaFxuICAgKiBlbGVtZW50IG9mIGBhcnJheWAgaXMgcGFzc2VkIHRocm91Z2ggYSBjYWxsYmFja2AgYmVmb3JlIHVuaXF1ZW5lc3MgaXMgY29tcHV0ZWQuXG4gICAqIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czsgKHZhbHVlLCBpbmRleCwgYXJyYXkpLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBhbGlhcyB1bmlxdWVcbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcHJvY2Vzcy5cbiAgICogQHBhcmFtIHtCb29sZWFufSBbaXNTb3J0ZWQ9ZmFsc2VdIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBgYXJyYXlgIGlzIGFscmVhZHkgc29ydGVkLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2s9aWRlbnRpdHldIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBkdXBsaWNhdGUtdmFsdWUtZnJlZSBhcnJheS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy51bmlxKFsxLCAyLCAxLCAzLCAxXSk7XG4gICAqIC8vID0+IFsxLCAyLCAzXVxuICAgKlxuICAgKiBfLnVuaXEoWzEsIDEsIDIsIDIsIDNdLCB0cnVlKTtcbiAgICogLy8gPT4gWzEsIDIsIDNdXG4gICAqXG4gICAqIF8udW5pcShbMSwgMiwgMS41LCAzLCAyLjVdLCBmdW5jdGlvbihudW0pIHsgcmV0dXJuIE1hdGguZmxvb3IobnVtKTsgfSk7XG4gICAqIC8vID0+IFsxLCAyLCAzXVxuICAgKlxuICAgKiBfLnVuaXEoWzEsIDIsIDEuNSwgMywgMi41XSwgZnVuY3Rpb24obnVtKSB7IHJldHVybiB0aGlzLmZsb29yKG51bSk7IH0sIE1hdGgpO1xuICAgKiAvLyA9PiBbMSwgMiwgM11cbiAgICovXG4gIGZ1bmN0aW9uIHVuaXEoYXJyYXksIGlzU29ydGVkLCBjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDAsXG4gICAgICAgIHJlc3VsdCA9IFtdLFxuICAgICAgICBzZWVuID0gcmVzdWx0O1xuXG4gICAgLy8ganVnZ2xlIGFyZ3VtZW50c1xuICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpc0FyZyA9IGNhbGxiYWNrO1xuICAgICAgY2FsbGJhY2sgPSBpc1NvcnRlZDtcbiAgICAgIGlzU29ydGVkID0gZmFsc2U7XG4gICAgfVxuICAgIC8vIGluaXQgdmFsdWUgY2FjaGUgZm9yIGxhcmdlIGFycmF5c1xuICAgIHZhciBpc0xhcmdlID0gIWlzU29ydGVkICYmIGxlbmd0aCA+PSA3NTtcbiAgICBpZiAoaXNMYXJnZSkge1xuICAgICAgdmFyIGNhY2hlID0ge307XG4gICAgfVxuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgc2VlbiA9IFtdO1xuICAgICAgY2FsbGJhY2sgPSBjcmVhdGVDYWxsYmFjayhjYWxsYmFjaywgdGhpc0FyZyk7XG4gICAgfVxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sXG4gICAgICAgICAgY29tcHV0ZWQgPSBjYWxsYmFjayA/IGNhbGxiYWNrKHZhbHVlLCBpbmRleCwgYXJyYXkpIDogdmFsdWU7XG5cbiAgICAgIGlmIChpc0xhcmdlKSB7XG4gICAgICAgIHZhciBrZXkgPSBjb21wdXRlZCArICcnO1xuICAgICAgICB2YXIgaW5pdGVkID0gaGFzT3duUHJvcGVydHkuY2FsbChjYWNoZSwga2V5KVxuICAgICAgICAgID8gIShzZWVuID0gY2FjaGVba2V5XSlcbiAgICAgICAgICA6IChzZWVuID0gY2FjaGVba2V5XSA9IFtdKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1NvcnRlZFxuICAgICAgICAgICAgPyAhaW5kZXggfHwgc2VlbltzZWVuLmxlbmd0aCAtIDFdICE9PSBjb21wdXRlZFxuICAgICAgICAgICAgOiBpbml0ZWQgfHwgaW5kZXhPZihzZWVuLCBjb21wdXRlZCkgPCAwXG4gICAgICAgICAgKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayB8fCBpc0xhcmdlKSB7XG4gICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBhcnJheSB3aXRoIGFsbCBvY2N1cnJlbmNlcyBvZiB0aGUgcGFzc2VkIHZhbHVlcyByZW1vdmVkIHVzaW5nXG4gICAqIHN0cmljdCBlcXVhbGl0eSBmb3IgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmlsdGVyLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdmFsdWUxLCB2YWx1ZTIsIC4uLl0gVmFsdWVzIHRvIHJlbW92ZS5cbiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGEgbmV3IGZpbHRlcmVkIGFycmF5LlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLndpdGhvdXQoWzEsIDIsIDEsIDAsIDMsIDEsIDRdLCAwLCAxKTtcbiAgICogLy8gPT4gWzIsIDMsIDRdXG4gICAqL1xuICBmdW5jdGlvbiB3aXRob3V0KGFycmF5KSB7XG4gICAgdmFyIGluZGV4ID0gLTEsXG4gICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCxcbiAgICAgICAgY29udGFpbnMgPSBjYWNoZWRDb250YWlucyhhcmd1bWVudHMsIDEsIDIwKSxcbiAgICAgICAgcmVzdWx0ID0gW107XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdO1xuICAgICAgaWYgKCFjb250YWlucyh2YWx1ZSkpIHtcbiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdyb3VwcyB0aGUgZWxlbWVudHMgb2YgZWFjaCBhcnJheSBhdCB0aGVpciBjb3JyZXNwb25kaW5nIGluZGV4ZXMuIFVzZWZ1bCBmb3JcbiAgICogc2VwYXJhdGUgZGF0YSBzb3VyY2VzIHRoYXQgYXJlIGNvb3JkaW5hdGVkIHRocm91Z2ggbWF0Y2hpbmcgYXJyYXkgaW5kZXhlcy5cbiAgICogRm9yIGEgbWF0cml4IG9mIG5lc3RlZCBhcnJheXMsIGBfLnppcC5hcHBseSguLi4pYCBjYW4gdHJhbnNwb3NlIHRoZSBtYXRyaXhcbiAgICogaW4gYSBzaW1pbGFyIGZhc2hpb24uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEFycmF5c1xuICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXkxLCBhcnJheTIsIC4uLl0gQXJyYXlzIHRvIHByb2Nlc3MuXG4gICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBhIG5ldyBhcnJheSBvZiBncm91cGVkIGVsZW1lbnRzLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLnppcChbJ21vZScsICdsYXJyeScsICdjdXJseSddLCBbMzAsIDQwLCA1MF0sIFt0cnVlLCBmYWxzZSwgZmFsc2VdKTtcbiAgICogLy8gPT4gW1snbW9lJywgMzAsIHRydWVdLCBbJ2xhcnJ5JywgNDAsIGZhbHNlXSwgWydjdXJseScsIDUwLCBmYWxzZV1dXG4gICAqL1xuICBmdW5jdGlvbiB6aXAoYXJyYXkpIHtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBtYXgocGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykpIDogMCxcbiAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcblxuICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgICByZXN1bHRbaW5kZXhdID0gcGx1Y2soYXJndW1lbnRzLCBpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaXMgcmVzdHJpY3RlZCB0byBleGVjdXRpbmcgYGZ1bmNgIG9ubHkgYWZ0ZXIgaXQgaXNcbiAgICogY2FsbGVkIGBuYCB0aW1lcy4gVGhlIGBmdW5jYCBpcyBleGVjdXRlZCB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiB0aGVcbiAgICogY3JlYXRlZCBmdW5jdGlvbi5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgdGltZXMgdGhlIGZ1bmN0aW9uIG11c3QgYmUgY2FsbGVkIGJlZm9yZVxuICAgKiBpdCBpcyBleGVjdXRlZC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gcmVzdHJpY3QuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlc3RyaWN0ZWQgZnVuY3Rpb24uXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciByZW5kZXJOb3RlcyA9IF8uYWZ0ZXIobm90ZXMubGVuZ3RoLCByZW5kZXIpO1xuICAgKiBfLmZvckVhY2gobm90ZXMsIGZ1bmN0aW9uKG5vdGUpIHtcbiAgICogICBub3RlLmFzeW5jU2F2ZSh7ICdzdWNjZXNzJzogcmVuZGVyTm90ZXMgfSk7XG4gICAqIH0pO1xuICAgKiAvLyBgcmVuZGVyTm90ZXNgIGlzIHJ1biBvbmNlLCBhZnRlciBhbGwgbm90ZXMgaGF2ZSBzYXZlZFxuICAgKi9cbiAgZnVuY3Rpb24gYWZ0ZXIobiwgZnVuYykge1xuICAgIGlmIChuIDwgMSkge1xuICAgICAgcmV0dXJuIGZ1bmMoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKC0tbiA8IDEpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGNhbGxlZCwgaW52b2tlcyBgZnVuY2Agd2l0aCB0aGUgYHRoaXNgXG4gICAqIGJpbmRpbmcgb2YgYHRoaXNBcmdgIGFuZCBwcmVwZW5kcyBhbnkgYWRkaXRpb25hbCBgYmluZGAgYXJndW1lbnRzIHRvIHRob3NlXG4gICAqIHBhc3NlZCB0byB0aGUgYm91bmQgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEZ1bmN0aW9uc1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBiaW5kLlxuICAgKiBAcGFyYW0ge01peGVkfSBbdGhpc0FyZ10gVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC5cbiAgICogQHBhcmFtIHtNaXhlZH0gW2FyZzEsIGFyZzIsIC4uLl0gQXJndW1lbnRzIHRvIGJlIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBib3VuZCBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIGZ1bmMgPSBmdW5jdGlvbihncmVldGluZykge1xuICAgKiAgIHJldHVybiBncmVldGluZyArICcgJyArIHRoaXMubmFtZTtcbiAgICogfTtcbiAgICpcbiAgICogZnVuYyA9IF8uYmluZChmdW5jLCB7ICduYW1lJzogJ21vZScgfSwgJ2hpJyk7XG4gICAqIGZ1bmMoKTtcbiAgICogLy8gPT4gJ2hpIG1vZSdcbiAgICovXG4gIGZ1bmN0aW9uIGJpbmQoZnVuYywgdGhpc0FyZykge1xuICAgIC8vIHVzZSBgRnVuY3Rpb24jYmluZGAgaWYgaXQgZXhpc3RzIGFuZCBpcyBmYXN0XG4gICAgLy8gKGluIFY4IGBGdW5jdGlvbiNiaW5kYCBpcyBzbG93ZXIgZXhjZXB0IHdoZW4gcGFydGlhbGx5IGFwcGxpZWQpXG4gICAgcmV0dXJuIGlzQmluZEZhc3QgfHwgKG5hdGl2ZUJpbmQgJiYgYXJndW1lbnRzLmxlbmd0aCA+IDIpXG4gICAgICA/IG5hdGl2ZUJpbmQuY2FsbC5hcHBseShuYXRpdmVCaW5kLCBhcmd1bWVudHMpXG4gICAgICA6IGNyZWF0ZUJvdW5kKGZ1bmMsIHRoaXNBcmcsIHNsaWNlKGFyZ3VtZW50cywgMikpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJpbmRzIG1ldGhvZHMgb24gYG9iamVjdGAgdG8gYG9iamVjdGAsIG92ZXJ3cml0aW5nIHRoZSBleGlzdGluZyBtZXRob2QuXG4gICAqIElmIG5vIG1ldGhvZCBuYW1lcyBhcmUgcHJvdmlkZWQsIGFsbCB0aGUgZnVuY3Rpb24gcHJvcGVydGllcyBvZiBgb2JqZWN0YFxuICAgKiB3aWxsIGJlIGJvdW5kLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBGdW5jdGlvbnNcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGJpbmQgYW5kIGFzc2lnbiB0aGUgYm91bmQgbWV0aG9kcyB0by5cbiAgICogQHBhcmFtIHtTdHJpbmd9IFttZXRob2ROYW1lMSwgbWV0aG9kTmFtZTIsIC4uLl0gTWV0aG9kIG5hbWVzIG9uIHRoZSBvYmplY3QgdG8gYmluZC5cbiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIGJ1dHRvblZpZXcgPSB7XG4gICAqICAnbGFiZWwnOiAnbG9kYXNoJyxcbiAgICogICdvbkNsaWNrJzogZnVuY3Rpb24oKSB7IGFsZXJ0KCdjbGlja2VkOiAnICsgdGhpcy5sYWJlbCk7IH1cbiAgICogfTtcbiAgICpcbiAgICogXy5iaW5kQWxsKGJ1dHRvblZpZXcpO1xuICAgKiBqUXVlcnkoJyNsb2Rhc2hfYnV0dG9uJykub24oJ2NsaWNrJywgYnV0dG9uVmlldy5vbkNsaWNrKTtcbiAgICogLy8gPT4gV2hlbiB0aGUgYnV0dG9uIGlzIGNsaWNrZWQsIGB0aGlzLmxhYmVsYCB3aWxsIGhhdmUgdGhlIGNvcnJlY3QgdmFsdWVcbiAgICovXG4gIGZ1bmN0aW9uIGJpbmRBbGwob2JqZWN0KSB7XG4gICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzLFxuICAgICAgICBpbmRleCA9IGZ1bmNzLmxlbmd0aCA+IDEgPyAwIDogKGZ1bmNzID0gZnVuY3Rpb25zKG9iamVjdCksIC0xKSxcbiAgICAgICAgbGVuZ3RoID0gZnVuY3MubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIHZhciBrZXkgPSBmdW5jc1tpbmRleF07XG4gICAgICBvYmplY3Rba2V5XSA9IGJpbmQob2JqZWN0W2tleV0sIG9iamVjdCk7XG4gICAgfVxuICAgIHJldHVybiBvYmplY3Q7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQsIHdoZW4gY2FsbGVkLCBpbnZva2VzIHRoZSBtZXRob2QgYXQgYG9iamVjdFtrZXldYFxuICAgKiBhbmQgcHJlcGVuZHMgYW55IGFkZGl0aW9uYWwgYGJpbmRLZXlgIGFyZ3VtZW50cyB0byB0aG9zZSBwYXNzZWQgdG8gdGhlIGJvdW5kXG4gICAqIGZ1bmN0aW9uLiBUaGlzIG1ldGhvZCBkaWZmZXJzIGZyb20gYF8uYmluZGAgYnkgYWxsb3dpbmcgYm91bmQgZnVuY3Rpb25zIHRvXG4gICAqIHJlZmVyZW5jZSBtZXRob2RzIHRoYXQgd2lsbCBiZSByZWRlZmluZWQgb3IgZG9uJ3QgeWV0IGV4aXN0LlxuICAgKiBTZWUgaHR0cDovL21pY2hhdXguY2EvYXJ0aWNsZXMvbGF6eS1mdW5jdGlvbi1kZWZpbml0aW9uLXBhdHRlcm4uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEZ1bmN0aW9uc1xuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdGhlIG1ldGhvZCBiZWxvbmdzIHRvLlxuICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIG1ldGhvZC5cbiAgICogQHBhcmFtIHtNaXhlZH0gW2FyZzEsIGFyZzIsIC4uLl0gQXJndW1lbnRzIHRvIGJlIHBhcnRpYWxseSBhcHBsaWVkLlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBib3VuZCBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIG9iamVjdCA9IHtcbiAgICogICAnbmFtZSc6ICdtb2UnLFxuICAgKiAgICdncmVldCc6IGZ1bmN0aW9uKGdyZWV0aW5nKSB7XG4gICAqICAgICByZXR1cm4gZ3JlZXRpbmcgKyAnICcgKyB0aGlzLm5hbWU7XG4gICAqICAgfVxuICAgKiB9O1xuICAgKlxuICAgKiB2YXIgZnVuYyA9IF8uYmluZEtleShvYmplY3QsICdncmVldCcsICdoaScpO1xuICAgKiBmdW5jKCk7XG4gICAqIC8vID0+ICdoaSBtb2UnXG4gICAqXG4gICAqIG9iamVjdC5ncmVldCA9IGZ1bmN0aW9uKGdyZWV0aW5nKSB7XG4gICAqICAgcmV0dXJuIGdyZWV0aW5nICsgJywgJyArIHRoaXMubmFtZSArICchJztcbiAgICogfTtcbiAgICpcbiAgICogZnVuYygpO1xuICAgKiAvLyA9PiAnaGksIG1vZSEnXG4gICAqL1xuICBmdW5jdGlvbiBiaW5kS2V5KG9iamVjdCwga2V5KSB7XG4gICAgcmV0dXJuIGNyZWF0ZUJvdW5kKG9iamVjdCwga2V5LCBzbGljZShhcmd1bWVudHMsIDIpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgdGhlIHBhc3NlZCBmdW5jdGlvbnMsXG4gICAqIHdoZXJlIGVhY2ggZnVuY3Rpb24gY29uc3VtZXMgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLlxuICAgKiBJbiBtYXRoIHRlcm1zLCBjb21wb3NpbmcgdGhlIGZ1bmN0aW9ucyBgZigpYCwgYGcoKWAsIGFuZCBgaCgpYCBwcm9kdWNlcyBgZihnKGgoKSkpYC5cbiAgICogRWFjaCBmdW5jdGlvbiBpcyBleGVjdXRlZCB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiB0aGUgY29tcG9zZWQgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IEZ1bmN0aW9uc1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZnVuYzEsIGZ1bmMyLCAuLi5dIEZ1bmN0aW9ucyB0byBjb21wb3NlLlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjb21wb3NlZCBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIGdyZWV0ID0gZnVuY3Rpb24obmFtZSkgeyByZXR1cm4gJ2hpOiAnICsgbmFtZTsgfTtcbiAgICogdmFyIGV4Y2xhaW0gPSBmdW5jdGlvbihzdGF0ZW1lbnQpIHsgcmV0dXJuIHN0YXRlbWVudCArICchJzsgfTtcbiAgICogdmFyIHdlbGNvbWUgPSBfLmNvbXBvc2UoZXhjbGFpbSwgZ3JlZXQpO1xuICAgKiB3ZWxjb21lKCdtb2UnKTtcbiAgICogLy8gPT4gJ2hpOiBtb2UhJ1xuICAgKi9cbiAgZnVuY3Rpb24gY29tcG9zZSgpIHtcbiAgICB2YXIgZnVuY3MgPSBhcmd1bWVudHM7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgICAgbGVuZ3RoID0gZnVuY3MubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgYXJncyA9IFtmdW5jc1tsZW5ndGhdLmFwcGx5KHRoaXMsIGFyZ3MpXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcmdzWzBdO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBkZWxheSB0aGUgZXhlY3V0aW9uIG9mIGBmdW5jYCB1bnRpbCBhZnRlclxuICAgKiBgd2FpdGAgbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIGl0IHdhcyBpbnZva2VkLiBQYXNzXG4gICAqIGB0cnVlYCBmb3IgYGltbWVkaWF0ZWAgdG8gY2F1c2UgZGVib3VuY2UgdG8gaW52b2tlIGBmdW5jYCBvbiB0aGUgbGVhZGluZyxcbiAgICogaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcsIGVkZ2Ugb2YgdGhlIGB3YWl0YCB0aW1lb3V0LiBTdWJzZXF1ZW50IGNhbGxzIHRvXG4gICAqIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AgY2FsbC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRlYm91bmNlLlxuICAgKiBAcGFyYW0ge051bWJlcn0gd2FpdCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheS5cbiAgICogQHBhcmFtIHtCb29sZWFufSBpbW1lZGlhdGUgQSBmbGFnIHRvIGluZGljYXRlIGV4ZWN1dGlvbiBpcyBvbiB0aGUgbGVhZGluZ1xuICAgKiAgZWRnZSBvZiB0aGUgdGltZW91dC5cbiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZGVib3VuY2VkIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgbGF6eUxheW91dCA9IF8uZGVib3VuY2UoY2FsY3VsYXRlTGF5b3V0LCAzMDApO1xuICAgKiBqUXVlcnkod2luZG93KS5vbigncmVzaXplJywgbGF6eUxheW91dCk7XG4gICAqL1xuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHtcbiAgICB2YXIgYXJncyxcbiAgICAgICAgcmVzdWx0LFxuICAgICAgICB0aGlzQXJnLFxuICAgICAgICB0aW1lb3V0SWQ7XG5cbiAgICBmdW5jdGlvbiBkZWxheWVkKCkge1xuICAgICAgdGltZW91dElkID0gbnVsbDtcbiAgICAgIGlmICghaW1tZWRpYXRlKSB7XG4gICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpc0ltbWVkaWF0ZSA9IGltbWVkaWF0ZSAmJiAhdGltZW91dElkO1xuICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHRoaXNBcmcgPSB0aGlzO1xuXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZGVsYXllZCwgd2FpdCk7XG5cbiAgICAgIGlmIChpc0ltbWVkaWF0ZSkge1xuICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIHRoZSBgZnVuY2AgZnVuY3Rpb24gYWZ0ZXIgYHdhaXRgIG1pbGxpc2Vjb25kcy4gQWRkaXRpb25hbCBhcmd1bWVudHNcbiAgICogd2lsbCBiZSBwYXNzZWQgdG8gYGZ1bmNgIHdoZW4gaXQgaXMgaW52b2tlZC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRlbGF5LlxuICAgKiBAcGFyYW0ge051bWJlcn0gd2FpdCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheSBleGVjdXRpb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFthcmcxLCBhcmcyLCAuLi5dIEFyZ3VtZW50cyB0byBpbnZva2UgdGhlIGZ1bmN0aW9uIHdpdGguXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgdGhlIGBzZXRUaW1lb3V0YCB0aW1lb3V0IGlkLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgbG9nID0gXy5iaW5kKGNvbnNvbGUubG9nLCBjb25zb2xlKTtcbiAgICogXy5kZWxheShsb2csIDEwMDAsICdsb2dnZWQgbGF0ZXInKTtcbiAgICogLy8gPT4gJ2xvZ2dlZCBsYXRlcicgKEFwcGVhcnMgYWZ0ZXIgb25lIHNlY29uZC4pXG4gICAqL1xuICBmdW5jdGlvbiBkZWxheShmdW5jLCB3YWl0KSB7XG4gICAgdmFyIGFyZ3MgPSBzbGljZShhcmd1bWVudHMsIDIpO1xuICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBmdW5jLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7IH0sIHdhaXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlZmVycyBleGVjdXRpbmcgdGhlIGBmdW5jYCBmdW5jdGlvbiB1bnRpbCB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcyBjbGVhcmVkLlxuICAgKiBBZGRpdGlvbmFsIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBgZnVuY2Agd2hlbiBpdCBpcyBpbnZva2VkLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBGdW5jdGlvbnNcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gZGVmZXIuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFthcmcxLCBhcmcyLCAuLi5dIEFyZ3VtZW50cyB0byBpbnZva2UgdGhlIGZ1bmN0aW9uIHdpdGguXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgdGhlIGBzZXRUaW1lb3V0YCB0aW1lb3V0IGlkLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmRlZmVyKGZ1bmN0aW9uKCkgeyBhbGVydCgnZGVmZXJyZWQnKTsgfSk7XG4gICAqIC8vIHJldHVybnMgZnJvbSB0aGUgZnVuY3Rpb24gYmVmb3JlIGBhbGVydGAgaXMgY2FsbGVkXG4gICAqL1xuICBmdW5jdGlvbiBkZWZlcihmdW5jKSB7XG4gICAgdmFyIGFyZ3MgPSBzbGljZShhcmd1bWVudHMsIDEpO1xuICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBmdW5jLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7IH0sIDEpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IG1lbW9pemVzIHRoZSByZXN1bHQgb2YgYGZ1bmNgLiBJZiBgcmVzb2x2ZXJgIGlzXG4gICAqIHBhc3NlZCwgaXQgd2lsbCBiZSB1c2VkIHRvIGRldGVybWluZSB0aGUgY2FjaGUga2V5IGZvciBzdG9yaW5nIHRoZSByZXN1bHRcbiAgICogYmFzZWQgb24gdGhlIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uLiBCeSBkZWZhdWx0LCB0aGUgZmlyc3RcbiAgICogYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbiBpcyB1c2VkIGFzIHRoZSBjYWNoZSBrZXkuIFRoZSBgZnVuY2BcbiAgICogaXMgZXhlY3V0ZWQgd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlIG1lbW9pemVkIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBGdW5jdGlvbnNcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gaGF2ZSBpdHMgb3V0cHV0IG1lbW9pemVkLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcmVzb2x2ZXJdIEEgZnVuY3Rpb24gdXNlZCB0byByZXNvbHZlIHRoZSBjYWNoZSBrZXkuXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemluZyBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIGZpYm9uYWNjaSA9IF8ubWVtb2l6ZShmdW5jdGlvbihuKSB7XG4gICAqICAgcmV0dXJuIG4gPCAyID8gbiA6IGZpYm9uYWNjaShuIC0gMSkgKyBmaWJvbmFjY2kobiAtIDIpO1xuICAgKiB9KTtcbiAgICovXG4gIGZ1bmN0aW9uIG1lbW9pemUoZnVuYywgcmVzb2x2ZXIpIHtcbiAgICB2YXIgY2FjaGUgPSB7fTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIga2V5ID0gcmVzb2x2ZXIgPyByZXNvbHZlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogYXJndW1lbnRzWzBdO1xuICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoY2FjaGUsIGtleSlcbiAgICAgICAgPyBjYWNoZVtrZXldXG4gICAgICAgIDogKGNhY2hlW2tleV0gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgaXMgcmVzdHJpY3RlZCB0byBleGVjdXRlIGBmdW5jYCBvbmNlLiBSZXBlYXQgY2FsbHMgdG9cbiAgICogdGhlIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgY2FsbC4gVGhlIGBmdW5jYCBpcyBleGVjdXRlZFxuICAgKiB3aXRoIHRoZSBgdGhpc2AgYmluZGluZyBvZiB0aGUgY3JlYXRlZCBmdW5jdGlvbi5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHJlc3RyaWN0LlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyByZXN0cmljdGVkIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgaW5pdGlhbGl6ZSA9IF8ub25jZShjcmVhdGVBcHBsaWNhdGlvbik7XG4gICAqIGluaXRpYWxpemUoKTtcbiAgICogaW5pdGlhbGl6ZSgpO1xuICAgKiAvLyBBcHBsaWNhdGlvbiBpcyBvbmx5IGNyZWF0ZWQgb25jZS5cbiAgICovXG4gIGZ1bmN0aW9uIG9uY2UoZnVuYykge1xuICAgIHZhciByZXN1bHQsXG4gICAgICAgIHJhbiA9IGZhbHNlO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHJhbikge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgcmFuID0gdHJ1ZTtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuICAgICAgLy8gY2xlYXIgdGhlIGBmdW5jYCB2YXJpYWJsZSBzbyB0aGUgZnVuY3Rpb24gbWF5IGJlIGdhcmJhZ2UgY29sbGVjdGVkXG4gICAgICBmdW5jID0gbnVsbDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCwgd2hlbiBjYWxsZWQsIGludm9rZXMgYGZ1bmNgIHdpdGggYW55IGFkZGl0aW9uYWxcbiAgICogYHBhcnRpYWxgIGFyZ3VtZW50cyBwcmVwZW5kZWQgdG8gdGhvc2UgcGFzc2VkIHRvIHRoZSBuZXcgZnVuY3Rpb24uIFRoaXNcbiAgICogbWV0aG9kIGlzIHNpbWlsYXIgdG8gYGJpbmRgLCBleGNlcHQgaXQgZG9lcyAqKm5vdCoqIGFsdGVyIHRoZSBgdGhpc2AgYmluZGluZy5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHBhcnRpYWxseSBhcHBseSBhcmd1bWVudHMgdG8uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFthcmcxLCBhcmcyLCAuLi5dIEFyZ3VtZW50cyB0byBiZSBwYXJ0aWFsbHkgYXBwbGllZC5cbiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcGFydGlhbGx5IGFwcGxpZWQgZnVuY3Rpb24uXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBncmVldCA9IGZ1bmN0aW9uKGdyZWV0aW5nLCBuYW1lKSB7IHJldHVybiBncmVldGluZyArICc6ICcgKyBuYW1lOyB9O1xuICAgKiB2YXIgaGkgPSBfLnBhcnRpYWwoZ3JlZXQsICdoaScpO1xuICAgKiBoaSgnbW9lJyk7XG4gICAqIC8vID0+ICdoaTogbW9lJ1xuICAgKi9cbiAgZnVuY3Rpb24gcGFydGlhbChmdW5jKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUJvdW5kKGZ1bmMsIHNsaWNlKGFyZ3VtZW50cywgMSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGV4ZWN1dGVkLCB3aWxsIG9ubHkgY2FsbCB0aGUgYGZ1bmNgXG4gICAqIGZ1bmN0aW9uIGF0IG1vc3Qgb25jZSBwZXIgZXZlcnkgYHdhaXRgIG1pbGxpc2Vjb25kcy4gSWYgdGhlIHRocm90dGxlZFxuICAgKiBmdW5jdGlvbiBpcyBpbnZva2VkIG1vcmUgdGhhbiBvbmNlIGR1cmluZyB0aGUgYHdhaXRgIHRpbWVvdXQsIGBmdW5jYCB3aWxsXG4gICAqIGFsc28gYmUgY2FsbGVkIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0LiBTdWJzZXF1ZW50IGNhbGxzIHRvIHRoZVxuICAgKiB0aHJvdHRsZWQgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AgY2FsbC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb25zXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHRocm90dGxlLlxuICAgKiBAcGFyYW0ge051bWJlcn0gd2FpdCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB0aHJvdHRsZSBleGVjdXRpb25zIHRvLlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB0aHJvdHRsZWQgZnVuY3Rpb24uXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciB0aHJvdHRsZWQgPSBfLnRocm90dGxlKHVwZGF0ZVBvc2l0aW9uLCAxMDApO1xuICAgKiBqUXVlcnkod2luZG93KS5vbignc2Nyb2xsJywgdGhyb3R0bGVkKTtcbiAgICovXG4gIGZ1bmN0aW9uIHRocm90dGxlKGZ1bmMsIHdhaXQpIHtcbiAgICB2YXIgYXJncyxcbiAgICAgICAgcmVzdWx0LFxuICAgICAgICB0aGlzQXJnLFxuICAgICAgICB0aW1lb3V0SWQsXG4gICAgICAgIGxhc3RDYWxsZWQgPSAwO1xuXG4gICAgZnVuY3Rpb24gdHJhaWxpbmdDYWxsKCkge1xuICAgICAgbGFzdENhbGxlZCA9IG5ldyBEYXRlO1xuICAgICAgdGltZW91dElkID0gbnVsbDtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSxcbiAgICAgICAgICByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIGxhc3RDYWxsZWQpO1xuXG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgdGhpc0FyZyA9IHRoaXM7XG5cbiAgICAgIGlmIChyZW1haW5pbmcgPD0gMCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgdGltZW91dElkID0gbnVsbDtcbiAgICAgICAgbGFzdENhbGxlZCA9IG5vdztcbiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCF0aW1lb3V0SWQpIHtcbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCh0cmFpbGluZ0NhbGwsIHJlbWFpbmluZyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIGB2YWx1ZWAgdG8gdGhlIGB3cmFwcGVyYCBmdW5jdGlvbiBhcyBpdHNcbiAgICogZmlyc3QgYXJndW1lbnQuIEFkZGl0aW9uYWwgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gYXJlIGFwcGVuZGVkXG4gICAqIHRvIHRob3NlIHBhc3NlZCB0byB0aGUgYHdyYXBwZXJgIGZ1bmN0aW9uLiBUaGUgYHdyYXBwZXJgIGlzIGV4ZWN1dGVkIHdpdGhcbiAgICogdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBjcmVhdGVkIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBGdW5jdGlvbnNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHdyYXBwZXIgVGhlIHdyYXBwZXIgZnVuY3Rpb24uXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB2YXIgaGVsbG8gPSBmdW5jdGlvbihuYW1lKSB7IHJldHVybiAnaGVsbG8gJyArIG5hbWU7IH07XG4gICAqIGhlbGxvID0gXy53cmFwKGhlbGxvLCBmdW5jdGlvbihmdW5jKSB7XG4gICAqICAgcmV0dXJuICdiZWZvcmUsICcgKyBmdW5jKCdtb2UnKSArICcsIGFmdGVyJztcbiAgICogfSk7XG4gICAqIGhlbGxvKCk7XG4gICAqIC8vID0+ICdiZWZvcmUsIGhlbGxvIG1vZSwgYWZ0ZXInXG4gICAqL1xuICBmdW5jdGlvbiB3cmFwKHZhbHVlLCB3cmFwcGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MgPSBbdmFsdWVdO1xuICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIHdyYXBwZXIuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfTtcbiAgfVxuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyB0aGUgY2hhcmFjdGVycyBgJmAsIGA8YCwgYD5gLCBgXCJgLCBhbmQgYCdgIGluIGBzdHJpbmdgIHRvIHRoZWlyXG4gICAqIGNvcnJlc3BvbmRpbmcgSFRNTCBlbnRpdGllcy5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgVXRpbGl0aWVzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBlc2NhcGUuXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IFJldHVybnMgdGhlIGVzY2FwZWQgc3RyaW5nLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmVzY2FwZSgnTW9lLCBMYXJyeSAmIEN1cmx5Jyk7XG4gICAqIC8vID0+ICdNb2UsIExhcnJ5ICZhbXA7IEN1cmx5J1xuICAgKi9cbiAgZnVuY3Rpb24gZXNjYXBlKHN0cmluZykge1xuICAgIHJldHVybiBzdHJpbmcgPT0gbnVsbCA/ICcnIDogKHN0cmluZyArICcnKS5yZXBsYWNlKHJlVW5lc2NhcGVkSHRtbCwgZXNjYXBlSHRtbENoYXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgcGFzc2VkIHRvIGl0LlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBVdGlsaXRpZXNcbiAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgQW55IHZhbHVlLlxuICAgKiBAcmV0dXJucyB7TWl4ZWR9IFJldHVybnMgYHZhbHVlYC5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIG1vZSA9IHsgJ25hbWUnOiAnbW9lJyB9O1xuICAgKiBtb2UgPT09IF8uaWRlbnRpdHkobW9lKTtcbiAgICogLy8gPT4gdHJ1ZVxuICAgKi9cbiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBmdW5jdGlvbnMgcHJvcGVydGllcyBvZiBgb2JqZWN0YCB0byB0aGUgYGxvZGFzaGAgZnVuY3Rpb24gYW5kIGNoYWluYWJsZVxuICAgKiB3cmFwcGVyLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBVdGlsaXRpZXNcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IG9mIGZ1bmN0aW9uIHByb3BlcnRpZXMgdG8gYWRkIHRvIGBsb2Rhc2hgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLm1peGluKHtcbiAgICogICAnY2FwaXRhbGl6ZSc6IGZ1bmN0aW9uKHN0cmluZykge1xuICAgKiAgICAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuICAgKiAgIH1cbiAgICogfSk7XG4gICAqXG4gICAqIF8uY2FwaXRhbGl6ZSgnbGFycnknKTtcbiAgICogLy8gPT4gJ0xhcnJ5J1xuICAgKlxuICAgKiBfKCdjdXJseScpLmNhcGl0YWxpemUoKTtcbiAgICogLy8gPT4gJ0N1cmx5J1xuICAgKi9cbiAgZnVuY3Rpb24gbWl4aW4ob2JqZWN0KSB7XG4gICAgZm9yRWFjaChmdW5jdGlvbnMob2JqZWN0KSwgZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgICAgdmFyIGZ1bmMgPSBsb2Rhc2hbbWV0aG9kTmFtZV0gPSBvYmplY3RbbWV0aG9kTmFtZV07XG5cbiAgICAgIGxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fX3dyYXBwZWRfX107XG4gICAgICAgIHB1c2guYXBwbHkoYXJncywgYXJndW1lbnRzKTtcblxuICAgICAgICB2YXIgcmVzdWx0ID0gZnVuYy5hcHBseShsb2Rhc2gsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gbmV3IGxvZGFzaChyZXN1bHQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXZlcnRzIHRoZSAnXycgdmFyaWFibGUgdG8gaXRzIHByZXZpb3VzIHZhbHVlIGFuZCByZXR1cm5zIGEgcmVmZXJlbmNlIHRvXG4gICAqIHRoZSBgbG9kYXNoYCBmdW5jdGlvbi5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgVXRpbGl0aWVzXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgYGxvZGFzaGAgZnVuY3Rpb24uXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBsb2Rhc2ggPSBfLm5vQ29uZmxpY3QoKTtcbiAgICovXG4gIGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7XG4gICAgd2luZG93Ll8gPSBvbGREYXNoO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2R1Y2VzIGEgcmFuZG9tIG51bWJlciBiZXR3ZWVuIGBtaW5gIGFuZCBgbWF4YCAoaW5jbHVzaXZlKS4gSWYgb25seSBvbmVcbiAgICogYXJndW1lbnQgaXMgcGFzc2VkLCBhIG51bWJlciBiZXR3ZWVuIGAwYCBhbmQgdGhlIGdpdmVuIG51bWJlciB3aWxsIGJlIHJldHVybmVkLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBVdGlsaXRpZXNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW49MF0gVGhlIG1pbmltdW0gcG9zc2libGUgdmFsdWUuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4PTFdIFRoZSBtYXhpbXVtIHBvc3NpYmxlIHZhbHVlLlxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIGEgcmFuZG9tIG51bWJlci5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogXy5yYW5kb20oMCwgNSk7XG4gICAqIC8vID0+IGEgbnVtYmVyIGJldHdlZW4gMSBhbmQgNVxuICAgKlxuICAgKiBfLnJhbmRvbSg1KTtcbiAgICogLy8gPT4gYWxzbyBhIG51bWJlciBiZXR3ZWVuIDEgYW5kIDVcbiAgICovXG4gIGZ1bmN0aW9uIHJhbmRvbShtaW4sIG1heCkge1xuICAgIGlmIChtaW4gPT0gbnVsbCAmJiBtYXggPT0gbnVsbCkge1xuICAgICAgbWF4ID0gMTtcbiAgICB9XG4gICAgbWluID0gK21pbiB8fCAwO1xuICAgIGlmIChtYXggPT0gbnVsbCkge1xuICAgICAgbWF4ID0gbWluO1xuICAgICAgbWluID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIG1pbiArIGZsb29yKG5hdGl2ZVJhbmRvbSgpICogKCgrbWF4IHx8IDApIC0gbWluICsgMSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRoZSB2YWx1ZSBvZiBgcHJvcGVydHlgIG9uIGBvYmplY3RgLiBJZiBgcHJvcGVydHlgIGlzIGEgZnVuY3Rpb25cbiAgICogaXQgd2lsbCBiZSBpbnZva2VkIGFuZCBpdHMgcmVzdWx0IHJldHVybmVkLCBlbHNlIHRoZSBwcm9wZXJ0eSB2YWx1ZSBpc1xuICAgKiByZXR1cm5lZC4gSWYgYG9iamVjdGAgaXMgZmFsc2V5LCB0aGVuIGBudWxsYCBpcyByZXR1cm5lZC5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgVXRpbGl0aWVzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LlxuICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHkgVGhlIHByb3BlcnR5IHRvIGdldCB0aGUgdmFsdWUgb2YuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHZhciBvYmplY3QgPSB7XG4gICAqICAgJ2NoZWVzZSc6ICdjcnVtcGV0cycsXG4gICAqICAgJ3N0dWZmJzogZnVuY3Rpb24oKSB7XG4gICAqICAgICByZXR1cm4gJ25vbnNlbnNlJztcbiAgICogICB9XG4gICAqIH07XG4gICAqXG4gICAqIF8ucmVzdWx0KG9iamVjdCwgJ2NoZWVzZScpO1xuICAgKiAvLyA9PiAnY3J1bXBldHMnXG4gICAqXG4gICAqIF8ucmVzdWx0KG9iamVjdCwgJ3N0dWZmJyk7XG4gICAqIC8vID0+ICdub25zZW5zZSdcbiAgICovXG4gIGZ1bmN0aW9uIHJlc3VsdChvYmplY3QsIHByb3BlcnR5KSB7XG4gICAgLy8gYmFzZWQgb24gQmFja2JvbmUncyBwcml2YXRlIGBnZXRWYWx1ZWAgZnVuY3Rpb25cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZG9jdW1lbnRjbG91ZC9iYWNrYm9uZS9ibG9iLzAuOS4yL2JhY2tib25lLmpzI0wxNDE5LTE0MjRcbiAgICB2YXIgdmFsdWUgPSBvYmplY3QgPyBvYmplY3RbcHJvcGVydHldIDogbnVsbDtcbiAgICByZXR1cm4gaXNGdW5jdGlvbih2YWx1ZSkgPyBvYmplY3RbcHJvcGVydHldKCkgOiB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIG1pY3JvLXRlbXBsYXRpbmcgbWV0aG9kIHRoYXQgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzXG4gICAqIHdoaXRlc3BhY2UsIGFuZCBjb3JyZWN0bHkgZXNjYXBlcyBxdW90ZXMgd2l0aGluIGludGVycG9sYXRlZCBjb2RlLlxuICAgKlxuICAgKiBOb3RlOiBJbiB0aGUgZGV2ZWxvcG1lbnQgYnVpbGQgYF8udGVtcGxhdGVgIHV0aWxpemVzIHNvdXJjZVVSTHMgZm9yIGVhc2llclxuICAgKiBkZWJ1Z2dpbmcuIFNlZSBodHRwOi8vd3d3Lmh0bWw1cm9ja3MuY29tL2VuL3R1dG9yaWFscy9kZXZlbG9wZXJ0b29scy9zb3VyY2VtYXBzLyN0b2Mtc291cmNldXJsXG4gICAqXG4gICAqIE5vdGU6IExvLURhc2ggbWF5IGJlIHVzZWQgaW4gQ2hyb21lIGV4dGVuc2lvbnMgYnkgZWl0aGVyIGNyZWF0aW5nIGEgYGxvZGFzaCBjc3BgXG4gICAqIGJ1aWxkIGFuZCBhdm9pZGluZyBgXy50ZW1wbGF0ZWAgdXNlLCBvciBsb2FkaW5nIExvLURhc2ggaW4gYSBzYW5kYm94ZWQgcGFnZS5cbiAgICogU2VlIGh0dHA6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS90cnVuay9leHRlbnNpb25zL3NhbmRib3hpbmdFdmFsLmh0bWxcbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgVXRpbGl0aWVzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZW1wbGF0ZSB0ZXh0LlxuICAgKiBAcGFyYW0ge09iZWN0fSBkYXRhIFRoZSBkYXRhIG9iamVjdCB1c2VkIHRvIHBvcHVsYXRlIHRoZSB0ZXh0LlxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuXG4gICAqICBlc2NhcGUgLSBUaGUgXCJlc2NhcGVcIiBkZWxpbWl0ZXIgcmVnZXhwLlxuICAgKiAgZXZhbHVhdGUgLSBUaGUgXCJldmFsdWF0ZVwiIGRlbGltaXRlciByZWdleHAuXG4gICAqICBpbnRlcnBvbGF0ZSAtIFRoZSBcImludGVycG9sYXRlXCIgZGVsaW1pdGVyIHJlZ2V4cC5cbiAgICogIHNvdXJjZVVSTCAtIFRoZSBzb3VyY2VVUkwgb2YgdGhlIHRlbXBsYXRlJ3MgY29tcGlsZWQgc291cmNlLlxuICAgKiAgdmFyaWFibGUgLSBUaGUgZGF0YSBvYmplY3QgdmFyaWFibGUgbmFtZS5cbiAgICpcbiAgICogQHJldHVybnMge0Z1bmN0aW9ufFN0cmluZ30gUmV0dXJucyBhIGNvbXBpbGVkIGZ1bmN0aW9uIHdoZW4gbm8gYGRhdGFgIG9iamVjdFxuICAgKiAgaXMgZ2l2ZW4sIGVsc2UgaXQgcmV0dXJucyB0aGUgaW50ZXJwb2xhdGVkIHRleHQuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIC8vIHVzaW5nIGEgY29tcGlsZWQgdGVtcGxhdGVcbiAgICogdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZSgnaGVsbG8gPCU9IG5hbWUgJT4nKTtcbiAgICogY29tcGlsZWQoeyAnbmFtZSc6ICdtb2UnIH0pO1xuICAgKiAvLyA9PiAnaGVsbG8gbW9lJ1xuICAgKlxuICAgKiB2YXIgbGlzdCA9ICc8JSBfLmZvckVhY2gocGVvcGxlLCBmdW5jdGlvbihuYW1lKSB7ICU+PGxpPjwlPSBuYW1lICU+PC9saT48JSB9KTsgJT4nO1xuICAgKiBfLnRlbXBsYXRlKGxpc3QsIHsgJ3Blb3BsZSc6IFsnbW9lJywgJ2xhcnJ5JywgJ2N1cmx5J10gfSk7XG4gICAqIC8vID0+ICc8bGk+bW9lPC9saT48bGk+bGFycnk8L2xpPjxsaT5jdXJseTwvbGk+J1xuICAgKlxuICAgKiAvLyB1c2luZyB0aGUgXCJlc2NhcGVcIiBkZWxpbWl0ZXIgdG8gZXNjYXBlIEhUTUwgaW4gZGF0YSBwcm9wZXJ0eSB2YWx1ZXNcbiAgICogXy50ZW1wbGF0ZSgnPGI+PCUtIHZhbHVlICU+PC9iPicsIHsgJ3ZhbHVlJzogJzxzY3JpcHQ+JyB9KTtcbiAgICogLy8gPT4gJzxiPiZsdDtzY3JpcHQmZ3Q7PC9iPidcbiAgICpcbiAgICogLy8gdXNpbmcgdGhlIEVTNiBkZWxpbWl0ZXIgYXMgYW4gYWx0ZXJuYXRpdmUgdG8gdGhlIGRlZmF1bHQgXCJpbnRlcnBvbGF0ZVwiIGRlbGltaXRlclxuICAgKiBfLnRlbXBsYXRlKCdoZWxsbyAkeyBuYW1lIH0nLCB7ICduYW1lJzogJ2N1cmx5JyB9KTtcbiAgICogLy8gPT4gJ2hlbGxvIGN1cmx5J1xuICAgKlxuICAgKiAvLyB1c2luZyB0aGUgaW50ZXJuYWwgYHByaW50YCBmdW5jdGlvbiBpbiBcImV2YWx1YXRlXCIgZGVsaW1pdGVyc1xuICAgKiBfLnRlbXBsYXRlKCc8JSBwcmludChcImhlbGxvIFwiICsgZXBpdGhldCk7ICU+IScsIHsgJ2VwaXRoZXQnOiAnc3Rvb2dlJyB9KTtcbiAgICogLy8gPT4gJ2hlbGxvIHN0b29nZSEnXG4gICAqXG4gICAqIC8vIHVzaW5nIGN1c3RvbSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzXG4gICAqIF8udGVtcGxhdGVTZXR0aW5ncyA9IHtcbiAgICogICAnaW50ZXJwb2xhdGUnOiAve3soW1xcc1xcU10rPyl9fS9nXG4gICAqIH07XG4gICAqXG4gICAqIF8udGVtcGxhdGUoJ2hlbGxvIHt7IG5hbWUgfX0hJywgeyAnbmFtZSc6ICdtdXN0YWNoZScgfSk7XG4gICAqIC8vID0+ICdoZWxsbyBtdXN0YWNoZSEnXG4gICAqXG4gICAqIC8vIHVzaW5nIHRoZSBgc291cmNlVVJMYCBvcHRpb24gdG8gc3BlY2lmeSBhIGN1c3RvbSBzb3VyY2VVUkwgZm9yIHRoZSB0ZW1wbGF0ZVxuICAgKiB2YXIgY29tcGlsZWQgPSBfLnRlbXBsYXRlKCdoZWxsbyA8JT0gbmFtZSAlPicsIG51bGwsIHsgJ3NvdXJjZVVSTCc6ICcvYmFzaWMvZ3JlZXRpbmcuanN0JyB9KTtcbiAgICogY29tcGlsZWQoZGF0YSk7XG4gICAqIC8vID0+IGZpbmQgdGhlIHNvdXJjZSBvZiBcImdyZWV0aW5nLmpzdFwiIHVuZGVyIHRoZSBTb3VyY2VzIHRhYiBvciBSZXNvdXJjZXMgcGFuZWwgb2YgdGhlIHdlYiBpbnNwZWN0b3JcbiAgICpcbiAgICogLy8gdXNpbmcgdGhlIGB2YXJpYWJsZWAgb3B0aW9uIHRvIGVuc3VyZSBhIHdpdGgtc3RhdGVtZW50IGlzbid0IHVzZWQgaW4gdGhlIGNvbXBpbGVkIHRlbXBsYXRlXG4gICAqIHZhciBjb21waWxlZCA9IF8udGVtcGxhdGUoJ2hlbGxvIDwlPSBkYXRhLm5hbWUgJT4hJywgbnVsbCwgeyAndmFyaWFibGUnOiAnZGF0YScgfSk7XG4gICAqIGNvbXBpbGVkLnNvdXJjZTtcbiAgICogLy8gPT4gZnVuY3Rpb24oZGF0YSkge1xuICAgKiAgIHZhciBfX3QsIF9fcCA9ICcnLCBfX2UgPSBfLmVzY2FwZTtcbiAgICogICBfX3AgKz0gJ2hlbGxvICcgKyAoKF9fdCA9ICggZGF0YS5uYW1lICkpID09IG51bGwgPyAnJyA6IF9fdCkgKyAnISc7XG4gICAqICAgcmV0dXJuIF9fcDtcbiAgICogfVxuICAgKlxuICAgKiAvLyB1c2luZyB0aGUgYHNvdXJjZWAgcHJvcGVydHkgdG8gaW5saW5lIGNvbXBpbGVkIHRlbXBsYXRlcyBmb3IgbWVhbmluZ2Z1bFxuICAgKiAvLyBsaW5lIG51bWJlcnMgaW4gZXJyb3IgbWVzc2FnZXMgYW5kIGEgc3RhY2sgdHJhY2VcbiAgICogZnMud3JpdGVGaWxlU3luYyhwYXRoLmpvaW4oY3dkLCAnanN0LmpzJyksICdcXFxuICAgKiAgIHZhciBKU1QgPSB7XFxcbiAgICogICAgIFwibWFpblwiOiAnICsgXy50ZW1wbGF0ZShtYWluVGV4dCkuc291cmNlICsgJ1xcXG4gICAqICAgfTtcXFxuICAgKiAnKTtcbiAgICovXG4gIGZ1bmN0aW9uIHRlbXBsYXRlKHRleHQsIGRhdGEsIG9wdGlvbnMpIHtcbiAgICAvLyBiYXNlZCBvbiBKb2huIFJlc2lnJ3MgYHRtcGxgIGltcGxlbWVudGF0aW9uXG4gICAgLy8gaHR0cDovL2Vqb2huLm9yZy9ibG9nL2phdmFzY3JpcHQtbWljcm8tdGVtcGxhdGluZy9cbiAgICAvLyBhbmQgTGF1cmEgRG9rdG9yb3ZhJ3MgZG9ULmpzXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL29sYWRvL2RvVFxuICAgIHRleHQgfHwgKHRleHQgPSAnJyk7XG4gICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTtcblxuICAgIHZhciBpc0V2YWx1YXRpbmcsXG4gICAgICAgIHJlc3VsdCxcbiAgICAgICAgc2V0dGluZ3MgPSBsb2Rhc2gudGVtcGxhdGVTZXR0aW5ncyxcbiAgICAgICAgaW5kZXggPSAwLFxuICAgICAgICBpbnRlcnBvbGF0ZSA9IG9wdGlvbnMuaW50ZXJwb2xhdGUgfHwgc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgcmVOb01hdGNoLFxuICAgICAgICBzb3VyY2UgPSBcIl9fcCArPSAnXCIsXG4gICAgICAgIHZhcmlhYmxlID0gb3B0aW9ucy52YXJpYWJsZSB8fCBzZXR0aW5ncy52YXJpYWJsZSxcbiAgICAgICAgaGFzVmFyaWFibGUgPSB2YXJpYWJsZTtcblxuICAgIC8vIGNvbXBpbGUgcmVnZXhwIHRvIG1hdGNoIGVhY2ggZGVsaW1pdGVyXG4gICAgdmFyIHJlRGVsaW1pdGVycyA9IFJlZ0V4cChcbiAgICAgIChvcHRpb25zLmVzY2FwZSB8fCBzZXR0aW5ncy5lc2NhcGUgfHwgcmVOb01hdGNoKS5zb3VyY2UgKyAnfCcgK1xuICAgICAgaW50ZXJwb2xhdGUuc291cmNlICsgJ3wnICtcbiAgICAgIChpbnRlcnBvbGF0ZSA9PT0gcmVJbnRlcnBvbGF0ZSA/IHJlRXNUZW1wbGF0ZSA6IHJlTm9NYXRjaCkuc291cmNlICsgJ3wnICtcbiAgICAgIChvcHRpb25zLmV2YWx1YXRlIHx8IHNldHRpbmdzLmV2YWx1YXRlIHx8IHJlTm9NYXRjaCkuc291cmNlICsgJ3wkJ1xuICAgICwgJ2cnKTtcblxuICAgIHRleHQucmVwbGFjZShyZURlbGltaXRlcnMsIGZ1bmN0aW9uKG1hdGNoLCBlc2NhcGVWYWx1ZSwgaW50ZXJwb2xhdGVWYWx1ZSwgZXNUZW1wbGF0ZVZhbHVlLCBldmFsdWF0ZVZhbHVlLCBvZmZzZXQpIHtcbiAgICAgIGludGVycG9sYXRlVmFsdWUgfHwgKGludGVycG9sYXRlVmFsdWUgPSBlc1RlbXBsYXRlVmFsdWUpO1xuXG4gICAgICAvLyBlc2NhcGUgY2hhcmFjdGVycyB0aGF0IGNhbm5vdCBiZSBpbmNsdWRlZCBpbiBzdHJpbmcgbGl0ZXJhbHNcbiAgICAgIHNvdXJjZSArPSB0ZXh0LnNsaWNlKGluZGV4LCBvZmZzZXQpLnJlcGxhY2UocmVVbmVzY2FwZWRTdHJpbmcsIGVzY2FwZVN0cmluZ0NoYXIpO1xuXG4gICAgICAvLyByZXBsYWNlIGRlbGltaXRlcnMgd2l0aCBzbmlwcGV0c1xuICAgICAgaWYgKGVzY2FwZVZhbHVlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIicgK1xcbl9fZShcIiArIGVzY2FwZVZhbHVlICsgXCIpICtcXG4nXCI7XG4gICAgICB9XG4gICAgICBpZiAoZXZhbHVhdGVWYWx1ZSkge1xuICAgICAgICBzb3VyY2UgKz0gXCInO1xcblwiICsgZXZhbHVhdGVWYWx1ZSArIFwiO1xcbl9fcCArPSAnXCI7XG4gICAgICB9XG4gICAgICBpZiAoaW50ZXJwb2xhdGVWYWx1ZSkge1xuICAgICAgICBzb3VyY2UgKz0gXCInICtcXG4oKF9fdCA9IChcIiArIGludGVycG9sYXRlVmFsdWUgKyBcIikpID09IG51bGwgPyAnJyA6IF9fdCkgK1xcbidcIjtcbiAgICAgIH1cbiAgICAgIGlzRXZhbHVhdGluZyB8fCAoaXNFdmFsdWF0aW5nID0gZXZhbHVhdGVWYWx1ZSB8fCByZUNvbXBsZXhEZWxpbWl0ZXIudGVzdChlc2NhcGVWYWx1ZSB8fCBpbnRlcnBvbGF0ZVZhbHVlKSk7XG4gICAgICBpbmRleCA9IG9mZnNldCArIG1hdGNoLmxlbmd0aDtcblxuICAgICAgLy8gdGhlIEpTIGVuZ2luZSBlbWJlZGRlZCBpbiBBZG9iZSBwcm9kdWN0cyByZXF1aXJlcyByZXR1cm5pbmcgdGhlIGBtYXRjaGBcbiAgICAgIC8vIHN0cmluZyBpbiBvcmRlciB0byBwcm9kdWNlIHRoZSBjb3JyZWN0IGBvZmZzZXRgIHZhbHVlXG4gICAgICByZXR1cm4gbWF0Y2g7XG4gICAgfSk7XG5cbiAgICBzb3VyY2UgKz0gXCInO1xcblwiO1xuXG4gICAgLy8gaWYgYHZhcmlhYmxlYCBpcyBub3Qgc3BlY2lmaWVkIGFuZCB0aGUgdGVtcGxhdGUgY29udGFpbnMgXCJldmFsdWF0ZVwiXG4gICAgLy8gZGVsaW1pdGVycywgd3JhcCBhIHdpdGgtc3RhdGVtZW50IGFyb3VuZCB0aGUgZ2VuZXJhdGVkIGNvZGUgdG8gYWRkIHRoZVxuICAgIC8vIGRhdGEgb2JqZWN0IHRvIHRoZSB0b3Agb2YgdGhlIHNjb3BlIGNoYWluXG4gICAgaWYgKCFoYXNWYXJpYWJsZSkge1xuICAgICAgdmFyaWFibGUgPSAnb2JqJztcbiAgICAgIGlmIChpc0V2YWx1YXRpbmcpIHtcbiAgICAgICAgc291cmNlID0gJ3dpdGggKCcgKyB2YXJpYWJsZSArICcpIHtcXG4nICsgc291cmNlICsgJ1xcbn1cXG4nO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIGF2b2lkIGEgd2l0aC1zdGF0ZW1lbnQgYnkgcHJlcGVuZGluZyBkYXRhIG9iamVjdCByZWZlcmVuY2VzIHRvIHByb3BlcnR5IG5hbWVzXG4gICAgICAgIHZhciByZURvdWJsZVZhcmlhYmxlID0gUmVnRXhwKCcoXFxcXChcXFxccyopJyArIHZhcmlhYmxlICsgJ1xcXFwuJyArIHZhcmlhYmxlICsgJ1xcXFxiJywgJ2cnKTtcbiAgICAgICAgc291cmNlID0gc291cmNlXG4gICAgICAgICAgLnJlcGxhY2UocmVJbnNlcnRWYXJpYWJsZSwgJyQmJyArIHZhcmlhYmxlICsgJy4nKVxuICAgICAgICAgIC5yZXBsYWNlKHJlRG91YmxlVmFyaWFibGUsICckMV9fZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNsZWFudXAgY29kZSBieSBzdHJpcHBpbmcgZW1wdHkgc3RyaW5nc1xuICAgIHNvdXJjZSA9IChpc0V2YWx1YXRpbmcgPyBzb3VyY2UucmVwbGFjZShyZUVtcHR5U3RyaW5nTGVhZGluZywgJycpIDogc291cmNlKVxuICAgICAgLnJlcGxhY2UocmVFbXB0eVN0cmluZ01pZGRsZSwgJyQxJylcbiAgICAgIC5yZXBsYWNlKHJlRW1wdHlTdHJpbmdUcmFpbGluZywgJyQxOycpO1xuXG4gICAgLy8gZnJhbWUgY29kZSBhcyB0aGUgZnVuY3Rpb24gYm9keVxuICAgIHNvdXJjZSA9ICdmdW5jdGlvbignICsgdmFyaWFibGUgKyAnKSB7XFxuJyArXG4gICAgICAoaGFzVmFyaWFibGUgPyAnJyA6IHZhcmlhYmxlICsgJyB8fCAoJyArIHZhcmlhYmxlICsgJyA9IHt9KTtcXG4nKSArXG4gICAgICBcInZhciBfX3QsIF9fcCA9ICcnLCBfX2UgPSBfLmVzY2FwZVwiICtcbiAgICAgIChpc0V2YWx1YXRpbmdcbiAgICAgICAgPyAnLCBfX2ogPSBBcnJheS5wcm90b3R5cGUuam9pbjtcXG4nICtcbiAgICAgICAgICBcImZ1bmN0aW9uIHByaW50KCkgeyBfX3AgKz0gX19qLmNhbGwoYXJndW1lbnRzLCAnJykgfVxcblwiXG4gICAgICAgIDogKGhhc1ZhcmlhYmxlID8gJycgOiAnLCBfX2QgPSAnICsgdmFyaWFibGUgKyAnLicgKyB2YXJpYWJsZSArICcgfHwgJyArIHZhcmlhYmxlKSArICc7XFxuJ1xuICAgICAgKSArXG4gICAgICBzb3VyY2UgK1xuICAgICAgJ3JldHVybiBfX3BcXG59JztcblxuICAgIC8vIHVzZSBhIHNvdXJjZVVSTCBmb3IgZWFzaWVyIGRlYnVnZ2luZ1xuICAgIC8vIGh0dHA6Ly93d3cuaHRtbDVyb2Nrcy5jb20vZW4vdHV0b3JpYWxzL2RldmVsb3BlcnRvb2xzL3NvdXJjZW1hcHMvI3RvYy1zb3VyY2V1cmxcbiAgICB2YXIgc291cmNlVVJMID0gdXNlU291cmNlVVJMXG4gICAgICA/ICdcXG4vL0Agc291cmNlVVJMPScgKyAob3B0aW9ucy5zb3VyY2VVUkwgfHwgJy9sb2Rhc2gvdGVtcGxhdGUvc291cmNlWycgKyAodGVtcGxhdGVDb3VudGVyKyspICsgJ10nKVxuICAgICAgOiAnJztcblxuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBGdW5jdGlvbignXycsICdyZXR1cm4gJyArIHNvdXJjZSArIHNvdXJjZVVSTCkobG9kYXNoKTtcbiAgICB9IGNhdGNoKGUpIHtcbiAgICAgIGUuc291cmNlID0gc291cmNlO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YSkge1xuICAgICAgcmV0dXJuIHJlc3VsdChkYXRhKTtcbiAgICB9XG4gICAgLy8gcHJvdmlkZSB0aGUgY29tcGlsZWQgZnVuY3Rpb24ncyBzb3VyY2UgdmlhIGl0cyBgdG9TdHJpbmdgIG1ldGhvZCwgaW5cbiAgICAvLyBzdXBwb3J0ZWQgZW52aXJvbm1lbnRzLCBvciB0aGUgYHNvdXJjZWAgcHJvcGVydHkgYXMgYSBjb252ZW5pZW5jZSBmb3JcbiAgICAvLyBpbmxpbmluZyBjb21waWxlZCB0ZW1wbGF0ZXMgZHVyaW5nIHRoZSBidWlsZCBwcm9jZXNzXG4gICAgcmVzdWx0LnNvdXJjZSA9IHNvdXJjZTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIHRoZSBgY2FsbGJhY2tgIGZ1bmN0aW9uIGBuYCB0aW1lcywgcmV0dXJuaW5nIGFuIGFycmF5IG9mIHRoZSByZXN1bHRzXG4gICAqIG9mIGVhY2ggYGNhbGxiYWNrYCBleGVjdXRpb24uIFRoZSBgY2FsbGJhY2tgIGlzIGJvdW5kIHRvIGB0aGlzQXJnYCBhbmQgaW52b2tlZFxuICAgKiB3aXRoIG9uZSBhcmd1bWVudDsgKGluZGV4KS5cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyT2YgX1xuICAgKiBAY2F0ZWdvcnkgVXRpbGl0aWVzXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgdGltZXMgdG8gZXhlY3V0ZSB0aGUgY2FsbGJhY2suXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiBjYWxsZWQgcGVyIGl0ZXJhdGlvbi5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgY2FsbGJhY2tgLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYSBuZXcgYXJyYXkgb2YgdGhlIHJlc3VsdHMgb2YgZWFjaCBgY2FsbGJhY2tgIGV4ZWN1dGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdmFyIGRpY2VSb2xscyA9IF8udGltZXMoMywgXy5wYXJ0aWFsKF8ucmFuZG9tLCAxLCA2KSk7XG4gICAqIC8vID0+IFszLCA2LCA0XVxuICAgKlxuICAgKiBfLnRpbWVzKDMsIGZ1bmN0aW9uKG4pIHsgbWFnZS5jYXN0U3BlbGwobik7IH0pO1xuICAgKiAvLyA9PiBjYWxscyBgbWFnZS5jYXN0U3BlbGwobilgIHRocmVlIHRpbWVzLCBwYXNzaW5nIGBuYCBvZiBgMGAsIGAxYCwgYW5kIGAyYCByZXNwZWN0aXZlbHlcbiAgICpcbiAgICogXy50aW1lcygzLCBmdW5jdGlvbihuKSB7IHRoaXMuY2FzdChuKTsgfSwgbWFnZSk7XG4gICAqIC8vID0+IGFsc28gY2FsbHMgYG1hZ2UuY2FzdFNwZWxsKG4pYCB0aHJlZSB0aW1lc1xuICAgKi9cbiAgZnVuY3Rpb24gdGltZXMobiwgY2FsbGJhY2ssIHRoaXNBcmcpIHtcbiAgICBuID0gK24gfHwgMDtcbiAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgcmVzdWx0ID0gQXJyYXkobik7XG5cbiAgICB3aGlsZSAoKytpbmRleCA8IG4pIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBjYWxsYmFjay5jYWxsKHRoaXNBcmcsIGluZGV4KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgb3Bwb3NpdGUgb2YgYF8uZXNjYXBlYCwgdGhpcyBtZXRob2QgY29udmVydHMgdGhlIEhUTUwgZW50aXRpZXNcbiAgICogYCZhbXA7YCwgYCZsdDtgLCBgJmd0O2AsIGAmcXVvdDtgLCBhbmQgYCYjeDI3O2AgaW4gYHN0cmluZ2AgdG8gdGhlaXJcbiAgICogY29ycmVzcG9uZGluZyBjaGFyYWN0ZXJzLlxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBVdGlsaXRpZXNcbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIHVuZXNjYXBlLlxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBSZXR1cm5zIHRoZSB1bmVzY2FwZWQgc3RyaW5nLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLnVuZXNjYXBlKCdNb2UsIExhcnJ5ICZhbXA7IEN1cmx5Jyk7XG4gICAqIC8vID0+ICdNb2UsIExhcnJ5ICYgQ3VybHknXG4gICAqL1xuICBmdW5jdGlvbiB1bmVzY2FwZShzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nID09IG51bGwgPyAnJyA6IChzdHJpbmcgKyAnJykucmVwbGFjZShyZUVzY2FwZWRIdG1sLCB1bmVzY2FwZUh0bWxDaGFyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgYSB1bmlxdWUgSUQuIElmIGBwcmVmaXhgIGlzIHBhc3NlZCwgdGhlIElEIHdpbGwgYmUgYXBwZW5kZWQgdG8gaXQuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IFV0aWxpdGllc1xuICAgKiBAcGFyYW0ge1N0cmluZ30gW3ByZWZpeF0gVGhlIHZhbHVlIHRvIHByZWZpeCB0aGUgSUQgd2l0aC5cbiAgICogQHJldHVybnMge1N0cmluZ30gUmV0dXJucyB0aGUgdW5pcXVlIElELlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLnVuaXF1ZUlkKCdjb250YWN0XycpO1xuICAgKiAvLyA9PiAnY29udGFjdF8xMDQnXG4gICAqXG4gICAqIF8udW5pcXVlSWQoKTtcbiAgICogLy8gPT4gJzEwNSdcbiAgICovXG4gIGZ1bmN0aW9uIHVuaXF1ZUlkKHByZWZpeCkge1xuICAgIHJldHVybiAocHJlZml4ID09IG51bGwgPyAnJyA6IHByZWZpeCArICcnKSArICgrK2lkQ291bnRlcik7XG4gIH1cblxuICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAvKipcbiAgICogSW52b2tlcyBgaW50ZXJjZXB0b3JgIHdpdGggdGhlIGB2YWx1ZWAgYXMgdGhlIGZpcnN0IGFyZ3VtZW50LCBhbmQgdGhlblxuICAgKiByZXR1cm5zIGB2YWx1ZWAuIFRoZSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvIFwidGFwIGludG9cIiBhIG1ldGhvZCBjaGFpbixcbiAgICogaW4gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGNhdGVnb3J5IENoYWluaW5nXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBwYXNzIHRvIGBpbnRlcmNlcHRvcmAuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGludGVyY2VwdG9yIFRoZSBmdW5jdGlvbiB0byBpbnZva2UuXG4gICAqIEByZXR1cm5zIHtNaXhlZH0gUmV0dXJucyBgdmFsdWVgLlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfLmNoYWluKFsxLCAyLCAzLCAyMDBdKVxuICAgKiAgLmZpbHRlcihmdW5jdGlvbihudW0pIHsgcmV0dXJuIG51bSAlIDIgPT0gMDsgfSlcbiAgICogIC50YXAoYWxlcnQpXG4gICAqICAubWFwKGZ1bmN0aW9uKG51bSkgeyByZXR1cm4gbnVtICogbnVtOyB9KVxuICAgKiAgLnZhbHVlKCk7XG4gICAqIC8vID0+IC8vIFsyLCAyMDBdIChhbGVydGVkKVxuICAgKiAvLyA9PiBbNCwgNDAwMDBdXG4gICAqL1xuICBmdW5jdGlvbiB0YXAodmFsdWUsIGludGVyY2VwdG9yKSB7XG4gICAgaW50ZXJjZXB0b3IodmFsdWUpO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9kdWNlcyB0aGUgYHRvU3RyaW5nYCByZXN1bHQgb2YgdGhlIHdyYXBwZWQgdmFsdWUuXG4gICAqXG4gICAqIEBuYW1lIHRvU3RyaW5nXG4gICAqIEBtZW1iZXJPZiBfXG4gICAqIEBjYXRlZ29yeSBDaGFpbmluZ1xuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBSZXR1cm5zIHRoZSBzdHJpbmcgcmVzdWx0LlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBfKFsxLCAyLCAzXSkudG9TdHJpbmcoKTtcbiAgICogLy8gPT4gJzEsMiwzJ1xuICAgKi9cbiAgZnVuY3Rpb24gd3JhcHBlclRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLl9fd3JhcHBlZF9fICsgJyc7XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgdGhlIHdyYXBwZWQgdmFsdWUuXG4gICAqXG4gICAqIEBuYW1lIHZhbHVlT2ZcbiAgICogQG1lbWJlck9mIF9cbiAgICogQGFsaWFzIHZhbHVlXG4gICAqIEBjYXRlZ29yeSBDaGFpbmluZ1xuICAgKiBAcmV0dXJucyB7TWl4ZWR9IFJldHVybnMgdGhlIHdyYXBwZWQgdmFsdWUuXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIF8oWzEsIDIsIDNdKS52YWx1ZU9mKCk7XG4gICAqIC8vID0+IFsxLCAyLCAzXVxuICAgKi9cbiAgZnVuY3Rpb24gd3JhcHBlclZhbHVlT2YoKSB7XG4gICAgcmV0dXJuIHRoaXMuX193cmFwcGVkX187XG4gIH1cblxuICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAvLyBhZGQgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIHdyYXBwZWQgdmFsdWVzIHdoZW4gY2hhaW5pbmdcbiAgbG9kYXNoLmFmdGVyID0gYWZ0ZXI7XG4gIGxvZGFzaC5hc3NpZ24gPSBhc3NpZ247XG4gIGxvZGFzaC5iaW5kID0gYmluZDtcbiAgbG9kYXNoLmJpbmRBbGwgPSBiaW5kQWxsO1xuICBsb2Rhc2guYmluZEtleSA9IGJpbmRLZXk7XG4gIGxvZGFzaC5jb21wYWN0ID0gY29tcGFjdDtcbiAgbG9kYXNoLmNvbXBvc2UgPSBjb21wb3NlO1xuICBsb2Rhc2guY291bnRCeSA9IGNvdW50Qnk7XG4gIGxvZGFzaC5kZWJvdW5jZSA9IGRlYm91bmNlO1xuICBsb2Rhc2guZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgbG9kYXNoLmRlZmVyID0gZGVmZXI7XG4gIGxvZGFzaC5kZWxheSA9IGRlbGF5O1xuICBsb2Rhc2guZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2U7XG4gIGxvZGFzaC5maWx0ZXIgPSBmaWx0ZXI7XG4gIGxvZGFzaC5mbGF0dGVuID0gZmxhdHRlbjtcbiAgbG9kYXNoLmZvckVhY2ggPSBmb3JFYWNoO1xuICBsb2Rhc2guZm9ySW4gPSBmb3JJbjtcbiAgbG9kYXNoLmZvck93biA9IGZvck93bjtcbiAgbG9kYXNoLmZ1bmN0aW9ucyA9IGZ1bmN0aW9ucztcbiAgbG9kYXNoLmdyb3VwQnkgPSBncm91cEJ5O1xuICBsb2Rhc2guaW5pdGlhbCA9IGluaXRpYWw7XG4gIGxvZGFzaC5pbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247XG4gIGxvZGFzaC5pbnZlcnQgPSBpbnZlcnQ7XG4gIGxvZGFzaC5pbnZva2UgPSBpbnZva2U7XG4gIGxvZGFzaC5rZXlzID0ga2V5cztcbiAgbG9kYXNoLm1hcCA9IG1hcDtcbiAgbG9kYXNoLm1heCA9IG1heDtcbiAgbG9kYXNoLm1lbW9pemUgPSBtZW1vaXplO1xuICBsb2Rhc2gubWVyZ2UgPSBtZXJnZTtcbiAgbG9kYXNoLm1pbiA9IG1pbjtcbiAgbG9kYXNoLm9iamVjdCA9IG9iamVjdDtcbiAgbG9kYXNoLm9taXQgPSBvbWl0O1xuICBsb2Rhc2gub25jZSA9IG9uY2U7XG4gIGxvZGFzaC5wYWlycyA9IHBhaXJzO1xuICBsb2Rhc2gucGFydGlhbCA9IHBhcnRpYWw7XG4gIGxvZGFzaC5waWNrID0gcGljaztcbiAgbG9kYXNoLnBsdWNrID0gcGx1Y2s7XG4gIGxvZGFzaC5yYW5nZSA9IHJhbmdlO1xuICBsb2Rhc2gucmVqZWN0ID0gcmVqZWN0O1xuICBsb2Rhc2gucmVzdCA9IHJlc3Q7XG4gIGxvZGFzaC5zaHVmZmxlID0gc2h1ZmZsZTtcbiAgbG9kYXNoLnNvcnRCeSA9IHNvcnRCeTtcbiAgbG9kYXNoLnRhcCA9IHRhcDtcbiAgbG9kYXNoLnRocm90dGxlID0gdGhyb3R0bGU7XG4gIGxvZGFzaC50aW1lcyA9IHRpbWVzO1xuICBsb2Rhc2gudG9BcnJheSA9IHRvQXJyYXk7XG4gIGxvZGFzaC51bmlvbiA9IHVuaW9uO1xuICBsb2Rhc2gudW5pcSA9IHVuaXE7XG4gIGxvZGFzaC52YWx1ZXMgPSB2YWx1ZXM7XG4gIGxvZGFzaC53aGVyZSA9IHdoZXJlO1xuICBsb2Rhc2gud2l0aG91dCA9IHdpdGhvdXQ7XG4gIGxvZGFzaC53cmFwID0gd3JhcDtcbiAgbG9kYXNoLnppcCA9IHppcDtcblxuICAvLyBhZGQgYWxpYXNlc1xuICBsb2Rhc2guY29sbGVjdCA9IG1hcDtcbiAgbG9kYXNoLmRyb3AgPSByZXN0O1xuICBsb2Rhc2guZWFjaCA9IGZvckVhY2g7XG4gIGxvZGFzaC5leHRlbmQgPSBhc3NpZ247XG4gIGxvZGFzaC5tZXRob2RzID0gZnVuY3Rpb25zO1xuICBsb2Rhc2guc2VsZWN0ID0gZmlsdGVyO1xuICBsb2Rhc2gudGFpbCA9IHJlc3Q7XG4gIGxvZGFzaC51bmlxdWUgPSB1bmlxO1xuXG4gIC8vIGFkZCBmdW5jdGlvbnMgdG8gYGxvZGFzaC5wcm90b3R5cGVgXG4gIG1peGluKGxvZGFzaCk7XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLy8gYWRkIGZ1bmN0aW9ucyB0aGF0IHJldHVybiB1bndyYXBwZWQgdmFsdWVzIHdoZW4gY2hhaW5pbmdcbiAgbG9kYXNoLmNsb25lID0gY2xvbmU7XG4gIGxvZGFzaC5jbG9uZURlZXAgPSBjbG9uZURlZXA7XG4gIGxvZGFzaC5jb250YWlucyA9IGNvbnRhaW5zO1xuICBsb2Rhc2guZXNjYXBlID0gZXNjYXBlO1xuICBsb2Rhc2guZXZlcnkgPSBldmVyeTtcbiAgbG9kYXNoLmZpbmQgPSBmaW5kO1xuICBsb2Rhc2guaGFzID0gaGFzO1xuICBsb2Rhc2guaWRlbnRpdHkgPSBpZGVudGl0eTtcbiAgbG9kYXNoLmluZGV4T2YgPSBpbmRleE9mO1xuICBsb2Rhc2guaXNBcmd1bWVudHMgPSBpc0FyZ3VtZW50cztcbiAgbG9kYXNoLmlzQXJyYXkgPSBpc0FycmF5O1xuICBsb2Rhc2guaXNCb29sZWFuID0gaXNCb29sZWFuO1xuICBsb2Rhc2guaXNEYXRlID0gaXNEYXRlO1xuICBsb2Rhc2guaXNFbGVtZW50ID0gaXNFbGVtZW50O1xuICBsb2Rhc2guaXNFbXB0eSA9IGlzRW1wdHk7XG4gIGxvZGFzaC5pc0VxdWFsID0gaXNFcXVhbDtcbiAgbG9kYXNoLmlzRmluaXRlID0gaXNGaW5pdGU7XG4gIGxvZGFzaC5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjtcbiAgbG9kYXNoLmlzTmFOID0gaXNOYU47XG4gIGxvZGFzaC5pc051bGwgPSBpc051bGw7XG4gIGxvZGFzaC5pc051bWJlciA9IGlzTnVtYmVyO1xuICBsb2Rhc2guaXNPYmplY3QgPSBpc09iamVjdDtcbiAgbG9kYXNoLmlzUGxhaW5PYmplY3QgPSBpc1BsYWluT2JqZWN0O1xuICBsb2Rhc2guaXNSZWdFeHAgPSBpc1JlZ0V4cDtcbiAgbG9kYXNoLmlzU3RyaW5nID0gaXNTdHJpbmc7XG4gIGxvZGFzaC5pc1VuZGVmaW5lZCA9IGlzVW5kZWZpbmVkO1xuICBsb2Rhc2gubGFzdEluZGV4T2YgPSBsYXN0SW5kZXhPZjtcbiAgbG9kYXNoLm1peGluID0gbWl4aW47XG4gIGxvZGFzaC5ub0NvbmZsaWN0ID0gbm9Db25mbGljdDtcbiAgbG9kYXNoLnJhbmRvbSA9IHJhbmRvbTtcbiAgbG9kYXNoLnJlZHVjZSA9IHJlZHVjZTtcbiAgbG9kYXNoLnJlZHVjZVJpZ2h0ID0gcmVkdWNlUmlnaHQ7XG4gIGxvZGFzaC5yZXN1bHQgPSByZXN1bHQ7XG4gIGxvZGFzaC5zaXplID0gc2l6ZTtcbiAgbG9kYXNoLnNvbWUgPSBzb21lO1xuICBsb2Rhc2guc29ydGVkSW5kZXggPSBzb3J0ZWRJbmRleDtcbiAgbG9kYXNoLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gIGxvZGFzaC51bmVzY2FwZSA9IHVuZXNjYXBlO1xuICBsb2Rhc2gudW5pcXVlSWQgPSB1bmlxdWVJZDtcblxuICAvLyBhZGQgYWxpYXNlc1xuICBsb2Rhc2guYWxsID0gZXZlcnk7XG4gIGxvZGFzaC5hbnkgPSBzb21lO1xuICBsb2Rhc2guZGV0ZWN0ID0gZmluZDtcbiAgbG9kYXNoLmZvbGRsID0gcmVkdWNlO1xuICBsb2Rhc2guZm9sZHIgPSByZWR1Y2VSaWdodDtcbiAgbG9kYXNoLmluY2x1ZGUgPSBjb250YWlucztcbiAgbG9kYXNoLmluamVjdCA9IHJlZHVjZTtcblxuICBmb3JPd24obG9kYXNoLCBmdW5jdGlvbihmdW5jLCBtZXRob2ROYW1lKSB7XG4gICAgaWYgKCFsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdKSB7XG4gICAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gW3RoaXMuX193cmFwcGVkX19dO1xuICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7XG4gICAgICAgIHJldHVybiBmdW5jLmFwcGx5KGxvZGFzaCwgYXJncyk7XG4gICAgICB9O1xuICAgIH1cbiAgfSk7XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLy8gYWRkIGZ1bmN0aW9ucyBjYXBhYmxlIG9mIHJldHVybmluZyB3cmFwcGVkIGFuZCB1bndyYXBwZWQgdmFsdWVzIHdoZW4gY2hhaW5pbmdcbiAgbG9kYXNoLmZpcnN0ID0gZmlyc3Q7XG4gIGxvZGFzaC5sYXN0ID0gbGFzdDtcblxuICAvLyBhZGQgYWxpYXNlc1xuICBsb2Rhc2gudGFrZSA9IGZpcnN0O1xuICBsb2Rhc2guaGVhZCA9IGZpcnN0O1xuXG4gIGZvck93bihsb2Rhc2gsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIWxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV0pIHtcbiAgICAgIGxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV09IGZ1bmN0aW9uKG4sIGd1YXJkKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBmdW5jKHRoaXMuX193cmFwcGVkX18sIG4sIGd1YXJkKTtcbiAgICAgICAgcmV0dXJuIChuID09IG51bGwgfHwgZ3VhcmQpID8gcmVzdWx0IDogbmV3IGxvZGFzaChyZXN1bHQpO1xuICAgICAgfTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gIC8qKlxuICAgKiBUaGUgc2VtYW50aWMgdmVyc2lvbiBudW1iZXIuXG4gICAqXG4gICAqIEBzdGF0aWNcbiAgICogQG1lbWJlck9mIF9cbiAgICogQHR5cGUgU3RyaW5nXG4gICAqL1xuICBsb2Rhc2guVkVSU0lPTiA9ICcxLjAuMC1yYy4zJztcblxuICAvLyBhZGQgXCJDaGFpbmluZ1wiIGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlclxuICBsb2Rhc2gucHJvdG90eXBlLnRvU3RyaW5nID0gd3JhcHBlclRvU3RyaW5nO1xuICBsb2Rhc2gucHJvdG90eXBlLnZhbHVlID0gd3JhcHBlclZhbHVlT2Y7XG4gIGxvZGFzaC5wcm90b3R5cGUudmFsdWVPZiA9IHdyYXBwZXJWYWx1ZU9mO1xuXG4gIC8vIGFkZCBgQXJyYXlgIGZ1bmN0aW9ucyB0aGF0IHJldHVybiB1bndyYXBwZWQgdmFsdWVzXG4gIGVhY2goWydqb2luJywgJ3BvcCcsICdzaGlmdCddLCBmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgdmFyIGZ1bmMgPSBhcnJheVJlZlttZXRob2ROYW1lXTtcbiAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLl9fd3JhcHBlZF9fLCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH0pO1xuXG4gIC8vIGFkZCBgQXJyYXlgIGZ1bmN0aW9ucyB0aGF0IHJldHVybiB0aGUgd3JhcHBlZCB2YWx1ZVxuICBlYWNoKFsncHVzaCcsICdyZXZlcnNlJywgJ3NvcnQnLCAndW5zaGlmdCddLCBmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgdmFyIGZ1bmMgPSBhcnJheVJlZlttZXRob2ROYW1lXTtcbiAgICBsb2Rhc2gucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICBmdW5jLmFwcGx5KHRoaXMuX193cmFwcGVkX18sIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICB9KTtcblxuICAvLyBhZGQgYEFycmF5YCBmdW5jdGlvbnMgdGhhdCByZXR1cm4gbmV3IHdyYXBwZWQgdmFsdWVzXG4gIGVhY2goWydjb25jYXQnLCAnc2xpY2UnLCAnc3BsaWNlJ10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICB2YXIgZnVuYyA9IGFycmF5UmVmW21ldGhvZE5hbWVdO1xuICAgIGxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXMuX193cmFwcGVkX18sIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gbmV3IGxvZGFzaChyZXN1bHQpO1xuICAgIH07XG4gIH0pO1xuXG4gIC8vIGF2b2lkIGFycmF5LWxpa2Ugb2JqZWN0IGJ1Z3Mgd2l0aCBgQXJyYXkjc2hpZnRgIGFuZCBgQXJyYXkjc3BsaWNlYFxuICAvLyBpbiBGaXJlZm94IDwgMTAgYW5kIElFIDwgOVxuICBpZiAoaGFzT2JqZWN0U3BsaWNlQnVnKSB7XG4gICAgZWFjaChbJ3BvcCcsICdzaGlmdCcsICdzcGxpY2UnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgICAgdmFyIGZ1bmMgPSBhcnJheVJlZlttZXRob2ROYW1lXSxcbiAgICAgICAgICBpc1NwbGljZSA9IG1ldGhvZE5hbWUgPT0gJ3NwbGljZSc7XG5cbiAgICAgIGxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5fX3dyYXBwZWRfXyxcbiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGRlbGV0ZSB2YWx1ZVswXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNTcGxpY2UgPyBuZXcgbG9kYXNoKHJlc3VsdCkgOiByZXN1bHQ7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLy8gYWRkIHBzZXVkbyBwcml2YXRlIHByb3BlcnR5IHRvIGJlIHVzZWQgYW5kIHJlbW92ZWQgZHVyaW5nIHRoZSBidWlsZCBwcm9jZXNzXG4gIGxvZGFzaC5fZWFjaCA9IGVhY2g7XG4gIGxvZGFzaC5faXRlcmF0b3JUZW1wbGF0ZSA9IGl0ZXJhdG9yVGVtcGxhdGU7XG5cbiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgLy8gZXhwb3NlIExvLURhc2hcbiAgLy8gc29tZSBBTUQgYnVpbGQgb3B0aW1pemVycywgbGlrZSByLmpzLCBjaGVjayBmb3Igc3BlY2lmaWMgY29uZGl0aW9uIHBhdHRlcm5zIGxpa2UgdGhlIGZvbGxvd2luZzpcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgZGVmaW5lLmFtZCA9PSAnb2JqZWN0JyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgLy8gRXhwb3NlIExvLURhc2ggdG8gdGhlIGdsb2JhbCBvYmplY3QgZXZlbiB3aGVuIGFuIEFNRCBsb2FkZXIgaXMgcHJlc2VudCBpblxuICAgIC8vIGNhc2UgTG8tRGFzaCB3YXMgaW5qZWN0ZWQgYnkgYSB0aGlyZC1wYXJ0eSBzY3JpcHQgYW5kIG5vdCBpbnRlbmRlZCB0byBiZVxuICAgIC8vIGxvYWRlZCBhcyBhIG1vZHVsZS4gVGhlIGdsb2JhbCBhc3NpZ25tZW50IGNhbiBiZSByZXZlcnRlZCBpbiB0aGUgTG8tRGFzaFxuICAgIC8vIG1vZHVsZSB2aWEgaXRzIGBub0NvbmZsaWN0KClgIG1ldGhvZC5cbiAgICB3aW5kb3cuXyA9IGxvZGFzaDtcblxuICAgIC8vIGRlZmluZSBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHNvLCB0aHJvdWdoIHBhdGggbWFwcGluZywgaXQgY2FuIGJlXG4gICAgLy8gcmVmZXJlbmNlZCBhcyB0aGUgXCJ1bmRlcnNjb3JlXCIgbW9kdWxlXG4gICAgZGVmaW5lKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGxvZGFzaDtcbiAgICB9KTtcbiAgfVxuICAvLyBjaGVjayBmb3IgYGV4cG9ydHNgIGFmdGVyIGBkZWZpbmVgIGluIGNhc2UgYSBidWlsZCBvcHRpbWl6ZXIgYWRkcyBhbiBgZXhwb3J0c2Agb2JqZWN0XG4gIGVsc2UgaWYgKGZyZWVFeHBvcnRzKSB7XG4gICAgLy8gaW4gTm9kZS5qcyBvciBSaW5nb0pTIHYwLjguMCtcbiAgICBpZiAodHlwZW9mIG1vZHVsZSA9PSAnb2JqZWN0JyAmJiBtb2R1bGUgJiYgbW9kdWxlLmV4cG9ydHMgPT0gZnJlZUV4cG9ydHMpIHtcbiAgICAgIChtb2R1bGUuZXhwb3J0cyA9IGxvZGFzaCkuXyA9IGxvZGFzaDtcbiAgICB9XG4gICAgLy8gaW4gTmFyd2hhbCBvciBSaW5nb0pTIHYwLjcuMC1cbiAgICBlbHNlIHtcbiAgICAgIGZyZWVFeHBvcnRzLl8gPSBsb2Rhc2g7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIC8vIGluIGEgYnJvd3NlciBvciBSaGlub1xuICAgIHdpbmRvdy5fID0gbG9kYXNoO1xuICB9XG59KHRoaXMpKTtcblxufSkod2luZG93KSIsbnVsbCwiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG5cbnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcblxucHJvY2Vzcy5uZXh0VGljayA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNhblNldEltbWVkaWF0ZSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnNldEltbWVkaWF0ZTtcbiAgICB2YXIgY2FuUG9zdCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnBvc3RNZXNzYWdlICYmIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyXG4gICAgO1xuXG4gICAgaWYgKGNhblNldEltbWVkaWF0ZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIHdpbmRvdy5zZXRJbW1lZGlhdGUoZikgfTtcbiAgICB9XG5cbiAgICBpZiAoY2FuUG9zdCkge1xuICAgICAgICB2YXIgcXVldWUgPSBbXTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIGlmIChldi5zb3VyY2UgPT09IHdpbmRvdyAmJiBldi5kYXRhID09PSAncHJvY2Vzcy10aWNrJykge1xuICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmbiA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGZuKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dFRpY2soZm4pIHtcbiAgICAgICAgICAgIHF1ZXVlLnB1c2goZm4pO1xuICAgICAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKCdwcm9jZXNzLXRpY2snLCAnKicpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiBuZXh0VGljayhmbikge1xuICAgICAgICBzZXRUaW1lb3V0KGZuLCAwKTtcbiAgICB9O1xufSkoKTtcblxucHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJztcbnByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG5wcm9jZXNzLmVudiA9IHt9O1xucHJvY2Vzcy5hcmd2ID0gW107XG5cbnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xufVxuXG4vLyBUT0RPKHNodHlsbWFuKVxucHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG4iLCIoZnVuY3Rpb24ocHJvY2VzcyxnbG9iYWwpe3ZhciBBZG1pblVwZ3JhZGUsIEFkbWluTWVudSwgUGFnaW5hdG9yLCBQaG90b0Nyb3BwZXIsIGxheW91dFN0YXRpYywgbGF5b3V0T25QZXJzb25hbGl6ZSwgcGFnZXJJbml0LCBob21lcGFnZSwgZm9ydW0sIHNhbWVQcm9maWxlLCBwcm9maWxlLCBhZG1pbiwgam9pblNlYXJjaCwgcmVzZXRQYWdpbmF0b3IsIGVuZFNlYXJjaCwgbWtTZWFyY2hQbnVtVG9IcmVmLCBta1Bvc3RQbnVtVG9IcmVmLCBzZWFyY2gsIHBhZ2UsIHByaXZhdGVTaXRlLCBzbGljZSQgPSBbXS5zbGljZSwgb3V0JCA9IHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnICYmIGV4cG9ydHMgfHwgdGhpcztcbmdsb2JhbC5mdXJsID0gcmVxdWlyZSgnLi9mb3J1bS11cmxzLmxzJyk7XG5pbXBvcnQkKGdsb2JhbCwgcmVxdWlyZSgnLi9zaGFyZWQtaGVscGVycy5scycpKTtcbkFkbWluVXBncmFkZSA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudC9BZG1pblVwZ3JhZGUubHMnKTtcbkFkbWluTWVudSA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudC9BZG1pbk1lbnUubHMnKTtcblBhZ2luYXRvciA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudC9QYWdpbmF0b3IubHMnKTtcblBob3RvQ3JvcHBlciA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudC9QaG90b0Nyb3BwZXIubHMnKTtcbmZ1bmN0aW9uIGJlbmNoKHN1YmplY3ROYW1lLCBzdWJqZWN0Qm9keSl7XG4gIHZhciBiZWYsIGFmdDtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICBzdWJqZWN0Qm9keSgpO1xuICB9IGVsc2Uge1xuICAgIGJlZiA9IG5ldyBEYXRlO1xuICAgIHN1YmplY3RCb2R5KCk7XG4gICAgYWZ0ID0gbmV3IERhdGU7XG4gICAgcGFydGlhbGl6ZSQuYXBwbHkodGhpcywgW3NldFRpbWVvdXQsIFt2b2lkIDgsIDFdLCBbMF1dKShmdW5jdGlvbigpe1xuICAgICAgdmFyIGR1cjtcbiAgICAgIGR1ciA9IGFmdCAtIGJlZjtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcImJlbmNobWFya2VkICdcIiArIHN1YmplY3ROYW1lICsgXCInOiB0b29rIFwiICsgZHVyICsgXCJtc1wiKTtcbiAgICB9KTtcbiAgfVxufVxuZnVuY3Rpb24gcmVuZGVyQ29tcG9uZW50KHdpbiwgdGFyZ2V0LCBuYW1lLCBrbGFzcywgZmlyc3RLbGFzc0FyZyl7XG4gIHZhciB3YywgYywgbG9jYWxzO1xuICB3YyA9IHdpbi5jb21wb25lbnQgfHwgKHdpbi5jb21wb25lbnQgPSB7fSk7XG4gIGlmIChjID0gd2NbbmFtZV0pIHtcbiAgICBpZiAobG9jYWxzID0gZmlyc3RLbGFzc0FyZyAhPSBudWxsID8gZmlyc3RLbGFzc0FyZy5sb2NhbHMgOiB2b2lkIDgpIHtcbiAgICAgIGMubG9jYWxzKGxvY2Fscyk7XG4gICAgfVxuICAgIGMucmVsb2FkKCk7XG4gIH0gZWxzZSB7XG4gICAgYyA9IHdjW25hbWVdID0gbmV3IGtsYXNzKGZpcnN0S2xhc3NBcmcpO1xuICB9XG4gIHdpbi4kKHRhcmdldCkuaHRtbCgnJykuYXBwZW5kKGMuJCk7XG59XG5mdW5jdGlvbiBwYWdpbmF0b3JDb21wb25lbnQodywgbG9jYWxzLCBwbnVtVG9IcmVmKXtcbiAgdmFyIHdjO1xuICB3YyA9IHcuY29tcG9uZW50IHx8ICh3LmNvbXBvbmVudCA9IHt9KTtcbiAgaWYgKHdjLnBhZ2luYXRvcikge1xuICAgIHdjLnBhZ2luYXRvci5sb2NhbHMobG9jYWxzKTtcbiAgICB3Yy5wYWdpbmF0b3IucG51bVRvSHJlZihwbnVtVG9IcmVmKTtcbiAgICB3Yy5wYWdpbmF0b3IucmVsb2FkKCk7XG4gIH0gZWxzZSB7XG4gICAgd2MucGFnaW5hdG9yID0gbmV3IFBhZ2luYXRvcih7XG4gICAgICBsb2NhbHM6IGxvY2FscyxcbiAgICAgIHBudW1Ub0hyZWY6IHBudW1Ub0hyZWZcbiAgICB9LCB3LiQoJyNwYl9wYWdpbmF0b3InKSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnNlVXJsKHVybCl7XG4gIHZhciBhLCBwO1xuICBpZiAodHlwZW9mIGRvY3VtZW50ICE9ICd1bmRlZmluZWQnICYmIGRvY3VtZW50ICE9PSBudWxsKSB7XG4gICAgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBhLmhyZWYgPSB1cmw7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlYXJjaDogYS5zZWFyY2gsXG4gICAgICBwYXRobmFtZTogYS5wYXRobmFtZVxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcCA9IHJlcXVpcmUoJ3VybCcpLnBhcnNlKHVybCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlYXJjaDogcC5zZWFyY2gsXG4gICAgICBwYXRobmFtZTogcC5wYXRobmFtZVxuICAgIH07XG4gIH1cbn1cbmZ1bmN0aW9uIGRlZmF1bHRQbnVtVG9IcmVmRnVuKHVyaSl7XG4gIHJldHVybiBmdW5jdGlvbihwZyl7XG4gICAgdmFyIHBhcnNlZDtcbiAgICBwYXJzZWQgPSBwYXJzZVVybCh1cmkpO1xuICAgIGlmIChwZyA+IDEpIHtcbiAgICAgIHJldHVybiBwYXJzZWQucGF0aG5hbWUgKyAoXCI/cGFnZT1cIiArIHBnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHBhcnNlZC5wYXRobmFtZTtcbiAgICB9XG4gIH07XG59XG5sYXlvdXRTdGF0aWMgPSBmdW5jdGlvbih3LCBuZXh0TXV0YW50LCBhY3RpdmVGb3J1bUlkKXtcbiAgdmFyIGZvcnVtQ2xhc3MsIGZpZCwgcDtcbiAgYWN0aXZlRm9ydW1JZCA9PSBudWxsICYmIChhY3RpdmVGb3J1bUlkID0gLTEpO1xuICBmb3J1bUNsYXNzID0gdy5hY3RpdmVGb3J1bUlkID8gXCIgZm9ydW0tXCIgKyB3LmFjdGl2ZUZvcnVtSWQgOiAnJztcbiAgdy4kKCdodG1sJykuYXR0cignY2xhc3MnLCBuZXh0TXV0YW50ICsgXCJcIiArIGZvcnVtQ2xhc3MpO1xuICB3Lm1hcnNoYWwoJ211dGF0b3InLCBuZXh0TXV0YW50KTtcbiAgZmlkID0gYWN0aXZlRm9ydW1JZCB8fCB3LmFjdGl2ZUZvcnVtSWQ7XG4gIHcuJCgnaGVhZGVyIC5tZW51JykuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgdy4kKFwibWVudSAucm93IC5mb3J1bS1cIiArIGZpZCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICBwID0gdy4kKFwibWVudSAuc3VibWVudSAuZm9ydW0tXCIgKyBmaWQpO1xuICBpZiAocC5sZW5ndGgpIHtcbiAgICBwLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICByZXR1cm4gdy4kKGxhc3QocC5wYXJlbnRzKCdsaScpKSkuZmluZCgnLnRpdGxlJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICB9XG59O1xubGF5b3V0T25QZXJzb25hbGl6ZSA9IGZ1bmN0aW9uKHcsIHUpe1xuICBpZiAodSkge1xuICAgIHNldE9ubGluZVVzZXIodS5pZCk7XG4gICAgc2V0UHJvZmlsZSh1LnBob3RvKTtcbiAgICBzd2l0Y2ggKHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgY2FzZSAnI2Nob29zZSc6XG4gICAgICBpZiAoaXNFbWFpbCh0eXBlb2YgdXNlciAhPSAndW5kZWZpbmVkJyAmJiB1c2VyICE9PSBudWxsID8gdXNlci5uYW1lIDogdm9pZCA4KSkge1xuICAgICAgICBBdXRoLnNob3dMb2dpbkRpYWxvZygpO1xuICAgICAgICByZXR1cm4gc3dpdGNoQW5kRm9jdXMoJ29uLWxvZ2luJywgJ29uLWNob29zZScsICcjYXV0aCBpbnB1dFtuYW1lPXVzZXJuYW1lXScpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcbnBhZ2VySW5pdCA9IGZ1bmN0aW9uKHcpe1xuICB2YXIgcGFnZXJPcHRzO1xuICBwYWdlck9wdHMgPSB7XG4gICAgY3VycmVudDogcGFyc2VJbnQody5wYWdlKSxcbiAgICBsYXN0OiBwYXJzZUludCh3LnBhZ2VzQ291bnQpLFxuICAgIGZvcnVtSWQ6IHBhcnNlSW50KHcuYWN0aXZlRm9ydW1JZClcbiAgfTtcbiAgaWYgKHcucGFnZXIpIHtcbiAgICBpbXBvcnQkKHcucGFnZXIsIHBhZ2VyT3B0cyk7XG4gICAgdy5wYWdlci5pbml0KCk7XG4gIH0gZWxzZSB7XG4gICAgdy5wYWdlciA9IG5ldyB3LlBhZ2VyKCcjcGFnaW5hdG9yJywgcGFnZXJPcHRzKTtcbiAgfVxuICBpZiAody5wYWdlKSB7XG4gICAgcmV0dXJuIHcucGFnZXIuc2V0UGFnZSh3LnBhZ2UsIGZhbHNlKTtcbiAgfVxufTtcbm91dCQuaG9tZXBhZ2UgPSBob21lcGFnZSA9IHtcbiAgJ3N0YXRpYyc6IGZ1bmN0aW9uKHdpbmRvdywgbmV4dCl7XG4gICAgd2luZG93LnJlbmRlck11dGFudCgnbWFpbl9jb250ZW50JywgJ2hvbWVwYWdlJyk7XG4gICAgbGF5b3V0U3RhdGljLmNhbGwodGhpcywgd2luZG93LCAnaG9tZXBhZ2UnKTtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvblBlcnNvbmFsaXplOiBmdW5jdGlvbih3LCB1LCBuZXh0KXtcbiAgICBsYXlvdXRPblBlcnNvbmFsaXplKHcsIHUpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB2YXIgYWN0aXZlLCByZWYkO1xuICAgIHRyeSB7XG4gICAgICB3aW5kb3cuJCgnLmZvcnVtIC5jb250YWluZXInKS5tYXNvbnJ5KHtcbiAgICAgICAgaXRlbVNlbGVjdG9yOiAnLnBvc3QnLFxuICAgICAgICBpc0FuaW1hdGVkOiB0cnVlLFxuICAgICAgICBhbmltYXRpb25PcHRpb25zOiB7XG4gICAgICAgICAgZHVyYXRpb246IDIwMFxuICAgICAgICB9LFxuICAgICAgICBpc0ZpdFdpZHRoOiB0cnVlLFxuICAgICAgICBpc1Jlc2l6YWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSQpIHt9XG4gICAgYWN0aXZlID0gKChyZWYkID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5tYXRjaCgvb3JkZXI9KFxcdyspLykpICE9IG51bGwgPyByZWYkWzFdIDogdm9pZCA4KSB8fCAncmVjZW50JztcbiAgICB3aW5kb3cuamFkZS5yZW5kZXIoJCgnLmV4dHJhOmZpcnN0JylbMF0sICdvcmRlci1jb250cm9sJywge1xuICAgICAgYWN0aXZlOiBhY3RpdmVcbiAgICB9KTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcmVvcmRlcjtcbiAgICAgICQoJy5mb3J1bScpLndheXBvaW50KHtcbiAgICAgICAgb2Zmc2V0OiAnMjUlJyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oZGlyZWN0aW9uKXtcbiAgICAgICAgICB2YXIgZSwgZWlkLCBpZCwgY3VyO1xuICAgICAgICAgIGUgPSAkKHRoaXMpO1xuICAgICAgICAgIGVpZCA9IGUuYXR0cignaWQnKTtcbiAgICAgICAgICBpZCA9IGRpcmVjdGlvbiA9PT0gJ2Rvd24nXG4gICAgICAgICAgICA/IGVpZFxuICAgICAgICAgICAgOiAkKFwiI1wiICsgZWlkKS5wcmV2QWxsKCcuZm9ydW06Zmlyc3QnKS5hdHRyKCdpZCcpO1xuICAgICAgICAgIGlmICghaWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgJCgnaGVhZGVyIC5tZW51JykuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICBjdXIgPSAkKCdoZWFkZXIgLm1lbnUnKS5maW5kKFwiLlwiICsgaWQucmVwbGFjZSgvXy8sICctJykpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAkKCcuZm9ydW0gLnN0dWNrJykucmVtb3ZlQ2xhc3MoJ3N0dWNrJyk7XG4gICAgICAgICAgcmV0dXJuIGZsaXBCYWNrZ3JvdW5kKHdpbmRvdywgY3VyLCBkaXJlY3Rpb24pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJlb3JkZXIgPSBfXy5kZWJvdW5jZShmdW5jdGlvbihpdCl7XG4gICAgICAgIHJldHVybiBIaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIGl0KTtcbiAgICAgIH0sIDEwMCk7XG4gICAgICB3aW5kb3cuY3VycmVudE9yZGVyID0gZmFsc2U7XG4gICAgICByZXR1cm4gJCgnI29yZGVyIGxpJykud2F5cG9pbnQoe1xuICAgICAgICBjb250ZXh0OiAndWwnLFxuICAgICAgICBvZmZzZXQ6IDMwLFxuICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihkaXJlY3Rpb24pe1xuICAgICAgICAgIHZhciBlLCBvcmRlciwgcGF0aDtcbiAgICAgICAgICBlID0gJCh0aGlzKTtcbiAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndXAnKSB7XG4gICAgICAgICAgICBlID0gZS5wcmV2KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGUgPSAkKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkKCcjb3JkZXIgbGkuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIGUuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIG9yZGVyID0gZS5kYXRhKCd2YWx1ZScpO1xuICAgICAgICAgIHBhdGggPSBcIi8/b3JkZXI9XCIgKyBvcmRlcjtcbiAgICAgICAgICBpZiAod2luZG93LmN1cnJlbnRPcmRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHJlb3JkZXIocGF0aCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuY3VycmVudE9yZGVyID0gb3JkZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCAxMDApO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uVW5sb2FkOiBmdW5jdGlvbih3aW5kb3csIG5leHRNdXRhbnQsIG5leHQpe1xuICAgIHRyeSB7XG4gICAgICB3aW5kb3cuJCgnLmZvcnVtIC5jb250YWluZXInKS5tYXNvbnJ5KCdkZXN0cm95Jyk7XG4gICAgICB3aW5kb3cuJCgnLmZvcnVtIC5oZWFkZXInKS53YXlwb2ludCgnZGVzdHJveScpO1xuICAgICAgd2luZG93LiQoJy5mb3J1bScpLndheXBvaW50KCdkZXN0cm95Jyk7XG4gICAgICB3aW5kb3cuJCgnI29yZGVyIGxpJykud2F5cG9pbnQoJ2Rlc3Ryb3knKTtcbiAgICAgIHdpbmRvdy4kKCcuYmcnKS5yZW1vdmUoKTtcbiAgICAgIHdpbmRvdy4kKCQoJy5leHRyYTpmaXJzdCcpKS5odG1sKCcnKTtcbiAgICB9IGNhdGNoIChlJCkge31cbiAgICByZXR1cm4gbmV4dCgpO1xuICB9XG59O1xuZnVuY3Rpb24gcmVuZGVyVGhyZWFkUGFnaW5hdG9yQ29tcG9uZW50KHdpbiwgcXR5LCBzdGVwKXtcbiAgdmFyIG9uUGFnZSwgbG9jYWxzO1xuICBvblBhZ2UgPSBmdW5jdGlvbihwYWdlKXtcbiAgICByZXR1cm4gJC5nZXQoXCIvcmVzb3VyY2VzL3RocmVhZHMvXCIgKyB3aW5kb3cuYWN0aXZlRm9ydW1JZCwge1xuICAgICAgcGFnZTogcGFnZVxuICAgIH0sIGZ1bmN0aW9uKHRvcFRocmVhZHMsIHN0YXR1cyl7XG4gICAgICB2YXIgY29udGFpbmVyO1xuICAgICAgY29udGFpbmVyID0gd2luLiQoJyNsZWZ0X2NvbnRhaW5lciAuc2Nyb2xsYWJsZScpO1xuICAgICAgcmV0dXJuIGNvbnRhaW5lci5odG1sKHdpbi5qYWRlLnRlbXBsYXRlcy5fX3RocmVhZHMoe1xuICAgICAgICB0b3BUaHJlYWRzOiB0b3BUaHJlYWRzXG4gICAgICB9KSk7XG4gICAgfSk7XG4gIH07XG4gIGxvY2FscyA9IHtcbiAgICBxdHk6IHF0eSxcbiAgICBzdGVwOiBzdGVwLFxuICAgIGFjdGl2ZVBhZ2U6IDFcbiAgfTtcbiAgcmVuZGVyQ29tcG9uZW50KHdpbiwgJyN0aHJlYWQtcGFnaW5hdG9yJywgJ3RocmVhZFBhZ2luYXRvcicsIFBhZ2luYXRvciwge1xuICAgIGxvY2FsczogbG9jYWxzLFxuICAgIG9uUGFnZTogb25QYWdlXG4gIH0pO1xufVxub3V0JC5mb3J1bSA9IGZvcnVtID0ge1xuICAnc3RhdGljJzogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB2YXIgcHJldk11dGFudCwgdGhpcyQgPSB0aGlzO1xuICAgIHByZXZNdXRhbnQgPSB3aW5kb3cubXV0YXRvcjtcbiAgICB3aW5kb3cucmVuZGVyTXV0YW50KCdtYWluX2NvbnRlbnQnLCBpc0VkaXRpbmcodGhpcy5mdXJsLnBhdGgpID09PSB0cnVlXG4gICAgICA/ICdwb3N0LW5ldydcbiAgICAgIDogaXNGb3J1bUhvbWVwYWdlKHRoaXMuZnVybC5wYXRoKSA/ICdob21lcGFnZScgOiAncG9zdHMnKTtcbiAgICBpZiAodGhpcy50b3BUaHJlYWRzKSB7XG4gICAgICB3aW5kb3cucmVuZGVyTXV0YW50KCdsZWZ0X2NvbnRhaW5lcicsICduYXYnKTtcbiAgICAgIHJlbmRlclRocmVhZFBhZ2luYXRvckNvbXBvbmVudCh3aW5kb3csIHRoaXMudFF0eSwgdGhpcy50U3RlcCk7XG4gICAgICB3aW5kb3cubWFyc2hhbCgndFF0eScsIHRoaXMudFF0eSk7XG4gICAgICB3aW5kb3cubWFyc2hhbCgndFN0ZXAnLCB0aGlzLnRTdGVwKTtcbiAgICB9XG4gICAgd2luZG93Lm1hcnNoYWwoJ2FjdGl2ZUZvcnVtSWQnLCB0aGlzLmFjdGl2ZUZvcnVtSWQpO1xuICAgIHdpbmRvdy5tYXJzaGFsKCdhY3RpdmVUaHJlYWRJZCcsIHRoaXMuYWN0aXZlVGhyZWFkSWQpO1xuICAgIHdpbmRvdy5tYXJzaGFsKCdwYWdlJywgdGhpcy5wYWdlKTtcbiAgICB3aW5kb3cubWFyc2hhbCgncGFnZXNDb3VudCcsIHRoaXMucGFnZXNDb3VudCk7XG4gICAgd2luZG93Lm1hcnNoYWwoJ3ByZXZQYWdlcycsIHRoaXMucHJldlBhZ2VzKTtcbiAgICAoZnVuY3Rpb24oKXtcbiAgICAgIHZhciB3YywgbG9jYWxzLCBwbnVtVG9IcmVmO1xuICAgICAgaWYgKCF0aGlzJC5wb3N0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHdjID0gd2luZG93LmNvbXBvbmVudCB8fCAod2luZG93LmNvbXBvbmVudCA9IHt9KTtcbiAgICAgIGxvY2FscyA9IHtcbiAgICAgICAgc3RlcDogdGhpcyQubGltaXQsXG4gICAgICAgIHF0eTogdGhpcyQucXR5LFxuICAgICAgICBhY3RpdmVQYWdlOiB0aGlzJC5wYWdlXG4gICAgICB9O1xuICAgICAgcG51bVRvSHJlZiA9IG1rUG9zdFBudW1Ub0hyZWYodGhpcyQucG9zdC51cmkpO1xuICAgICAgcmV0dXJuIHBhZ2luYXRvckNvbXBvbmVudCh3aW5kb3csIGxvY2FscywgcG51bVRvSHJlZik7XG4gICAgfSkoKTtcbiAgICBsYXlvdXRTdGF0aWMuY2FsbCh0aGlzLCB3aW5kb3csICdmb3J1bScsIHRoaXMuYWN0aXZlRm9ydW1JZCk7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHZhciBjdXIsICQsICRsLCBpZCwgcG9zdElkO1xuICAgIGN1ciA9IHdpbmRvdy4kKFwiaGVhZGVyIC5tZW51IC5mb3J1bS1cIiArIHdpbmRvdy5hY3RpdmVGb3J1bUlkKTtcbiAgICBmbGlwQmFja2dyb3VuZCh3aW5kb3csIGN1cik7XG4gICAgJCA9IHdpbmRvdy4kO1xuICAgIGFsaWduQnJlYWRjcnVtYigpO1xuICAgICRsID0gJCgnI2xlZnRfY29udGFpbmVyJyk7XG4gICAgJGwuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAkbC5maW5kKFwiLnRocmVhZFtkYXRhLWlkPSdcIiArIHdpbmRvdy5hY3RpdmVUaHJlYWRJZCArIFwiJ11cIikuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIGlkID0gaXNFZGl0aW5nKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSk7XG4gICAgaWYgKGlkKSB7XG4gICAgICBlZGl0UG9zdChpZCwge1xuICAgICAgICBmb3J1bV9pZDogd2luZG93LmFjdGl2ZUZvcnVtSWRcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgdG9nZ2xlUG9zdCk7XG4gICAgcG9zdElkID0gJCgnI21haW5fY29udGVudCAucG9zdDpmaXJzdCcpLmRhdGEoJ3Bvc3QtaWQnKTtcbiAgICBpZiAocG9zdElkKSB7XG4gICAgICAkLnBvc3QoXCIvcmVzb3VyY2VzL3Bvc3RzL1wiICsgcG9zdElkICsgXCIvaW1wcmVzc2lvblwiKTtcbiAgICB9XG4gICAgcGFnZXJJbml0KHdpbmRvdyk7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoJy5vbmNsaWNrLWFwcGVuZC1yZXBseS11aTpmaXJzdCcpLmNsaWNrKCk7XG4gICAgICB9LCAzMDApO1xuICAgIH1cbiAgICB3aW5kb3cuc3VyZkRhdGEgPSB3aW5kb3cuYWN0aXZlRm9ydW1JZDtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvbkluaXRpYWw6IGZ1bmN0aW9uKHdpbmRvdywgbmV4dCl7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgdmFyIHRocmVhZHMsIG9mZnNldCwgY3VyLCBkc3QsIHJlZiQ7XG4gICAgICB0aHJlYWRzID0gJCgnI2xlZnRfY29udGFpbmVyIC50aHJlYWRzJyk7XG4gICAgICBvZmZzZXQgPSAtMTI1O1xuICAgICAgY3VyID0gdGhyZWFkcy5zY3JvbGxUb3AoKTtcbiAgICAgIGRzdCA9IE1hdGgucm91bmQoKHJlZiQgPSAkKCcjbGVmdF9jb250YWluZXIgLnRocmVhZHMgPiAuYWN0aXZlJykucG9zaXRpb24oKSkgIT0gbnVsbCA/IHJlZiQudG9wIDogdm9pZCA4KTtcbiAgICAgIGlmIChkc3QpIHtcbiAgICAgICAgcmV0dXJuIHRocmVhZHMuYW5pbWF0ZSh7XG4gICAgICAgICAgc2Nyb2xsVG9wOiBjdXIgKyBkc3QgKyBvZmZzZXRcbiAgICAgICAgfSwgNTAwLCAnZWFzZU91dEV4cG8nKTtcbiAgICAgIH1cbiAgICB9LCA1MDApO1xuICAgIHJlbmRlclRocmVhZFBhZ2luYXRvckNvbXBvbmVudCh3aW5kb3csIHdpbmRvdy50UXR5LCB3aW5kb3cudFN0ZXApO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTXV0YXRlOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHZhciByZWYkO1xuICAgIHNjcm9sbFRvVG9wKCk7XG4gICAgc2V0V2lkZSgpO1xuICAgIGlmICgocmVmJCA9IHdpbmRvdy5zb2NrZXQpICE9IG51bGwpIHtcbiAgICAgIHJlZiQuZW1pdCgnb25saW5lLW5vdycpO1xuICAgIH1cbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvblBlcnNvbmFsaXplOiBmdW5jdGlvbih3LCB1LCBuZXh0KXtcbiAgICB2YXIgcmVmJDtcbiAgICBpZiAodSkge1xuICAgICAgbGF5b3V0T25QZXJzb25hbGl6ZSh3LCB1KTtcbiAgICAgICQoXCIucG9zdFtkYXRhLXVzZXItaWQ9XCIgKyB1LmlkICsgXCJdIC5jZW5zb3JcIikuY3NzKCdkaXNwbGF5JywgJ2lubGluZScpO1xuICAgICAgaWYgKChyZWYkID0gdS5yaWdodHMpICE9IG51bGwgJiYgcmVmJFsnc3VwZXInXSkge1xuICAgICAgICAkKCcuY2Vuc29yJykuY3NzKCdkaXNwbGF5JywgJ2lubGluZScpO1xuICAgICAgfVxuICAgICAgc2V0SW5saW5lRWRpdG9yKHUuaWQpO1xuICAgIH1cbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvblVubG9hZDogZnVuY3Rpb24od2luLCBuZXh0TXV0YW50LCBuZXh0KXtcbiAgICAkKCdib2R5Jykub2ZmKCdjbGljaycpO1xuICAgIHRyeSB7XG4gICAgICB3aW4uJCgnI2xlZnRfY29udGFpbmVyJykucmVzaXphYmxlKCdkZXN0cm95Jyk7XG4gICAgfSBjYXRjaCAoZSQpIHt9XG4gICAgaWYgKG5leHRNdXRhbnQgIT09ICdmb3J1bScpIHtcbiAgICAgIHJlc2V0UGFnaW5hdG9yKHdpbik7XG4gICAgfVxuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cbn07XG5zYW1lUHJvZmlsZSA9IGZ1bmN0aW9uKGhpbnRzKXtcbiAgdmFyIHJlZiQsIGwsIGMsIHAxLCBwMjtcbiAgcmVmJCA9IFtoaW50cy5sYXN0LCBoaW50cy5jdXJyZW50XSwgbCA9IHJlZiRbMF0sIGMgPSByZWYkWzFdO1xuICBpZiAobC5tdXRhdG9yID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJlZiQgPSBbbC5wYXRobmFtZS5zcGxpdCgnLycpLCBjLnBhdGhuYW1lLnNwbGl0KCcvJyldLCBwMSA9IHJlZiRbMF0sIHAyID0gcmVmJFsxXTtcbiAgaWYgKHAxWzFdID09PSAndXNlcicgJiYgcDJbMV0gPT09ICd1c2VyJykge1xuICAgIGlmIChwMVsyXSA9PT0gcDJbMl0pIHtcbiAgICAgIHJldHVybiBwMVsyXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcbm91dCQucHJvZmlsZSA9IHByb2ZpbGUgPSB7XG4gICdzdGF0aWMnOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgaWYgKHdpbmRvdy5oaW50cykge1xuICAgICAgaWYgKCFzYW1lUHJvZmlsZSh3aW5kb3cuaGludHMpKSB7XG4gICAgICAgIHdpbmRvdy5yZW5kZXJNdXRhbnQoJ2xlZnRfY29udGFpbmVyJywgJ3Byb2ZpbGUnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LnJlbmRlck11dGFudCgnbGVmdF9jb250YWluZXInLCAncHJvZmlsZScpO1xuICAgIH1cbiAgICB3aW5kb3cucmVuZGVyTXV0YW50KCdtYWluX2NvbnRlbnQnLCAncG9zdHMtYnktdXNlcicpO1xuICAgIHdpbmRvdy5tYXJzaGFsKCdzdGVwJywgdGhpcy5zdGVwKTtcbiAgICB3aW5kb3cubWFyc2hhbCgncXR5JywgdGhpcy5xdHkpO1xuICAgIHdpbmRvdy5tYXJzaGFsKCdwYWdlJywgdGhpcy5wYWdlKTtcbiAgICB3aW5kb3cubWFyc2hhbCgncGFnZXNDb3VudCcsIHRoaXMucGFnZXNDb3VudCk7XG4gICAgKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgbG9jYWxzLCBwbnVtVG9IcmVmO1xuICAgICAgbG9jYWxzID0ge1xuICAgICAgICBzdGVwOiB0aGlzJC5saW1pdCxcbiAgICAgICAgcXR5OiB0aGlzJC5xdHksXG4gICAgICAgIGFjdGl2ZVBhZ2U6IHRoaXMkLnBhZ2VcbiAgICAgIH07XG4gICAgICBwbnVtVG9IcmVmID0gbWtQb3N0UG51bVRvSHJlZihcIi91c2VyL1wiICsgdGhpcyQucHJvZmlsZS5uYW1lKTtcbiAgICAgIHdpbmRvdy5tYXJzaGFsKCd1cmknLCB0aGlzJC51cmkpO1xuICAgICAgcmV0dXJuIHBhZ2luYXRvckNvbXBvbmVudCh3aW5kb3csIGxvY2FscywgcG51bVRvSHJlZik7XG4gICAgfSkoKTtcbiAgICBsYXlvdXRTdGF0aWMuY2FsbCh0aGlzLCB3aW5kb3csICdwcm9maWxlJyk7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHBhZ2VySW5pdCh3aW5kb3cpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTXV0YXRlOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHNjcm9sbFRvVG9wKCk7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfSxcbiAgb25QZXJzb25hbGl6ZTogZnVuY3Rpb24odywgdSwgbmV4dCl7XG4gICAgcmV0dXJuIGxhenlMb2FkSHRtbDVVcGxvYWRlcihmdW5jdGlvbigpe1xuICAgICAgdmFyIHBob3RvY3JvcHBlclN0YXJ0LCBwaG90b2Nyb3BwZXJFbmFibGUsIHBob3RvY3JvcHBlckRpc2FibGUsIHByb2ZpbGVVc2VySWQ7XG4gICAgICBwaG90b2Nyb3BwZXJTdGFydCA9IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgcmV0dXJuIFBob3RvQ3JvcHBlci5zdGFydCgpO1xuICAgICAgfTtcbiAgICAgIHBob3RvY3JvcHBlckVuYWJsZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBvcHRpb25zO1xuICAgICAgICB3aW5kb3cuJCgnI2xlZnRfY29udGVudCcpLmFkZENsYXNzKCdlZGl0YWJsZScpO1xuICAgICAgICB3aW5kb3cuJCgnYm9keScpLm9uKCdjbGljaycsICcjbGVmdF9jb250ZW50LmVkaXRhYmxlIC5hdmF0YXInLCBwaG90b2Nyb3BwZXJTdGFydCk7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgbmFtZTogJ2F2YXRhcicsXG4gICAgICAgICAgcG9zdFVybDogXCIvcmVzb3VyY2VzL3VzZXJzL1wiICsgd2luZG93LnVzZXIuaWQgKyBcIi9hdmF0YXJcIixcbiAgICAgICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKHIpe1xuICAgICAgICAgICAgcmV0dXJuIFBob3RvQ3JvcHBlci5zdGFydCh7XG4gICAgICAgICAgICAgIG1vZGU6ICdjcm9wJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gd2luZG93LiQoJyNsZWZ0X2NvbnRlbnQgLmF2YXRhcicpLmh0bWw1VXBsb2FkZXIob3B0aW9ucyk7XG4gICAgICB9O1xuICAgICAgcGhvdG9jcm9wcGVyRGlzYWJsZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHdpbmRvdy4kKCcjbGVmdF9jb250ZW50JykucmVtb3ZlQ2xhc3MoJ2VkaXRhYmxlJyk7XG4gICAgICAgIHJldHVybiB3aW5kb3cuJCgnYm9keScpLm9mZignY2xpY2snLCAnI2xlZnRfY29udGVudC5lZGl0YWJsZSAuYXZhdGFyJywgcGhvdG9jcm9wcGVyU3RhcnQpO1xuICAgICAgfTtcbiAgICAgIGlmICh1KSB7XG4gICAgICAgIGxheW91dE9uUGVyc29uYWxpemUodywgdSk7XG4gICAgICAgIHByb2ZpbGVVc2VySWQgPSB3aW5kb3cuJCgnI2xlZnRfY29udGVudCAucHJvZmlsZScpLmRhdGEoJ3VzZXJJZCcpO1xuICAgICAgICBpZiAocHJvZmlsZVVzZXJJZCA9PT0gdS5pZCkge1xuICAgICAgICAgIHBob3RvY3JvcHBlckVuYWJsZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBob3RvY3JvcHBlckRpc2FibGUoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGhvdG9jcm9wcGVyRGlzYWJsZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9KTtcbiAgfSxcbiAgb25VbmxvYWQ6IGZ1bmN0aW9uKHdpbmRvdywgbmV4dE11dGFudCwgbmV4dCl7XG4gICAgaWYgKG5leHRNdXRhbnQgIT09ICdmb3J1bScpIHtcbiAgICAgIHJlc2V0UGFnaW5hdG9yKHdpbmRvdyk7XG4gICAgfVxuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uSW5pdGlhbDogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgIChmdW5jdGlvbigpe1xuICAgICAgdmFyIGxvY2FscywgbmFtZSwgcG51bVRvSHJlZjtcbiAgICAgIGxvY2FscyA9IHtcbiAgICAgICAgc3RlcDogd2luZG93LnN0ZXAsXG4gICAgICAgIHF0eTogd2luZG93LnF0eSxcbiAgICAgICAgYWN0aXZlUGFnZTogd2luZG93LnBhZ2VcbiAgICAgIH07XG4gICAgICBuYW1lID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJylbMl07XG4gICAgICBwbnVtVG9IcmVmID0gbWtQb3N0UG51bVRvSHJlZihcIi91c2VyL1wiICsgbmFtZSk7XG4gICAgICByZXR1cm4gcGFnaW5hdG9yQ29tcG9uZW50KHdpbmRvdywgbG9jYWxzLCBwbnVtVG9IcmVmKTtcbiAgICB9KSgpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cbn07XG5mdW5jdGlvbiByZW5kZXJBZG1pbkNvbXBvbmVudHMoYWN0aW9uLCBzaXRlLCB3aW4pe1xuICBzd2l0Y2ggKGFjdGlvbikge1xuICBjYXNlICdkb21haW5zJzpcbiAgICB0cnkge1xuICAgICAgd2luLnJlbmRlck11dGFudCgnbWFpbl9jb250ZW50JywgJ2FkbWluLWRvbWFpbnMnKTtcbiAgICB9IGNhdGNoIChlJCkge31cbiAgICBicmVhaztcbiAgY2FzZSAnaW52aXRlcyc6XG4gICAgdHJ5IHtcbiAgICAgIHdpbi5yZW5kZXJNdXRhbnQoJ21haW5fY29udGVudCcsICdhZG1pbi1pbnZpdGVzJyk7XG4gICAgfSBjYXRjaCAoZSQpIHt9XG4gICAgYnJlYWs7XG4gIGNhc2UgJ21lbnUnOlxuICAgIHJlbmRlckNvbXBvbmVudCh3aW4sICcjbWFpbl9jb250ZW50JywgJ2FkbWluLW1lbnUnLCBBZG1pbk1lbnUsIHtcbiAgICAgIGxvY2Fsczoge1xuICAgICAgICBzaXRlOiBzaXRlXG4gICAgICB9XG4gICAgfSk7XG4gICAgYnJlYWs7XG4gIGNhc2UgJ3VwZ3JhZGUnOlxuICAgIHJlbmRlckNvbXBvbmVudCh3aW4sICcjbWFpbl9jb250ZW50JywgJ2FkbWluLXVwZ3JhZGUnLCBBZG1pblVwZ3JhZGUsIHtcbiAgICAgIGxvY2Fsczoge1xuICAgICAgICBzdWJzY3JpcHRpb25zOiBzaXRlLnN1YnNjcmlwdGlvbnNcbiAgICAgIH1cbiAgICB9KTtcbiAgICBicmVhaztcbiAgZGVmYXVsdDpcbiAgICB0cnkge1xuICAgICAgd2luLnJlbmRlck11dGFudCgnbWFpbl9jb250ZW50JywgJ2FkbWluLWdlbmVyYWwnKTtcbiAgICB9IGNhdGNoIChlJCkge31cbiAgfVxufVxub3V0JC5hZG1pbiA9IGFkbWluID0ge1xuICAnc3RhdGljJzogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB3aW5kb3cucmVuZGVyTXV0YW50KCdsZWZ0X2NvbnRhaW5lcicsICdhZG1pbi1uYXYnKTtcbiAgICB3aW5kb3cuJCgnI2xlZnRfY29udGFpbmVyIG1lbnUgbGknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgd2luZG93LiQoXCIjbGVmdF9jb250YWluZXIgbWVudSAuXCIgKyAodGhpcy5hY3Rpb24gfHwgJ2dlbmVyYWwnKSkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIHJlbmRlckFkbWluQ29tcG9uZW50cyh0aGlzLmFjdGlvbiwgdGhpcy5zaXRlLCB3aW5kb3cpO1xuICAgIHdpbmRvdy5tYXJzaGFsKCdhY3Rpb24nLCB0aGlzLmFjdGlvbik7XG4gICAgd2luZG93Lm1hcnNoYWwoJ3NpdGUnLCB0aGlzLnNpdGUpO1xuICAgIGxheW91dFN0YXRpYy5jYWxsKHRoaXMsIHdpbmRvdywgJ2FkbWluJyk7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfSxcbiAgb25QZXJzb25hbGl6ZTogZnVuY3Rpb24odywgdSwgbmV4dCl7XG4gICAgbGF5b3V0T25QZXJzb25hbGl6ZSh3LCB1KTtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvblVubG9hZDogZnVuY3Rpb24od2luZG93LCBuZXh0TXV0YW50LCBuZXh0KXtcbiAgICBpZiAod2luZG93LmFkbWluRXhwYW5kZWQpIHtcbiAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnY29sbGFwc2VkJyk7XG4gICAgfVxuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB2YXIgJGIsIHRoaXMkID0gdGhpcztcbiAgICAkYiA9ICQoJ2JvZHknKTtcbiAgICBpZiAod2luZG93LmFkbWluRXhwYW5kZWQgPSAkYi5oYXNDbGFzcygnY29sbGFwc2VkJykpIHtcbiAgICAgICRiLnJlbW92ZUNsYXNzKCdjb2xsYXBzZWQnKTtcbiAgICB9XG4gICAgJCgnZm9ybSBpbnB1dDpmaXJzdCcpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgJCgnLmRvbWFpbicpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIHdpbmRvdy5wYWdlc0NvdW50ID0gMDtcbiAgICBwYWdlckluaXQod2luZG93KTtcbiAgICByZXR1cm4gbGF6eUxvYWROZXN0ZWRTb3J0YWJsZShmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGxhenlMb2FkRGVzZXJpYWxpemUoZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuICBvbkluaXRpYWw6IGZ1bmN0aW9uKHdpbiwgbmV4dCl7XG4gICAgcmVuZGVyQWRtaW5Db21wb25lbnRzKHdpbi5hY3Rpb24sIHdpbi5zaXRlLCB3aW4pO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTXV0YXRlOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHNjcm9sbFRvVG9wKCk7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxufTtcbmpvaW5TZWFyY2ggPSBmdW5jdGlvbihzb2NrKXtcbiAgcmV0dXJuIHNvY2suZW1pdCgnc2VhcmNoJywgd2luZG93LnNlYXJjaG9wdHMpO1xufTtcbnJlc2V0UGFnaW5hdG9yID0gZnVuY3Rpb24odyl7XG4gIHZhciByZWYkLCB4JDtcbiAgJCgnI3BiX3BhZ2luYXRvcicpLmhpZGUoKTtcbiAgaWYgKChyZWYkID0gdy5jb21wb25lbnQpICE9IG51bGwgJiYgcmVmJC5wYWdpbmF0b3IpIHtcbiAgICB4JCA9IHcuY29tcG9uZW50LnBhZ2luYXRvcjtcbiAgICB4JC5sb2NhbCgncXR5JywgMCk7XG4gICAgeCQucmVsb2FkKCk7XG4gICAgcmV0dXJuIHgkO1xuICB9XG59O1xuZW5kU2VhcmNoID0gZnVuY3Rpb24odyl7XG4gIHJlc2V0UGFnaW5hdG9yKHcpO1xuICByZXR1cm4gc29ja2V0LmVtaXQoJ3NlYXJjaC1lbmQnKTtcbn07XG5ta1NlYXJjaFBudW1Ub0hyZWYgPSBmdW5jdGlvbihzZWFyY2hvcHRzKXtcbiAgcmV0dXJuIGZ1bmN0aW9uKHBudW0pe1xuICAgIHZhciBxdWVyeSwgcnZhbCwgcmVmJCwgaywgdjtcbiAgICBxdWVyeSA9IHBudW0gPT09IHZvaWQgOCB8fCBwYXJzZUludChwbnVtKSA9PT0gMVxuICAgICAgPyAocnZhbCA9IGltcG9ydCQoe30sIHNlYXJjaG9wdHMpLCBkZWxldGUgcnZhbC5wYWdlLCBydmFsKVxuICAgICAgOiAocmVmJCA9IGltcG9ydCQoe30sIHNlYXJjaG9wdHMpLCByZWYkLnBhZ2UgPSBwbnVtLCByZWYkKTtcbiAgICBpZiAoT2JqZWN0LmtleXMocXVlcnkpLmxlbmd0aCkge1xuICAgICAgcmV0dXJuICcvc2VhcmNoPycgKyAoZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHJlZiQsIHJlc3VsdHMkID0gW107XG4gICAgICAgIGZvciAoayBpbiByZWYkID0gcXVlcnkpIHtcbiAgICAgICAgICB2ID0gcmVmJFtrXTtcbiAgICAgICAgICByZXN1bHRzJC5wdXNoKGsgKyBcIj1cIiArIHYpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzJDtcbiAgICAgIH0oKSkuam9pbignJicpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJy9zZWFyY2gnO1xuICAgIH1cbiAgfTtcbn07XG5ta1Bvc3RQbnVtVG9IcmVmID0gZnVuY3Rpb24ocG9zdFVyaSl7XG4gIHJldHVybiBmdW5jdGlvbihwbnVtKXtcbiAgICBpZiAocG51bSA+IDEpIHtcbiAgICAgIHJldHVybiBwb3N0VXJpICsgXCIvcGFnZS9cIiArIHBudW07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwb3N0VXJpO1xuICAgIH1cbiAgfTtcbn07XG5vdXQkLnNlYXJjaCA9IHNlYXJjaCA9IHtcbiAgJ3N0YXRpYyc6IHtcbiAgICBwcmVwYXJlOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgICAgdmFyIHBhcmFtcywgYWZ0ZXIsIHJlZiQsIHJlZjEkLCAkcSwgcUVsLCBxO1xuICAgICAgcGFyYW1zID0gdGhpcztcbiAgICAgIGFmdGVyID0gd2luZG93LmFmdGVyUHJlcGFyZSA9IFtdO1xuICAgICAgd2luZG93Lm1hcnNoYWwoJ3BhZ2UnLCB0aGlzLnBhZ2UpO1xuICAgICAgd2luZG93Lm1hcnNoYWwoJ3BhZ2VzQ291bnQnLCB0aGlzLnBhZ2VzQ291bnQpO1xuICAgICAgd2luZG93Lm1hcnNoYWwoJ3NlYXJjaG9wdHMnLCB0aGlzLnNlYXJjaG9wdHMpO1xuICAgICAgd2luZG93Lm1hcnNoYWwoJ25ld0hpdHMnLCAwKTtcbiAgICAgIGlmICgoKHJlZiQgPSB3aW5kb3cuaGludHMpICE9IG51bGwgPyAocmVmMSQgPSByZWYkLmxhc3QpICE9IG51bGwgPyByZWYxJC5tdXRhdG9yIDogdm9pZCA4IDogdm9pZCA4KSAhPT0gJ3NlYXJjaCcpIHtcbiAgICAgICAgKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdmFyIGZpbHRlcnNIdG1sLCAkdDtcbiAgICAgICAgICB3aW5kb3cucmVwbGFjZUh0bWwod2luZG93LiQoJyNsZWZ0X2NvbnRhaW5lcicpLCAnPGRpdiBpZD1cInNlYXJjaF9maWx0ZXJzXCI+PC9kaXY+PGRpdiBpZD1cInNlYXJjaF9mYWNldHNcIj48L2Rpdj4nKTtcbiAgICAgICAgICBmaWx0ZXJzSHRtbCA9IHdpbmRvdy5yZW5kZXIoJ3NlYXJjaC1maWx0ZXJzJyk7XG4gICAgICAgICAgJHQgPSB3aW5kb3cuJCgnI3NlYXJjaF9maWx0ZXJzJyk7XG4gICAgICAgICAgcmV0dXJuIGFmdGVyLnB1c2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBiZW5jaCgnc2VhcmNoLWZpbHRlcnMnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICByZXR1cm4gd2luZG93LnJlcGxhY2VIdG1sKCR0LCBmaWx0ZXJzSHRtbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkoKTtcbiAgICAgIH1cbiAgICAgIChmdW5jdGlvbigpe1xuICAgICAgICB2YXIgaHRtbCwgJHQ7XG4gICAgICAgIGh0bWwgPSB3aW5kb3cucmVuZGVyKCdzZWFyY2gtZmFjZXRzJyk7XG4gICAgICAgICR0ID0gd2luZG93LiQoJyNzZWFyY2hfZmFjZXRzJyk7XG4gICAgICAgIHJldHVybiBhZnRlci5wdXNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgcmV0dXJuIGJlbmNoKCdzZWFyY2gtZmFjZXRzJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cucmVwbGFjZUh0bWwoJHQsIGh0bWwpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pKCk7XG4gICAgICAoZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGh0bWwsICR0O1xuICAgICAgICBodG1sID0gd2luZG93LnJlbmRlcignc2VhcmNoJyk7XG4gICAgICAgICR0ID0gd2luZG93LiQoJyNtYWluX2NvbnRlbnQnKTtcbiAgICAgICAgcmV0dXJuIGFmdGVyLnB1c2goZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gYmVuY2goJ3NlYXJjaC1jb250ZW50JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cucmVwbGFjZUh0bWwoJHQsIGh0bWwpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pKCk7XG4gICAgICAkcSA9IHdpbmRvdy4kKCcjcXVlcnknKTtcbiAgICAgIHFFbCA9ICRxWzBdO1xuICAgICAgcSA9IHRoaXMuc2VhcmNob3B0cy5xO1xuICAgICAgaWYgKHR5cGVvZiBIaXN0b3J5ICE9ICd1bmRlZmluZWQnICYmIEhpc3RvcnkgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGVjaGFuZ2VXYXNVc2VyKSB7XG4gICAgICAgICAgYWZ0ZXIucHVzaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGJlbmNoKCdxdWVyeS1zdHJpbmctdXBkYXRlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgcmV0dXJuIHFFbC52YWx1ZSA9IHE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWZ0ZXIucHVzaChmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiBiZW5jaCgncXVlcnktc3RyaW5nLXVwZGF0ZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gJHEudmFsKHEpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgSGlzdG9yeSAhPSAndW5kZWZpbmVkJyAmJiBIaXN0b3J5ICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBxRWwpIHtcbiAgICAgICAgICAkcS5ibHVyKCk7XG4gICAgICAgICAgYWZ0ZXIucHVzaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGJlbmNoKCdyZS1mb2N1cycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgIHJldHVybiBwYXJ0aWFsaXplJC5hcHBseSh0aGlzLCBbc2V0VGltZW91dCwgW3ZvaWQgOCwgMV0sIFswXV0pKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLmZvY3VzKCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgfSxcbiAgICBkcmF3OiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgICAgdmFyIGFmdGVyLCBpJCwgbGVuJCwgZiwgdGhpcyQgPSB0aGlzO1xuICAgICAgYWZ0ZXIgPSB3aW5kb3cuYWZ0ZXJQcmVwYXJlO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBhZnRlci5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICBmID0gYWZ0ZXJbaSRdO1xuICAgICAgICBmKCk7XG4gICAgICB9XG4gICAgICBiZW5jaCgnZmlsdGVyLXN0YXRlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgd2luZG93LiQoJyNzZWFyY2hfZmlsdGVycyBbbmFtZT1mb3J1bV9pZF0nKS52YWwodGhpcyQuc2VhcmNob3B0cy5mb3J1bV9pZCk7XG4gICAgICAgIHJldHVybiB3aW5kb3cuJCgnI3NlYXJjaF9maWx0ZXJzIFtuYW1lPXdpdGhpbl0nKS52YWwodGhpcyQuc2VhcmNob3B0cy53aXRoaW4pO1xuICAgICAgfSk7XG4gICAgICAoZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHdjLCBsb2NhbHMsIHBudW1Ub0hyZWY7XG4gICAgICAgIHdjID0gd2luZG93LmNvbXBvbmVudCB8fCAod2luZG93LmNvbXBvbmVudCA9IHt9KTtcbiAgICAgICAgbG9jYWxzID0ge1xuICAgICAgICAgIHN0ZXA6IDEwLFxuICAgICAgICAgIHF0eTogdGhpcyQuZWxyZXMudG90YWwsXG4gICAgICAgICAgYWN0aXZlUGFnZTogdGhpcyQucGFnZVxuICAgICAgICB9O1xuICAgICAgICBwbnVtVG9IcmVmID0gbWtTZWFyY2hQbnVtVG9IcmVmKHRoaXMkLnNlYXJjaG9wdHMpO1xuICAgICAgICByZXR1cm4gcGFnaW5hdG9yQ29tcG9uZW50KHdpbmRvdywgbG9jYWxzLCBwbnVtVG9IcmVmKTtcbiAgICAgIH0pKCk7XG4gICAgICBiZW5jaCgnbGF5b3V0LXN0YXRpYycsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBsYXlvdXRTdGF0aWMuY2FsbCh0aGlzJCwgd2luZG93LCAnc2VhcmNoJyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgfVxuICB9LFxuICBvbkluaXRpYWw6IGZ1bmN0aW9uKHcsIG5leHQpe1xuICAgICRSKGpvaW5TZWFyY2gpLmJpbmRUbyh3LnJTb2NrZXQpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTXV0YXRlOiBmdW5jdGlvbih3LCBuZXh0KXtcbiAgICBqb2luU2VhcmNoKHcuc29ja2V0KTtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvbkxvYWQ6IGZ1bmN0aW9uKHcsIG5leHQpe1xuICAgIHdpbmRvdy4kbmV3SGl0cyA9IHcuJCgnPGRpdi8+Jyk7XG4gICAgYWxpZ25CcmVhZGNydW1iKCk7XG4gICAgcGFnZXJJbml0KHcpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uVW5sb2FkOiBmdW5jdGlvbih3LCBuZXh0TXV0YW50LCBuZXh0KXtcbiAgICBlbmRTZWFyY2godyk7XG4gICAgZGVsZXRlIHcuc2VhcmNob3B0cztcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9XG59O1xub3V0JC5wYWdlID0gcGFnZSA9IHtcbiAgJ3N0YXRpYyc6IGZ1bmN0aW9uKHdpbmRvdywgbmV4dCl7XG4gICAgd2luZG93LnJlcGxhY2VIdG1sKHdpbmRvdy4kKCcjbGVmdF9jb250YWluZXInKSwgJycpO1xuICAgIHdpbmRvdy5yZXBsYWNlSHRtbCh3aW5kb3cuJCgnI21haW5fY29udGVudCcpLCB0aGlzLnBhZ2UuY29uZmlnLm1haW5fY29udGVudCk7XG4gICAgbGF5b3V0U3RhdGljLmNhbGwodGhpcywgd2luZG93LCAncGFnZScpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICBwYWdlckluaXQod2luZG93KTtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9LFxuICBvbk11dGF0ZTogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICBzY3JvbGxUb1RvcCgpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cbn07XG5vdXQkLnByaXZhdGVTaXRlID0gcHJpdmF0ZVNpdGUgPSB7XG4gICdzdGF0aWMnOiBmdW5jdGlvbih3aW5kb3csIG5leHQpe1xuICAgIHdpbmRvdy4kKCdoZWFkZXInKS5yZW1vdmUoKTtcbiAgICB3aW5kb3cuJCgnZm9vdGVyJykucmVtb3ZlKCk7XG4gICAgd2luZG93LiQoJyNsZWZ0X2NvbnRlbnQnKS5yZW1vdmUoKTtcbiAgICB3aW5kb3cuJCgnI21haW5fY29udGVudCcpLnJlbW92ZSgpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24od2luZG93LCBuZXh0KXtcbiAgICB2YXIgcmVmJDtcbiAgICByZWYkID0gd2luZG93LmZhbmN5Ym94UGFyYW1zO1xuICAgIHJlZiQuY2xvc2VCdG4gPSBmYWxzZTtcbiAgICByZWYkLmNsb3NlQ2xpY2sgPSBmYWxzZTtcbiAgICByZWYkLm1vZGFsID0gdHJ1ZTtcbiAgICBBdXRoLnNob3dMb2dpbkRpYWxvZygpO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cbn07XG5mdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICByZXR1cm4gb2JqO1xufVxuZnVuY3Rpb24gcGFydGlhbGl6ZSQoZiwgYXJncywgd2hlcmUpe1xuICB2YXIgY29udGV4dCA9IHRoaXM7XG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHZhciBwYXJhbXMgPSBzbGljZSQuY2FsbChhcmd1bWVudHMpLCBpLFxuICAgICAgICBsZW4gPSBwYXJhbXMubGVuZ3RoLCB3bGVuID0gd2hlcmUubGVuZ3RoLFxuICAgICAgICB0YSA9IGFyZ3MgPyBhcmdzLmNvbmNhdCgpIDogW10sIHR3ID0gd2hlcmUgPyB3aGVyZS5jb25jYXQoKSA6IFtdO1xuICAgIGZvcihpID0gMDsgaSA8IGxlbjsgKytpKSB7IHRhW3R3WzBdXSA9IHBhcmFtc1tpXTsgdHcuc2hpZnQoKTsgfVxuICAgIHJldHVybiBsZW4gPCB3bGVuICYmIGxlbiA/XG4gICAgICBwYXJ0aWFsaXplJC5hcHBseShjb250ZXh0LCBbZiwgdGEsIHR3XSkgOiBmLmFwcGx5KGNvbnRleHQsIHRhKTtcbiAgfTtcbn1cbn0pKHJlcXVpcmUoXCJfX2Jyb3dzZXJpZnlfcHJvY2Vzc1wiKSx3aW5kb3cpIiwidmFyIGZ1cmwsIGZvck11dGFudCwgcmVxdWlyZWRUYXNrcywgZGlmZmVyZW5jZSwgZXhwYW5kS2V5cywgZXhwYW5kU3RyaW5nLCBjYywgcmVjb21tZW5kYXRpb24sIG91dCQgPSB0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyAmJiBleHBvcnRzIHx8IHRoaXMsIHNsaWNlJCA9IFtdLnNsaWNlO1xuZnVybCA9IHJlcXVpcmUoJy4vZm9ydW0tdXJscy5scycpO1xub3V0JC5mb3JNdXRhbnQgPSBmb3JNdXRhbnQgPSB7XG4gIGZvcnVtOiB7XG4gICAgXCJtZW51XCI6IDEsXG4gICAgXCJmb3J1bSA6Zm9ydW0taWRcIjogMSxcbiAgICBcImZvcnVtcyA6Zm9ydW0taWRcIjogMSxcbiAgICBcInRvcC10aHJlYWRzIDpmb3J1bS1pZFwiOiAxXG4gIH0sXG4gIHRocmVhZDoge1xuICAgIFwibWVudVwiOiAxLFxuICAgIFwic3ViLXBvc3RzLXRyZWUgOnBvc3QtaWQgOmxpbWl0IDpvZmZzZXRcIjogMSxcbiAgICBcInN1Yi1wb3N0cy1jb3VudCA6cG9zdC1pZFwiOiAxLFxuICAgIFwidG9wLXRocmVhZHMgOmZvcnVtLWlkXCI6IDEsXG4gICAgXCJmb3J1bSA6Zm9ydW0taWRcIjogMVxuICB9XG59O1xub3V0JC5yZXF1aXJlZFRhc2tzID0gcmVxdWlyZWRUYXNrcyA9IGZ1bmN0aW9uKGFyZyQsIGFyZzEkKXtcbiAgdmFyIHNyYywgc3JjVmFycywgZHN0LCBkc3RWYXJzO1xuICBzcmMgPSBhcmckWzBdLCBzcmNWYXJzID0gYXJnJFsxXTtcbiAgZHN0ID0gYXJnMSRbMF0sIGRzdFZhcnMgPSBhcmcxJFsxXTtcbiAgcmV0dXJuIG1hcChmdW5jdGlvbihpdCl7XG4gICAgcmV0dXJuIGl0LnJlcGxhY2UoLyAuKiQvLCAnJyk7XG4gIH0pKFxuICBrZXlzKGRpZmZlcmVuY2UoZXhwYW5kS2V5cyhzcmMsIHNyY1ZhcnMpLCBleHBhbmRLZXlzKGRzdCwgZHN0VmFycykpKSk7XG59O1xub3V0JC5kaWZmZXJlbmNlID0gZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGEsIGIpe1xuICB2YXIgaywgdiwgcmVzdWx0cyQgPSB7fTtcbiAgZm9yIChrIGluIGEpIHtcbiAgICB2ID0gYVtrXTtcbmlmICghYi5oYXNPd25Qcm9wZXJ0eShrKSkge1xuICAgICAgcmVzdWx0cyRba10gPSB2O1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xub3V0JC5leHBhbmRLZXlzID0gZXhwYW5kS2V5cyA9IGZ1bmN0aW9uKGEsIHZhcnMpe1xuICB2YXIgaywgdiwgcmVzdWx0cyQgPSB7fTtcbiAgZm9yIChrIGluIGEpIHtcbiAgICB2ID0gYVtrXTtcbiAgICByZXN1bHRzJFtleHBhbmRTdHJpbmcoaywgdmFycyldID0gdjtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xub3V0JC5leHBhbmRTdHJpbmcgPSBleHBhbmRTdHJpbmcgPSBmdW5jdGlvbihzLCB2YXJzKXtcbiAgcmV0dXJuIHMucmVwbGFjZSgvKDpbXFx3LV0rKS9nLCBmdW5jdGlvbihtLCBwKXtcbiAgICByZXR1cm4gdmFyc1tjYyhwKV07XG4gIH0pO1xufTtcbm91dCQuY2MgPSBjYyA9IGZ1bmN0aW9uKHMpe1xuICB2YXIgcmVmJCwgZmlyc3QsIHJlc3Q7XG4gIHJlZiQgPSBzLnNwbGl0KCctJyksIGZpcnN0ID0gcmVmJFswXSwgcmVzdCA9IHNsaWNlJC5jYWxsKHJlZiQsIDEpO1xuICByZXR1cm4gZmlyc3QucmVwbGFjZSgvXjovLCAnJykgKyBqb2luKCcnKShcbiAgbWFwKGZ1bmN0aW9uKGl0KXtcbiAgICByZXR1cm4gaXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBpdC5zbGljZSgxKTtcbiAgfSkoXG4gIHJlc3QpKTtcbn07XG5vdXQkLnJlY29tbWVuZGF0aW9uID0gcmVjb21tZW5kYXRpb24gPSBmdW5jdGlvbihwYXRoLCBsYXN0UGF0aCl7XG4gIHZhciBtZXRhLCBsYXN0TWV0YSwgc2ltcGxpZnksIG11dGFudCwgbGFzdE11dGFudCwgZGVmYXVsdFJlY29tbWVuZGF0aW9uLCBtZXRhVmFycywgbGFzdE1ldGFWYXJzLCBzcmMsIGRzdCwga2VlcDtcbiAgbWV0YSA9IGZ1cmwucGFyc2UocGF0aCk7XG4gIGxhc3RNZXRhID0gZnVybC5wYXJzZShsYXN0UGF0aCk7XG4gIHNpbXBsaWZ5ID0gZnVuY3Rpb24odCl7XG4gICAgaWYgKHQubWF0Y2goL150aHJlYWQvKSkge1xuICAgICAgcmV0dXJuICd0aHJlYWQnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdDtcbiAgICB9XG4gIH07XG4gIG11dGFudCA9IHNpbXBsaWZ5KG1ldGEudHlwZSk7XG4gIGxhc3RNdXRhbnQgPSBzaW1wbGlmeShsYXN0TWV0YS50eXBlKTtcbiAgZGVmYXVsdFJlY29tbWVuZGF0aW9uID0ge1xuICAgIHJlbW92ZTogWydtZW51J11cbiAgfTtcbiAgc3dpdGNoIChtdXRhbnQpIHtcbiAgY2FzZSAnZm9ydW0nOlxuICAgIG1ldGFWYXJzID0ge1xuICAgICAgZm9ydW1JZDogMVxuICAgIH07XG4gICAgbGFzdE1ldGFWYXJzID0ge1xuICAgICAgZm9ydW1JZDogbWV0YS5mb3J1bVVyaSA9PT0gbGFzdE1ldGEuZm9ydW1VcmkgPyAxIDogMlxuICAgIH07XG4gICAgaWYgKGxhc3RNdXRhbnQgPT09ICd0aHJlYWQnKSB7XG4gICAgICBsYXN0TWV0YVZhcnMucG9zdElkID0gMTtcbiAgICAgIGxhc3RNZXRhVmFycy5saW1pdCA9IDEwO1xuICAgICAgbGFzdE1ldGFWYXJzLm9mZnNldCA9IDA7XG4gICAgfVxuICAgIHNyYyA9IGZvck11dGFudFttdXRhbnRdO1xuICAgIGRzdCA9IGZvck11dGFudFtsYXN0TXV0YW50XTtcbiAgICBrZWVwID0gcmVxdWlyZWRUYXNrcyhbc3JjLCBtZXRhVmFyc10sIFtkc3QsIGxhc3RNZXRhVmFyc10pO1xuICAgIHJldHVybiB7XG4gICAgICBrZWVwOiBrZWVwXG4gICAgfTtcbiAgY2FzZSAndGhyZWFkJzpcbiAgICBtZXRhVmFycyA9IHtcbiAgICAgIGZvcnVtSWQ6IDEsXG4gICAgICBwb3N0SWQ6IDEsXG4gICAgICBsaW1pdDogMTAsXG4gICAgICBvZmZzZXQ6ICgobWV0YS5wYWdlIHx8IDEpIC0gMSkgKiAxMFxuICAgIH07XG4gICAgbGFzdE1ldGFWYXJzID0ge1xuICAgICAgZm9ydW1JZDogbWV0YS5mb3J1bVVyaSA9PT0gbGFzdE1ldGEuZm9ydW1VcmkgPyAxIDogMlxuICAgIH07XG4gICAgaWYgKGxhc3RNdXRhbnQgPT09ICd0aHJlYWQnKSB7XG4gICAgICBsYXN0TWV0YVZhcnMucG9zdElkID0gbWV0YS50aHJlYWRVcmkgPT09IGxhc3RNZXRhLnRocmVhZFVyaSA/IDEgOiAyO1xuICAgICAgbGFzdE1ldGFWYXJzLmxpbWl0ID0gMTA7XG4gICAgICBsYXN0TWV0YVZhcnMub2Zmc2V0ID0gKChsYXN0TWV0YS5wYWdlIHx8IDEpIC0gMSkgKiAxMDtcbiAgICB9XG4gICAgc3JjID0gZm9yTXV0YW50W211dGFudF07XG4gICAgZHN0ID0gZm9yTXV0YW50W2xhc3RNdXRhbnRdO1xuICAgIGtlZXAgPSByZXF1aXJlZFRhc2tzKFtzcmMsIG1ldGFWYXJzXSwgW2RzdCwgbGFzdE1ldGFWYXJzXSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGtlZXA6IGtlZXBcbiAgICB9O1xuICBkZWZhdWx0OlxuICAgIHJldHVybiBkZWZhdWx0UmVjb21tZW5kYXRpb247XG4gIH1cbn07IiwidmFyIGZzbSwgdHlwZU9mUGFydCwgbWFjaGluZSwgcGFyc2UsIGZvcnVtVXJpLCBvdXQkID0gdHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgJiYgZXhwb3J0cyB8fCB0aGlzLCBzbGljZSQgPSBbXS5zbGljZTtcbmZzbSA9IHJlcXVpcmUoJy4vZnNtLmxzJyk7XG4vKlxuc3RhdGVzID1cbiAgKiBcXGluaXRpYWxcbiAgKiBcXGZvcnVtXG4gICogXFxuZXctdGhyZWFkXG4gICogXFwtdGhyZWFkLW1hcmtlclxuICAqIFxcdGhyZWFkXG4gICogXFx0aHJlYWQtcGFnZVxuICAqIFxcLXBhZ2UtbWFya2VyXG4gICogXFx0aHJlYWQtcGVybWFsaW5rXG4gICogXFwtcGVybWFsaW5rLXBhZ2UtbWFya2VyXG4gICogXFx0aHJlYWQtcGVybWFsaW5rLXBhZ2VcbiAgKiBcXC1lZGl0LW1hcmtlclxuICAqIFxcZWRpdFxuICAqIFxcZXJyb3JcblxuaW5wdXRzID1cbiAgKiBcXHN0cmluZ1xuICAqIFxcbnVtYmVyXG4gICogXFxuZXdcbiAgKiBcXGVkaXRcbiAgKiBcXHRcbiAgKiBcXHBhZ2VcbiovXG5vdXQkLnR5cGVPZlBhcnQgPSB0eXBlT2ZQYXJ0ID0gZnVuY3Rpb24oaSl7XG4gIHN3aXRjaCAoaSkge1xuICBjYXNlICdwYWdlJzpcbiAgICByZXR1cm4gJ3BhZ2UnO1xuICBjYXNlICd0JzpcbiAgICByZXR1cm4gJ3QnO1xuICBjYXNlICdlZGl0JzpcbiAgICByZXR1cm4gJ2VkaXQnO1xuICBjYXNlICduZXcnOlxuICAgIHJldHVybiAnbmV3JztcbiAgZGVmYXVsdDpcbiAgICBpZiAoaS5tYXRjaCgvW1xcLl0vKSkge1xuICAgICAgcmV0dXJuICdmYmRuJztcbiAgICB9XG4gICAgaWYgKGkubWF0Y2goL15cXGQrJC8pKSB7XG4gICAgICByZXR1cm4gJ251bWJlcic7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICB9XG4gIH1cbn07XG5vdXQkLm1hY2hpbmUgPSBtYWNoaW5lID0ge1xuICBpbml0aWFsOiB7XG4gICAgc3RyaW5nOiAnZm9ydW0nLFxuICAgIG51bWJlcjogJ2ZvcnVtJyxcbiAgICAnbmV3JzogJ2ZvcnVtJyxcbiAgICBlZGl0OiAnZm9ydW0nLFxuICAgIHQ6ICdmb3J1bScsXG4gICAgcGFnZTogJ2ZvcnVtJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH0sXG4gIGZvcnVtOiB7XG4gICAgc3RyaW5nOiAnZm9ydW0nLFxuICAgIG51bWJlcjogJ2ZvcnVtJyxcbiAgICAnbmV3JzogJ25ldy10aHJlYWQnLFxuICAgIGVkaXQ6ICdmb3J1bScsXG4gICAgdDogJy10aHJlYWQtbWFya2VyJyxcbiAgICBwYWdlOiAnZm9ydW0nLFxuICAgIGZiZG46ICdlcnJvcidcbiAgfSxcbiAgJ25ldy10aHJlYWQnOiB7XG4gICAgc3RyaW5nOiAnZXJyb3InLFxuICAgIG51bWJlcjogJ2Vycm9yJyxcbiAgICAnbmV3JzogJ2Vycm9yJyxcbiAgICBlZGl0OiAnZXJyb3InLFxuICAgIHQ6ICdlcnJvcicsXG4gICAgcGFnZTogJ2Vycm9yJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH0sXG4gICctdGhyZWFkLW1hcmtlcic6IHtcbiAgICBzdHJpbmc6ICd0aHJlYWQnLFxuICAgIG51bWJlcjogJ3RocmVhZCcsXG4gICAgJ25ldyc6ICd0aHJlYWQnLFxuICAgIGVkaXQ6ICd0aHJlYWQnLFxuICAgIHQ6ICd0aHJlYWQnLFxuICAgIHBhZ2U6ICd0aHJlYWQnLFxuICAgIGZiZG46ICdlcnJvcidcbiAgfSxcbiAgdGhyZWFkOiB7XG4gICAgc3RyaW5nOiAndGhyZWFkLXBlcm1hbGluaycsXG4gICAgbnVtYmVyOiAndGhyZWFkLXBlcm1hbGluaycsXG4gICAgJ25ldyc6ICdlcnJvcicsXG4gICAgZWRpdDogJy1lZGl0LW1hcmtlcicsXG4gICAgdDogJ2Vycm9yJyxcbiAgICBwYWdlOiAnLXBhZ2UtbWFya2VyJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH0sXG4gICd0aHJlYWQtcGVybWFsaW5rJzoge1xuICAgIHN0cmluZzogJ2Vycm9yJyxcbiAgICBudW1iZXI6ICdlcnJvcicsXG4gICAgJ25ldyc6ICdlcnJvcicsXG4gICAgZWRpdDogJy1lZGl0LW1hcmtlcicsXG4gICAgdDogJ2Vycm9yJyxcbiAgICBwYWdlOiAnLXBlcm1hbGluay1wYWdlLW1hcmtlcicsXG4gICAgZmJkbjogJ2Vycm9yJ1xuICB9LFxuICAnLWVkaXQtbWFya2VyJzoge1xuICAgIHN0cmluZzogJ2Vycm9yJyxcbiAgICBudW1iZXI6ICdlZGl0JyxcbiAgICAnbmV3JzogJ2Vycm9yJyxcbiAgICBlZGl0OiAnZXJyb3InLFxuICAgIHQ6ICdlcnJvcicsXG4gICAgcGFnZTogJ2Vycm9yJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH0sXG4gIGVkaXQ6IHtcbiAgICBzdHJpbmc6ICdlcnJvcicsXG4gICAgbnVtYmVyOiAnZXJyb3InLFxuICAgICduZXcnOiAnZXJyb3InLFxuICAgIGVkaXQ6ICdlcnJvcicsXG4gICAgdDogJ2Vycm9yJyxcbiAgICBwYWdlOiAnZXJyb3InLFxuICAgIGZiZG46ICdlcnJvcidcbiAgfSxcbiAgJy1wZXJtYWxpbmstcGFnZS1tYXJrZXInOiB7XG4gICAgc3RyaW5nOiAnZXJyb3InLFxuICAgIG51bWJlcjogJ3RocmVhZC1wZXJtYWxpbmstcGFnZScsXG4gICAgJ25ldyc6ICdlcnJvcicsXG4gICAgZWRpdDogJ2Vycm9yJyxcbiAgICB0OiAnZXJyb3InLFxuICAgIHBhZ2U6ICdlcnJvcicsXG4gICAgZmJkbjogJ2Vycm9yJ1xuICB9LFxuICAndGhyZWFkLXBlcm1hbGluay1wYWdlJzoge1xuICAgIHN0cmluZzogJ2Vycm9yJyxcbiAgICBudW1iZXI6ICdlcnJvcicsXG4gICAgJ25ldyc6ICdlcnJvcicsXG4gICAgZWRpdDogJ2Vycm9yJyxcbiAgICB0OiAnZXJyb3InLFxuICAgIHBhZ2U6ICdlcnJvcicsXG4gICAgZmJkbjogJ2Vycm9yJ1xuICB9LFxuICAnLXBhZ2UtbWFya2VyJzoge1xuICAgIHN0cmluZzogJ2Vycm9yJyxcbiAgICBudW1iZXI6ICd0aHJlYWQtcGFnZScsXG4gICAgJ25ldyc6ICdlcnJvcicsXG4gICAgZWRpdDogJ2Vycm9yJyxcbiAgICB0OiAnZXJyb3InLFxuICAgIHBhZ2U6ICdlcnJvcicsXG4gICAgZmJkbjogJ2Vycm9yJ1xuICB9LFxuICAndGhyZWFkLXBhZ2UnOiB7XG4gICAgc3RyaW5nOiAnZXJyb3InLFxuICAgIG51bWJlcjogJ2Vycm9yJyxcbiAgICAnbmV3JzogJ2Vycm9yJyxcbiAgICBlZGl0OiAnZXJyb3InLFxuICAgIHQ6ICdlcnJvcicsXG4gICAgcGFnZTogJ2Vycm9yJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH0sXG4gIGVycm9yOiB7XG4gICAgc3RyaW5nOiAnZXJyb3InLFxuICAgIG51bWJlcjogJ2Vycm9yJyxcbiAgICAnbmV3JzogJ2Vycm9yJyxcbiAgICBlZGl0OiAnZXJyb3InLFxuICAgIHQ6ICdlcnJvcicsXG4gICAgcGFnZTogJ2Vycm9yJyxcbiAgICBmYmRuOiAnZXJyb3InXG4gIH1cbn07XG5vdXQkLnBhcnNlID0gcGFyc2UgPSBmdW5jdGlvbihwYXRoKXtcbiAgdmFyIHBhcnRzLCBpbnB1dHMsIHR5cGUsIG1ldGEsIHVyaVBhcnRzLCBwYWdlLCBuLCBlZGl0LCBpZDtcbiAgcGFydHMgPSByZWplY3QoZnVuY3Rpb24oaXQpe1xuICAgIHJldHVybiBpdCA9PT0gJyc7XG4gIH0pKFxuICBwYXRoLnNwbGl0KCcvJykpO1xuICBpbnB1dHMgPSBtYXAodHlwZU9mUGFydCwgcGFydHMpO1xuICB0eXBlID0gZnNtLm5ld1N0YXRlKG1hY2hpbmUsICdpbml0aWFsJywgaW5wdXRzKTtcbiAgbWV0YSA9IChmdW5jdGlvbigpe1xuICAgIHZhciByZWYkLCByZWYxJDtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdpbml0aWFsJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGluY29tcGxldGU6IHRydWVcbiAgICAgIH07XG4gICAgY2FzZSAnZm9ydW0nOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9ydW1Vcmk6IFwiL1wiICsgcGFydHMuam9pbignLycpXG4gICAgICB9O1xuICAgIGNhc2UgJ25ldy10aHJlYWQnOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9ydW1Vcmk6IFwiL1wiICsgc2xpY2UkLmNhbGwocGFydHMsIDAsIHBhcnRzLmxlbmd0aCAtIDEpLmpvaW4oJy8nKVxuICAgICAgfTtcbiAgICBjYXNlICd0aHJlYWQnOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9ydW1Vcmk6IGZvcnVtVXJpKHBhdGgpLFxuICAgICAgICB0aHJlYWRVcmk6IFwiL1wiICsgcGFydHMuam9pbignLycpXG4gICAgICB9O1xuICAgIGNhc2UgJ3RocmVhZC1wYWdlJzpcbiAgICAgIHJlZiQgPSBzcGxpdEF0KHBhcnRzLmxlbmd0aCAtIDIsIHBhcnRzKSwgdXJpUGFydHMgPSByZWYkWzBdLCByZWYxJCA9IHJlZiRbMV0sIHBhZ2UgPSByZWYxJFswXSwgbiA9IHJlZjEkWzFdO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9ydW1Vcmk6IGZvcnVtVXJpKHBhdGgpLFxuICAgICAgICB0aHJlYWRVcmk6IFwiL1wiICsgdXJpUGFydHMuam9pbignLycpLFxuICAgICAgICBwYWdlOiBwYXJzZUludChuKVxuICAgICAgfTtcbiAgICBjYXNlICd0aHJlYWQtcGVybWFsaW5rJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZvcnVtVXJpOiBmb3J1bVVyaShwYXRoKSxcbiAgICAgICAgdGhyZWFkVXJpOiBcIi9cIiArIHBhcnRzLmpvaW4oJy8nKSxcbiAgICAgICAgc2x1ZzogcGFydHNbcGFydHMubGVuZ3RoIC0gMV1cbiAgICAgIH07XG4gICAgY2FzZSAndGhyZWFkLXBlcm1hbGluay1wYWdlJzpcbiAgICAgIHJlZiQgPSBzcGxpdEF0KHBhcnRzLmxlbmd0aCAtIDIsIHBhcnRzKSwgdXJpUGFydHMgPSByZWYkWzBdLCByZWYxJCA9IHJlZiRbMV0sIHBhZ2UgPSByZWYxJFswXSwgbiA9IHJlZjEkWzFdO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9ydW1Vcmk6IGZvcnVtVXJpKHBhdGgpLFxuICAgICAgICB0aHJlYWRVcmk6IFwiL1wiICsgdXJpUGFydHMuam9pbignLycpLFxuICAgICAgICBwYWdlOiBwYXJzZUludChuKVxuICAgICAgfTtcbiAgICBjYXNlICdlZGl0JzpcbiAgICAgIHJlZiQgPSBzcGxpdEF0KHBhcnRzLmxlbmd0aCAtIDIsIHBhcnRzKSwgdXJpUGFydHMgPSByZWYkWzBdLCByZWYxJCA9IHJlZiRbMV0sIGVkaXQgPSByZWYxJFswXSwgaWQgPSByZWYxJFsxXTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZvcnVtVXJpOiBmb3J1bVVyaShwYXRoKSxcbiAgICAgICAgdGhyZWFkVXJpOiBcIi9cIiArIHVyaVBhcnRzLmpvaW4oJy8nKSxcbiAgICAgICAgaWQ6IHBhcnNlSW50KGlkKVxuICAgICAgfTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW5jb21wbGV0ZTogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG4gIH0oKSk7XG4gIHJldHVybiBpbXBvcnQkKHtcbiAgICB0eXBlOiB0eXBlLFxuICAgIHBhcnRzOiBwYXJ0cyxcbiAgICBwYXRoOiBcIi9cIiArIHBhcnRzLmpvaW4oJy8nKVxuICB9LCBtZXRhKTtcbn07XG5vdXQkLmZvcnVtVXJpID0gZm9ydW1VcmkgPSBmdW5jdGlvbihwYXRoKXtcbiAgdmFyIHBhcnRzLCBpbnB1dHMsIHQsIGZvcnVtU3RhdGVzO1xuICBwYXJ0cyA9IHJlamVjdChmdW5jdGlvbihpdCl7XG4gICAgcmV0dXJuIGl0ID09PSAnJztcbiAgfSkoXG4gIHBhdGguc3BsaXQoJy8nKSk7XG4gIGlucHV0cyA9IG1hcCh0eXBlT2ZQYXJ0LCBwYXJ0cyk7XG4gIHQgPSBmdW5jdGlvbihzdGF0ZSwgaW5wdXQpe1xuICAgIHJldHVybiBmc20ubmV3U3RhdGUobWFjaGluZSwgc3RhdGUsIFtpbnB1dF0pO1xuICB9O1xuICBmb3J1bVN0YXRlcyA9IHRha2VXaGlsZShmdW5jdGlvbihpdCl7XG4gICAgcmV0dXJuIGl0ID09PSAnaW5pdGlhbCcgfHwgaXQgPT09ICdmb3J1bSc7XG4gIH0pKFxuICBzY2FuKHQsICdpbml0aWFsJywgaW5wdXRzKSk7XG4gIHJldHVybiAnLycgKyBqb2luKCcvJykoXG4gIHRha2UoZm9ydW1TdGF0ZXMubGVuZ3RoIC0gMSkoXG4gIHBhcnRzKSk7XG59O1xuLypcblRyeSB0aGVzZSBpbiB0aGUgUkVQTC5cblxuZnVybC5wYXJzZSAnL290aGVyZ3JvdW5kLWZvcnVtJ1xuZnVybC5wYXJzZSAnL290aGVyZ3JvdW5kLWZvcnVtL3N1cHBvcnRncm91bmQnXG5mdXJsLnBhcnNlICcvb3RoZXJncm91bmQtZm9ydW0vbmV3JyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdlIGNhbiBpZGVudGlmeSB0aGUgbmV3IHRocmVhZCBtYXJrZXJcbmZ1cmwucGFyc2UgJy9vdGhlcmdyb3VuZC1mb3J1bS9zdXBwb3J0Z3JvdW5kL3QvbmV3JyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdGhyZWFkcyBjYW4gYmUgY2FsbGVkIFwibmV3XCJcbmZ1cmwucGFyc2UgJy9vdGhlcmdyb3VuZC1mb3J1bS9zdXBwb3J0Z3JvdW5kL3QvZWRpdCcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdGhyZWFkcyBjYW4gYmUgY2FsbGVkIFwiZWRpdFwiXG5mdXJsLnBhcnNlICcvb3RoZXJncm91bmQtZm9ydW0vc3VwcG9ydGdyb3VuZC90L2VkaXQvZWRpdCcgICAgICAgICAgICAgICAgICAgICAgICAgICAjIC4uLmJ1dCB3ZSBjYW4gc3RpbGwgaWRlbnRpZnkgdGhlIGVkaXQgbWFya2VyXG5mdXJsLnBhcnNlICcvb3RoZXJncm91bmQtZm9ydW0vc3VwcG9ydGdyb3VuZC90L2VkaXQvZWRpdC8xMjM0JyAgICAgICAgICAgICAgICAgICAgICAjIGFuZCBrbm93IHRoaXMgaXMgYW4gZWRpdCB1cmxcbmZ1cmwucGFyc2UgJy9vdGhlcmdyb3VuZC1mb3J1bS9zdXBwb3J0Z3JvdW5kL3QvbmV3LXRoaW5nJyAgICAgICAgICAgICAgICAgIFxuZnVybC5wYXJzZSAnL290aGVyZ3JvdW5kLWZvcnVtL3N1cHBvcnRncm91bmQvdC9uZXctdGhpbmcvcGFnZS81JyAgICAgICAgICAgICAgICAgICAgIyBwcmV0dHkgcGFnZSB1cmxzIGFyZSBub3QgYSBwcm9ibGVtXG5mdXJsLnBhcnNlICcvb3RoZXJncm91bmQtZm9ydW0vc3VwcG9ydGdyb3VuZC90L3RoaXMtaXMtYS10ZXN0L2VkaXQvMjEwOCdcbiovXG5mdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICByZXR1cm4gb2JqO1xufSIsInZhciBjaDtcbmNoID0gcmVxdWlyZSgnLi9jbGllbnQtaGVscGVycy5scycpO1xuY2gubGF6eUxvYWRTb2NrZXRpbyhmdW5jdGlvbigpe1xuICB3aW5kb3cuc29ja2V0ID0gaW8uY29ubmVjdCgpO1xuICBzb2NrZXQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gd2luZG93LnJTb2NrZXQoc29ja2V0KTtcbiAgICB9LCA1MCk7XG4gIH0pO1xuICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbigpe30pO1xuICBzb2NrZXQub24oJ2VudGVyLXNpdGUnLCBmdW5jdGlvbihtZXNzYWdlLCBjYil7XG4gICAgcmV0dXJuIHNldE9ubGluZVVzZXIobWVzc2FnZSAhPSBudWxsID8gbWVzc2FnZS5pZCA6IHZvaWQgOCk7XG4gIH0pO1xuICBzb2NrZXQub24oJ2xlYXZlLXNpdGUnLCBmdW5jdGlvbihtZXNzYWdlLCBjYil7XG4gICAgcmV0dXJuICQoXCJbZGF0YS11c2VyLWlkPVwiICsgbWVzc2FnZS5pZCArIFwiXSAucHJvZmlsZS5waG90b1wiKS5yZW1vdmVDbGFzcygnb25saW5lJyk7XG4gIH0pO1xuICBzb2NrZXQub24oJ3RocmVhZC1pbXByZXNzaW9uJywgZnVuY3Rpb24odGhyZWFkLCBjYil7XG4gICAgaWYgKHRocmVhZC5mb3J1bV9pZCA9PT0gd2luZG93LmFjdGl2ZUZvcnVtSWQpIHtcbiAgICAgIHJldHVybiAkKFwiI2xlZnRfY29udGFpbmVyIHVsLnRocmVhZHMgbGlbZGF0YS1pZD1cIiArIHRocmVhZC5pZCArIFwiXSBzcGFuLnZpZXdzXCIpLmh0bWwodGhyZWFkLnZpZXdzICsgXCI8aT52aWV3czwvaT5cIik7XG4gICAgfVxuICB9KTtcbiAgc29ja2V0Lm9uKCd0aHJlYWQtY3JlYXRlJywgZnVuY3Rpb24odGhyZWFkLCBjYil7XG4gICAgaWYgKHdpbmRvdy5hY3RpdmVGb3J1bUlkID09PSAodGhyZWFkICE9IG51bGwgPyB0aHJlYWQuZm9ydW1faWQgOiB2b2lkIDgpKSB7XG4gICAgICByZXR1cm4gJHVpLnRyaWdnZXIoJ3RocmVhZC1jcmVhdGUnLCB0aHJlYWQpO1xuICAgIH1cbiAgfSk7XG4gIHNvY2tldC5vbigncG9zdC1jcmVhdGUnLCBmdW5jdGlvbihwb3N0LCBjYil7XG4gICAgdmFyIHBjLCBzZWwsIGFuaW1hdGVJbjtcbiAgICB3aW5kb3cuYWN0aXZlVGhyZWFkSWQgfHwgKHdpbmRvdy5hY3RpdmVUaHJlYWRJZCA9IC0xKTtcbiAgICBpZiAocG9zdC50aHJlYWRfaWQgPT09IHdpbmRvdy5hY3RpdmVUaHJlYWRJZCB8fCAocG9zdC51c2VyX2lkID09PSB1c2VyLmlkICYmIG11dGF0b3IgPT09ICdwcm9maWxlJykpIHtcbiAgICAgIGlmICgkKFwicG9zdF9cIiArIHBvc3QuaWQpLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBwYyA9ICQoXCIjbGVmdF9jb250YWluZXIgdWwudGhyZWFkcyBsaVtkYXRhLWlkPVwiICsgcG9zdC50aHJlYWRfaWQgKyBcIl0gc3Bhbi5wb3N0LWNvdW50XCIpO1xuICAgICAgcGMuaHRtbCgocGFyc2VJbnQocGMudGV4dCgpKSArIDEpICsgXCIgPGk+cG9zdHM8L2k+XCIpO1xuICAgICAgc2VsID0gXCIjcG9zdF9cIiArIHBvc3QucGFyZW50X2lkICsgXCIgKyAuY2hpbGRyZW5cIjtcbiAgICAgIGFuaW1hdGVJbiA9IGZ1bmN0aW9uKGUpe1xuICAgICAgICByZXR1cm4gJChlKS5hZGRDbGFzcygncG9zdC1hbmltYXRlLWluJyk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHJlbmRlckFuZEFwcGVuZCh3aW5kb3csICQoc2VsKSwgJ3Bvc3QnLCB7XG4gICAgICAgIHBvc3Q6IHBvc3RcbiAgICAgIH0sIGZ1bmN0aW9uKG5ld1Bvc3Qpe1xuICAgICAgICBpZiAocG9zdC51c2VyX2lkID09PSAodHlwZW9mIHVzZXIgIT0gJ3VuZGVmaW5lZCcgJiYgdXNlciAhPT0gbnVsbCA/IHVzZXIuaWQgOiB2b2lkIDgpKSB7XG4gICAgICAgICAgbXV0YW50cy5mb3J1bS5vblBlcnNvbmFsaXplKHdpbmRvdywgdXNlciwgZnVuY3Rpb24oKXt9KTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0ZUluKG5ld1Bvc3QpO1xuICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgaWYgKG11dGF0b3IgPT09ICdmb3J1bScpIHtcbiAgICAgICAgICAgIHJldHVybiBhd2Vzb21lU2Nyb2xsVG8obmV3UG9zdCwgMzAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGFuaW1hdGVJbihuZXdQb3N0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgc29ja2V0Lm9uKCduZXctaGl0JywgZnVuY3Rpb24oaGl0KXtcbiAgICB2YXIgaHMsIHN1ZmZpeCwgcmVhbHRpbWVIdG1sLCB4JDtcbiAgICBocyA9IGhpdC5fc291cmNlO1xuICAgIHdpbmRvdy5uZXdIaXRzKys7XG4gICAgd2luZG93LiRuZXdIaXRzLnByZXBlbmQoamFkZS50ZW1wbGF0ZXMucG9zdCh7XG4gICAgICBwb3N0OiBoc1xuICAgIH0pKTtcbiAgICB3aW5kb3cuc2hvd05ld0hpdHMgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHdpbmRvdy5hd2Vzb21lU2Nyb2xsVG8oJyNtYWluX2NvbnRlbnQnLCBudWxsLCBmdW5jdGlvbigpe1xuICAgICAgICAkKCcjbmV3X3Bvc3RzJykuaHRtbCgnJykuYXBwZW5kKHdpbmRvdy4kbmV3SGl0cykuZWZmZWN0KCdmbGFzaCcpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHdpbmRvdy5oaWRlTmV3SGl0cyA9IGZ1bmN0aW9uKCl7XG4gICAgICAkKCcjbmV3X3Bvc3RzJykuaHRtbCgnJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBzdWZmaXggPSB3aW5kb3cubmV3SGl0cyA9PT0gMSA/ICcnIDogJ3MnO1xuICAgIHJlYWx0aW1lSHRtbCA9IFwiPGEgaHJlZj1cXFwiI1xcXCIgb25jbGljaz1cXFwic2hvd05ld0hpdHMoKVxcXCI+XFxuICBcIiArIHdpbmRvdy5uZXdIaXRzICsgXCIgbmV3IHJlc3VsdFwiICsgc3VmZml4ICsgXCJcXG48L2E+XCI7XG4gICAgeCQgPSAkKCcjbmV3X2hpdF9jb3VudCcpO1xuICAgIHgkLmZpbmQoJy5jb3VudCcpLmh0bWwod2luZG93Lm5ld0hpdHMpO1xuICAgIHgkLnNob3coKS5lZmZlY3QoJ2hpZ2hsaWdodCcpO1xuICAgICQoJyNuZXdfaGl0cycpLmh0bWwocmVhbHRpbWVIdG1sKTtcbiAgICByZXR1cm4gJCgnI2JyZWFkY3J1bWInKS5zbGlkZURvd24oMzAwKTtcbiAgfSk7XG4gIHNvY2tldC5vbignZGVidWcnLCBmdW5jdGlvbihtZXNzYWdlLCBjYil7XG4gICAgcmV0dXJuIHR5cGVvZiBjb25zb2xlICE9ICd1bmRlZmluZWQnICYmIGNvbnNvbGUgIT09IG51bGwgPyBjb25zb2xlLmxvZygnZGVidWcnLCBtZXNzYWdlKSA6IHZvaWQgODtcbiAgfSk7XG4gIHJldHVybiBDaGF0LmNsaWVudFNvY2tldEluaXQoc29ja2V0KTtcbn0pOyIsInZhciBjaGVlcmlvLCB1c2VKc2RvbSwgZG9tV2luZG93LCBpc1N1cmZhYmxlLCBzbGljZSQgPSBbXS5zbGljZTtcbmlmICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdyAhPT0gbnVsbCkge1xuICB0cnVlO1xufSBlbHNlIHtcbiAgY2hlZXJpbyA9IHJlcXVpcmUoJ2NoZWVyaW8nKTtcbiAgdXNlSnNkb20gPSBmYWxzZTtcbiAgZG9tV2luZG93ID0gZnVuY3Rpb24oaHRtbCwgY2Ipe1xuICAgIHZhciBzY3JpcHRzLCBqc2RvbV9vcHRzLCBqc2RvbV9kb25lLCB0aGlzJCA9IHRoaXM7XG4gICAgc2NyaXB0cyA9IFsnLi4vLi4vcHVibGljL2xvY2FsL2pxdWVyeS0xLjkuMS5taW4uanMnLCAnLi4vLi4vbm9kZV9tb2R1bGVzL3JlYWN0aXZlanMvc3JjL3JlYWN0aXZlLmpzJ107XG4gICAganNkb21fb3B0cyA9IHtcbiAgICAgIGh0bWw6IGh0bWwsXG4gICAgICBzY3JpcHRzOiBzY3JpcHRzXG4gICAgfTtcbiAgICBqc2RvbV9kb25lID0gZnVuY3Rpb24oZXJyLCB3aW5kb3cpe1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY2IoZXJyKTtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy4kID0gd2luZG93LmpRdWVyeTtcbiAgICAgIHJldHVybiBjYihudWxsLCB3aW5kb3cpO1xuICAgIH07XG4gICAgcmV0dXJuIGpzZG9tLmVudihqc2RvbV9vcHRzLCBqc2RvbV9kb25lKTtcbiAgfTtcbn1cbnRoaXMucnVuID0gZnVuY3Rpb24odGVtcGxhdGUsIG9wdHMsIGNiKXtcbiAgLypcbiAgcnVuIHJldHVybnMgdm9pZCBiZWNhdXNlIGl0IG11dGF0ZXMgdGhlIHdpbmRvdyBvYmplY3RcbiAgXG4gIG9uIHRoZSBzZXJ2ZXIgc2lkZSB3ZSBuZWVkIHRvIGtub3cgdGhlIGJhc2UgaHRtbCBiZWZvcmUgd2UgY2FuIG11dGF0ZSBpdFxuICBcbiAgb24gdGhlIGNsaWVudCBzaWRlIHRoZSBjYWxsYmFjayByZXR1cm5zIG5vdGhpbmcgYmVjYXVzZSB0aGUgZG9tIGhhcyBiZWVuIG11dGF0ZWQgYWxyZWFkeVxuICBvbiB0aGUgc2VydmVyIHNpZGUgdGhlIGNhbGxiYWNrIHdpbGwgcmV0dXJuIGh0bWxcbiAgXG4gIHRlbXBsYXRlcyBhcmUgb2JqZWN0cyB3aXRoIHVwIHRvIGZvdXIgbWV0aG9kczpcbiAgc3RhdGljLCBvbkxvYWQsIG9uSW5pdGlhbCwgb25NdXRhdGVcbiAgXG4gIHN0YXRpYyBpcyBjbGllbnQgb3Igc2VydmVyc2lkZSBhbmQgdGhpcyBwaGFzZSBpcyBwdXJlbHkgZm9yIGh0bWwgZG9tIHRyZWUgY3JlYXRpb24vbWFuaXB1bGF0aW9uXG4gIFxuICBvbkxvYWQgaGFwcGVucyB3aGVuIGEgbXV0YW50IHRlbXBsYXRlIGlzIHJ1biwgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIGl0IGlzIHRoZSBpbml0aWFsIHBhZ2Vsb2FkLCBvciBhIG11dGF0aW9uXG4gIFxuICBvbkluaXRpYWwgb25seSBoYXBwZW5zIG9uIGFuIGluaXRpYWwgcGFnZWxvYWQgKG5vdCBvbiBtdXRhdGlvbilcbiAgXG4gIG9uTXV0YXRlIG9ubHkgaGFwcGVucyBvbiBhIG11dGF0aW9uIChub3Qgb24gYW4gaW5pdGlhbCBwYWdlbG9hZClcbiAgKi9cbiAgdmFyIGluaXRpYWxfcnVuLCBwYXJhbXMsIGh0bWwsIHVzZXIsIHJlZiQsIHByZXBhcmUsIHJhd0RyYXcsIHJhZiwgZHJhdywgb25Mb2FkLCBvbkluaXRpYWwsIG9uTXV0YXRlLCBvblBlcnNvbmFsaXplLCByZW5kZXJNdXRhbnQsIHJlbmRlciwgdmFyU3RhdGVtZW50cywgbWFyc2hhbCwgcnVuU3RhdGljLCAkO1xuICBjYiA9PSBudWxsICYmIChjYiA9IGZ1bmN0aW9uKCl7fSk7XG4gIGluaXRpYWxfcnVuID0gb3B0cy5pbml0aWFsO1xuICBwYXJhbXMgPSBvcHRzLmxvY2FscyB8fCB7fTtcbiAgaHRtbCA9IG9wdHMuaHRtbDtcbiAgdXNlciA9IG9wdHMudXNlcjtcbiAgaWYgKCgocmVmJCA9IHRlbXBsYXRlWydzdGF0aWMnXSkgIT0gbnVsbCAmJiByZWYkLnByZXBhcmUpICYmICgocmVmJCA9IHRlbXBsYXRlWydzdGF0aWMnXSkgIT0gbnVsbCAmJiByZWYkLmRyYXcpKSB7XG4gICAgcHJlcGFyZSA9ICgocmVmJCA9IHRlbXBsYXRlWydzdGF0aWMnXSkgIT0gbnVsbCA/IHJlZiQucHJlcGFyZSA6IHZvaWQgOCkgfHwgZnVuY3Rpb24odywgY2Ipe1xuICAgICAgcmV0dXJuIGNiKCk7XG4gICAgfTtcbiAgICByYXdEcmF3ID0gKChyZWYkID0gdGVtcGxhdGVbJ3N0YXRpYyddKSAhPSBudWxsID8gcmVmJC5kcmF3IDogdm9pZCA4KSB8fCBmdW5jdGlvbih3LCBjYil7XG4gICAgICByZXR1cm4gY2IoKTtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHByZXBhcmUgPSBmdW5jdGlvbih3LCBjYil7XG4gICAgICByZXR1cm4gY2IoKTtcbiAgICB9O1xuICAgIHJhd0RyYXcgPSB0ZW1wbGF0ZVsnc3RhdGljJ10gfHwgZnVuY3Rpb24odywgY2Ipe1xuICAgICAgcmV0dXJuIGNiKCk7XG4gICAgfTtcbiAgfVxuICBpZiAocmFmID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cgIT09IG51bGwgPyB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIDogdm9pZCA4KSB7XG4gICAgZHJhdyA9IGZ1bmN0aW9uKHcsIGNiKXtcbiAgICAgIHZhciBwYXJhbXM7XG4gICAgICBwYXJhbXMgPSB0aGlzO1xuICAgICAgcmV0dXJuIHJhZihmdW5jdGlvbigpe1xuICAgICAgICB2YXIgYmVnO1xuICAgICAgICBiZWcgPSBuZXcgRGF0ZTtcbiAgICAgICAgcmV0dXJuIHJhd0RyYXcuY2FsbChwYXJhbXMsIHcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdmFyIGVuZDtcbiAgICAgICAgICBlbmQgPSBuZXcgRGF0ZTtcbiAgICAgICAgICBjYigpO1xuICAgICAgICAgIHJldHVybiBwYXJ0aWFsaXplJC5hcHBseSh0aGlzLCBbc2V0VGltZW91dCwgW3ZvaWQgOCwgMV0sIFswXV0pKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZHVyLCBpbmZvO1xuICAgICAgICAgICAgZHVyID0gZW5kIC0gYmVnO1xuICAgICAgICAgICAgaWYgKHRydWUpIHtcbiAgICAgICAgICAgICAgaW5mbyA9IFwicmVxdWVzdC1hbmltYXRpb24tZnJhbWUgdG9vayBcIiArIGR1ciArIFwibXMgaW4gbXV0YW50IHN0YXRpYyBkcmF3IHBoYXNlXCI7XG4gICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oaW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBkcmF3ID0gcmF3RHJhdztcbiAgfVxuICBvbkxvYWQgPSB0ZW1wbGF0ZS5vbkxvYWQgfHwgZnVuY3Rpb24odywgY2Ipe1xuICAgIHJldHVybiBjYigpO1xuICB9O1xuICBvbkluaXRpYWwgPSB0ZW1wbGF0ZS5vbkluaXRpYWwgfHwgZnVuY3Rpb24odywgY2Ipe1xuICAgIHJldHVybiBjYigpO1xuICB9O1xuICBvbk11dGF0ZSA9IHRlbXBsYXRlLm9uTXV0YXRlIHx8IGZ1bmN0aW9uKHcsIGNiKXtcbiAgICByZXR1cm4gY2IoKTtcbiAgfTtcbiAgb25QZXJzb25hbGl6ZSA9IHRlbXBsYXRlLm9uUGVyc29uYWxpemUgfHwgZnVuY3Rpb24odywgdSwgY2Ipe1xuICAgIHJldHVybiBjYigpO1xuICB9O1xuICByZXF1aXJlKCcuLi8uLi9idWlsZC9jbGllbnQtamFkZS5qcycpO1xuICBmdW5jdGlvbiByZXBsYWNlSHRtbCgkZWwsIGh0bWwpe1xuICAgIHZhciBlbCwgbmV3RWw7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93ICE9PSBudWxsKSB7XG4gICAgICBlbCA9ICRlbFswXTtcbiAgICAgIG5ld0VsID0gZWwuY2xvbmVOb2RlKGZhbHNlKTtcbiAgICAgIG5ld0VsLmlubmVySFRNTCA9IGh0bWw7XG4gICAgICBlbC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdFbCwgZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZWwuaHRtbChodG1sKTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyTXV0YW50ID0gZnVuY3Rpb24oaWQsIHRtcGwpe1xuICAgIHJldHVybiByZXBsYWNlSHRtbCgkKFwiI1wiICsgaWQpLCBqYWRlLnRlbXBsYXRlc1t0bXBsXShwYXJhbXMpKTtcbiAgfTtcbiAgcmVuZGVyID0gZnVuY3Rpb24odCl7XG4gICAgcmV0dXJuIGphZGUudGVtcGxhdGVzW3RdKHBhcmFtcyk7XG4gIH07XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdyAhPT0gbnVsbCkge1xuICAgIHdpbmRvdy5yZW5kZXIgPSByZW5kZXI7XG4gICAgd2luZG93LnJlcGxhY2VIdG1sID0gcmVwbGFjZUh0bWw7XG4gICAgaWYgKGluaXRpYWxfcnVuKSB7XG4gICAgICByZXR1cm4gb25Mb2FkLmNhbGwocGFyYW1zLCB3aW5kb3csIGZ1bmN0aW9uKGVycil7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gY2IoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb25Jbml0aWFsLmNhbGwocGFyYW1zLCB3aW5kb3csIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gb25QZXJzb25hbGl6ZS5jYWxsKHBhcmFtcywgd2luZG93LCB1c2VyLCBjYik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjYigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LnJlbmRlck11dGFudCA9IGZ1bmN0aW9uKHRhcmdldCwgdG1wbCl7XG4gICAgICAgIHJldHVybiBqYWRlLnJlbmRlcih3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFyZ2V0KSwgdG1wbCwgcGFyYW1zKTtcbiAgICAgIH07XG4gICAgICB3aW5kb3cubWFyc2hhbCA9IGZ1bmN0aW9uKGtleSwgdmFsKXtcbiAgICAgICAgcmV0dXJuIHdpbmRvd1trZXldID0gdmFsO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBwcmVwYXJlLmNhbGwocGFyYW1zLCB3aW5kb3csIGZ1bmN0aW9uKGVycil7XG4gICAgICAgIHZhciBoYXNEcmF3LCByZWYkO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgaGFzRHJhdyA9ICEhKChyZWYkID0gdGVtcGxhdGVbJ3N0YXRpYyddKSAhPSBudWxsICYmIHJlZiQuZHJhdyk7XG4gICAgICAgIHJldHVybiAoaGFzRHJhdyA/IGRyYXcgOiByYXdEcmF3KS5jYWxsKHBhcmFtcywgd2luZG93LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gb25Mb2FkLmNhbGwocGFyYW1zLCB3aW5kb3csIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9uTXV0YXRlLmNhbGwocGFyYW1zLCB3aW5kb3csIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBvblBlcnNvbmFsaXplLmNhbGwocGFyYW1zLCB3aW5kb3csIHVzZXIsIGNiKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2IoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGh0bWwpIHtcbiAgICB2YXJTdGF0ZW1lbnRzID0gW107XG4gICAgbWFyc2hhbCA9IGZ1bmN0aW9uKGtleSwgdmFsKXtcbiAgICAgIGlmICh2YWwgIT09IHZvaWQgOCkge1xuICAgICAgICByZXR1cm4gdmFyU3RhdGVtZW50cy5wdXNoKFwid2luZG93WydcIiArIGtleSArIFwiJ109XCIgKyBKU09OLnN0cmluZ2lmeSh2YWwpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHJ1blN0YXRpYyA9IGZ1bmN0aW9uKHdpbmRvdyl7XG4gICAgICB3aW5kb3cucmVuZGVyID0gcmVuZGVyO1xuICAgICAgd2luZG93LnJlcGxhY2VIdG1sID0gcmVwbGFjZUh0bWw7XG4gICAgICByZXR1cm4gcHJlcGFyZS5jYWxsKHBhcmFtcywgd2luZG93LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRyYXcuY2FsbChwYXJhbXMsIHdpbmRvdywgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICB2YXIgcztcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2IoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHVzZUpzZG9tKSB7XG4gICAgICAgICAgICB3aW5kb3cuJCgnc2NyaXB0LmpzZG9tJykucmVtb3ZlKCk7XG4gICAgICAgICAgICBzID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgd2luZG93LiQocykuYXR0cigndHlwZScsICd0ZXh0L2phdmFzY3JpcHQnKTtcbiAgICAgICAgICAgIHdpbmRvdy4kKHMpLnRleHQodmFyU3RhdGVtZW50cy5qb2luKCc7JykpO1xuICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoXCI8c2NyaXB0IHR5cGU9XFxcInRleHQvamF2YXNjcmlwdFxcXCI+XCIgKyB2YXJTdGF0ZW1lbnRzLmpvaW4oJzsnKSArIFwiPC9zY3JpcHQ+XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2IobnVsbCwgdXNlSnNkb21cbiAgICAgICAgICAgID8gXCI8IWRvY3R5cGUgaHRtbD5cIiArIHdpbmRvdy5kb2N1bWVudC5vdXRlckhUTUxcbiAgICAgICAgICAgIDogJC5odG1sKCkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgaWYgKHVzZUpzZG9tKSB7XG4gICAgICByZXR1cm4gZG9tV2luZG93KGh0bWwsIGZ1bmN0aW9uKGVyciwganNkb21XaW5kb3cpe1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgICAgIH1cbiAgICAgICAganNkb21XaW5kb3cubWFyc2hhbCA9IG1hcnNoYWw7XG4gICAgICAgIGpzZG9tV2luZG93LnJlbmRlck11dGFudCA9IGZ1bmN0aW9uKHRhcmdldCwgdG1wbCl7XG4gICAgICAgICAgcmV0dXJuIGphZGUucmVuZGVyKGpzZG9tV2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldCksIHRtcGwsIHBhcmFtcyk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBydW5TdGF0aWMoanNkb21XaW5kb3cpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQgPSBjaGVlcmlvLmxvYWQoaHRtbCk7XG4gICAgICByZXR1cm4gcnVuU3RhdGljKHtcbiAgICAgICAgbWFyc2hhbDogbWFyc2hhbCxcbiAgICAgICAgcmVuZGVyTXV0YW50OiByZW5kZXJNdXRhbnQsXG4gICAgICAgICQ6ICRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJuZWVkIGh0bWwgZm9yIHNlcnZlcnNpZGVcIik7XG4gIH1cbn07XG5pc1N1cmZhYmxlID0gZnVuY3Rpb24ocil7XG4gIHJldHVybiByLmNhbGxiYWNrcy5zb21lKGZ1bmN0aW9uKG0pe1xuICAgIHJldHVybiBtLnN1cmZhYmxlO1xuICB9KTtcbn07XG50aGlzLnN1cmZhYmxlUm91dGVzID0gZnVuY3Rpb24oYXBwKXtcbiAgdmFyIGkkLCByZWYkLCBsZW4kLCByLCByZXN1bHRzJCA9IFtdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gYXBwLnJvdXRlcy5nZXQpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgciA9IHJlZiRbaSRdO1xuICAgIGlmIChpc1N1cmZhYmxlKHIpKSB7XG4gICAgICByZXN1bHRzJC5wdXNoKHIucmVnZXhwLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG59O1xuZnVuY3Rpb24gcGFydGlhbGl6ZSQoZiwgYXJncywgd2hlcmUpe1xuICB2YXIgY29udGV4dCA9IHRoaXM7XG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHZhciBwYXJhbXMgPSBzbGljZSQuY2FsbChhcmd1bWVudHMpLCBpLFxuICAgICAgICBsZW4gPSBwYXJhbXMubGVuZ3RoLCB3bGVuID0gd2hlcmUubGVuZ3RoLFxuICAgICAgICB0YSA9IGFyZ3MgPyBhcmdzLmNvbmNhdCgpIDogW10sIHR3ID0gd2hlcmUgPyB3aGVyZS5jb25jYXQoKSA6IFtdO1xuICAgIGZvcihpID0gMDsgaSA8IGxlbjsgKytpKSB7IHRhW3R3WzBdXSA9IHBhcmFtc1tpXTsgdHcuc2hpZnQoKTsgfVxuICAgIHJldHVybiBsZW4gPCB3bGVuICYmIGxlbiA/XG4gICAgICBwYXJ0aWFsaXplJC5hcHBseShjb250ZXh0LCBbZiwgdGEsIHR3XSkgOiBmLmFwcGx5KGNvbnRleHQsIHRhKTtcbiAgfTtcbn0iLCJ2YXIgQ29tcG9uZW50LCBzaCwgdGVtcGxhdGVzLCBQaG90b0Nyb3BwZXI7XG5Db21wb25lbnQgPSByZXF1aXJlKCd5YWNvbXBvbmVudCcpO1xuc2ggPSByZXF1aXJlKCcuLi9hcHAvc2hhcmVkLWhlbHBlcnMubHMnKTtcbnRlbXBsYXRlcyA9IHJlcXVpcmUoJy4uL2J1aWxkL2NvbXBvbmVudC1qYWRlLmpzJykudGVtcGxhdGVzO1xubW9kdWxlLmV4cG9ydHMgPSBQaG90b0Nyb3BwZXIgPSAoZnVuY3Rpb24oc3VwZXJjbGFzcyl7XG4gIHZhciBwcm90b3R5cGUgPSBleHRlbmQkKChpbXBvcnQkKFBob3RvQ3JvcHBlciwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnUGhvdG9Dcm9wcGVyJywgUGhvdG9Dcm9wcGVyKSwgc3VwZXJjbGFzcykucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IFBob3RvQ3JvcHBlcjtcbiAgUGhvdG9Dcm9wcGVyLnBjID0gbnVsbDtcbiAgUGhvdG9Dcm9wcGVyLnN0YXJ0ID0gZnVuY3Rpb24oYXJnJCwgY2Ipe1xuICAgIHZhciByZWYkLCB0aXRsZSwgcmVmMSQsIG1vZGUsIHBob3RvLCBhc3BlY3RSYXRpbywgZW5kcG9pbnRVcmw7XG4gICAgcmVmJCA9IGFyZyQgIT0gbnVsbFxuICAgICAgPyBhcmckXG4gICAgICA6IHt9LCB0aXRsZSA9IChyZWYxJCA9IHJlZiQudGl0bGUpICE9IG51bGwgPyByZWYxJCA6IFwiUHJvZmlsZSBQaG90b1wiLCBtb2RlID0gKHJlZjEkID0gcmVmJC5tb2RlKSAhPSBudWxsID8gcmVmMSQgOiAndXBsb2FkJywgcGhvdG8gPSAocmVmMSQgPSByZWYkLnBob3RvKSAhPSBudWxsID8gcmVmMSQgOiBudWxsLCBhc3BlY3RSYXRpbyA9IChyZWYxJCA9IHJlZiQuYXNwZWN0UmF0aW8pICE9IG51bGxcbiAgICAgID8gcmVmMSRcbiAgICAgIDogMSAvIDEsIGVuZHBvaW50VXJsID0gKHJlZjEkID0gcmVmJC5lbmRwb2ludFVybCkgIT0gbnVsbCA/IHJlZjEkIDogbnVsbDtcbiAgICBjYiA9PSBudWxsICYmIChjYiA9IGZ1bmN0aW9uKCl7fSk7XG4gICAgaWYgKCFwaG90bykge1xuICAgICAgcGhvdG8gPSB1c2VyLnBob3RvO1xuICAgIH1cbiAgICBpZiAoIWVuZHBvaW50VXJsKSB7XG4gICAgICBlbmRwb2ludFVybCA9IFwiL3Jlc291cmNlcy91c2Vycy9cIiArIHVzZXIuaWQgKyBcIi9hdmF0YXJcIjtcbiAgICB9XG4gICAgcmV0dXJuIGxhenlMb2FkRmFuY3lib3goZnVuY3Rpb24oKXtcbiAgICAgIFBob3RvQ3JvcHBlci5wYyA9IG5ldyBQaG90b0Nyb3BwZXIoe1xuICAgICAgICBhc3BlY3RSYXRpbzogYXNwZWN0UmF0aW8sXG4gICAgICAgIGVuZHBvaW50VXJsOiBlbmRwb2ludFVybCxcbiAgICAgICAgbG9jYWxzOiB7XG4gICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgIHBob3RvOiBwaG90byxcbiAgICAgICAgICBlbmRwb2ludFVybDogZW5kcG9pbnRVcmxcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAobW9kZSA9PT0gJ2Nyb3AnKSB7XG4gICAgICAgIFBob3RvQ3JvcHBlci5wYy5jcm9wTW9kZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuICQuZmFuY3lib3gub3BlbihQaG90b0Nyb3BwZXIucGMuJCwge1xuICAgICAgICBhZnRlckxvYWQ6IGNiXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgZnVuY3Rpb24gUGhvdG9Dcm9wcGVyKGFyZyQpe1xuICAgIHZhciB0aXRsZSwgYXNwZWN0UmF0aW87XG4gICAgdGl0bGUgPSBhcmckLnRpdGxlLCBhc3BlY3RSYXRpbyA9IGFyZyQuYXNwZWN0UmF0aW8sIHRoaXMuZW5kcG9pbnRVcmwgPSBhcmckLmVuZHBvaW50VXJsO1xuICAgIHRoaXMuY3JvcCA9IGJpbmQkKHRoaXMsICdjcm9wJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLmFzcGVjdFJhdGlvID0gcGFyc2VGbG9hdChhc3BlY3RSYXRpbyk7XG4gICAgUGhvdG9Dcm9wcGVyLnN1cGVyY2xhc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuICBwcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZXMuUGhvdG9Dcm9wcGVyO1xuICBwcm90b3R5cGUuamNyb3AgPSBudWxsO1xuICBwcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCl7XG4gICAgaWYgKHRoaXMuYXNwZWN0UmF0aW8pIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9XG4gIH07XG4gIHByb3RvdHlwZS5vbkF0dGFjaCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICB0aGlzLiQuZmluZCgnLnVwbG9hZCBpbnB1dFt0eXBlPWZpbGVdJykuaHRtbDVVcGxvYWRlcih7XG4gICAgICBuYW1lOiAnYXZhdGFyJyxcbiAgICAgIHBvc3RVcmw6IHRoaXMuZW5kcG9pbnRVcmwsXG4gICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKHhociwgZmlsZSwgckpzb24pe1xuICAgICAgICB2YXIgcjtcbiAgICAgICAgciA9IEpTT04ucGFyc2Uockpzb24pO1xuICAgICAgICB0aGlzJC4kLmZpbmQoJ2ltZycpLmF0dHIoJ3NyYycsIGNhY2hlVXJsICsgXCJcIiArIHIudXJsKTtcbiAgICAgICAgcmV0dXJuIHRoaXMkLmNyb3BNb2RlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuJC5maW5kKCcuY3JvcCAuYnV0dG9uJykuY2xpY2sodGhpcy5jcm9wKTtcbiAgfTtcbiAgcHJvdG90eXBlLnVwbG9hZCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRhdGEsIGpxeGhyLCB0aGlzJCA9IHRoaXM7XG4gICAgZGF0YSA9IHRoaXMuJC5maW5kKCdmb3JtJykuc2VyaWFsaXplKCk7XG4gICAganF4aHIgPSBjb25zdHJ1Y3Rvci4kLnBvc3QodGhpcy5lbmRwb2ludFVybCwgZGF0YSk7XG4gICAganF4aHIuZG9uZShmdW5jdGlvbihyKXtcbiAgICAgIHJldHVybiB0aGlzJC5jcm9wTW9kZShyKTtcbiAgICB9KTtcbiAgICByZXR1cm4ganF4aHIuZmFpbChmdW5jdGlvbihyKXtcbiAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ3VwbG9hZCBmYWlsZWQnLCByKTtcbiAgICB9KTtcbiAgfTtcbiAgcHJvdG90eXBlLnVwbG9hZE1vZGUgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuJC5maW5kKCcuY3JvcCcpLmhpZGUoKTtcbiAgICByZXR1cm4gdGhpcy4kLmZpbmQoJy51cGxvYWQnKS5zaG93KCk7XG4gIH07XG4gIHByb3RvdHlwZS5jcm9wTW9kZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHRoaXMkID0gdGhpcztcbiAgICB0aGlzLiQuZmluZCgnLnVwbG9hZCcpLmhpZGUoKTtcbiAgICB0aGlzLiQuZmluZCgnLmNyb3AnKS5zaG93KCk7XG4gICAgcmV0dXJuIGxhenlMb2FkSmNyb3AoZnVuY3Rpb24oKXtcbiAgICAgIHZhciBvcHRpb25zLCBmYiwgc2F2ZUpjcm9wO1xuICAgICAgaWYgKHRoaXMkLmpjcm9wKSB7XG4gICAgICAgIHRoaXMkLmpjcm9wLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIGFzcGVjdFJhdGlvOiB0aGlzJC5hc3BlY3RSYXRpb1xuICAgICAgfTtcbiAgICAgIGltcG9ydCQob3B0aW9ucywgdGhpcyQuYm94RGltZW5zaW9ucygpKTtcbiAgICAgIGZiID0gY29uc3RydWN0b3IuJC5mYW5jeWJveDtcbiAgICAgIHNhdmVKY3JvcCA9IGZ1bmN0aW9uKGope1xuICAgICAgICByZXR1cm4gdGhpcyQuamNyb3AgPSBqO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB0aGlzJC4kLmZpbmQoJy5jcm9wIGltZycpLkpjcm9wKG9wdGlvbnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHNhdmVKY3JvcCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGZiLnVwZGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIHByb3RvdHlwZS5ib3hEaW1lbnNpb25zID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZmFuY3lib3hTaWRlTWFyZ2luLCByZXNpemU7XG4gICAgZmFuY3lib3hTaWRlTWFyZ2luID0gMzU7XG4gICAgcmVzaXplID0gMC45NTtcbiAgICByZXR1cm4ge1xuICAgICAgYm94V2lkdGg6IHBhcnNlSW50KGNvbnN0cnVjdG9yLiQod2luZG93KS53aWR0aCgpIC0gZmFuY3lib3hTaWRlTWFyZ2luICogMiksXG4gICAgICBib3hIZWlnaHQ6IHBhcnNlSW50KGNvbnN0cnVjdG9yLiQod2luZG93KS5oZWlnaHQoKSAqIHJlc2l6ZSlcbiAgICB9O1xuICB9O1xuICBwcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uKGV2KXtcbiAgICB2YXIgZGF0YSwganF4aHIsIHRoaXMkID0gdGhpcztcbiAgICBkYXRhID0gdGhpcy5qY3JvcC50ZWxsU2VsZWN0KCk7XG4gICAgaWYgKGRhdGEuaGVpZ2h0ID09PSAwIHx8IGRhdGEud2lkdGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAganF4aHIgPSBjb25zdHJ1Y3Rvci4kLmFqYXgoe1xuICAgICAgdHlwZTogJ1BVVCcsXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgdXJsOiB0aGlzLmVuZHBvaW50VXJsXG4gICAgfSk7XG4gICAganF4aHIuZG9uZShmdW5jdGlvbihyKXtcbiAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci4kLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGpxeGhyLmZhaWwoZnVuY3Rpb24ocil7XG4gICAgICByZXR1cm4gY29uc29sZS53YXJuKCd1cGxvYWQgZmFpbGVkJywgcik7XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBQaG90b0Nyb3BwZXI7XG59KENvbXBvbmVudCkpO1xuZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG59XG5mdW5jdGlvbiBleHRlbmQkKHN1Yiwgc3VwKXtcbiAgZnVuY3Rpb24gZnVuKCl7fSBmdW4ucHJvdG90eXBlID0gKHN1Yi5zdXBlcmNsYXNzID0gc3VwKS5wcm90b3R5cGU7XG4gIChzdWIucHJvdG90eXBlID0gbmV3IGZ1bikuY29uc3RydWN0b3IgPSBzdWI7XG4gIGlmICh0eXBlb2Ygc3VwLmV4dGVuZGVkID09ICdmdW5jdGlvbicpIHN1cC5leHRlbmRlZChzdWIpO1xuICByZXR1cm4gc3ViO1xufVxuZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgcmV0dXJuIG9iajtcbn0iLCJ2YXIgQ29tcG9uZW50LCBjaCwgdGVtcGxhdGVzLCBBdXRoO1xuQ29tcG9uZW50ID0gcmVxdWlyZSgneWFjb21wb25lbnQnKTtcbmNoID0gcmVxdWlyZSgnLi4vYXBwL2NsaWVudC1oZWxwZXJzLmxzJyk7XG50ZW1wbGF0ZXMgPSByZXF1aXJlKCcuLi9idWlsZC9jb21wb25lbnQtamFkZS5qcycpLnRlbXBsYXRlcztcbm1vZHVsZS5leHBvcnRzID0gQXV0aCA9IChmdW5jdGlvbihzdXBlcmNsYXNzKXtcbiAgdmFyIHByb3RvdHlwZSA9IGV4dGVuZCQoKGltcG9ydCQoQXV0aCwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnQXV0aCcsIEF1dGgpLCBzdXBlcmNsYXNzKS5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gQXV0aDtcbiAgcHJvdG90eXBlLmNvbXBvbmVudE5hbWUgPSAnQXV0aCc7XG4gIHByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlcy5BdXRoO1xuICBBdXRoLnNob3dMb2dpbkRpYWxvZyA9IGZ1bmN0aW9uKGNiKXtcbiAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgIGNiID09IG51bGwgJiYgKGNiID0gZnVuY3Rpb24oKXt9KTtcbiAgICByZXR1cm4gY2gubGF6eUxvYWRGYW5jeWJveChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGNoLmxhenlMb2FkKGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB3aW5kb3cuJC5mbi5jb21wbGV4aWZ5O1xuICAgICAgfSwgd2luZG93LmNhY2hlVXJsICsgXCIvbG9jYWwvanF1ZXJ5LmNvbXBsZXhpZnkubWluLmpzXCIsIG51bGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICghd2luZG93Ll9hdXRoKSB7XG4gICAgICAgICAgd2luZG93Ll9hdXRoID0gbmV3IEF1dGgoe1xuICAgICAgICAgICAgbG9jYWxzOiB7XG4gICAgICAgICAgICAgIHNpdGVOYW1lOiB3aW5kb3cuc2l0ZU5hbWUsXG4gICAgICAgICAgICAgIGludml0ZU9ubHk6IHdpbmRvdy5pbnZpdGVPbmx5XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgJCgnI2F1dGgnKSk7XG4gICAgICAgICAgaWYgKEF1dGguYWZ0ZXJMb2dpbikge1xuICAgICAgICAgICAgd2luZG93Ll9hdXRoLmFmdGVyTG9naW4gPSBBdXRoLmFmdGVyTG9naW47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghJCgnLmZhbmN5Ym94LW92ZXJsYXk6dmlzaWJsZScpLmxlbmd0aCkge1xuICAgICAgICAgICQuZmFuY3lib3gub3BlbignI2F1dGgnLCB3aW5kb3cuZmFuY3lib3hQYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gJCgnI2F1dGggaW5wdXRbbmFtZT11c2VybmFtZV0nKS5mb2N1cygpO1xuICAgICAgICB9LCAxMDApO1xuICAgICAgICB3aW5kb3cuQ09NUExFWElGWV9CQU5MSVNUID0gWydnb2QnLCAnbW9uZXknLCAncGFzc3dvcmQnLCAnbG92ZSddO1xuICAgICAgICAkKCcjYXV0aCBbbmFtZT1cInBhc3N3b3JkXCJdJykuY29tcGxleGlmeSh7fSwgZnVuY3Rpb24ocGFzcywgcGVyY2VudCl7XG4gICAgICAgICAgdmFyIGU7XG4gICAgICAgICAgZSA9ICQodGhpcykucGFyZW50KCk7XG4gICAgICAgICAgZS5maW5kKCcuc3RyZW5ndGgtbWV0ZXInKS50b2dnbGVDbGFzcygnc3Ryb25nJywgcGFzcyk7XG4gICAgICAgICAgcmV0dXJuIGUuZmluZCgnLnN0cmVuZ3RoJykuY3NzKHtcbiAgICAgICAgICAgIGhlaWdodDogcGFyc2VJbnQocGVyY2VudCkgKyAnJSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjYih3aW5kb3cuX2F1dGguJCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgQXV0aC5zaG93SW5mb0RpYWxvZyA9IGZ1bmN0aW9uKG1zZywgbXNnMiwgcmVtb3ZlLCBjYil7XG4gICAgbXNnMiA9PSBudWxsICYmIChtc2cyID0gJycpO1xuICAgIHJlbW92ZSA9PSBudWxsICYmIChyZW1vdmUgPSAnJyk7XG4gICAgY2IgPT0gbnVsbCAmJiAoY2IgPSBmdW5jdGlvbigpe30pO1xuICAgIHJldHVybiBBdXRoLnNob3dMb2dpbkRpYWxvZyhmdW5jdGlvbigpe1xuICAgICAgdmFyIGZiO1xuICAgICAgZmIgPSAkKCcuZmFuY3lib3gtd3JhcDpmaXJzdCcpO1xuICAgICAgZmIuZmluZCgnI21zZycpLmh0bWwobXNnKTtcbiAgICAgIGZiLmZpbmQoJy5kaWFsb2cgLm1zZzInKS5odG1sKG1zZzIpO1xuICAgICAgY2guc3dpdGNoQW5kRm9jdXMocmVtb3ZlLCAnb24tZGlhbG9nJywgJycpO1xuICAgICAgcmV0dXJuIGNiKHdpbmRvdy5fYXV0aC4kKTtcbiAgICB9KTtcbiAgfTtcbiAgQXV0aC5zaG93UmVnaXN0ZXJEaWFsb2cgPSBmdW5jdGlvbihyZW1vdmUsIGNiKXtcbiAgICByZW1vdmUgPT0gbnVsbCAmJiAocmVtb3ZlID0gJycpO1xuICAgIGNiID09IG51bGwgJiYgKGNiID0gZnVuY3Rpb24oKXt9KTtcbiAgICByZXR1cm4gQXV0aC5zaG93TG9naW5EaWFsb2coZnVuY3Rpb24oKXtcbiAgICAgIGNoLnN3aXRjaEFuZEZvY3VzKHJlbW92ZSwgJ29uLXJlZ2lzdGVyJywgJy5yZWdpc3RlciBpbnB1dDpmaXJzdCcpO1xuICAgICAgcmV0dXJuIGNiKHdpbmRvdy5fYXV0aC4kKTtcbiAgICB9KTtcbiAgfTtcbiAgQXV0aC5zaG93UmVzZXRQYXNzd29yZERpYWxvZyA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIEF1dGguc2hvd0xvZ2luRGlhbG9nKGZ1bmN0aW9uKCRhdXRoKXtcbiAgICAgIHZhciAkZm9ybSwgaGFzaDtcbiAgICAgICRmb3JtID0gJGF1dGguZmluZCgnLnJlc2V0IGZvcm0nKTtcbiAgICAgIGNoLnN3aXRjaEFuZEZvY3VzKCcnLCAnb24tcmVzZXQnLCAnI2F1dGggLnJlc2V0IGlucHV0OmZpcnN0Jyk7XG4gICAgICBoYXNoID0gbG9jYXRpb24uaGFzaC5zcGxpdCgnPScpWzFdO1xuICAgICAgJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1oaWRkZW5dJykudmFsKGhhc2gpO1xuICAgICAgY29uc29sZS5sb2coaGFzaCwgJGZvcm0sICRhdXRoKTtcbiAgICAgIHJldHVybiAkLnBvc3QoJy9hdXRoL2ZvcmdvdC11c2VyJywge1xuICAgICAgICBmb3Jnb3Q6IGhhc2hcbiAgICAgIH0sIGZ1bmN0aW9uKHIpe1xuICAgICAgICBpZiAoci5zdWNjZXNzKSB7XG4gICAgICAgICAgJGZvcm0uZmluZCgnaDI6Zmlyc3QnKS5odG1sKCdDaG9vc2UgYSBOZXcgUGFzc3dvcmQnKTtcbiAgICAgICAgICByZXR1cm4gJGZvcm0uZmluZCgnaW5wdXQnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gJGZvcm0uZmluZCgnaDI6Zmlyc3QnKS5odG1sKFwiQ291bGRuJ3QgZmluZCB5b3UuIDooXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgQXV0aC5sb2dpbldpdGhUb2tlbiA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIGNvcnMuZ2V0KGF1dGhEb21haW4gKyBcIi9hdXRoL29uY2VcIiwge1xuICAgICAgc2l0ZV9pZDogd2luZG93LnNpdGVJZFxuICAgIH0sIGZ1bmN0aW9uKHIpe1xuICAgICAgaWYgKHIpIHtcbiAgICAgICAgcmV0dXJuICQucG9zdCgnL2F1dGgvb25jZScsIHtcbiAgICAgICAgICB0b2tlbjogci50b2tlblxuICAgICAgICB9LCBmdW5jdGlvbihycil7XG4gICAgICAgICAgaWYgKHJyLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIEF1dGguYWZ0ZXJMb2dpbigpO1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyc7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgQXV0aC5yZXF1aXJlTG9naW4gPSBmdW5jdGlvbihmbil7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICBpZiAod2luZG93LnVzZXIpIHtcbiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHdpbmRvdywgYXJndW1lbnRzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEF1dGguc2hvd0xvZ2luRGlhbG9nKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuICBBdXRoLnJlcXVpcmVSZWdpc3RyYXRpb24gPSBmdW5jdGlvbihmbil7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICBpZiAod2luZG93LnVzZXIpIHtcbiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHdpbmRvdywgYXJndW1lbnRzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEF1dGguc2hvd1JlZ2lzdGVyRGlhbG9nKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuICBmdW5jdGlvbiBBdXRoKCl7XG4gICAgdGhpcy5jaG9vc2UgPSBiaW5kJCh0aGlzLCAnY2hvb3NlJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnRvZ2dsZVBhc3N3b3JkID0gYmluZCQodGhpcywgJ3RvZ2dsZVBhc3N3b3JkJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnJlc2VuZCA9IGJpbmQkKHRoaXMsICdyZXNlbmQnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMucmVzZXRQYXNzd29yZCA9IGJpbmQkKHRoaXMsICdyZXNldFBhc3N3b3JkJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLmZvcmdvdFBhc3N3b3JkID0gYmluZCQodGhpcywgJ2ZvcmdvdFBhc3N3b3JkJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLnJlZ2lzdGVyID0gYmluZCQodGhpcywgJ3JlZ2lzdGVyJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLmFmdGVyTG9naW4gPSBiaW5kJCh0aGlzLCAnYWZ0ZXJMb2dpbicsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5sb2dpbiA9IGJpbmQkKHRoaXMsICdsb2dpbicsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5vbkRldGFjaCA9IGJpbmQkKHRoaXMsICdvbkRldGFjaCcsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5vbkF0dGFjaCA9IGJpbmQkKHRoaXMsICdvbkF0dGFjaCcsIHByb3RvdHlwZSk7XG4gICAgQXV0aC5zdXBlcmNsYXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cbiAgcHJvdG90eXBlLm9uQXR0YWNoID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLiQuZmluZCgnLnNvY2lhbCBhJykuY2xpY2sodGhpcy5vcGVuT2F1dGhXaW5kb3cpO1xuICAgIHRoaXMuJC5vbignc3VibWl0JywgJy5sb2dpbiBmb3JtJywgdGhpcy5sb2dpbik7XG4gICAgdGhpcy4kLm9uKCdzdWJtaXQnLCAnLnJlZ2lzdGVyIGZvcm0nLCB0aGlzLnJlZ2lzdGVyKTtcbiAgICB0aGlzLiQub24oJ3N1Ym1pdCcsICcuZm9yZ290IGZvcm0nLCB0aGlzLmZvcmdvdFBhc3N3b3JkKTtcbiAgICB0aGlzLiQub24oJ3N1Ym1pdCcsICcucmVzZXQgZm9ybScsIHRoaXMucmVzZXRQYXNzd29yZCk7XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICcudG9nZ2xlLXBhc3N3b3JkJywgdGhpcy50b2dnbGVQYXNzd29yZCk7XG4gICAgdGhpcy4kLm9uKCdzdWJtaXQnLCAnLmNob29zZSBmb3JtJywgdGhpcy5jaG9vc2UpO1xuICAgIHRoaXMuJC5vbignY2xpY2snLCAnLmRpYWxvZyBhLnJlc2VuZCcsIHRoaXMucmVzZW5kKTtcbiAgICB0aGlzLiQub24oJ2NsaWNrJywgJy5vbmNsaWNrLWNsb3NlLWZhbmN5Ym94JywgZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgfSk7XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICcub25jbGljay1zaG93LWxvZ2luJywgZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBjaC5zd2l0Y2hBbmRGb2N1cygnb24tZm9yZ290IG9uLXJlZ2lzdGVyIG9uLXJlc2V0JywgJ29uLWxvZ2luJywgJyNhdXRoIGlucHV0W25hbWU9dXNlcm5hbWVdJyk7XG4gICAgfSk7XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICcub25jbGljay1zaG93LWZvcmdvdCcsIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gY2guc3dpdGNoQW5kRm9jdXMoJ29uLWVycm9yJywgJ29uLWZvcmdvdCcsICcjYXV0aCBpbnB1dFtuYW1lPWVtYWlsXScpO1xuICAgIH0pO1xuICAgIHRoaXMuJC5vbignY2xpY2snLCAnLm9uY2xpY2stc2hvdy1jaG9vc2UnLCBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGNoLnN3aXRjaEFuZEZvY3VzKCdvbi1sb2dpbicsICdvbi1jaG9vc2UnLCAnI2F1dGggaW5wdXRbbmFtZT11c2VybmFtZV0nKTtcbiAgICB9KTtcbiAgICB0aGlzLiQub24oJ2NsaWNrJywgJy5vbmNsaWNrLXNob3ctcmVnaXN0ZXInLCBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGNoLnN3aXRjaEFuZEZvY3VzKCdvbi1sb2dpbicsICdvbi1yZWdpc3RlcicsICcjYXV0aCBpbnB1dFtuYW1lPXVzZXJuYW1lXScpO1xuICAgIH0pO1xuICAgIHRoaXMuJC5vbigna2V5dXAnLCAnLmZhbmN5Ym94LWlubmVyIGlucHV0JywgZnVuY3Rpb24oaXQpe1xuICAgICAgaWYgKGl0LndoaWNoID09PSAyNykge1xuICAgICAgICAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcHJvdG90eXBlLm9uRGV0YWNoID0gZnVuY3Rpb24oKXt9O1xuICBwcm90b3R5cGUub3Blbk9hdXRoV2luZG93ID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciB1cmw7XG4gICAgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG4gICAgd2luZG93Lm9wZW4odXJsLCAncG9wdXAnLCBcIndpZHRoPTk4MCxoZWlnaHQ9NjUwLHNjcm9sbGJhcnM9bm8sdG9vbGJhcj1ubyxsb2NhdGlvbj1ubyxkaXJlY3Rvcmllcz1ubyxzdGF0dXM9bm8sbWVudWJhcj1ub1wiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIHByb3RvdHlwZS5sb2dpbiA9IGZ1bmN0aW9uKGV2KXtcbiAgICB2YXIgJGZvcm0sIHUsIHAsIHMsIHBhcmFtcywgdGhpcyQgPSB0aGlzO1xuICAgICRmb3JtID0gJChldi50YXJnZXQpO1xuICAgIHUgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPXVzZXJuYW1lXScpO1xuICAgIHAgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPXBhc3N3b3JkXScpO1xuICAgIHMgPSAkZm9ybS5maW5kKCdpbnB1dFt0eXBlPXN1Ym1pdF0nKTtcbiAgICBwYXJhbXMgPSB7XG4gICAgICB1c2VybmFtZTogdS52YWwoKSxcbiAgICAgIHBhc3N3b3JkOiBwLnZhbCgpXG4gICAgfTtcbiAgICBzLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgJC5wb3N0KCRmb3JtLmF0dHIoJ2FjdGlvbicpLCBwYXJhbXMsIGZ1bmN0aW9uKHIpe1xuICAgICAgdmFyIHJlc2VuZCwgJGZhbmN5Ym94O1xuICAgICAgaWYgKHIuc3VjY2Vzcykge1xuICAgICAgICAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgICAgIGlmICh0aGlzJC5hZnRlckxvZ2luKSB7XG4gICAgICAgICAgdGhpcyQuYWZ0ZXJMb2dpbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbml0aWFsTXV0YW50ID09PSAncHJpdmF0ZVNpdGUnKSB7XG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoci50eXBlID09PSAndW52ZXJpZmllZC11c2VyJykge1xuICAgICAgICAgIHJlc2VuZCA9IFwiVG8gcmVzZW5kIHlvdXIgdmVyaWZpY2F0aW9uIGVtYWlsLCA8YSBjbGFzcz1cXFwicmVzZW5kXFxcIiBkYXRhLWVtYWlsPVxcXCJcIiArIHIuZW1haWwgKyBcIlxcXCI+Y2xpY2sgaGVyZTwvYT4uXCI7XG4gICAgICAgICAgY29uc3RydWN0b3Iuc2hvd0luZm9EaWFsb2coJ1BsZWFzZSB2ZXJpZnkgeW91ciBhY2NvdW50IGZpcnN0LicsIHJlc2VuZCwgJ29uLWxvZ2luJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGZhbmN5Ym94ID0gJGZvcm0ucGFyZW50cygnLmZhbmN5Ym94LXdyYXA6Zmlyc3QnKTtcbiAgICAgICAgICAkZmFuY3lib3guYWRkQ2xhc3MoJ29uLWVycm9yJyk7XG4gICAgICAgICAgJGZhbmN5Ym94LnJlbW92ZUNsYXNzKCdzaGFrZScpO1xuICAgICAgICAgIGNoLnNob3dUb29sdGlwKCRmb3JtLmZpbmQoJy50b29sdGlwJyksICdUcnkgYWdhaW4hJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJGZhbmN5Ym94LmFkZENsYXNzKCdzaGFrZScpO1xuICAgICAgICAgICAgcmV0dXJuIHUuZm9jdXMoKTtcbiAgICAgICAgICB9LCAxMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBzLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBwcm90b3R5cGUuYWZ0ZXJMb2dpbiA9IGZ1bmN0aW9uKCl7fTtcbiAgcHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciAkZm9ybSwgcywgdGhpcyQgPSB0aGlzO1xuICAgICRmb3JtID0gJChldi50YXJnZXQpO1xuICAgICRmb3JtLmZpbmQoJ2lucHV0JykucmVtb3ZlQ2xhc3MoJ3ZhbGlkYXRpb24tZXJyb3InKTtcbiAgICBzID0gJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1zdWJtaXRdJyk7XG4gICAgcy5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICQucG9zdCgkZm9ybS5hdHRyKCdhY3Rpb24nKSwgJGZvcm0uc2VyaWFsaXplKCksIGZ1bmN0aW9uKHIpe1xuICAgICAgdmFyIG1zZ3MsIHJlZiQ7XG4gICAgICBpZiAoci5zdWNjZXNzKSB7XG4gICAgICAgICRmb3JtLmZpbmQoXCJpbnB1dDp0ZXh0LGlucHV0OnBhc3N3b3JkXCIpLnJlbW92ZUNsYXNzKCd2YWxpZGF0aW9uLWVycm9yJykudmFsKCcnKTtcbiAgICAgICAgY2guc3dpdGNoQW5kRm9jdXMoJ29uLXJlZ2lzdGVyJywgJ29uLWRpYWxvZycsICcnKTtcbiAgICAgICAgQXV0aC5hZnRlckxvZ2luKCk7XG4gICAgICAgIEF1dGguc2hvd0luZm9EaWFsb2coXCJXZWxjb21lIHRvIFwiICsgc2l0ZU5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbXNncyA9IFtdO1xuICAgICAgICBpZiAoKHJlZiQgPSByLmVycm9ycykgIT0gbnVsbCkge1xuICAgICAgICAgIHJlZiQuZm9yRWFjaChmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIHZhciAkZTtcbiAgICAgICAgICAgICRlID0gJGZvcm0uZmluZChcImlucHV0W25hbWU9XCIgKyBlLnBhcmFtICsgXCJdXCIpO1xuICAgICAgICAgICAgJGUuYWRkQ2xhc3MoJ3ZhbGlkYXRpb24tZXJyb3InKS5mb2N1cygpO1xuICAgICAgICAgICAgcmV0dXJuIG1zZ3MucHVzaChlLm1zZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2guc2hvd1Rvb2x0aXAoJGZvcm0uZmluZCgnLnRvb2x0aXAnKSwgdW5pcXVlKG1zZ3MpLmpvaW4oJzxicj4nKSk7XG4gICAgICAgIHNoYWtlRGlhbG9nKCRmb3JtLCAxMDApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHMucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIHByb3RvdHlwZS5mb3Jnb3RQYXNzd29yZCA9IGZ1bmN0aW9uKGV2KXtcbiAgICB2YXIgJGZvcm0sIHMsIHRoaXMkID0gdGhpcztcbiAgICAkZm9ybSA9ICQoZXYudGFyZ2V0KTtcbiAgICBzID0gJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1zdWJtaXRdJyk7XG4gICAgcy5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICQucG9zdCgkZm9ybS5hdHRyKCdhY3Rpb24nKSwgJGZvcm0uc2VyaWFsaXplKCksIGZ1bmN0aW9uKHIpe1xuICAgICAgdmFyIG1zZywgcmVmJCwgcmVmMSQ7XG4gICAgICBpZiAoci5zdWNjZXNzKSB7XG4gICAgICAgIEF1dGguc2hvd0luZm9EaWFsb2coJ0NoZWNrIHlvdXIgaW5ib3ggZm9yIHJlc2V0IGxpbmshJywgJycsICdvbi1mb3Jnb3QnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRmb3JtLmZpbmQoJ2lucHV0OmZpcnN0JykuZm9jdXMoKTtcbiAgICAgICAgbXNnID0gKChyZWYkID0gci5lcnJvcnMpICE9IG51bGwgPyAocmVmMSQgPSByZWYkWzBdKSAhPSBudWxsID8gcmVmMSQubmFtZSA6IHZvaWQgOCA6IHZvaWQgOCkgfHwgKChyZWYkID0gci5lcnJvcnMpICE9IG51bGwgPyAocmVmMSQgPSByZWYkWzBdKSAhPSBudWxsID8gcmVmMSQubXNnIDogdm9pZCA4IDogdm9pZCA4KSB8fCAnVW5hYmxlIHRvIGZpbmQgeW91JztcbiAgICAgICAgY2guc2hvd1Rvb2x0aXAoJGZvcm0uZmluZCgnLnRvb2x0aXAnKSwgbXNnKTtcbiAgICAgICAgc2hha2VEaWFsb2coJGZvcm0sIDEwMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcy5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgcHJvdG90eXBlLnJlc2V0UGFzc3dvcmQgPSBmdW5jdGlvbihldil7XG4gICAgdmFyICRmb3JtLCBwYXNzd29yZCwgcywgdGhpcyQgPSB0aGlzO1xuICAgICRmb3JtID0gJChldi50YXJnZXQpO1xuICAgIHBhc3N3b3JkID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1wYXNzd29yZF0nKS52YWwoKTtcbiAgICBpZiAocGFzc3dvcmQubWF0Y2goL15cXHMqJC8pKSB7XG4gICAgICBjaC5zaG93VG9vbHRpcCgkZm9ybS5maW5kKCcudG9vbHRpcCcpLCBcIlBhc3N3b3JkIG1heSBub3QgYmUgYmxhbmtcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHMgPSAkZm9ybS5maW5kKCdpbnB1dFt0eXBlPXN1Ym1pdF0nKTtcbiAgICBzLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgJC5wb3N0KCRmb3JtLmF0dHIoJ2FjdGlvbicpLCAkZm9ybS5zZXJpYWxpemUoKSwgZnVuY3Rpb24ocil7XG4gICAgICBpZiAoci5zdWNjZXNzKSB7XG4gICAgICAgICRmb3JtLmZpbmQoJ2lucHV0JykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgY2guc2hvd1Rvb2x0aXAoJGZvcm0uZmluZCgnLnRvb2x0aXAnKSwgXCJQYXNzd29yZCBjaGFuZ2VkIVwiKTtcbiAgICAgICAgbG9jYXRpb24uaGFzaCA9ICcnO1xuICAgICAgICAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPXBhc3N3b3JkXScpLnZhbCgnJyk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICBjaC5zd2l0Y2hBbmRGb2N1cygnb24tcmVzZXQnLCAnb24tbG9naW4nLCAnI2F1dGggLmxvZ2luIGlucHV0OmZpcnN0Jyk7XG4gICAgICAgICAgcmV0dXJuIGNoLnNob3dUb29sdGlwKCQoJyNhdXRoIC5sb2dpbiBmb3JtIC50b29sdGlwJyksIFwiTm93IGxvZyBpbiFcIik7XG4gICAgICAgIH0sIDE1MDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2guc2hvd1Rvb2x0aXAoJGZvcm0uZmluZCgnLnRvb2x0aXAnKSwgXCJDaG9vc2UgYSBiZXR0ZXIgcGFzc3dvcmRcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcy5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgcHJvdG90eXBlLnJlc2VuZCA9IGZ1bmN0aW9uKGV2KXtcbiAgICB2YXIgZW1haWw7XG4gICAgZW1haWwgPSAkKCcuZGlhbG9nIGEucmVzZW5kJykuZGF0YSgnZW1haWwnKTtcbiAgICByZXR1cm4gJC5wb3N0KCcvYXV0aC9yZXNlbmQnLCB7XG4gICAgICBlbWFpbDogZW1haWxcbiAgICB9LCBmdW5jdGlvbihyKXtcbiAgICAgIGlmIChyLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIGNvbnN0cnVjdG9yLnNob3dJbmZvRGlhbG9nKCdWZXJpZmljYXRpb24gZW1haWwgc2VudCBhZ2Fpbi4nLCAnUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwuICBJdCBtaWdodCBiZSBpbiB5b3VyIHNwYW0uJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gY29uc3RydWN0b3Iuc2hvd0luZm9EaWFsb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gc2VuZGluZyB0aGUgZW1haWwnLCAnUGxlYXNlIHRyeSBhZ2Fpbi4nKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcHJvdG90eXBlLnRvZ2dsZVBhc3N3b3JkID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciBlLCBwO1xuICAgIGUgPSAkKGV2LnRhcmdldCk7XG4gICAgcCA9IGUucHJldignW25hbWU9cGFzc3dvcmRdJyk7XG4gICAgaWYgKHAuYXR0cigndHlwZScpID09PSAncGFzc3dvcmQnKSB7XG4gICAgICBlLmh0bWwoJ0hpZGUnKTtcbiAgICAgIHAuYXR0cigndHlwZScsICd0ZXh0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGUuaHRtbCgnU2hvdycpO1xuICAgICAgcC5hdHRyKCd0eXBlJywgJ3Bhc3N3b3JkJyk7XG4gICAgfVxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBwLmZvY3VzKCk7XG4gICAgfSwgMTApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgcHJvdG90eXBlLmNob29zZSA9IGZ1bmN0aW9uKGV2KXtcbiAgICB2YXIgJGZvcm0sIHMsIHRoaXMkID0gdGhpcztcbiAgICAkZm9ybSA9ICQoZXYudGFyZ2V0KTtcbiAgICBzID0gJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1zdWJtaXRdJyk7XG4gICAgcy5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICQucG9zdCgkZm9ybS5hdHRyKCdhY3Rpb24nKSwgJGZvcm0uc2VyaWFsaXplKCksIGZ1bmN0aW9uKHIpe1xuICAgICAgaWYgKHIuc3VjY2Vzcykge1xuICAgICAgICAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgICAgIHRoaXMkLmFmdGVyTG9naW4oKTtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRmb3JtLmZpbmQoJ2lucHV0OmZpcnN0JykuZm9jdXMoKTtcbiAgICAgICAgY2guc2hvd1Rvb2x0aXAoJGZvcm0uZmluZCgnLnRvb2x0aXAnKSwgci5tc2cpO1xuICAgICAgICBzaGFrZURpYWxvZygkZm9ybSwgMTAwKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICByZXR1cm4gQXV0aDtcbn0oQ29tcG9uZW50KSk7XG5mdW5jdGlvbiBiaW5kJChvYmosIGtleSwgdGFyZ2V0KXtcbiAgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiAodGFyZ2V0IHx8IG9iailba2V5XS5hcHBseShvYmosIGFyZ3VtZW50cykgfTtcbn1cbmZ1bmN0aW9uIGV4dGVuZCQoc3ViLCBzdXApe1xuICBmdW5jdGlvbiBmdW4oKXt9IGZ1bi5wcm90b3R5cGUgPSAoc3ViLnN1cGVyY2xhc3MgPSBzdXApLnByb3RvdHlwZTtcbiAgKHN1Yi5wcm90b3R5cGUgPSBuZXcgZnVuKS5jb25zdHJ1Y3RvciA9IHN1YjtcbiAgaWYgKHR5cGVvZiBzdXAuZXh0ZW5kZWQgPT0gJ2Z1bmN0aW9uJykgc3VwLmV4dGVuZGVkKHN1Yik7XG4gIHJldHVybiBzdWI7XG59XG5mdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICByZXR1cm4gb2JqO1xufSIsInZhciBfXywgc2Vjb25kc1RvSHVtYW5SZWFkYWJsZSwgZGF0ZUZpZWxkcztcbl9fID0gcmVxdWlyZSgnbG9kYXNoJyk7XG50aGlzLmFkZENvbW1hcyA9IGZ1bmN0aW9uKHMpe1xuICByZXR1cm4gU3RyLnJldmVyc2UoXG4gIGpvaW4oJywnKShcbiAgZmlsdGVyKGZ1bmN0aW9uKGl0KXtcbiAgICByZXR1cm4gaXQubGVuZ3RoO1xuICB9KShcbiAgc3BsaXQoLyhcXGR7M30pLykoXG4gIFN0ci5yZXZlcnNlKFxuICBzLnRvU3RyaW5nKCkpKSkpKTtcbn07XG50aGlzLnRpdGxlQ2FzZSA9IGZ1bmN0aW9uKHMpe1xuICByZXR1cm4gcyAhPSBudWxsID8gcy5yZXBsYWNlKC9bXFx3XVxcUyovZywgZnVuY3Rpb24od29yZCl7XG4gICAgaWYgKHdvcmQgPT09IHdvcmQudG9VcHBlckNhc2UoKSkge1xuICAgICAgaWYgKHdvcmQuaW5kZXhPZignLicpID4gLTEgfHwgd29yZC5pbmRleE9mKCctJykgPiAtMSB8fCB3b3JkLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh3b3JkLmxlbmd0aCA+IDMpIHtcbiAgICAgIHJldHVybiB3b3JkWzBdLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gd29yZDtcbiAgfSkgOiB2b2lkIDg7XG59O1xudGhpcy5lbGxpcHNlID0gZnVuY3Rpb24ocywgbGVuLCBzdWZmaXgpe1xuICBzdWZmaXggPT0gbnVsbCAmJiAoc3VmZml4ID0gJy4uLicpO1xuICBpZiAoKHMgIT0gbnVsbCA/IHMubGVuZ3RoIDogdm9pZCA4KSA+IGxlbikge1xuICAgIHMgPSBzLnN1YnN0cigwLCBsZW4pO1xuICAgIGlmIChzLmxhc3RJbmRleE9mKCcgJykgPiAwKSB7XG4gICAgICBzID0gcy5zdWJzdHIoMCwgcy5sYXN0SW5kZXhPZignICcpKSArIHN1ZmZpeDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHM7XG59O1xudGhpcy5kYXlOYW1lID0gZnVuY3Rpb24oaSl7XG4gIHN3aXRjaCAoaSkge1xuICBjYXNlIDA6XG4gICAgcmV0dXJuICdzdW4nO1xuICBjYXNlIDE6XG4gICAgcmV0dXJuICdtb24nO1xuICBjYXNlIDI6XG4gICAgcmV0dXJuICd0dWUnO1xuICBjYXNlIDM6XG4gICAgcmV0dXJuICd3ZWQnO1xuICBjYXNlIDQ6XG4gICAgcmV0dXJuICd0aHUnO1xuICBjYXNlIDU6XG4gICAgcmV0dXJuICdmcmknO1xuICBjYXNlIDY6XG4gICAgcmV0dXJuICdzYXQnO1xuICB9XG59O1xudGhpcy5wcmV0dHlEYXlOYW1lID0gZnVuY3Rpb24oaSl7XG4gIHN3aXRjaCAoaSkge1xuICBjYXNlIDA6XG4gICAgcmV0dXJuICdTdW5kYXknO1xuICBjYXNlIDE6XG4gICAgcmV0dXJuICdNb25kYXknO1xuICBjYXNlIDI6XG4gICAgcmV0dXJuICdUdWVzZGF5JztcbiAgY2FzZSAzOlxuICAgIHJldHVybiAnV2VkbmVzZGF5JztcbiAgY2FzZSA0OlxuICAgIHJldHVybiAnVGh1cnNkYXknO1xuICBjYXNlIDU6XG4gICAgcmV0dXJuICdGcmlkYXknO1xuICBjYXNlIDY6XG4gICAgcmV0dXJuICdTYXR1cmRheSc7XG4gIH1cbn07XG5zZWNvbmRzVG9IdW1hblJlYWRhYmxlID0gZnVuY3Rpb24oc2Vjcyl7XG4gIHZhciBob3VycywgbWludXRlcywgc2Vjb25kcywgdGltZXN0cmluZztcbiAgaG91cnMgPSBNYXRoLmZsb29yKHNlY3MgLyAoNjAgKiA2MCkpO1xuICBzZWNzIC09IGhvdXJzICogKDYwICogNjApO1xuICBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNzIC8gNjApO1xuICBzZWNzIC09IG1pbnV0ZXMgKiA2MDtcbiAgc2Vjb25kcyA9IHNlY3M7XG4gIHRpbWVzdHJpbmcgPSAnJztcbiAgaWYgKGhvdXJzID4gMSkge1xuICAgIHRpbWVzdHJpbmcgKz0gaG91cnMgKyAnIGhvdXJzJztcbiAgfSBlbHNlIGlmIChob3VycyA9PT0gMSkge1xuICAgIHRpbWVzdHJpbmcgKz0gJzEgaG91cic7XG4gIH1cbiAgaWYgKG1pbnV0ZXMpIHtcbiAgICBpZiAoaG91cnMpIHtcbiAgICAgIHRpbWVzdHJpbmcgKz0gJywgJztcbiAgICB9XG4gICAgaWYgKG1pbnV0ZXMgPiAxKSB7XG4gICAgICB0aW1lc3RyaW5nICs9IG1pbnV0ZXMgKyAnIG1pbnV0ZXMnO1xuICAgIH0gZWxzZSBpZiAobWludXRlcyA9PT0gMSkge1xuICAgICAgdGltZXN0cmluZyArPSAnMSBtaW51dGUnO1xuICAgIH1cbiAgfSBlbHNlIGlmICghaG91cnMpIHtcbiAgICBpZiAoc2VjcyA9PT0gMSkge1xuICAgICAgdGltZXN0cmluZyA9IHNlY3MgKyBcIiBzZWNvbmRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGltZXN0cmluZyA9IHNlY3MgKyBcIiBzZWNvbmRzXCI7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aW1lc3RyaW5nO1xufTtcbnRoaXMuZWxhcHNlZFRvSHVtYW5SZWFkYWJsZSA9IGZ1bmN0aW9uKHNlY3NBZ28pe1xuICB2YXIgc3VmZml4LCBodW1hbiwgZCwgd2Vla3MsIG1vbnRocywgeWVhcnM7XG4gIHN1ZmZpeCA9ICdhZ28nO1xuICBodW1hbiA9IHNlY3NBZ28gPCAzMFxuICAgID8gJ0p1c3Qgbm93ISdcbiAgICA6IHNlY3NBZ28gPCA2MFxuICAgICAgPyBcIkEgbW9tZW50IFwiICsgc3VmZml4XG4gICAgICA6IHNlY3NBZ28gPCAxMjBcbiAgICAgICAgPyBcIkEgbWludXRlIFwiICsgc3VmZml4XG4gICAgICAgIDogc2Vjc0FnbyA8IDg2NDAwXG4gICAgICAgICAgPyBzZWNvbmRzVG9IdW1hblJlYWRhYmxlKHNlY3NBZ28pICsgJyAnICsgc3VmZml4XG4gICAgICAgICAgOiBzZWNzQWdvIDwgMTcyODAwXG4gICAgICAgICAgICA/ICdZZXN0ZXJkYXknXG4gICAgICAgICAgICA6IHNlY3NBZ28gPCA2MDQ4MDBcbiAgICAgICAgICAgICAgPyAoZCA9IG5ldyBEYXRlKCksIGQuc2V0VGltZShkLmdldFRpbWUoKSAtIHNlY3NBZ28gKiAxMDAwKSwgdGhpcy5wcmV0dHlEYXlOYW1lKGQuZ2V0RGF5KCkpKVxuICAgICAgICAgICAgICA6IHNlY3NBZ28gPCAyNjI4MDAwXG4gICAgICAgICAgICAgICAgPyAod2Vla3MgPSBNYXRoLmZsb29yKHNlY3NBZ28gLyA2MDQ4MDApLCB3ZWVrcyA9PT0gMVxuICAgICAgICAgICAgICAgICAgPyBcIkEgd2VlayBcIiArIHN1ZmZpeFxuICAgICAgICAgICAgICAgICAgOiB3ZWVrcyArIFwiIHdlZWtzIFwiICsgc3VmZml4KVxuICAgICAgICAgICAgICAgIDogc2Vjc0FnbyA8IDMxNDQ2OTI1XG4gICAgICAgICAgICAgICAgICA/IChtb250aHMgPSBNYXRoLmZsb29yKHNlY3NBZ28gLyAyNjI4MDAwKSwgbW9udGhzID09PSAxXG4gICAgICAgICAgICAgICAgICAgID8gXCJBIG1vbnRoIFwiICsgc3VmZml4XG4gICAgICAgICAgICAgICAgICAgIDogbW9udGhzICsgXCIgbW9udGhzIFwiICsgc3VmZml4KVxuICAgICAgICAgICAgICAgICAgOiAoeWVhcnMgPSBNYXRoLmZsb29yKHNlY3NBZ28gLyAzMTQ0NjkyNSksIHllYXJzID09PSAxXG4gICAgICAgICAgICAgICAgICAgID8gXCJBIHllYXIgXCIgKyBzdWZmaXhcbiAgICAgICAgICAgICAgICAgICAgOiB5ZWFycyArIFwiIHllYXJzIFwiICsgc3VmZml4KTtcbiAgcmV0dXJuIGh1bWFuLnJlcGxhY2UoLyhcXGQrKS9nLCAnPGI+JDE8L2I+Jyk7XG59O1xudGhpcy5kamIySGFzaCA9IGZ1bmN0aW9uKHN0cil7XG4gIHZhciBoYXNoLCBpJCwgbGVuJCwgaSwgY2hhcjtcbiAgaGFzaCA9IDUzODE7XG4gIGZvciAoaSQgPSAwLCBsZW4kID0gc3RyLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgaSA9IHN0cltpJF07XG4gICAgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgKyBoYXNoKSArIGNoYXI7XG4gIH1cbiAgcmV0dXJuIGhhc2g7XG59O1xuZGF0ZUZpZWxkcyA9IFsnY3JlYXRlZCcsICd1cGRhdGVkJ107XG50aGlzLmFkZERhdGVzID0gZnVuY3Rpb24obyl7XG4gIHZhciBub3csIGkkLCByZWYkLCBsZW4kLCBkZiwgc3ViLCBrLCBpLCB2O1xuICBub3cgPSBEYXRlLm5vdygpO1xuICBpZiAoIW8pIHtcbiAgICByZXR1cm4gbztcbiAgfVxuICBzd2l0Y2ggKHR5cGVvZiBvKSB7XG4gIGNhc2UgJ29iamVjdCc6XG4gICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IGRhdGVGaWVsZHMpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICBkZiA9IHJlZiRbaSRdO1xuICAgICAgaWYgKG9bZGZdKSB7XG4gICAgICAgIG9bZGZdID0gbmV3IERhdGUob1tkZl0pO1xuICAgICAgICBvW2RmICsgXCJfaHVtYW5cIl0gPSB0aGlzLmVsYXBzZWRUb0h1bWFuUmVhZGFibGUoKG5vdyAtIG9bZGZdKSAvIDEwMDApO1xuICAgICAgICBvW2RmICsgXCJfaXNvXCJdID0gb1tkZl0udG9JU09TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3ViID0gX18ua2V5cyhvKS5maWx0ZXIoZnVuY3Rpb24oayl7XG4gICAgICByZXR1cm4gdHlwZW9mIG9ba10gPT09ICdhcnJheScgfHwgdHlwZW9mIG9ba10gPT09ICdvYmplY3QnO1xuICAgIH0pO1xuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gc3ViLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICBrID0gc3ViW2kkXTtcbiAgICAgIG9ba10gPSB0aGlzLmFkZERhdGVzKG9ba10pO1xuICAgIH1cbiAgICByZXR1cm4gbztcbiAgY2FzZSAnYXJyYXknOlxuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gby5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgaSA9IGkkO1xuICAgICAgdiA9IG9baSRdO1xuICAgICAgaWYgKHR5cGVvZiB2ID09PSAnb2JqZWN0Jykge1xuICAgICAgICBvW2ldID0gdGhpcy5hZGREYXRlcyhvW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG87XG4gIGRlZmF1bHQ6XG4gICAgcmV0dXJuIG87XG4gIH1cbn07XG50aGlzLnJlbmRlckFuZCA9IGN1cnJ5JChmdW5jdGlvbihmbiwgdywgdGFyZ2V0LCB0bXBsLCBwYXJhbXMsIGNiKXtcbiAgdmFyICR0LCAkYjtcbiAgJHQgPSB3LiQodGFyZ2V0KTtcbiAgJGIgPSB3LiQoJzxkaXY+Jyk7XG4gICRiLmhpZGUoKTtcbiAgJHRbZm5dKCRiKTtcbiAgdy5qYWRlLnJlbmRlcigkYlswXSwgdG1wbCwgcGFyYW1zKTtcbiAgJGIuc2hvdygpLmFkZENsYXNzKCdmYWRlaW4nKTtcbiAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gY2IoJGIpO1xuICB9LCAxMDApO1xufSk7XG50aGlzLnJlbmRlckFuZEFwcGVuZCA9IHRoaXMucmVuZGVyQW5kKCdhcHBlbmQnKTtcbnRoaXMucmVuZGVyQW5kUHJlcGVuZCA9IHRoaXMucmVuZGVyQW5kKCdwcmVwZW5kJyk7XG50aGlzLmlzRW1haWwgPSBmdW5jdGlvbihuYW1lKXtcbiAgcmV0dXJuIG5hbWUuaW5kZXhPZignQCcpICE9PSAtMTtcbn07XG50aGlzLmlzRm9ydW1Ib21lcGFnZSA9IGZ1bmN0aW9uKHBhdGgpe1xuICByZXR1cm4gZnVybC5wYXJzZShwYXRoKS50eXBlID09PSAnZm9ydW0nO1xufTtcbnRoaXMuaXNFZGl0aW5nID0gZnVuY3Rpb24ocGF0aCl7XG4gIHZhciBtZXRhO1xuICBtZXRhID0gZnVybC5wYXJzZShwYXRoKTtcbiAgc3dpdGNoIChtZXRhLnR5cGUpIHtcbiAgY2FzZSAnbmV3LXRocmVhZCc6XG4gICAgcmV0dXJuIHRydWU7XG4gIGNhc2UgJ2VkaXQnOlxuICAgIHJldHVybiBtZXRhLmlkO1xuICBkZWZhdWx0OlxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnRoaXMuZmxpcEJhY2tncm91bmQgPSBmdW5jdGlvbih3LCBjdXIsIGRpcmVjdGlvbil7XG4gIHZhciBsYXN0LCBuZXh0O1xuICBkaXJlY3Rpb24gPT0gbnVsbCAmJiAoZGlyZWN0aW9uID0gJ2Rvd24nKTtcbiAgaWYgKHcuYmdBbmltKSB7XG4gICAgY2xlYXJUaW1lb3V0KHcuYmdBbmltKTtcbiAgfVxuICBsYXN0ID0gdy4kKCcuYmcuYWN0aXZlJyk7XG4gIG5leHQgPSB3LiQoJyNmb3J1bV9iZ18nICsgY3VyLmRhdGEoJ2lkJykpO1xuICBuZXh0LmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICBpZiAoIWxhc3QubGVuZ3RoKSB7XG4gICAgcmV0dXJuIG5leHQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB3LmJnQW5pbSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIGxhc3QuY3NzKCd0b3AnLCBkaXJlY3Rpb24gPT09ICdkb3duJyA/IC0zMDAgOiAzMDApO1xuICAgICAgbGFzdC5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICBuZXh0LmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgIHJldHVybiB3LmJnQW5pbSA9IDA7XG4gICAgfSwgMTAwKTtcbiAgfVxufTtcbnRoaXMuclVuYmluZCA9IGZ1bmN0aW9uKHJmKXtcbiAgdmFyIGkkLCByZWYkLCBsZW4kLCBkO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gcmYuZGVwZW5kZW5jaWVzKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgIGQgPSByZWYkW2kkXTtcbiAgICBkLnJlbW92ZURlcGVuZGVudCgpO1xuICB9XG59O1xuZnVuY3Rpb24gY3VycnkkKGYsIGJvdW5kKXtcbiAgdmFyIGNvbnRleHQsXG4gIF9jdXJyeSA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICByZXR1cm4gZi5sZW5ndGggPiAxID8gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBwYXJhbXMgPSBhcmdzID8gYXJncy5jb25jYXQoKSA6IFtdO1xuICAgICAgY29udGV4dCA9IGJvdW5kID8gY29udGV4dCB8fCB0aGlzIDogdGhpcztcbiAgICAgIHJldHVybiBwYXJhbXMucHVzaC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykgPFxuICAgICAgICAgIGYubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggP1xuICAgICAgICBfY3VycnkuY2FsbChjb250ZXh0LCBwYXJhbXMpIDogZi5hcHBseShjb250ZXh0LCBwYXJhbXMpO1xuICAgIH0gOiBmO1xuICB9O1xuICByZXR1cm4gX2N1cnJ5KCk7XG59IiwidmFyIENvbXBvbmVudCwgdGVtcGxhdGVzLCBCdXk7XG5Db21wb25lbnQgPSByZXF1aXJlKCd5YWNvbXBvbmVudCcpO1xudGVtcGxhdGVzID0gcmVxdWlyZSgnLi4vYnVpbGQvY29tcG9uZW50LWphZGUuanMnKS50ZW1wbGF0ZXM7XG5tb2R1bGUuZXhwb3J0cyA9IEJ1eSA9IChmdW5jdGlvbihzdXBlcmNsYXNzKXtcbiAgdmFyIHByb3RvdHlwZSA9IGV4dGVuZCQoKGltcG9ydCQoQnV5LCBzdXBlcmNsYXNzKS5kaXNwbGF5TmFtZSA9ICdCdXknLCBCdXkpLCBzdXBlcmNsYXNzKS5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gQnV5O1xuICBwcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZXMuQnV5O1xuICBwcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCl7XG4gICAgaWYgKHRoaXMubG9jYWwoJ2NhcmROZWVkZWQnKSA9PT0gdm9pZCA4KSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2NhbCgnY2FyZE5lZWRlZCcsIHRydWUpO1xuICAgIH1cbiAgfTtcbiAgcHJvdG90eXBlLm9uQXR0YWNoID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgdGhpcyQgPSB0aGlzO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci4kKCcuQnV5LWNhcmQtbnVtYmVyJykuZm9jdXMoKTtcbiAgICB9LCAxMDApO1xuICAgIHRoaXMuJC5vbignY2xpY2snLCAnLkJ1eS1jaGFuZ2UtY2FyZCcsIGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgJGZiO1xuICAgICAgdGhpcyQubG9jYWwoJ2NhcmROZWVkZWQnLCB0cnVlKTtcbiAgICAgIHRoaXMkLmRldGFjaCgpLnJlbmRlcigpLmF0dGFjaCgpO1xuICAgICAgJGZiID0gY29uc3RydWN0b3IuJCgnLmZhbmN5Ym94LXdyYXA6Zmlyc3QnKTtcbiAgICAgICRmYi5yZW1vdmVDbGFzcygnc2xpZGUnKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICRmYi5hZGRDbGFzcygnc2xpZGUnKTtcbiAgICAgIH0sIDEwKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy4kLm9uKCdjbGljaycsICcuQnV5LWNoZWNrb3V0JywgZnVuY3Rpb24oZXYpe1xuICAgICAgdmFyIGRhdGEsIHByb2R1Y3QsIHJlRW5hYmxlO1xuICAgICAgJChldi50YXJnZXQpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICBkYXRhID0ge1xuICAgICAgICBudW1iZXI6IHRoaXMkLiQuZmluZCgnLkJ1eS1jYXJkLW51bWJlcicpLnZhbCgpLFxuICAgICAgICBleHBtbzogdGhpcyQuJC5maW5kKCcuQnV5LWNhcmQtbW9udGgnKS52YWwoKSxcbiAgICAgICAgZXhweWVhcjogdGhpcyQuJC5maW5kKCcuQnV5LWNhcmQteWVhcicpLnZhbCgpLFxuICAgICAgICBjb2RlOiB0aGlzJC4kLmZpbmQoJy5CdXktY2FyZC1jb2RlJykudmFsKClcbiAgICAgIH07XG4gICAgICBwcm9kdWN0ID0gdGhpcyQubG9jYWwoJ3Byb2R1Y3QnKS5pZDtcbiAgICAgIHJlRW5hYmxlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoZXYudGFyZ2V0KS5hdHRyKCdkaXNhYmxlZCcsIG51bGwpO1xuICAgICAgfTtcbiAgICAgIHNob3dUb29sdGlwKHRoaXMkLiQuZmluZCgnLnRvb2x0aXAnKSwgJ1NlY3VyaW5nIGEgY29ubmVjdGlvbicpO1xuICAgICAgY29uc3RydWN0b3IuJC5wb3N0KFwiL2FqYXgvY2hlY2tvdXQvXCIgKyBwcm9kdWN0LCBkYXRhLCBmdW5jdGlvbihyKXtcbiAgICAgICAgdmFyIHJlZiQsIGNhcmROdW1iZXIsIGkkLCBsZW4kLCBlLCAkZmI7XG4gICAgICAgIGlmIChyLnN1Y2Nlc3MpIHtcbiAgICAgICAgICBzaXRlLnN1YnNjcmlwdGlvbnMucHVzaChwcm9kdWN0KTtcbiAgICAgICAgICBzaXRlLmhhc19zdHJpcGUgPSB0cnVlO1xuICAgICAgICAgICQoXCIjXCIgKyBwcm9kdWN0KS5mb2N1cygpO1xuICAgICAgICAgIHNob3dUb29sdGlwKHRoaXMkLiQuZmluZCgnLnRvb2x0aXAnKSwgWydTaW5jZXJlIHRoYW5rcyEnLCBcIkF3ZXNvbWUuICBHbyBhaGVhZCFcIiwgJ1lvdSBnb3QgaXQhJywgJ1RoYW5rIHlvdSEnXVtwYXJzZUludChNYXRoLnJhbmRvbSgpICogNSldKTtcbiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmVFbmFibGUoKTtcbiAgICAgICAgICAgICQoXCIuXCIgKyBwcm9kdWN0ICsgXCItYXZhaWxhYmxlXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICQoXCIuXCIgKyBwcm9kdWN0ICsgXCItcHVyY2hhc2VkXCIpLnNob3coNTAwKTtcbiAgICAgICAgICAgIHJldHVybiAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gICAgICAgICAgfSwgMjAwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2hvd1Rvb2x0aXAodGhpcyQuJC5maW5kKCcudG9vbHRpcCcpLCAocmVmJCA9IHIuZXJyb3JzKSAhPSBudWxsICYmIHJlZiQubGVuZ3RoID8gci5lcnJvcnMuam9pbihcIlxcblwiKSA6ICdJbnZhbGlkIHBheW1lbnQhJyk7XG4gICAgICAgICAgY2FyZE51bWJlciA9IHRoaXMkLiQuZmluZCgnLkJ1eS1jYXJkLW51bWJlcicpO1xuICAgICAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBbY2FyZE51bWJlciwgY29uc3RydWN0b3IuJCgnLkJ1eS1jYXJkLWNvZGUnKV0pLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgICBlID0gcmVmJFtpJF07XG4gICAgICAgICAgICBlLmFkZENsYXNzKCdoYXMtZXJyb3InKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGZiID0gY29uc3RydWN0b3IuJCgnLmZhbmN5Ym94LXdyYXA6Zmlyc3QnKTtcbiAgICAgICAgICAkZmIuYWRkQ2xhc3MoJ29uLWVycm9yJyk7XG4gICAgICAgICAgJGZiLnJlbW92ZUNsYXNzKCdzaGFrZScpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICRmYi5hZGRDbGFzcygnc2hha2UnKTtcbiAgICAgICAgICAgIHJldHVybiBjYXJkTnVtYmVyLmZvY3VzKCk7XG4gICAgICAgICAgfSwgMTApO1xuICAgICAgICAgIHJldHVybiByZUVuYWJsZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgfTtcbiAgcHJvdG90eXBlLm9uRGV0YWNoID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy4kLm9mZigpO1xuICB9O1xuICBmdW5jdGlvbiBCdXkoKXtcbiAgICBCdXkuc3VwZXJjbGFzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG4gIHJldHVybiBCdXk7XG59KENvbXBvbmVudCkpO1xuZnVuY3Rpb24gZXh0ZW5kJChzdWIsIHN1cCl7XG4gIGZ1bmN0aW9uIGZ1bigpe30gZnVuLnByb3RvdHlwZSA9IChzdWIuc3VwZXJjbGFzcyA9IHN1cCkucHJvdG90eXBlO1xuICAoc3ViLnByb3RvdHlwZSA9IG5ldyBmdW4pLmNvbnN0cnVjdG9yID0gc3ViO1xuICBpZiAodHlwZW9mIHN1cC5leHRlbmRlZCA9PSAnZnVuY3Rpb24nKSBzdXAuZXh0ZW5kZWQoc3ViKTtcbiAgcmV0dXJuIHN1Yjtcbn1cbmZ1bmN0aW9uIGltcG9ydCQob2JqLCBzcmMpe1xuICB2YXIgb3duID0ge30uaGFzT3duUHJvcGVydHk7XG4gIGZvciAodmFyIGtleSBpbiBzcmMpIGlmIChvd24uY2FsbChzcmMsIGtleSkpIG9ialtrZXldID0gc3JjW2tleV07XG4gIHJldHVybiBvYmo7XG59IiwidmFyIENvbXBvbmVudCwgdGVtcGxhdGVzLCBQYWdpbmF0b3I7XG5Db21wb25lbnQgPSByZXF1aXJlKCd5YWNvbXBvbmVudCcpO1xudGVtcGxhdGVzID0gcmVxdWlyZSgnLi4vYnVpbGQvY29tcG9uZW50LWphZGUuanMnKS50ZW1wbGF0ZXM7XG5mdW5jdGlvbiBjYWxjUGFnZXMoYWN0aXZlUGFnZSwgc3RlcCwgcXR5LCBwYWdlRGlzdGFuY2UsIHBhZ2VRdHksIHBudW1Ub0hyZWYpe1xuICB2YXIgYmVnLCBlbmQsIHBhZ2VzLCByZXMkLCBpJCwgcmVmJCwgbGVuJCwgbnVtLCBmaXJzdE51bSwgbGFzdE51bTtcbiAgYWN0aXZlUGFnZSA9IHBhcnNlSW50KGFjdGl2ZVBhZ2UpO1xuICBzdGVwID0gcGFyc2VJbnQoc3RlcCk7XG4gIHF0eSA9IHBhcnNlSW50KHF0eSk7XG4gIHBhZ2VEaXN0YW5jZSA9IHBhcnNlSW50KHBhZ2VEaXN0YW5jZSk7XG4gIHBhZ2VRdHkgPSBwYXJzZUludChwYWdlUXR5KTtcbiAgYWN0aXZlUGFnZSA9IHBhcnNlSW50KGFjdGl2ZVBhZ2UpO1xuICBiZWcgPSBNYXRoLm1heChhY3RpdmVQYWdlIC0gcGFnZURpc3RhbmNlLCAxKTtcbiAgZW5kID0gTWF0aC5taW4oYWN0aXZlUGFnZSArIHBhZ2VEaXN0YW5jZSwgcGFnZVF0eSk7XG4gIGlmIChhY3RpdmVQYWdlIDw9IHBhZ2VEaXN0YW5jZSkge1xuICAgIGVuZCA9IE1hdGgubWluKGVuZCArIChwYWdlRGlzdGFuY2UgLSBhY3RpdmVQYWdlKSArIDEsIHBhZ2VRdHkpO1xuICB9IGVsc2UgaWYgKGFjdGl2ZVBhZ2UgPj0gcGFnZVF0eSAtIHBhZ2VEaXN0YW5jZSkge1xuICAgIGJlZyA9IE1hdGgubWF4KGJlZyAtIChwYWdlRGlzdGFuY2UgLSAocGFnZVF0eSAtIGFjdGl2ZVBhZ2UpKSwgMSk7XG4gIH1cbiAgcmVzJCA9IFtdO1xuICBmb3IgKGkkID0gMCwgbGVuJCA9IChyZWYkID0gKGZuJCgpKSkubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICBudW0gPSByZWYkW2kkXTtcbiAgICByZXMkLnB1c2goe1xuICAgICAgbnVtOiBudW0sXG4gICAgICB0aXRsZTogbnVtLFxuICAgICAgaHJlZjogcG51bVRvSHJlZihudW0pLFxuICAgICAgYWN0aXZlOiBhY3RpdmVQYWdlID09PSBudW1cbiAgICB9KTtcbiAgfVxuICBwYWdlcyA9IHJlcyQ7XG4gIGZpcnN0TnVtID0gMTtcbiAgaWYgKHBhZ2VzLmxlbmd0aCAmJiBwYWdlc1swXS50aXRsZSAhPT0gZmlyc3ROdW0pIHtcbiAgICBwYWdlcy51bnNoaWZ0KHtcbiAgICAgIG51bTogZmlyc3ROdW0sXG4gICAgICB0aXRsZTogJ0ZpcnN0JyxcbiAgICAgIGhyZWY6IHBudW1Ub0hyZWYoZmlyc3ROdW0pXG4gICAgfSk7XG4gIH1cbiAgbGFzdE51bSA9IHBhZ2VzLmxlbmd0aCAtIDE7XG4gIGlmIChwYWdlcy5sZW5ndGggJiYgcGFnZXNbbGFzdE51bV0udGl0bGUgIT09IHBhZ2VRdHkpIHtcbiAgICBwYWdlcy5wdXNoKHtcbiAgICAgIG51bTogcGFnZVF0eSxcbiAgICAgIHRpdGxlOiAnTGFzdCcsXG4gICAgICBocmVmOiBwbnVtVG9IcmVmKHBhZ2VRdHkpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHBhZ2VzO1xuICBmdW5jdGlvbiBmbiQoKXtcbiAgICB2YXIgaSQsIHRvJCwgcmVzdWx0cyQgPSBbXTtcbiAgICBmb3IgKGkkID0gYmVnLCB0byQgPSBlbmQ7IGkkIDw9IHRvJDsgKytpJCkge1xuICAgICAgcmVzdWx0cyQucHVzaChpJCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzJDtcbiAgfVxufVxubW9kdWxlLmV4cG9ydHMgPSBQYWdpbmF0b3IgPSAoZnVuY3Rpb24oc3VwZXJjbGFzcyl7XG4gIHZhciBkZWZhdWx0TG9jYWxzLCBwcm90b3R5cGUgPSBleHRlbmQkKChpbXBvcnQkKFBhZ2luYXRvciwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnUGFnaW5hdG9yJywgUGFnaW5hdG9yKSwgc3VwZXJjbGFzcykucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IFBhZ2luYXRvcjtcbiAgZGVmYXVsdExvY2FscyA9IHtcbiAgICBhY3RpdmVQYWdlOiAxLFxuICAgIHN0ZXA6IDgsXG4gICAgcXR5OiAwLFxuICAgIHBhZ2VEaXN0YW5jZTogNFxuICB9O1xuICBmdW5jdGlvbiBQYWdpbmF0b3IoYXJnJCl7XG4gICAgdmFyIHJlZiQsIHBudW1Ub0hyZWY7XG4gICAgcmVmJCA9IGFyZyQgIT0gbnVsbFxuICAgICAgPyBhcmckXG4gICAgICA6IHt9LCBwbnVtVG9IcmVmID0gcmVmJC5wbnVtVG9IcmVmLCB0aGlzLm9uUGFnZSA9IHJlZiQub25QYWdlO1xuICAgIGlmICghcG51bVRvSHJlZikge1xuICAgICAgaWYgKHRoaXMub25QYWdlKSB7XG4gICAgICAgIHBudW1Ub0hyZWYgPSBmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiAnIyc7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwbnVtVG9IcmVmID0gZnVuY3Rpb24oaXQpe1xuICAgICAgICAgIHJldHVybiBcIj9wYWdlPVwiICsgaXQ7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMucG51bVRvSHJlZiA9IGNvbnN0cnVjdG9yLiRSLnN0YXRlKHBudW1Ub0hyZWYpO1xuICAgIFBhZ2luYXRvci5zdXBlcmNsYXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cbiAgcHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpe1xuICAgIHZhciBrLCByZWYkLCB2LCB0aGlzJCA9IHRoaXM7XG4gICAgZm9yIChrIGluIHJlZiQgPSBkZWZhdWx0TG9jYWxzKSB7XG4gICAgICB2ID0gcmVmJFtrXTtcbiAgICAgIGlmICh0aGlzLmxvY2FsKGspID09PSB2b2lkIDgpIHtcbiAgICAgICAgdGhpcy5sb2NhbChrLCB2KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zdGF0ZS5wYWdlUXR5ID0gY29uc3RydWN0b3IuJFIoZnVuY3Rpb24ocXR5LCBzdGVwKXtcbiAgICAgIHJldHVybiBNYXRoLmNlaWwocXR5IC8gc3RlcCk7XG4gICAgfSkuYmluZFRvKHRoaXMuc3RhdGUucXR5LCB0aGlzLnN0YXRlLnN0ZXApO1xuICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgdmFyIGJpbmRpbmdzLCByZWYkO1xuICAgICAgYmluZGluZ3MgPSBbdGhpcyQuc3RhdGUuYWN0aXZlUGFnZSwgdGhpcyQuc3RhdGUuc3RlcCwgdGhpcyQuc3RhdGUucXR5LCB0aGlzJC5zdGF0ZS5wYWdlRGlzdGFuY2UsIHRoaXMkLnN0YXRlLnBhZ2VRdHksIHRoaXMkLnBudW1Ub0hyZWZdO1xuICAgICAgcmV0dXJuIHRoaXMkLnN0YXRlLnBhZ2VzID0gKHJlZiQgPSBjb25zdHJ1Y3Rvci4kUihjYWxjUGFnZXMpKS5iaW5kVG8uYXBwbHkocmVmJCwgYmluZGluZ3MpO1xuICAgIH0oKTtcbiAgfTtcbiAgcHJvdG90eXBlLnRlbXBsYXRlID0gdGVtcGxhdGVzLlBhZ2luYXRvcjtcbiAgcHJvdG90eXBlLm9uQXR0YWNoID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgYywgaGFuZGxlcjtcbiAgICB0aGlzLiQuc2hvdygpO1xuICAgIGlmICh0aGlzLm9uUGFnZSkge1xuICAgICAgYyA9IHRoaXM7XG4gICAgICBoYW5kbGVyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHBnO1xuICAgICAgICBwZyA9IHBhcnNlSW50KGNvbnN0cnVjdG9yLiQodGhpcykuZGF0YSgncGFnZScpKTtcbiAgICAgICAgYy5sb2NhbCgnYWN0aXZlUGFnZScsIHBnKTtcbiAgICAgICAgYy5yZWxvYWQoKTtcbiAgICAgICAgYy5vblBhZ2UocGcsIGMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHRoaXMuJC5vbignY2xpY2snLCAnYScsIGhhbmRsZXIpO1xuICAgIH1cbiAgfTtcbiAgcHJvdG90eXBlLm9uRGV0YWNoID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy4kLm9mZigpO1xuICB9O1xuICByZXR1cm4gUGFnaW5hdG9yO1xufShDb21wb25lbnQpKTtcbmZ1bmN0aW9uIGV4dGVuZCQoc3ViLCBzdXApe1xuICBmdW5jdGlvbiBmdW4oKXt9IGZ1bi5wcm90b3R5cGUgPSAoc3ViLnN1cGVyY2xhc3MgPSBzdXApLnByb3RvdHlwZTtcbiAgKHN1Yi5wcm90b3R5cGUgPSBuZXcgZnVuKS5jb25zdHJ1Y3RvciA9IHN1YjtcbiAgaWYgKHR5cGVvZiBzdXAuZXh0ZW5kZWQgPT0gJ2Z1bmN0aW9uJykgc3VwLmV4dGVuZGVkKHN1Yik7XG4gIHJldHVybiBzdWI7XG59XG5mdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICBmb3IgKHZhciBrZXkgaW4gc3JjKSBpZiAob3duLmNhbGwoc3JjLCBrZXkpKSBvYmpba2V5XSA9IHNyY1trZXldO1xuICByZXR1cm4gb2JqO1xufSIsInZhciBDb21wb25lbnQsIHRlbXBsYXRlcywgYWRkTWVzc2FnZSwgQ2hhdCwgc2xpY2UkID0gW10uc2xpY2U7XG5Db21wb25lbnQgPSByZXF1aXJlKCd5YWNvbXBvbmVudCcpO1xudGVtcGxhdGVzID0gcmVxdWlyZSgnLi4vYnVpbGQvY29tcG9uZW50LWphZGUuanMnKS50ZW1wbGF0ZXM7XG5hZGRNZXNzYWdlID0gY3VycnkkKGZ1bmN0aW9uKGZuLCBtKXtcbiAgdmFyICRtc2csICRtZXNzYWdlcztcbiAgJG1zZyA9IHRoaXMubWVzc2FnZU5vZGUobSk7XG4gICRtZXNzYWdlcyA9IHRoaXMuJC5maW5kKCcubWVzc2FnZXMnKVtmbl0oJG1zZyk7XG4gICRtc2cuc2hvdygpO1xuICAkbWVzc2FnZXNbMF0uc2Nyb2xsVG9wID0gJG1lc3NhZ2VzWzBdLnNjcm9sbEhlaWdodDtcbiAgcmV0dXJuIHRoaXMuJC5maW5kKCd0ZXh0YXJlYScpLnZhbCgnJyk7XG59KTtcbm1vZHVsZS5leHBvcnRzID0gQ2hhdCA9IChmdW5jdGlvbihzdXBlcmNsYXNzKXtcbiAgdmFyIHByb3RvdHlwZSA9IGV4dGVuZCQoKGltcG9ydCQoQ2hhdCwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnQ2hhdCcsIENoYXQpLCBzdXBlcmNsYXNzKS5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gQ2hhdDtcbiAgQ2hhdC5kdXJhdGlvbiA9IDMwMDtcbiAgQ2hhdC5lYXNpbmcgPSAnZWFzZU91dEV4cG8nO1xuICBDaGF0LmNoYXRzID0ge307XG4gIHByb3RvdHlwZS5jb252ZXJzYXRpb24gPSBudWxsO1xuICBwcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZXMuQ2hhdDtcbiAgcHJvdG90eXBlLnJlbWVtYmVyQ2hhdCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNoYXRzLCBpZCwgcmVmJDtcbiAgICBjaGF0cyA9IEpTT04ucGFyc2UoJC5jb29raWUoJ2NoYXRzJykgfHwgJ1tdJyk7XG4gICAgaWQgPSAocmVmJCA9IHRoaXMuY29udmVyc2F0aW9uKSAhPSBudWxsID8gcmVmJC5pZCA6IHZvaWQgODtcbiAgICBpZiAoY2hhdHMuaW5kZXhPZihpZCkgPT09IC0xICYmIGlkKSB7XG4gICAgICBjaGF0cy5wdXNoKGlkKTtcbiAgICAgIHJldHVybiAkLmNvb2tpZSgnY2hhdHMnLCBKU09OLnN0cmluZ2lmeShjaGF0cyksIHtcbiAgICAgICAgcGF0aDogJy8nXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihjaGF0cy5pbmRleE9mKGlkKSwgaWQpO1xuICAgIH1cbiAgfTtcbiAgcHJvdG90eXBlLmZvcmdldENoYXQgPSBmdW5jdGlvbigpe1xuICAgIHZhciBjaGF0cywgaWQsIHJlZiQsIGk7XG4gICAgY2hhdHMgPSBKU09OLnBhcnNlKCQuY29va2llKCdjaGF0cycpIHx8ICdbXScpO1xuICAgIGlkID0gKHJlZiQgPSB0aGlzLmNvbnZlcnNhdGlvbikgIT0gbnVsbCA/IHJlZiQuaWQgOiB2b2lkIDg7XG4gICAgaSA9IGNoYXRzLmluZGV4T2YoaWQpO1xuICAgIGlmIChpICE9PSAtMSAmJiBpZCkge1xuICAgICAgY2hhdHMuc3BsaWNlKGksIDEpO1xuICAgICAgcmV0dXJuICQuY29va2llKCdjaGF0cycsIEpTT04uc3RyaW5naWZ5KGNoYXRzKSwge1xuICAgICAgICBwYXRoOiAnLydcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29uc29sZS53YXJuKGNoYXRzLmluZGV4T2YoaWQpLCBpZCk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUub25BdHRhY2ggPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuJC5kcmFnZ2FibGUoe1xuICAgICAgc25hcDogJ2Zvb3RlcicsXG4gICAgICBzbmFwTW9kZTogJ291dGVyJyxcbiAgICAgIGN1cnNvcjogJ21vdmUnLFxuICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGV2KXtcbiAgICAgICAgcmV0dXJuICQoZXYudGFyZ2V0KS5maW5kKCcubWluaW1pemUnKS5hZGRDbGFzcygnbm8tY2xpY2snKTtcbiAgICAgIH1cbiAgICB9KS5jc3Moe1xuICAgICAgbGVmdDogNTAsXG4gICAgICBib3R0b206IDMzNVxuICAgIH0pO1xuICAgIHRoaXMuJC5vbignY2xpY2snLCAnLm1pbmltaXplJywgdGhpcy5taW5pbWl6ZSk7XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICcuY2xvc2UnLCB0aGlzLmNsb3NlKTtcbiAgICB0aGlzLiQub24oJ2tleWRvd24nLCAndGV4dGFyZWEnLCB0aGlzLnNlbmRNZXNzYWdlKTtcbiAgICByZXR1cm4gdGhpcy4kLmZpbmQoJy5tZXNzYWdlcycpLnNjcm9sbCh0aGlzLm1heWJlTG9hZE1vcmUpO1xuICB9O1xuICBwcm90b3R5cGUub25EZXRhY2ggPSBmdW5jdGlvbigpe307XG4gIHByb3RvdHlwZS5rZXkgPSBmdW5jdGlvbigpe1xuICAgIHZhciByZWYkLCBtZSwgb3RoZXJzO1xuICAgIHJlZiQgPSBbdGhpcy5zdGF0ZS5tZS52YWwsIHRoaXMuc3RhdGUub3RoZXJzLnZhbF0sIG1lID0gcmVmJFswXSwgb3RoZXJzID0gcmVmJFsxXTtcbiAgICByZXR1cm4gbWUubmFtZSArIFwiL1wiICsgb3RoZXJzLm1hcChmdW5jdGlvbihpdCl7XG4gICAgICByZXR1cm4gaXQubmFtZTtcbiAgICB9KS5qb2luKCcvJyk7XG4gIH07XG4gIHByb3RvdHlwZS51c2VycyA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIGZvbGQoZnVuY3Rpb24obSwgdSl7XG4gICAgICBtW3UuaWRdID0gdTtcbiAgICAgIHJldHVybiBtO1xuICAgIH0sIHt9KShcbiAgICBmbGF0dGVuKFt0aGlzLnN0YXRlLm1lLnZhbCwgdGhpcy5zdGF0ZS5vdGhlcnMudmFsXSkpO1xuICB9O1xuICBwcm90b3R5cGUubWVzc2FnZUZyb21FbnYgPSBmdW5jdGlvbigpe1xuICAgIHZhciB1LCByZWYkLCByZWYxJCwgbTtcbiAgICB1ID0gKHJlZiQgPSB0aGlzLnN0YXRlKSAhPSBudWxsID8gKHJlZjEkID0gcmVmJC5vdGhlcnMpICE9IG51bGwgPyAocmVmJCA9IHJlZjEkLnZhbCkgIT0gbnVsbCA/IHJlZiRbMF0gOiB2b2lkIDggOiB2b2lkIDggOiB2b2lkIDg7XG4gICAgcmV0dXJuIG0gPSB7XG4gICAgICBjb252ZXJzYXRpb25faWQ6IChyZWYkID0gdGhpcy5jb252ZXJzYXRpb24pICE9IG51bGwgPyByZWYkLmlkIDogdm9pZCA4LFxuICAgICAgZnJvbTogd2luZG93LnVzZXIsXG4gICAgICB0bzoge1xuICAgICAgICBpZDogdS5pZCxcbiAgICAgICAgbmFtZTogdS5uYW1lXG4gICAgICB9LFxuICAgICAgYm9keTogdGhpcy4kLmZpbmQoJ3RleHRhcmVhJykudmFsKClcbiAgICB9O1xuICB9O1xuICBwcm90b3R5cGUubWVzc2FnZU5vZGUgPSBmdW5jdGlvbihtKXtcbiAgICB2YXIgJG1zZywgbXlOYW1lLCByZWYkLCByZWYxJDtcbiAgICBjb25zb2xlLndhcm4oJ20nLCBtKTtcbiAgICAkbXNnID0gdGhpcy4kLmZpbmQoJy5jb250YWluZXIgPiAubXNnJykuY2xvbmUoKTtcbiAgICAkbXNnLmF0dHIoJ2RhdGEtbWVzc2FnZS1pZCcsIG0uaWQpO1xuICAgIGlmIChtLmNyZWF0ZWRfaHVtYW4pIHtcbiAgICAgICRtc2cuZmluZCgnLmJvZHknKS5hdHRyKCd0aXRsZScsIG0uY3JlYXRlZF9odW1hbi5yZXBsYWNlKC88Lio/XFwvPz4vZywgJycpKS5hdHRyKCdkYXRhLXRpbWUnLCBtLmNyZWF0ZWRfaXNvKS5hZGRDbGFzcygndGltZS10aXRsZScpLmh0bWwobS5ib2R5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFwibWlzc2luZyBtLmNyZWF0ZWRfaHVtYW5cIiwgbSk7XG4gICAgICAkbXNnLmZpbmQoJy5ib2R5JykuaHRtbChtLmJvZHkpO1xuICAgIH1cbiAgICAkbXNnLmZpbmQoJ2EuZnJvbS1uYW1lJykuYXR0cignaHJlZicsIFwiL3VzZXIvXCIgKyBtLmZyb20ubmFtZSkuaHRtbChtLmZyb20ubmFtZSk7XG4gICAgbXlOYW1lID0gKHJlZiQgPSB0aGlzLnN0YXRlLm1lKSAhPSBudWxsID8gKHJlZjEkID0gcmVmJC52YWwpICE9IG51bGwgPyByZWYxJC5uYW1lIDogdm9pZCA4IDogdm9pZCA4O1xuICAgIGlmIChtLmZyb20ubmFtZSAhPT0gbXlOYW1lKSB7XG4gICAgICAkbXNnLmFkZENsYXNzKCdvdGhlcicpO1xuICAgIH1cbiAgICByZXR1cm4gJG1zZztcbiAgfTtcbiAgcHJvdG90eXBlLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciBtLCB0aGlzJCA9IHRoaXM7XG4gICAgaWYgKGV2LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICBtID0gdGhpcy5tZXNzYWdlRnJvbUVudigpO1xuICAgICAgY29uc29sZS5sb2coJ20nLCBtKTtcbiAgICAgIGlmIChtLmJvZHkubWF0Y2goL15cXHMqJC8pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzb2NrZXQuZW1pdCgnY2hhdC1tZXNzYWdlJywgbSwgZnVuY3Rpb24oZXJyLCByKXtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMkLmNvbnZlcnNhdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMkLmNvbnZlcnNhdGlvbiA9IHIuY29udmVyc2F0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdyJywgcik7XG4gICAgICAgIG0uaWQgPSByLm1lc3NhZ2UuaWQ7XG4gICAgICAgIG0uYm9keSA9IHIubWVzc2FnZS5ib2R5O1xuICAgICAgICBjb25zb2xlLmxvZygncicsIHIubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB0aGlzJC5hcHBlbmRNZXNzYWdlKG0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUuYXBwZW5kTWVzc2FnZSA9IGFkZE1lc3NhZ2UoJ2FwcGVuZCcpO1xuICBwcm90b3R5cGUucHJlcGVuZE1lc3NhZ2UgPSBhZGRNZXNzYWdlKCdwcmVwZW5kJyk7XG4gIHByb3RvdHlwZS5tYXliZUxvYWRNb3JlID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciBwb3M7XG4gICAgaWYgKHRoaXMubG9hZGVkQWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHBvcyA9ICQoZXYudGFyZ2V0KS5zY3JvbGxUb3AoKTtcbiAgICBpZiAocG9zID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkTW9yZU1lc3NhZ2VzKCk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUubG9hZE1vcmVNZXNzYWdlcyA9IGZ1bmN0aW9uKGxhc3Qpe1xuICAgIHZhciAkZmlyc3RNc2csIHRoaXMkID0gdGhpcztcbiAgICAkZmlyc3RNc2cgPSB0aGlzLiQuZmluZCgnLm1lc3NhZ2VzIC5tc2c6Zmlyc3QnKTtcbiAgICBsYXN0IHx8IChsYXN0ID0gJGZpcnN0TXNnLmRhdGEoJ21lc3NhZ2UtaWQnKSk7XG4gICAgcmV0dXJuICQuZ2V0KFwiL3Jlc291cmNlcy9jb252ZXJzYXRpb25zL1wiICsgdGhpcy5jb252ZXJzYXRpb24uaWQsIHtcbiAgICAgIGxhc3Q6IGxhc3RcbiAgICB9LCBmdW5jdGlvbihyKXtcbiAgICAgIHZhciBpZCwgcmVmJCwgdXNlcnM7XG4gICAgICBpZiAoci5zdWNjZXNzKSB7XG4gICAgICAgIGlkID0gKHJlZiQgPSByLm1lc3NhZ2VzWzBdKSAhPSBudWxsID8gcmVmJC5pZCA6IHZvaWQgODtcbiAgICAgICAgaWYgKCFpZCB8fCBpZCA+PSBsYXN0KSB7XG4gICAgICAgICAgdGhpcyQubG9hZGVkQWxsID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdXNlcnMgPSB0aGlzJC51c2VycygpO1xuICAgICAgICBlYWNoKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICByZXR1cm4gdGhpcyQucHJlcGVuZE1lc3NhZ2UoaXQpO1xuICAgICAgICB9KShcbiAgICAgICAgbWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgICBpdC5mcm9tID0gdXNlcnNbaXQudXNlcl9pZF07XG4gICAgICAgICAgcmV0dXJuIGl0O1xuICAgICAgICB9KShcbiAgICAgICAgci5tZXNzYWdlcykpO1xuICAgICAgICByZXR1cm4gdGhpcyQuJC5maW5kKCcubWVzc2FnZXMnKS5zY3JvbGxUb3AoMCArIDUwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcHJvdG90eXBlLm1pbmltaXplID0gZnVuY3Rpb24oZXYpe1xuICAgIHZhciBlO1xuICAgIGUgPSAkKGV2LnRhcmdldCk7XG4gICAgaWYgKGUuaGFzQ2xhc3MoJ25vLWNsaWNrJykpIHtcbiAgICAgIHJldHVybiBlLnJlbW92ZUNsYXNzKCduby1jbGljaycpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQudG9nZ2xlQ2xhc3MoJ21pbmltaXplZCcpO1xuICAgICAgcmV0dXJuIHRoaXMuJC5maW5kKCd0ZXh0YXJlYScpLmZvY3VzKCk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpe1xuICAgIHZhciBrZXksIHRoaXMkID0gdGhpcztcbiAgICBrZXkgPSB0aGlzLmtleSgpO1xuICAgIENoYXQuc3RvcCh0aGlzLmtleSgpKTtcbiAgICByZXR1cm4gc29ja2V0LmVtaXQoJ2NoYXQtbGVhdmUnLCB0aGlzLmNvbnZlcnNhdGlvbiwgZnVuY3Rpb24oZXJyLCByKXt9KTtcbiAgfTtcbiAgZnVuY3Rpb24gQ2hhdCgpe1xuICAgIHRoaXMuY2xvc2UgPSBiaW5kJCh0aGlzLCAnY2xvc2UnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMubWluaW1pemUgPSBiaW5kJCh0aGlzLCAnbWluaW1pemUnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMubG9hZE1vcmVNZXNzYWdlcyA9IGJpbmQkKHRoaXMsICdsb2FkTW9yZU1lc3NhZ2VzJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLm1heWJlTG9hZE1vcmUgPSBiaW5kJCh0aGlzLCAnbWF5YmVMb2FkTW9yZScsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5zZW5kTWVzc2FnZSA9IGJpbmQkKHRoaXMsICdzZW5kTWVzc2FnZScsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5tZXNzYWdlTm9kZSA9IGJpbmQkKHRoaXMsICdtZXNzYWdlTm9kZScsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5tZXNzYWdlRnJvbUVudiA9IGJpbmQkKHRoaXMsICdtZXNzYWdlRnJvbUVudicsIHByb3RvdHlwZSk7XG4gICAgdGhpcy51c2VycyA9IGJpbmQkKHRoaXMsICd1c2VycycsIHByb3RvdHlwZSk7XG4gICAgdGhpcy5rZXkgPSBiaW5kJCh0aGlzLCAna2V5JywgcHJvdG90eXBlKTtcbiAgICB0aGlzLm9uRGV0YWNoID0gYmluZCQodGhpcywgJ29uRGV0YWNoJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLm9uQXR0YWNoID0gYmluZCQodGhpcywgJ29uQXR0YWNoJywgcHJvdG90eXBlKTtcbiAgICBDaGF0LnN1cGVyY2xhc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuICByZXR1cm4gQ2hhdDtcbn0oQ29tcG9uZW50KSk7XG5DaGF0LnN0YXJ0ID0gZnVuY3Rpb24odXNlcnMsIG1lc3NhZ2VzLCB4LCB5KXtcbiAgdmFyIG1lLCBvdGhlcnMsIGtleSwgYywgJGRpdjtcbiAgbWUgPSB1c2Vyc1swXSwgb3RoZXJzID0gc2xpY2UkLmNhbGwodXNlcnMsIDEpO1xuICBtZXNzYWdlcyA9PSBudWxsICYmIChtZXNzYWdlcyA9IFtdKTtcbiAgeCA9PSBudWxsICYmICh4ID0gbnVsbCk7XG4gIHkgPT0gbnVsbCAmJiAoeSA9IG51bGwpO1xuICBrZXkgPSBqb2luKCcvJykoXG4gIG1hcChmdW5jdGlvbihpdCl7XG4gICAgcmV0dXJuIGl0Lm5hbWU7XG4gIH0sIHVzZXJzKSk7XG4gIGlmIChjID0gdGhpcy5jaGF0c1trZXldKSB7XG4gICAgcmV0dXJuIGM7XG4gIH1cbiAgJGRpdiA9ICQoJzxkaXYvPicpLmhpZGUoKTtcbiAgYyA9IHRoaXMuY2hhdHNba2V5XSA9IG5ldyBDaGF0KHtcbiAgICBsb2NhbHM6IHtcbiAgICAgIG1lOiBtZSxcbiAgICAgIG90aGVyczogb3RoZXJzXG4gICAgfVxuICB9LCAkZGl2KTtcbiAgaWYgKHggfHwgeSkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiAkZGl2LnNob3codGhpcy5kdXJhdGlvbiwgdGhpcy5lYXNpbmcpLmNzcyh7XG4gICAgICAgIHRvcDogJycsXG4gICAgICAgIGxlZnQ6ICcnXG4gICAgICB9KS50cmFuc2l0aW9uKHtcbiAgICAgICAgYm90dG9tOiB5LFxuICAgICAgICByaWdodDogeFxuICAgICAgfSk7XG4gICAgfSwgMjAwMCk7XG4gIH0gZWxzZSB7XG4gICAgYy4kLnNob3coKTtcbiAgfVxuICAkKCcjY2hhdF9kcmF3ZXInKS5hZnRlcihjLiQpO1xuICByZXR1cm4gJC5wb3N0KCcvcmVzb3VyY2VzL2NvbnZlcnNhdGlvbnMnLCB7XG4gICAgc2l0ZV9pZDogd2luZG93LnNpdGVJZCxcbiAgICB1c2VyczogdXNlcnNcbiAgfSwgZnVuY3Rpb24ocil7XG4gICAgdmFyIGkkLCBsZW4kLCBtO1xuICAgIGNvbnNvbGUubG9nKCdyJywgcik7XG4gICAgaWYgKHIubWVzc2FnZXMubGVuZ3RoID4gMCAmJiBtZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIG1lc3NhZ2VzID0gci5tZXNzYWdlcztcbiAgICB9XG4gICAgZm9yIChpJCA9IDAsIGxlbiQgPSBtZXNzYWdlcy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgbSA9IG1lc3NhZ2VzW2kkXTtcbiAgICAgIGMucHJlcGVuZE1lc3NhZ2UobSk7XG4gICAgfVxuICAgIGMuJC5maW5kKCd0ZXh0YXJlYScpLmZvY3VzKCk7XG4gICAgYy5jb252ZXJzYXRpb24gPSByO1xuICAgIGMucmVtZW1iZXJDaGF0KCk7XG4gICAgcmV0dXJuIGM7XG4gIH0pO1xufTtcbkNoYXQuc3RvcCA9IGZ1bmN0aW9uKGtleSl7XG4gIHZhciBjLCB0aGlzJCA9IHRoaXM7XG4gIGMgPSB0aGlzLmNoYXRzW2tleV07XG4gIGlmICghYykge1xuICAgIHJldHVybjtcbiAgfVxuICByZXR1cm4gYy4kLmZhZGVPdXQodGhpcy5kdXJhdGlvbiwgZnVuY3Rpb24oKXtcbiAgICB2YXIgcmVmJCwgcmVmMSQ7XG4gICAgYy4kLmVtcHR5KCkucmVtb3ZlKCk7XG4gICAgdGhpcyQucmVvcmdhbml6ZSgpO1xuICAgIGMuZm9yZ2V0Q2hhdCgpO1xuICAgIHJldHVybiByZWYxJCA9IChyZWYkID0gdGhpcyQuY2hhdHMpW2tleV0sIGRlbGV0ZSByZWYkW2tleV0sIHJlZjEkO1xuICB9KTtcbn07XG5DaGF0LnJlb3JnYW5pemUgPSBmdW5jdGlvbigpe1xuICB2YXIgJGNzLCB3aWR0aCwgbjtcbiAgJGNzID0gJCgnI2NoYXRfZHJhd2VyIC5DaGF0Jyk7XG4gIHdpZHRoID0gJGNzLmZpcnN0KCkud2lkdGgoKTtcbiAgbiA9ICRjcy5sZW5ndGg7XG4gIHJldHVybiAkY3MuZWFjaChmdW5jdGlvbihpLCBlKXtcbiAgICB2YXIgcmlnaHQ7XG4gICAgcmlnaHQgPSAobiAtIGkgLSAxKSAqICh3aWR0aCArIDgpICsgODtcbiAgICByZXR1cm4gJChlKS50cmFuc2l0aW9uKHtcbiAgICAgIHJpZ2h0OiByaWdodFxuICAgIH0sIHRoaXMuZHVyYXRpb24sIHRoaXMuZWFzaW5nKTtcbiAgfSk7XG59O1xuQ2hhdC5yZW1lbWJlciA9IGZ1bmN0aW9uKCl7XG4gIHZhciBpZHMsIHgsIHksIGkkLCBsZW4kLCBpZCwgcmVzdWx0cyQgPSBbXTtcbiAgaWRzID0gSlNPTi5wYXJzZSgkLmNvb2tpZSgnY2hhdHMnKSB8fCAnW10nKTtcbiAgeCA9IDAgKyA4O1xuICB5ID0gJCgnZm9vdGVyJykuaGVpZ2h0KCkgLSAxNDtcbiAgZm9yIChpJCA9IDAsIGxlbiQgPSBpZHMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICBpZCA9IGlkc1tpJF07XG4gICAgY29uc29sZS5sb2coJ2NoYXQtam9pbi1hbmQtb3BlbicsIGlkKTtcbiAgICByZXN1bHRzJC5wdXNoKGZuJCgpKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cyQ7XG4gIGZ1bmN0aW9uIGZuJCgpe1xuICAgIHJldHVybiAkLmdldChcIi9yZXNvdXJjZXMvY29udmVyc2F0aW9ucy9cIiArIGlkLCBmdW5jdGlvbihjKXtcbiAgICAgIHZhciBtZUZpcnN0LCBwZW9wbGUsIGNoYXQ7XG4gICAgICBjb25zb2xlLmxvZygnYycsIGMpO1xuICAgICAgaWYgKGMpIHtcbiAgICAgICAgbWVGaXJzdCA9IGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgIHZhciByZWYkO1xuICAgICAgICAgIHN3aXRjaCAoZmFsc2UpIHtcbiAgICAgICAgICBjYXNlIGEubmFtZSAhPT0gKChyZWYkID0gd2luZG93LnVzZXIpICE9IG51bGwgPyByZWYkLm5hbWUgOiB2b2lkIDgpOlxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHBlb3BsZSA9IHNvcnRXaXRoKG1lRmlyc3QsIGMucGFydGljaXBhbnRzKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3gteScsIHgsIHkpO1xuICAgICAgICBjaGF0ID0gQ2hhdC5zdGFydChwZW9wbGUsIGMubWVzc2FnZXMsIHgsIHkpO1xuICAgICAgICByZXR1cm4geCA9IHggKyAyMjAgKyA4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUud2Fybignbm8tY2hhdCcsIGlkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTtcbkNoYXQuY2xpZW50U29ja2V0SW5pdCA9IGZ1bmN0aW9uKHNvY2tldCl7XG4gIHZhciB0aGlzJCA9IHRoaXM7XG4gIHNvY2tldC5vbignY2hhdC1vcGVuJywgZnVuY3Rpb24oY29udmVyc2F0aW9uLCBjYil7XG4gICAgY29uc29sZS53YXJuKFwicmVjZWl2ZWQgcmVxdWVzdCB0byBvcGVuIGNoYXQgXCIgKyBjb252ZXJzYXRpb24uaWQsIGNvbnZlcnNhdGlvbik7XG4gICAgcmV0dXJuIHNvY2tldC5lbWl0KCdjaGF0LWpvaW4nLCBjb252ZXJzYXRpb24sIGZ1bmN0aW9uKGVyciwgYzIpe1xuICAgICAgdmFyIG1lRmlyc3QsIHBlb3BsZSwgbmFtZXMsIGtleSwgYztcbiAgICAgIGNvbnNvbGUubG9nKCdhZnRlci1jaGF0LWpvaW4nLCBlcnIsIGMyKTtcbiAgICAgIG1lRmlyc3QgPSBmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgdmFyIHJlZiQ7XG4gICAgICAgIHN3aXRjaCAoZmFsc2UpIHtcbiAgICAgICAgY2FzZSBhLm5hbWUgIT09ICgocmVmJCA9IHdpbmRvdy51c2VyKSAhPSBudWxsID8gcmVmJC5uYW1lIDogdm9pZCA4KTpcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBwZW9wbGUgPSBzb3J0V2l0aChtZUZpcnN0LCBjb252ZXJzYXRpb24ucGFydGljaXBhbnRzKTtcbiAgICAgIG5hbWVzID0gbWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgcmV0dXJuIGl0Lm5hbWU7XG4gICAgICB9LCBwZW9wbGUpO1xuICAgICAga2V5ID0gbmFtZXMuam9pbignLycpO1xuICAgICAgY29uc29sZS5sb2coJ2traycsIGtleSwgQ2hhdC5jaGF0c1trZXldKTtcbiAgICAgIGlmIChDaGF0LmNoYXRzW2tleV0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYyA9IENoYXQuc3RhcnQocGVvcGxlLCBjb252ZXJzYXRpb24ubWVzc2FnZXMpO1xuICAgICAgY29uc29sZS53YXJuKCdhZnRlci1jaGF0LXN0YXJ0Jyk7XG4gICAgICBjLmNvbnZlcnNhdGlvbiA9IGNvbnZlcnNhdGlvbjtcbiAgICAgIGMucm9vbSA9IGMyLnJvb207XG4gICAgICByZXR1cm4gY29uc29sZS53YXJuKCdlbmQtb2YtY2hhdC1vcGVuJywgYyA9PT0gQ2hhdC5jaGF0c1trZXldLCBjKTtcbiAgICB9KTtcbiAgfSk7XG4gIHNvY2tldC5vbignY2hhdC1tZXNzYWdlJywgZnVuY3Rpb24obXNnLCBjYil7XG4gICAgdmFyIGM7XG4gICAgY29uc29sZS5sb2coJ2luY29taW5nLWNoYXQnLCBtc2cpO1xuICAgIGlmIChtc2cuZnJvbS5pZCA9PT0gKHR5cGVvZiB1c2VyICE9ICd1bmRlZmluZWQnICYmIHVzZXIgIT09IG51bGwgPyB1c2VyLmlkIDogdm9pZCA4KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjID0gT2JqLmZpbmQoZnVuY3Rpb24oaXQpe1xuICAgICAgdmFyIHJlZiQ7XG4gICAgICByZXR1cm4gKChyZWYkID0gaXQuY29udmVyc2F0aW9uKSAhPSBudWxsID8gcmVmJC5pZCA6IHZvaWQgOCkgPT09IG1zZy5jb252ZXJzYXRpb25faWQ7XG4gICAgfSwgQ2hhdC5jaGF0cyk7XG4gICAgaWYgKGMpIHtcbiAgICAgIHJldHVybiBjLmFwcGVuZE1lc3NhZ2UobXNnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignY2hhdC1tZXNzYWdlJywgJ2Mgbm90IGZvdW5kJywgbXNnKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gQ2hhdC5yZW1lbWJlcigpO1xufTtcbmZ1bmN0aW9uIGN1cnJ5JChmLCBib3VuZCl7XG4gIHZhciBjb250ZXh0LFxuICBfY3VycnkgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgcmV0dXJuIGYubGVuZ3RoID4gMSA/IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcGFyYW1zID0gYXJncyA/IGFyZ3MuY29uY2F0KCkgOiBbXTtcbiAgICAgIGNvbnRleHQgPSBib3VuZCA/IGNvbnRleHQgfHwgdGhpcyA6IHRoaXM7XG4gICAgICByZXR1cm4gcGFyYW1zLnB1c2guYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpIDxcbiAgICAgICAgICBmLmxlbmd0aCAmJiBhcmd1bWVudHMubGVuZ3RoID9cbiAgICAgICAgX2N1cnJ5LmNhbGwoY29udGV4dCwgcGFyYW1zKSA6IGYuYXBwbHkoY29udGV4dCwgcGFyYW1zKTtcbiAgICB9IDogZjtcbiAgfTtcbiAgcmV0dXJuIF9jdXJyeSgpO1xufVxuZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG59XG5mdW5jdGlvbiBleHRlbmQkKHN1Yiwgc3VwKXtcbiAgZnVuY3Rpb24gZnVuKCl7fSBmdW4ucHJvdG90eXBlID0gKHN1Yi5zdXBlcmNsYXNzID0gc3VwKS5wcm90b3R5cGU7XG4gIChzdWIucHJvdG90eXBlID0gbmV3IGZ1bikuY29uc3RydWN0b3IgPSBzdWI7XG4gIGlmICh0eXBlb2Ygc3VwLmV4dGVuZGVkID09ICdmdW5jdGlvbicpIHN1cC5leHRlbmRlZChzdWIpO1xuICByZXR1cm4gc3ViO1xufVxuZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgcmV0dXJuIG9iajtcbn0iLCIvKlxuZXhwb3J0IGV4YW1wbGUgPVxuICBBOlxuICAgIGE6IFwiQlwiXG4gICAgYjogXCJDXCJcbiAgQjpcbiAgICBhOiBcIkFcIlxuICAgIGI6IFwiQ1wiXG4gIEM6XG4gICAgYTogXCJDXCJcbiAgICBiOiBcIkNcIlxuKi9cbnZhciBuZXdTdGF0ZSwgb3V0JCA9IHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnICYmIGV4cG9ydHMgfHwgdGhpcztcbm91dCQubmV3U3RhdGUgPSBuZXdTdGF0ZSA9IGZ1bmN0aW9uKG1hY2hpbmUsIHN0YXRlLCBpbnB1dHMpe1xuICB2YXIgdHJhbnNpdGlvbjtcbiAgdHJhbnNpdGlvbiA9IGZ1bmN0aW9uKHMsIGkpe1xuICAgIHJldHVybiBtYWNoaW5lW3NdW2ldO1xuICB9O1xuICByZXR1cm4gZm9sZCh0cmFuc2l0aW9uLCBzdGF0ZSwgaW5wdXRzKTtcbn07IiwiXG5tb2R1bGUuZXhwb3J0cyA9IGphZGUgPSAoZnVuY3Rpb24oZXhwb3J0cyl7XG4vKiFcbiAqIEphZGUgLSBydW50aW1lXG4gKiBDb3B5cmlnaHQoYykgMjAxMCBUSiBIb2xvd2F5Y2h1ayA8dGpAdmlzaW9uLW1lZGlhLmNhPlxuICogTUlUIExpY2Vuc2VkXG4gKi9cblxuLyoqXG4gKiBMYW1lIEFycmF5LmlzQXJyYXkoKSBwb2x5ZmlsbCBmb3Igbm93LlxuICovXG5cbmlmICghQXJyYXkuaXNBcnJheSkge1xuICBBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24oYXJyKXtcbiAgICByZXR1cm4gJ1tvYmplY3QgQXJyYXldJyA9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBMYW1lIE9iamVjdC5rZXlzKCkgcG9seWZpbGwgZm9yIG5vdy5cbiAqL1xuXG5pZiAoIU9iamVjdC5rZXlzKSB7XG4gIE9iamVjdC5rZXlzID0gZnVuY3Rpb24ob2JqKXtcbiAgICB2YXIgYXJyID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIGFyci5wdXNoKGtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH1cbn1cblxuLyoqXG4gKiBNZXJnZSB0d28gYXR0cmlidXRlIG9iamVjdHMgZ2l2aW5nIHByZWNlZGVuY2VcbiAqIHRvIHZhbHVlcyBpbiBvYmplY3QgYGJgLiBDbGFzc2VzIGFyZSBzcGVjaWFsLWNhc2VkXG4gKiBhbGxvd2luZyBmb3IgYXJyYXlzIGFuZCBtZXJnaW5nL2pvaW5pbmcgYXBwcm9wcmlhdGVseVxuICogcmVzdWx0aW5nIGluIGEgc3RyaW5nLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBhXG4gKiBAcGFyYW0ge09iamVjdH0gYlxuICogQHJldHVybiB7T2JqZWN0fSBhXG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5leHBvcnRzLm1lcmdlID0gZnVuY3Rpb24gbWVyZ2UoYSwgYikge1xuICB2YXIgYWMgPSBhWydjbGFzcyddO1xuICB2YXIgYmMgPSBiWydjbGFzcyddO1xuXG4gIGlmIChhYyB8fCBiYykge1xuICAgIGFjID0gYWMgfHwgW107XG4gICAgYmMgPSBiYyB8fCBbXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWMpKSBhYyA9IFthY107XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGJjKSkgYmMgPSBbYmNdO1xuICAgIGFjID0gYWMuZmlsdGVyKG51bGxzKTtcbiAgICBiYyA9IGJjLmZpbHRlcihudWxscyk7XG4gICAgYVsnY2xhc3MnXSA9IGFjLmNvbmNhdChiYykuam9pbignICcpO1xuICB9XG5cbiAgZm9yICh2YXIga2V5IGluIGIpIHtcbiAgICBpZiAoa2V5ICE9ICdjbGFzcycpIHtcbiAgICAgIGFba2V5XSA9IGJba2V5XTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYTtcbn07XG5cbi8qKlxuICogRmlsdGVyIG51bGwgYHZhbGBzLlxuICpcbiAqIEBwYXJhbSB7TWl4ZWR9IHZhbFxuICogQHJldHVybiB7TWl4ZWR9XG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5mdW5jdGlvbiBudWxscyh2YWwpIHtcbiAgcmV0dXJuIHZhbCAhPSBudWxsO1xufVxuXG4vKipcbiAqIFJlbmRlciB0aGUgZ2l2ZW4gYXR0cmlidXRlcyBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9ialxuICogQHBhcmFtIHtPYmplY3R9IGVzY2FwZWRcbiAqIEByZXR1cm4ge1N0cmluZ31cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmV4cG9ydHMuYXR0cnMgPSBmdW5jdGlvbiBhdHRycyhvYmosIGVzY2FwZWQpe1xuICB2YXIgYnVmID0gW11cbiAgICAsIHRlcnNlID0gb2JqLnRlcnNlO1xuXG4gIGRlbGV0ZSBvYmoudGVyc2U7XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKVxuICAgICwgbGVuID0ga2V5cy5sZW5ndGg7XG5cbiAgaWYgKGxlbikge1xuICAgIGJ1Zi5wdXNoKCcnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXVxuICAgICAgICAsIHZhbCA9IG9ialtrZXldO1xuXG4gICAgICBpZiAoJ2Jvb2xlYW4nID09IHR5cGVvZiB2YWwgfHwgbnVsbCA9PSB2YWwpIHtcbiAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgIHRlcnNlXG4gICAgICAgICAgICA/IGJ1Zi5wdXNoKGtleSlcbiAgICAgICAgICAgIDogYnVmLnB1c2goa2V5ICsgJz1cIicgKyBrZXkgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgwID09IGtleS5pbmRleE9mKCdkYXRhJykgJiYgJ3N0cmluZycgIT0gdHlwZW9mIHZhbCkge1xuICAgICAgICBidWYucHVzaChrZXkgKyBcIj0nXCIgKyBKU09OLnN0cmluZ2lmeSh2YWwpICsgXCInXCIpO1xuICAgICAgfSBlbHNlIGlmICgnY2xhc3MnID09IGtleSAmJiBBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICAgICAgYnVmLnB1c2goa2V5ICsgJz1cIicgKyBleHBvcnRzLmVzY2FwZSh2YWwuam9pbignICcpKSArICdcIicpO1xuICAgICAgfSBlbHNlIGlmIChlc2NhcGVkICYmIGVzY2FwZWRba2V5XSkge1xuICAgICAgICBidWYucHVzaChrZXkgKyAnPVwiJyArIGV4cG9ydHMuZXNjYXBlKHZhbCkgKyAnXCInKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1Zi5wdXNoKGtleSArICc9XCInICsgdmFsICsgJ1wiJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJ1Zi5qb2luKCcgJyk7XG59O1xuXG4vKipcbiAqIEVzY2FwZSB0aGUgZ2l2ZW4gc3RyaW5nIG9mIGBodG1sYC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaHRtbFxuICogQHJldHVybiB7U3RyaW5nfVxuICogQGFwaSBwcml2YXRlXG4gKi9cblxuZXhwb3J0cy5lc2NhcGUgPSBmdW5jdGlvbiBlc2NhcGUoaHRtbCl7XG4gIHJldHVybiBTdHJpbmcoaHRtbClcbiAgICAucmVwbGFjZSgvJig/IShcXHcrfFxcI1xcZCspOykvZywgJyZhbXA7JylcbiAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXG4gICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgIC5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyk7XG59O1xuXG4vKipcbiAqIFJlLXRocm93IHRoZSBnaXZlbiBgZXJyYCBpbiBjb250ZXh0IHRvIHRoZVxuICogdGhlIGphZGUgaW4gYGZpbGVuYW1lYCBhdCB0aGUgZ2l2ZW4gYGxpbmVub2AuXG4gKlxuICogQHBhcmFtIHtFcnJvcn0gZXJyXG4gKiBAcGFyYW0ge1N0cmluZ30gZmlsZW5hbWVcbiAqIEBwYXJhbSB7U3RyaW5nfSBsaW5lbm9cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmV4cG9ydHMucmV0aHJvdyA9IGZ1bmN0aW9uIHJldGhyb3coZXJyLCBmaWxlbmFtZSwgbGluZW5vKXtcbiAgaWYgKCFmaWxlbmFtZSkgdGhyb3cgZXJyO1xuXG4gIHZhciBjb250ZXh0ID0gM1xuICAgICwgc3RyID0gcmVxdWlyZSgnZnMnKS5yZWFkRmlsZVN5bmMoZmlsZW5hbWUsICd1dGY4JylcbiAgICAsIGxpbmVzID0gc3RyLnNwbGl0KCdcXG4nKVxuICAgICwgc3RhcnQgPSBNYXRoLm1heChsaW5lbm8gLSBjb250ZXh0LCAwKVxuICAgICwgZW5kID0gTWF0aC5taW4obGluZXMubGVuZ3RoLCBsaW5lbm8gKyBjb250ZXh0KTtcblxuICAvLyBFcnJvciBjb250ZXh0XG4gIHZhciBjb250ZXh0ID0gbGluZXMuc2xpY2Uoc3RhcnQsIGVuZCkubWFwKGZ1bmN0aW9uKGxpbmUsIGkpe1xuICAgIHZhciBjdXJyID0gaSArIHN0YXJ0ICsgMTtcbiAgICByZXR1cm4gKGN1cnIgPT0gbGluZW5vID8gJyAgPiAnIDogJyAgICAnKVxuICAgICAgKyBjdXJyXG4gICAgICArICd8ICdcbiAgICAgICsgbGluZTtcbiAgfSkuam9pbignXFxuJyk7XG5cbiAgLy8gQWx0ZXIgZXhjZXB0aW9uIG1lc3NhZ2VcbiAgZXJyLnBhdGggPSBmaWxlbmFtZTtcbiAgZXJyLm1lc3NhZ2UgPSAoZmlsZW5hbWUgfHwgJ0phZGUnKSArICc6JyArIGxpbmVub1xuICAgICsgJ1xcbicgKyBjb250ZXh0ICsgJ1xcblxcbicgKyBlcnIubWVzc2FnZTtcbiAgdGhyb3cgZXJyO1xufTtcblxuICByZXR1cm4gZXhwb3J0cztcblxufSkoe30pO1xuXG5qYWRlLnRlbXBsYXRlcyA9IHt9O1xuamFkZS5yZW5kZXIgPSBmdW5jdGlvbihub2RlLCB0ZW1wbGF0ZSwgZGF0YSkge1xuICB2YXIgdG1wID0gamFkZS50ZW1wbGF0ZXNbdGVtcGxhdGVdKGRhdGEpO1xuICBub2RlLmlubmVySFRNTCA9IHRtcDtcbn07XG5cbmphZGUudGVtcGxhdGVzW1wiQWRtaW5NZW51XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxsaSBjbGFzcz1cImRlZmF1bHRcIj48ZGl2PjxpbnB1dCB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiVGl0bGVcIiBjbGFzcz1cInJvd1wiLz48L2Rpdj48L2xpPjxmb3JtJyk7XG5idWYucHVzaChhdHRycyh7ICdhY3Rpb24nOihcIi9yZXNvdXJjZXMvc2l0ZXMvXCIgKyAoc2l0ZS5pZCkgKyBcIlwiKSwgJ21ldGhvZCc6KFwicHV0XCIpLCBcImNsYXNzXCI6ICgnbWVudXMnKSArICcgJyArICgnb25jbGljay1zdWJtaXQnKSB9LCB7XCJhY3Rpb25cIjp0cnVlLFwibWV0aG9kXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiYWN0aW9uXCIgdmFsdWU9XCJtZW51XCIvPjxkaXYgY2xhc3M9XCJjb2wxXCI+PGJ1dHRvbiBjbGFzcz1cIm9uY2xpY2stYWRkXCI+QWRkPC9idXR0b24+PG9sIGNsYXNzPVwic29ydGFibGVcIj48L29sPjwvZGl2PjxkaXYgY2xhc3M9XCJjb2wyXCI+PGZpZWxkc2V0PjxsYWJlbCBjbGFzcz1cInR5cGVcIj5UeXBlPC9sYWJlbD48dWwgY2xhc3M9XCJvcHRpb25zXCI+PGxpPjxsYWJlbCBmb3I9XCJmb3J1bVwiIGNsYXNzPVwiaGVhZGVyXCI+Rm9ydW08L2xhYmVsPjxpbnB1dCBpZD1cImZvcnVtXCIgdHlwZT1cInJhZGlvXCIgbmFtZT1cImRpYWxvZ1wiIGNoZWNrZWQ9XCJjaGVja2VkXCIgY2xhc3M9XCJvcHRpb25cIi8+PGRpdiBjbGFzcz1cImRpYWxvZ1wiPjxsYWJlbCBmb3I9XCJmb3J1bV9zbHVnXCI+U2x1ZzwvbGFiZWw+PGlucHV0IGlkPVwiZm9ydW1fc2x1Z1wiIHR5cGU9XCJ0ZXh0XCIgbmFtZT1cImZvcnVtU2x1Z1wiLz48ZGl2IGNsYXNzPVwibm90ZVwiPlVSTCBzdWZmaXggZm9yIHRoaXMgcGFnZTwvZGl2PjxkaXYgY2xhc3M9XCJicmVha1wiPjwvZGl2PjxsYWJlbCBmb3I9XCJsb2NrZWRcIj5BZG1pbiBPbmx5PC9sYWJlbD48ZGl2IGNsYXNzPVwiYm94XCI+PGlucHV0IGlkPVwibG9ja2VkXCIgdHlwZT1cImNoZWNrYm94XCIgdmFsdWU9XCJjaGVja2VkXCIgbmFtZT1cImxvY2tlZFwiLz48bGFiZWwgZm9yPVwibG9ja2VkXCIgY2xhc3M9XCJzd2l0Y2gtY29udHJvbFwiPjxkaXYgY2xhc3M9XCJzd2l0Y2hcIj48L2Rpdj48L2xhYmVsPjxzcGFuIGNsYXNzPVwibGFiZWwgY2hlY2tlZFwiPkxvY2tlZDwvc3Bhbj48ZGl2IGNsYXNzPVwibm90ZVwiPkxvY2sgZW50aXJlIGZvcnVtIChyZWFkLW9ubHkgZXhjZXB0IGFkbWluKTwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJicmVha1wiPiAgIDwvZGl2PjxsYWJlbCBmb3I9XCJjb21tZW50c1wiPkNvbW1lbnRzPC9sYWJlbD48ZGl2IGNsYXNzPVwiYm94XCI+PGlucHV0IGlkPVwiY29tbWVudHNcIiB0eXBlPVwiY2hlY2tib3hcIiB2YWx1ZT1cImNoZWNrZWRcIiBuYW1lPVwiY29tbWVudHNcIi8+PGxhYmVsIGZvcj1cImNvbW1lbnRzXCIgY2xhc3M9XCJzd2l0Y2gtY29udHJvbFwiPjxkaXYgY2xhc3M9XCJzd2l0Y2hcIj48L2Rpdj48L2xhYmVsPjxzcGFuIGNsYXNzPVwibGFiZWwgY2hlY2tlZFwiPlllczwvc3Bhbj48ZGl2IGNsYXNzPVwibm90ZVwiPkNvbW1lbnRhYmxlIGZvcnVtcyBhcmUgdGhyZWFkZWQgbGlrZSBSZWRkaXQ8L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPVwiYnJlYWtcIj4gICA8L2Rpdj48YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIlNhdmVcIj5TYXZlPC9idXR0b24+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48L2Rpdj48L2xpPjxsaT48bGFiZWwgZm9yPVwicGFnZVwiIGNsYXNzPVwiaGVhZGVyXCI+UGFnZTwvbGFiZWw+PGlucHV0IGlkPVwicGFnZVwiIHR5cGU9XCJyYWRpb1wiIG5hbWU9XCJkaWFsb2dcIiBjbGFzcz1cIm9wdGlvblwiLz48ZGl2IGNsYXNzPVwiZGlhbG9nXCI+PGxhYmVsIGZvcj1cInBhZ2Vfc2x1Z1wiPlNsdWc8L2xhYmVsPjxpbnB1dCBpZD1cInBhZ2Vfc2x1Z1wiIHR5cGU9XCJ0ZXh0XCIgbmFtZT1cInBhZ2VTbHVnXCIvPjxkaXYgY2xhc3M9XCJub3RlXCI+VVJMIHN1ZmZpeCBmb3IgdGhpcyBwYWdlPC9kaXY+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGxhYmVsPk1haW4gTWVudTwvbGFiZWw+PGRpdiBjbGFzcz1cImJveFwiPjxpbnB1dCBpZD1cImhpZGVfbWVudVwiIHR5cGU9XCJjaGVja2JveFwiIHZhbHVlPVwiY2hlY2tlZFwiIG5hbWU9XCJoaWRlTWVudVwiLz48bGFiZWwgZm9yPVwiaGlkZV9tZW51XCIgY2xhc3M9XCJzd2l0Y2gtY29udHJvbFwiPjxkaXYgY2xhc3M9XCJzd2l0Y2hcIj48L2Rpdj48L2xhYmVsPjxzcGFuIGNsYXNzPVwibGFiZWwgY2hlY2tlZFwiPk9uPC9zcGFuPjxkaXYgY2xhc3M9XCJub3RlXCI+U2hvd3MgJmFtcDsgaGlkZXMgdGhlIG1haW4gbWVudSBmb3IgdGhpcyBwYWdlPC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGxhYmVsIGZvcj1cImJvZHlcIj5Cb2R5PC9sYWJlbD48dGV4dGFyZWEgaWQ9XCJib2R5XCIgbmFtZT1cImJvZHlcIj48L3RleHRhcmVhPjxkaXYgY2xhc3M9XCJub3RlXCI+UGFzdGUgdGhlIGNvbnRlbnRzIG9mIHRoZSBwYWdlIGFib3ZlPC9kaXY+PGRpdiBjbGFzcz1cImJyZWFrXCI+ICAgPC9kaXY+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJTYXZlXCI+U2F2ZTwvYnV0dG9uPjxkaXYgY2xhc3M9XCJ0b29sdGlwXCI+PC9kaXY+PC9kaXY+PC9saT48bGk+PGxhYmVsIGZvcj1cImxpbmtcIiBjbGFzcz1cImhlYWRlclwiPkV4dGVybmFsIExpbms8L2xhYmVsPjxpbnB1dCBpZD1cImxpbmtcIiB0eXBlPVwicmFkaW9cIiBuYW1lPVwiZGlhbG9nXCIgY2xhc3M9XCJvcHRpb25cIi8+PGRpdiBjbGFzcz1cImRpYWxvZ1wiPjxsYWJlbCBmb3I9XCJ1cmxcIj5Vcmw8L2xhYmVsPjxpbnB1dCBpZD1cInVybFwiIHR5cGU9XCJ0ZXh0XCIgbmFtZT1cInVybFwiIHBsYWNlaG9sZGVyPVwiaHR0cDovL1wiLz48ZGl2IGNsYXNzPVwiYnJlYWtcIj48L2Rpdj48bGFiZWwgZm9yPVwic2VwYXJhdGVfdGFiXCI+U2VwYXJhdGUgVGFiPC9sYWJlbD48ZGl2IGNsYXNzPVwiYm94XCI+PGlucHV0IGlkPVwic2VwYXJhdGVfdGFiXCIgdHlwZT1cImNoZWNrYm94XCIgdmFsdWU9XCJjaGVja2VkXCIgbmFtZT1cInNlcGFyYXRlVGFiXCIvPjxsYWJlbCBmb3I9XCJzZXBhcmF0ZV90YWJcIiBjbGFzcz1cInN3aXRjaC1jb250cm9sXCI+PGRpdiBjbGFzcz1cInN3aXRjaFwiPjwvZGl2PjwvbGFiZWw+PHNwYW4gY2xhc3M9XCJsYWJlbCBjaGVja2VkXCI+WWVzPC9zcGFuPjxkaXYgY2xhc3M9XCJub3RlXCI+T3BlbiBsaW5rIGluIHNlcGFyYXRlIHdpbmRvdzwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJicmVha1wiPiAgIDwvZGl2PjxidXR0b24gdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiU2F2ZVwiPlNhdmU8L2J1dHRvbj48ZGl2IGNsYXNzPVwidG9vbHRpcFwiPjwvZGl2PjwvZGl2PjwvbGk+PC91bD48L2ZpZWxkc2V0PjwvZGl2PjwvZm9ybT4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiQWRtaW5VcGdyYWRlXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIHByb2R1Y3RfbWl4aW4gPSBmdW5jdGlvbihwLCBtc2cpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmlmICggc3Vic2NyaXB0aW9ucy5pbmRleE9mKHApPT0tMSlcbntcbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7IFwiY2xhc3NcIjogKFwiXCIgKyAocCkgKyBcIi1hdmFpbGFibGVcIikgfSwge1wiY2xhc3NcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48YnV0dG9uJyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2J1dHRvbicpLCAnZGF0YS1wcm9kdWN0JzoocCksICd2YWx1ZSc6KCdHZXQgSXQnKSwgXCJjbGFzc1wiOiAoJ29uY2xpY2stYnV5JykgfSwge1widHlwZVwiOnRydWUsXCJkYXRhLXByb2R1Y3RcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5HZXQgSXQ8L2J1dHRvbj48L2Rpdj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7IFwiY2xhc3NcIjogKFwiXCIgKyAocCkgKyBcIi1wdXJjaGFzZWQgaGlkZGVuXCIpIH0sIHtcImNsYXNzXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PHAgY2xhc3M9XCJncmVlblwiPicpO1xudmFyIF9fdmFsX18gPSBtc2dcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxzcGFuPiYjeDI3MTM7PC9zcGFuPjwvcD48L2Rpdj4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7IFwiY2xhc3NcIjogKFwiXCIgKyAocCkgKyBcIi1hdmFpbGFibGUgaGlkZGVuXCIpIH0sIHtcImNsYXNzXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGJ1dHRvbicpO1xuYnVmLnB1c2goYXR0cnMoeyAndHlwZSc6KCdidXR0b24nKSwgJ2RhdGEtcHJvZHVjdCc6KHApLCAndmFsdWUnOignR2V0IEl0JyksIFwiY2xhc3NcIjogKCdvbmNsaWNrLWJ1eScpIH0sIHtcInR5cGVcIjp0cnVlLFwiZGF0YS1wcm9kdWN0XCI6dHJ1ZSxcInZhbHVlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+R2V0IEl0PC9idXR0b24+PC9kaXY+PGRpdicpO1xuYnVmLnB1c2goYXR0cnMoeyBcImNsYXNzXCI6IChcIlwiICsgKHApICsgXCItcHVyY2hhc2VkXCIpIH0sIHtcImNsYXNzXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PHAgY2xhc3M9XCJncmVlblwiPicpO1xudmFyIF9fdmFsX18gPSBtc2dcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxzcGFuPiYjeDI3MTM7PC9zcGFuPjwvcD48L2Rpdj4nKTtcbn1cbn07XG5idWYucHVzaCgnPGZpZWxkc2V0PjxoMj5DdXN0b20gRG9tYWluPC9oMj48cD5BZGQgeW91ciBvd24gcGVyc29uYWwgZmxhaXIhICBHZXQgc2VyaW91cyBhbmQgYWltIGFueSBkb21haW4gYXQgeW91ciBQb3dlckJ1bGxldGluIHNpdGUuPC9wPicpO1xucHJvZHVjdF9taXhpbignY3VzdG9tX2RvbWFpbicsICdDdXN0b20gRG9tYWluIFB1cmNoYXNlZCcpO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJub3Rlc1wiPjxhIGhyZWY9XCIvYWRtaW4vZG9tYWluc1wiIGNsYXNzPVwibXV0YW50XCI+Q2xpY2sgaGVyZSB0byBicmluZyB5b3VyIGRvbWFpbnMgb25saW5lITwvYT48L2Rpdj48L2ZpZWxkc2V0PjxmaWVsZHNldD48aDI+R28gUHJpdmF0ZTwvaDI+PHA+UHJpdmFjeT8gIFdlIGdvdCB5b3UgY292ZXJlZC4gIFRoaXMgZmVhdHVyZSBoaWRlcyB5b3VyIGNvbnRlbnQgZnJvbSBTZWFyY2ggRW5naW5lcyBhbmQgdGhlIHB1YmxpYy48L3A+Jyk7XG5wcm9kdWN0X21peGluKCdwcml2YXRlJywgJ1ByaXZhdGUgU2l0ZSBQdXJjaGFzZWQnKTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwibm90ZXNcIj48YSBocmVmPVwiL2FkbWluXCIgY2xhc3M9XCJtdXRhbnRcIj5DbGljayBoZXJlIHRvIHRvZ2dsZSBwcml2YWN5IHNldHRpbmdzITwvYT48L2Rpdj48L2ZpZWxkc2V0PjxmaWVsZHNldD48aDI+QW5hbHl0aWNzPC9oMj48cD5Zb3VyIGVudGVycHJpc2luZyBQb3dlckJ1bGxldGluIGNvbW11bml0eSBpcyBidXN0bGluZyEgIEtub3cgd2hvLCB3aGVyZSBhbmQgaG93IHdpdGggeW91ciBmYXZvcml0ZSBhbmFseXRpY3MgdHJhY2tlci48L3A+Jyk7XG5wcm9kdWN0X21peGluKCdhbmFseXRpY3MnLCAnQW5hbHl0aWNzIFB1cmNoYXNlZCcpO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJub3Rlc1wiPjxhIGhyZWY9XCIvYWRtaW5cIiBjbGFzcz1cIm11dGFudFwiPkdldCBzdGFydGVkIHdpdGggYW5hbHl0aWNzIGhlcmUhPC9hPjwvZGl2PjwvZmllbGRzZXQ+PGZpZWxkc2V0PjxoMj5TdXBlciBDb21wdXRpbmcgSW5zdGFuY2U8L2gyPjxwPllvdXIgc2l0ZSByZWFsbHkgdG9vayBvZmYgYW5kIHlvdVxcJ2QgbGlrZSBtb3JlIGhvcnNlcG93ZXItLXNwZWVkIGlzIGV2ZXJ5dGhpbmchICBXaXRoIHlvdXIgdHVyYm8tY2hhcmdlZCBpbnN0YW5jZSBjb21lcyBhZGRpdGlvbmFsIHNlY3VyaXR5LCBtb25pdG9yaW5nIGFuZCBwZWFjZSBvZiBtaW5kLjwvcD4nKTtcbnByb2R1Y3RfbWl4aW4oJ2NvbXB1dGVfaW5zdGFuY2UnLCAnU3VwZXIgQ29tcHV0aW5nIEluc3RhbmNlIFB1cmNoYXNlZCcpO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJub3Rlc1wiPjxwPkEgUG93ZXJCdWxsZXRpbiB0ZWFtIG1lbWJlciB3aWxsIGNvbnRhY3QgeW91IGFmdGVyIHB1cmNoYXNlITwvcD48L2Rpdj48L2ZpZWxkc2V0PjxmaWVsZHNldD48aDI+RW5naW5lZXJpbmcgJmFtcDsgQ3JlYXRpdmU8L2gyPjxwPk5lZWQgZXh0cmEgcGVyc29uYWxpemF0aW9uIGZvciB5b3VyIFBvd2VyQnVsbGV0aW4gY29tbXVuaXR5PyAgT3VyIGVuZ2luZWVyaW5nIG5pbmphcyBlbnRlcnRhaW4gaW52ZW50aXZlIGlkZWFzITwvcD4nKTtcbnByb2R1Y3RfbWl4aW4oJ2VuZ2luZWVyaW5nJywgJ0VuZ2luZWVyaW5nIFB1cmNoYXNlZCcpO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJub3Rlc1wiPjxwPkEgUG93ZXJCdWxsZXRpbiB0ZWFtIG1lbWJlciB3aWxsIGNvbnRhY3QgeW91IGFmdGVyIHB1cmNoYXNlITwvcD48L2Rpdj48L2ZpZWxkc2V0PicpO1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJBdXRoXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIgY2xhc3M9XCJyZXNldFwiPjxmb3JtIG1ldGhvZD1cInBvc3RcIiBhY3Rpb249XCIvYXV0aC9yZXNldC1wYXNzd29yZFwiPjxsYWJlbCBmb3I9XCJwYXNzd29yZFwiPjxoMj5BdXRoZW50aWNhdGluZy4uLjwvaDI+PC9sYWJlbD48ZmllbGRzZXQ+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48aW5wdXQgaWQ9XCJwYXNzd29yZFwiIG5hbWU9XCJwYXNzd29yZFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJQYXNzd29yZFwiIGRpc2FibGVkPVwiZGlzYWJsZWRcIiBhdXRvY29tcGxldGU9XCJvZmZcIi8+PGRpdiBjbGFzcz1cInRvZ2dsZS1wYXNzd29yZFwiPkhpZGU8L2Rpdj48ZGl2IHRpdGxlPVwiU3Ryb25nZXIgcGFzc3dvcmRzIGFyZSBncmVlblwiIGNsYXNzPVwic3RyZW5ndGgtbWV0ZXJcIj48ZGl2IGNsYXNzPVwic3RyZW5ndGhcIj48L2Rpdj48L2Rpdj48aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJmb3Jnb3RcIi8+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJTYXZlXCIgZGlzYWJsZWQ9XCJkaXNhYmxlZFwiPlNhdmU8L2J1dHRvbj48YSBjbGFzcz1cIm1zZyBvbmNsaWNrLXNob3ctbG9naW5cIj48aDM+QmFjazwvaDM+PC9hPjwvZmllbGRzZXQ+PC9mb3JtPjwvZGl2PjxkaXYgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIgY2xhc3M9XCJjaG9vc2VcIj48Zm9ybSBtZXRob2Q9XCJwb3N0XCIgYWN0aW9uPVwiL2F1dGgvY2hvb3NlLXVzZXJuYW1lXCI+PGxhYmVsIGZvcj1cInVzZXJuYW1lXCI+PGgyPkNob29zZSBhIFVzZXIgTmFtZTxpPiE8L2k+PC9oMj48L2xhYmVsPjxmaWVsZHNldD48ZGl2IGNsYXNzPVwidG9vbHRpcFwiPjwvZGl2PjxpbnB1dCBpZD1cInVzZXJuYW1lXCIgbmFtZT1cInVzZXJuYW1lXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIlVzZXJuYW1lXCIvPjxidXR0b24gdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiU2F2ZVwiPlNhdmU8L2J1dHRvbj48YSBjbGFzcz1cIm1zZyBvbmNsaWNrLXNob3ctbG9naW5cIj48aDM+QmFjazwvaDM+PC9hPjwvZmllbGRzZXQ+PC9mb3JtPjwvZGl2PjxkaXYgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIgY2xhc3M9XCJmb3Jnb3RcIj48Zm9ybSBtZXRob2Q9XCJwb3N0XCIgYWN0aW9uPVwiL2F1dGgvZm9yZ290XCI+PGxhYmVsIGZvcj1cImVtYWlsXCI+PGgyPlRlbGwgVXMgWW91ciBFbWFpbCBBZGRyZXNzPGk+ITwvaT48L2gyPjwvbGFiZWw+PGZpZWxkc2V0PjxkaXYgY2xhc3M9XCJ0b29sdGlwXCI+PC9kaXY+PGlucHV0IGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiRW1haWxcIiBtYXhsZW5ndGg9XCIyNTRcIi8+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJTZW5kIFJlc2V0XCI+U2VuZCBSZXNldDwvYnV0dG9uPjxhIGNsYXNzPVwibXNnIG9uY2xpY2stc2hvdy1sb2dpblwiPjxoMz5CYWNrPC9oMz48L2E+PC9maWVsZHNldD48L2Zvcm0+PC9kaXY+PGRpdiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIiBjbGFzcz1cImRpYWxvZ1wiPjxoMiBpZD1cIm1zZ1wiPkNoZWNrIHlvdXIgaW5ib3ggZm9yIGFjdGl2YXRpb248aT4hPC9pPjwvaDI+PGRpdiBjbGFzcz1cIm1zZzJcIj48L2Rpdj48YSBjbGFzcz1cIm1zZyBvbmNsaWNrLWNsb3NlLWZhbmN5Ym94XCI+PGgzPkNsb3NlPC9oMz48L2E+PC9kaXY+PGRpdiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIiBjbGFzcz1cInJlZ2lzdGVyXCI+PGZvcm0gbWV0aG9kPVwicG9zdFwiIGFjdGlvbj1cIi9hdXRoL3JlZ2lzdGVyXCI+PGxhYmVsIGZvcj1cInVzZXJuYW1lXCI+PGgyPldlbGNvbWU8aT4hPC9pPjwvaDI+PC9sYWJlbD48ZmllbGRzZXQ+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48aW5wdXQgaWQ9XCJ1c2VybmFtZVwiIG5hbWU9XCJ1c2VybmFtZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJVc2VybmFtZVwiLz48aW5wdXQgbmFtZT1cInBhc3N3b3JkXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIlBhc3N3b3JkXCIgYXV0b2NvbXBsZXRlPVwib2ZmXCIvPjxkaXYgY2xhc3M9XCJ0b2dnbGUtcGFzc3dvcmRcIj5IaWRlPC9kaXY+PGRpdiB0aXRsZT1cIlN0cm9uZ2VyIHBhc3N3b3JkcyBhcmUgZ3JlZW5cIiBjbGFzcz1cInN0cmVuZ3RoLW1ldGVyXCI+PGRpdiBjbGFzcz1cInN0cmVuZ3RoXCI+PC9kaXY+PC9kaXY+PGlucHV0IG5hbWU9XCJlbWFpbFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJFbWFpbFwiIG1heGxlbmd0aD1cIjI1NFwiIGNsYXNzPVwicmVnaXN0ZXItZW1haWxcIi8+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJSZWdpc3RlclwiPlJlZ2lzdGVyPC9idXR0b24+PGEgY2xhc3M9XCJtc2cgb25jbGljay1zaG93LWxvZ2luXCI+PGgzPkkgYWxyZWFkeSBoYXZlIGFuIGFjY291bnQ8L2gzPjwvYT48L2ZpZWxkc2V0PjwvZm9ybT48L2Rpdj48ZGl2IGNsYXNzPVwibG9naW5cIj48Zm9ybSBtZXRob2Q9XCJwb3N0XCIgYWN0aW9uPVwiL2F1dGgvbG9naW5cIj48bGFiZWwgZm9yPVwidXNlcm5hbWVcIj48aDI+Jyk7XG52YXIgX192YWxfXyA9IHNpdGVOYW1lXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2gyPjwvbGFiZWw+PGZpZWxkc2V0PjxhIGNsYXNzPVwiZm1zZyBtc2cgb25jbGljay1zaG93LWZvcmdvdFwiPjxoMz5Gb3Jnb3Q/PC9oMz48L2E+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48aW5wdXQgaWQ9XCJ1c2VybmFtZVwiIG5hbWU9XCJ1c2VybmFtZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJVc2VybmFtZVwiLz48aW5wdXQgbmFtZT1cInBhc3N3b3JkXCIgdHlwZT1cInBhc3N3b3JkXCIgcGxhY2Vob2xkZXI9XCJQYXNzd29yZFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiLz48YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIkxvZ2luXCI+TG9naW48L2J1dHRvbj4nKTtcbmlmICghKCBpbnZpdGVPbmx5KSlcbntcbmJ1Zi5wdXNoKCc8YSBjbGFzcz1cIm1zZyBvbmNsaWNrLXNob3ctcmVnaXN0ZXJcIj48aDM+UmVnaXN0ZXI8aT4hPC9pPjwvaDM+PC9hPicpO1xufVxuYnVmLnB1c2goJzxhIGNsYXNzPVwic21hbGwgbXNnIG9uY2xpY2stc2hvdy1mb3Jnb3RcIj48aDM+SGVscDxpPj88L2k+PC9oMz48L2E+PC9maWVsZHNldD48L2Zvcm0+Jyk7XG5pZiAoISggaW52aXRlT25seSkpXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInNvY2lhbCBoYXMtYXV0aFwiPjxoMz5PciBMb2cgSW4gV2l0aDwvaDM+PGEgaHJlZj1cIi9hdXRoL2ZhY2Vib29rXCIgdGl0bGU9XCJGYWNlYm9vayFcIiBjbGFzcz1cImhhcy1mYWNlYm9va1wiPiA8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiL2ltYWdlcy9mYWNlYm9va18zMi5wbmdcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvYT48YSBocmVmPVwiL2F1dGgvZ29vZ2xlXCIgdGl0bGU9XCJHb29nbGUrXCIgY2xhc3M9XCJoYXMtZ29vZ2xlXCI+IDxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvaW1hZ2VzL2dvb2dsZV8zMi5wbmdcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvYT48YSBocmVmPVwiL2F1dGgvdHdpdHRlclwiIHRpdGxlPVwiVHdpdHRlciFcIiBjbGFzcz1cImhhcy10d2l0dGVyXCI+IDxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvaW1hZ2VzL3R3aXR0ZXJfMzIucG5nXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2E+PC9kaXY+Jyk7XG59XG5idWYucHVzaCgnPC9kaXY+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIkJ1eVwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbnZhciBwcmljZSA9ICgocHJvZHVjdC5wcmljZSAvIDEwMC4wKS50b0ZpeGVkKDApKTtcbmJ1Zi5wdXNoKCc8aDE+JyArIGVzY2FwZSgoaW50ZXJwID0gcHJvZHVjdC5kZXNjcmlwdGlvbikgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICc8L2gxPjxkaXYgY2xhc3M9XCJyaWdodCBjY2luZm9cIj48Zm9ybSBhdXRvY29tcGxldGU9XCJvZmZcIj48ZGl2IGNsYXNzPVwidG9vbHRpcFwiPjwvZGl2PicpO1xuaWYgKCBjYXJkTmVlZGVkKVxue1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PjxsYWJlbCBmb3I9XCJjYXJkX251bWJlclwiPkNhcmQgTnVtYmVyPC9sYWJlbD48aW5wdXQgaWQ9XCJjYXJkX251bWJlclwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJYWFhYIC0gWFhYWCAtIFhYWFggLSBYWFhYXCIgbWF4bGVuZ3RoPVwiMTlcIiBjbGFzcz1cIkJ1eS1jYXJkLW51bWJlclwiLz48ZGl2IGNsYXNzPVwiY2xlYXJcIj48L2Rpdj48bGFiZWwgZm9yPVwiY2FyZF9tb250aFwiPkV4cGlyYXRpb248L2xhYmVsPjxzZWxlY3QgaWQ9XCJjYXJkX21vbnRoXCIgY2xhc3M9XCJCdXktY2FyZC1tb250aFwiPjxvcHRpb24gZGlzYWJsZWQ9XCJkaXNhYmxlZFwiIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj4tIE1vbnRoIC08L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiMVwiPkphbiAtIDE8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiMlwiPkZlYiAtIDI8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiM1wiPk1hciAtIDM8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiNFwiPkFwciAtIDQ8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiNVwiPk1heSAtIDU8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiNlwiPkp1biAtIDY8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiN1wiPkp1bCAtIDc8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiOFwiPkF1ZyAtIDg8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiOVwiPlNlcHQgLSA5PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT1cIjEwXCI+T2N0IC0gMTA8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiMTFcIj5Ob3YgLSAxMTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9XCIxMlwiPkRlYyAtIDEyPC9vcHRpb24+PC9zZWxlY3Q+PHNtYWxsPi88L3NtYWxsPjxzZWxlY3QgaWQ9XCJjYXJkX3llYXJcIiBjbGFzcz1cIkJ1eS1jYXJkLXllYXJcIj48b3B0aW9uIGRpc2FibGVkPVwiZGlzYWJsZWRcIiBzZWxlY3RlZD1cInNlbGVjdGVkXCI+LSBZZWFyIC08L29wdGlvbj4nKTtcbnZhciBkID0gKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSk7XG4gZm9yICh2YXIgaT0wOyBpPD0xNjsgaSsrKVxue1xuYnVmLnB1c2goJzxvcHRpb24+Jyk7XG52YXIgX192YWxfXyA9IGQgKyBpXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L29wdGlvbj4nKTtcbn1cbmJ1Zi5wdXNoKCc8L3NlbGVjdD48ZGl2IGNsYXNzPVwiY2xlYXJcIj48L2Rpdj48bGFiZWwgZm9yPVwiY2FyZF9jb2RlXCI+U2VjdXJpdHkgQ29kZTwvbGFiZWw+PGlucHV0IGlkPVwiY2FyZF9jb2RlXCIgdHlwZT1cInBhc3N3b3JkXCIgcGxhY2Vob2xkZXI9XCJDQ1ZcIiBtYXhsZW5ndGg9XCI1XCIgY2xhc3M9XCJCdXktY2FyZC1jb2RlXCIvPjxzcGFuIGNsYXNzPVwiY29kZVwiPj88ZGl2IGNsYXNzPVwiY3Z2aW5mb1wiPjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KGNhY2hlVXJsICsgJy9pbWFnZXMvY3Z2Ml9leGFtcGxlLmdpZicpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihjYWNoZVVybCArICcvaW1hZ2VzL2N2djJfZXhhbXBsZV9hbWV4LmdpZicpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2Rpdj48L3NwYW4+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGgzPllvdXIgcGF5bWVudCBpbmZvcm1hdGlvbiBpcyBSZWFkeS10by1HbzxpPiE8L2k+PC9oMz48YSBocmVmPVwiI1wiIGNsYXNzPVwiQnV5LWNoYW5nZS1jYXJkXCI+RW50ZXIgZGlmZmVyZW50IGNyZWRpdCBjYXJkIGRldGFpbHM8L2E+PGRpdiBjbGFzcz1cImNsZWFyXCI+PC9kaXY+PGVtPlNhdmVzIGZvciBhbGwgc3Vic2NyaXB0aW9uczwvZW0+Jyk7XG59XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNsZWFyXCI+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJDSEVDS09VVFwiIGNsYXNzPVwiQnV5LWNoZWNrb3V0XCI+Q0hFQ0tPVVQ8L2J1dHRvbj48L2Rpdj48L2Zvcm0+PC9kaXY+PGRpdiBjbGFzcz1cInJpZ2h0IGZlYXR1cmVzXCI+Jyk7XG5pZiAoIHByaWNlICYmIChwcmljZSAhPT0gJzAnKSlcbntcbmJ1Zi5wdXNoKCc8aDI+T25seSA8Yj48c21hbGw+JDwvc21hbGw+Jyk7XG52YXIgX192YWxfXyA9IHByaWNlXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9iPjxzbWFsbD4vbW88L3NtYWxsPjwvaDI+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGgyPjxiPkZyZWU8aT4hPC9pPjwvYj48L2gyPicpO1xufVxuYnVmLnB1c2goJzxtZW51PicpO1xuLy8gaXRlcmF0ZSBwcm9kdWN0LmNvbmZpZy5mZWF0dXJlc1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHByb2R1Y3QuY29uZmlnLmZlYXR1cmVzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IHByb2R1Y3QuY29uZmlnLmZlYXR1cmVzLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIGYgPSBwcm9kdWN0LmNvbmZpZy5mZWF0dXJlc1skaW5kZXhdO1xuXG5idWYucHVzaCgnPGxpPicpO1xudmFyIF9fdmFsX18gPSBmXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2xpPicpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gcHJvZHVjdC5jb25maWcuZmVhdHVyZXMpIHtcbiAgICAgIHZhciBmID0gcHJvZHVjdC5jb25maWcuZmVhdHVyZXNbJGluZGV4XTtcblxuYnVmLnB1c2goJzxsaT4nKTtcbnZhciBfX3ZhbF9fID0gZlxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9saT4nKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvbWVudT48L2Rpdj48ZGl2IGNsYXNzPVwiY2FyZHNcIj48ZGl2IGNsYXNzPVwiamNiXCI+PC9kaXY+PGRpdiBjbGFzcz1cImRpbmVyc2NsdWJcIj48L2Rpdj48ZGl2IGNsYXNzPVwiZGlzY292ZXJcIj48L2Rpdj48ZGl2IGNsYXNzPVwiYW1leFwiPjwvZGl2PjxkaXYgY2xhc3M9XCJtYXN0ZXJjYXJkXCI+PC9kaXY+PGRpdiBjbGFzcz1cInZpc2FcIj48L2Rpdj48L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiQ2hhdFwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+PGRpdiBjbGFzcz1cInByb2ZpbGVcIj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICd0aXRsZSc6KG90aGVyc1swXS5uYW1lKSwgXCJjbGFzc1wiOiAoJ21pbmltaXplJykgfSwge1widGl0bGVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbmlmICggb3RoZXJzWzBdLnBob3RvLm1hdGNoKC9eaHR0cHM/XFw6LykgfHwgb3RoZXJzWzBdLnBob3RvLm1hdGNoKC9cXC9cXC8vKSlcbntcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihvdGhlcnNbMF0ucGhvdG8pIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiL1wiICsgKG90aGVyc1swXS5waG90bykgKyBcIlwiKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5idWYucHVzaCgnPC9kaXY+PC9kaXY+PGgyPicgKyBlc2NhcGUoKGludGVycCA9IG90aGVyc1swXS5uYW1lKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJzwvaDI+PGRpdiB0aXRsZT1cIkNsb3NlXCIgY2xhc3M9XCJjbG9zZSBvbmNsaWNrLWNsb3NlXCI+WDwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj48ZGl2IGNsYXNzPVwibWVzc2FnZXNcIj48ZGl2IHN0eWxlPVwiZGlzcGxheTpub25lO1wiIGNsYXNzPVwibG9hZC1tb3JlXCI+bG9hZCBtb3JlLi4uPC9kaXY+PC9kaXY+PGRpdiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIiBjbGFzcz1cIm1zZ1wiPjxkaXYgY2xhc3M9XCJmcm9tXCI+PGEgY2xhc3M9XCJmcm9tLW5hbWUgbXV0YW50XCI+PC9hPjwvZGl2PjxkaXYgY2xhc3M9XCJib2R5XCI+PC9kaXY+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImZvb3RlclwiPjxmb3JtPjx0ZXh0YXJlYSBuYW1lPVwiYm9keVwiPjwvdGV4dGFyZWE+PC9mb3JtPjwvZGl2PicpO1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJQYWdpbmF0b3JcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG5pZiAoIHBhZ2VzLmxlbmd0aCA+PSAyKVxue1xuLy8gaXRlcmF0ZSBwYWdlc1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHBhZ2VzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IHBhZ2VzLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIHAgPSBwYWdlc1skaW5kZXhdO1xuXG5pZiAoIHAuYWN0aXZlKVxue1xuYnVmLnB1c2goJzxzdHJvbmcgY2xhc3M9XCJQYWdpbmF0b3ItcGFnZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L3N0cm9uZz4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAuaHJlZiksICdkYXRhLXBhZ2UnOihwLm51bSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArICgnUGFnaW5hdG9yLXBhZ2UnKSB9LCB7XCJocmVmXCI6dHJ1ZSxcImRhdGEtcGFnZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+Jyk7XG59XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAodmFyICRpbmRleCBpbiBwYWdlcykge1xuICAgICAgdmFyIHAgPSBwYWdlc1skaW5kZXhdO1xuXG5pZiAoIHAuYWN0aXZlKVxue1xuYnVmLnB1c2goJzxzdHJvbmcgY2xhc3M9XCJQYWdpbmF0b3ItcGFnZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L3N0cm9uZz4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAuaHJlZiksICdkYXRhLXBhZ2UnOihwLm51bSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArICgnUGFnaW5hdG9yLXBhZ2UnKSB9LCB7XCJocmVmXCI6dHJ1ZSxcImRhdGEtcGFnZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+Jyk7XG59XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiUGhvdG9Dcm9wcGVyXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJ1cGxvYWRcIj48aDE+Jyk7XG52YXIgX192YWxfXyA9IHRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2gxPjxkaXY+PGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIlwiICsgKHBob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2Rpdj48ZGl2Pjxmb3JtJyk7XG5idWYucHVzaChhdHRycyh7ICdtZXRob2QnOihcIlBPU1RcIiksICdhY3Rpb24nOihcIlwiICsgKGVuZHBvaW50VXJsKSArIFwiXCIpLCAnZW5jdHlwZSc6KFwibXVsdGlwYXJ0L2Zvcm0tZGF0YVwiKSB9LCB7XCJtZXRob2RcIjp0cnVlLFwiYWN0aW9uXCI6dHJ1ZSxcImVuY3R5cGVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwiYnV0dG9uXCI+IDxzcGFuPlVwbG9hZCBJbWFnZTwvc3Bhbj48aW5wdXQgdHlwZT1cImZpbGVcIiBuYW1lPVwiYXZhdGFyXCIvPjwvZGl2PjwvZm9ybT48L2Rpdj48L2Rpdj48ZGl2IHN0eWxlPVwiZGlzcGxheTpub25lO1wiIGNsYXNzPVwiY3JvcFwiPjxoMT4nKTtcbnZhciBfX3ZhbF9fID0gdGl0bGUgKyBcIiAoY3JvcClcIlxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oMT48ZGl2PjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCJcIiArIChwaG90bykgKyBcIlwiKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PC9kaXY+PGRpdiBjbGFzcz1cImJ1dHRvblwiPjxzcGFuPkNyb3AgSW1hZ2U8L3NwYW4+PC9kaXY+PC9kaXY+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIlNhbGVzXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJsb2dvXCI+PGgxPlBvd2VyPGI+QnVsbGV0aW48L2I+PC9oMT48ZW0+VGhlIE9mZmljaWFsIFJlYWwtVGltZSBDb21tdW5pdHkgQnVpbGRlcjwvZW0+PC9kaXY+PGgyIGlkPVwiaW1hZ2luZVwiIGNsYXNzPVwic3RpY2tcIj5JbWFnaW5lIHJlYWwtdGltZSBjb21tdW5pdGllcyBhdCB0aGUgY2xpY2sgb2YgYSBidXR0b24uPC9oMj48ZGl2IGlkPVwicmVnaXN0ZXJfdG9wXCI+PC9kaXY+PGgyIGlkPVwiZmVhdHVyZXNcIiBjbGFzcz1cInN0aWNrXCI+V2h5IHlvdVxcJ2xsIGxvdmUgUG93ZXJCdWxsZXRpbiAuLi48L2gyPjxzZWN0aW9uIGNsYXNzPVwidHJhbnNsdWNlbnQgc3RpY2tcIj48YXJ0aWNsZT48aDQ+QnJlYWt0aHJvdWdoIE5hdmlnYXRpb248L2g0PjxwPkZyb20gU0VPIHRlY2hub2xvZ3kgdGhhdCBzcGVlZGlseSB0cmFuc21pdHMgcGFnZSBkZWx0YSBpbnN0ZWFkIG9mIHJlbG9hZGluZyBicm93c2VycyxcXG50byBhIHNwbGl0LXRocmVhZCAmYW1wOyBwb3N0IGludGVyZmFjZSwgdGhlIFBvd2VyQnVsbGV0aW4gZXhwZXJpZW5jZSBpcyBhbHdheXMgc2VjdXJlLCBmYXN0ICZhbXA7IGZsdWlkLjwvcD48L2FydGljbGU+PC9zZWN0aW9uPjxzZWN0aW9uIGNsYXNzPVwiYmcgZmlyc3RcIj48L3NlY3Rpb24+PHNlY3Rpb24gY2xhc3M9XCJzdGlja1wiPjxhcnRpY2xlPjxoND5Vbm1hdGNoZWQgUmVzcG9uc2l2ZSBEZXNpZ248L2g0PjxwPkEgbW9kZXJuLCByZXNwb25zaXZlIGludGVyZmFjZSB0aGF0IHNjYWxlcyBmcm9tIHRvIHlvdXIgcGhvbmUsXFxudGFibGV0IGFuZCBQQyB0byB3aWRlLXNjcmVlbiBwcm9qZWN0b3JzLS15b3VyIFBvd2VyQnVsbGV0aW4gY29tbXVuaXR5IGFsd2F5cyBzdHVucy48L3A+PC9hcnRpY2xlPjwvc2VjdGlvbj48c2VjdGlvbiBjbGFzcz1cImJnIHNlY29uZFwiPjwvc2VjdGlvbj48c2VjdGlvbiBjbGFzcz1cInN0aWNrXCI+PGFydGljbGU+PGg0PlJlYWwtVGltZSBGbG93PC9oND48cD5VbHRyYWZhc3QgUG93ZXJCdWxsZXRpbiBpcyBidWlsdCBvbiBhIHJlYWwtdGltZSBlbmdpbmUgdGhhdCBwb3dlcnNcXG5ldmVyeXRoaW5nIGZyb20gdXNlciBjaGF0ICZhbXA7IHBvc3RzIHRvIGFkbWluaXN0cmF0aW9uLCBzdWNoIGFzIGNyZWF0aW5nIHByb2R1Y3RzLjwvcD48L2FydGljbGU+PC9zZWN0aW9uPjxzZWN0aW9uIGNsYXNzPVwiYmcgdGhpcmRcIj48L3NlY3Rpb24+PHNlY3Rpb24gY2xhc3M9XCJzdGlja1wiPjxhcnRpY2xlPjxoND5Qcm9kdWN0cyAmYW1wOyBlLUNvbW1lcmNlIENhcGFiaWxpdGllczwvaDQ+PHA+U2VsbCB5b3VyIGJ1c2luZXNzIHByb2R1Y3RzICZhbXA7IHNlcnZpY2VzIGFyb3VuZCBQb3dlckJ1bGxldGluIGNvbW11bml0aWVzLlxcbk9mZmVyaW5nIGUtY29tbWVyY2UgaXMgc28gZWFzeSB0byB1c2UsIGl0XFwncyBlYXN5IHRvIGxvdmUuPC9wPjwvYXJ0aWNsZT48L3NlY3Rpb24+PHNlY3Rpb24gY2xhc3M9XCJiZyBmb3VydGhcIj48L3NlY3Rpb24+PHNlY3Rpb24gY2xhc3M9XCJzdGlja1wiPjxhcnRpY2xlPjxoND5MaXZlIFN1cHBvcnQ8L2g0PjxwPktub3dsZWRnZSBpcyBQb3dlckJ1bGxldGluISAgV2l0aDxhIGhyZWY9XCJtYWlsdG86c3VwcG9ydEBwb3dlcmJ1bGxldGluLmNvbVwiPmRpcmVjdCBhY2Nlc3MgdG8gb3VyIHRlYW08L2E+b2YgZnJpZW5kbHkgZGV2ZWxvcGVycyAmYW1wOyBkZXNpZ25lcnNcXG50aGVyZVxcJ3MgYWxtb3N0IG5vIGxpbWl0IHRvIHdoYXQgeW91IGNhbiBidWlsZC48L3A+PC9hcnRpY2xlPjwvc2VjdGlvbj48c2VjdGlvbiBjbGFzcz1cImxhc3RcIj48YXJ0aWNsZT48ZGl2IGlkPVwicmVnaXN0ZXJfYm90dG9tXCI+PC9kaXY+PC9hcnRpY2xlPjwvc2VjdGlvbj48c2VjdGlvbiBpZD1cImZhcVwiIGNsYXNzPVwiZmFxXCI+PGFydGljbGU+PGgzPkZBUTwvaDM+PG1lbnU+PGxpPjxoND5DYW4gSSBjaGFuZ2UgdGhlIGxvb2sgb2YgUG93ZXJCdWxsZXRpbj88L2g0PjxwPkFic29sdXRlbHkhICBXZSBwcm92aWRlIGEgc29saWQgZGVmYXVsdCB0aGVtZSB0byBnZXQgc3RhcnRlZCBxdWlja2x5LlxcbkFueXRoaW5nIGlzIHBvc3NpYmxlIHdpdGggeW91ciBzdHlsaXNoIGV5ZTo8YSBocmVmPVwiaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL2Nzc3JlZi9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5DU1M8L2E+JmFtcDs8YSBocmVmPVwiaHR0cDovL2xlYXJuYm9vc3QuZ2l0aHViLmlvL3N0eWx1cy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5TdHlsdXM8L2E+YXJlIHN1cHBvcnRlZC48L3A+PC9saT48L21lbnU+PG1lbnU+PGxpPjxoND5Db250YWN0PC9oND48cD5XZVxcJ3JlIGhlcmUgZm9yIFlPVTo8YSBocmVmPVwibWFpbHRvOnN1cHBvcnRAcG93ZXJidWxsZXRpbi5jb21cIj5zdXBwb3J0QHBvd2VyYnVsbGV0aW4uY29tPC9hPjwvcD48L2xpPjwvbWVudT48L2FydGljbGU+PC9zZWN0aW9uPjxmb290ZXI+PGRpdiBjbGFzcz1cIm9uY2xpY2stc2Nyb2xsLXRvcFwiPlRvcDwvZGl2PjwvZm9vdGVyPicpO1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJTYWxlc0FwcFwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbmJ1Zi5wdXNoKCc8aGVhZGVyPjx1bD48bGk+PGEgZGF0YS1zY3JvbGwtdG89XCIjZmVhdHVyZXNcIiBjbGFzcz1cIm9uY2xpY2stc2Nyb2xsLXRvXCI+RmVhdHVyZXM8L2E+PC9saT48bGk+PGEgZGF0YS1zY3JvbGwtdG89XCIjZmFxXCIgY2xhc3M9XCJvbmNsaWNrLXNjcm9sbC10b1wiPkZBUTwvYT48L2xpPjxsaSBjbGFzcz1cImF1dGhcIj48YSBjbGFzcz1cIm9uY2xpY2stbG9naW5cIj5Mb2dpbjwvYT48YSBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIiBjbGFzcz1cIm9uY2xpY2stbG9nb3V0XCI+TG9nb3V0PC9hPjwvbGk+PC91bD48L2hlYWRlcj48ZGl2IGlkPVwid3JhcHBlclwiIGNsYXNzPVwiU2FsZXNBcHAtY29udGVudFwiPjwvZGl2PjxkaXYgaWQ9XCJhdXRoXCI+PC9kaXY+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIlNhbGVzTG9hZGVyXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzwhRE9DVFlQRSBodG1sPjxodG1sPjxoZWFkPjx0aXRsZT5Qb3dlckJ1bGxldGluPC90aXRsZT4nKTtcbi8vIGl0ZXJhdGUgc3R5bGVzaGVldHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBzdHlsZXNoZWV0cy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciAkaW5kZXggPSAwLCAkJGwgPSBzdHlsZXNoZWV0cy5sZW5ndGg7ICRpbmRleCA8ICQkbDsgJGluZGV4KyspIHtcbiAgICAgIHZhciBzdHlsZXNoZWV0ID0gc3R5bGVzaGVldHNbJGluZGV4XTtcblxuYnVmLnB1c2goJzxsaW5rJyk7XG5idWYucHVzaChhdHRycyh7IHRlcnNlOiB0cnVlLCAncmVsJzooJ3N0eWxlc2hlZXQnKSwgJ3R5cGUnOigndGV4dC9jc3MnKSwgJ2hyZWYnOihzdHlsZXNoZWV0KSB9LCB7XCJyZWxcIjp0cnVlLFwidHlwZVwiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAodmFyICRpbmRleCBpbiBzdHlsZXNoZWV0cykge1xuICAgICAgdmFyIHN0eWxlc2hlZXQgPSBzdHlsZXNoZWV0c1skaW5kZXhdO1xuXG5idWYucHVzaCgnPGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgdGVyc2U6IHRydWUsICdyZWwnOignc3R5bGVzaGVldCcpLCAndHlwZSc6KCd0ZXh0L2NzcycpLCAnaHJlZic6KHN0eWxlc2hlZXQpIH0sIHtcInJlbFwiOnRydWUsXCJ0eXBlXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzxzY3JpcHQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgdGVyc2U6IHRydWUsICd0eXBlJzooJ3RleHQvamF2YXNjcmlwdCcpLCAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9sb2NhbC9oZWFkLTAuOTkubG9hZC5taW4uanNcIikgfSwge1widHlwZVwiOnRydWUsXCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48L3NjcmlwdD48c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIj5cXG4gd2luZG93LmhlYWRqcyA9IGhlYWQuanNcXG4gd2luZG93LmVudiA9IFxcJycgKyAoKGludGVycCA9IGVudikgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICdcXCdcXG4gd2luZG93LmNhY2hlVXJsID0gXFwnJyArICgoaW50ZXJwID0gY2FjaGVVcmwpID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnXFwnO1xcbiB3aW5kb3cuc2l0ZU5hbWUgPSBcXCdQb3dlckJ1bGxldGluXFwnO1xcbiB3aW5kb3cuYXV0aERvbWFpbiA9IFxcJycgKyAoKGludGVycCA9IGF1dGhEb21haW4pID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnXFwnO1xcbiBoZWFkLmpzLmFwcGx5KGhlYWQsICcgKyAoKGludGVycCA9IEpTT04uc3RyaW5naWZ5KHNjcmlwdHMpKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJyk7XFxuPC9zY3JpcHQ+PC9oZWFkPjxib2R5PjwvYm9keT48L2h0bWw+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIlNpdGVSZWdpc3RlclwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbmJ1Zi5wdXNoKCc8aDM+U3RhcnQgYnkgY3JlYXRpbmcgYSBuYW1lIG5vdzxpPiE8L2k+PC9oMz48ZGl2IGNsYXNzPVwidG9vbHRpcCBTaXRlUmVnaXN0ZXItZXJyb3JzXCI+PC9kaXY+PGZvcm0gY2xhc3M9XCJzaXRlLXJlZ2lzdGVyXCI+PGZpZWxkc2V0PjxpbnB1dCcpO1xuYnVmLnB1c2goYXR0cnMoeyAndHlwZSc6KCd0ZXh0JyksICduYW1lJzooJ3N1YmRvbWFpbicpLCAndmFsdWUnOih0eXBlb2Ygc3ViZG9tYWluICE9ICd1bmRlZmluZWQnID8gc3ViZG9tYWluIDogJycpLCAnYXV0b2NvbXBsZXRlJzooXCJvZmZcIiksIFwiY2xhc3NcIjogKCdTaXRlUmVnaXN0ZXItc3ViZG9tYWluJykgfSwge1widHlwZVwiOnRydWUsXCJuYW1lXCI6dHJ1ZSxcInZhbHVlXCI6dHJ1ZSxcImF1dG9jb21wbGV0ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48c3BhbiBjbGFzcz1cImhvc3RuYW1lXCI+Jyk7XG52YXIgX192YWxfXyA9IGhvc3RuYW1lXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L3NwYW4+PHNwYW4gY2xhc3M9XCJTaXRlUmVnaXN0ZXItYXZhaWxhYmxlXCI+PGRpdiBjbGFzcz1cInN1Y2Nlc3NcIj4mI3gyNzEzOzwvZGl2PjxkaXYgY2xhc3M9XCJlcnJvclwiPiYjeDI3MTg7PC9kaXY+PC9zcGFuPjxkaXYgY2xhc3M9XCJTaXRlUmVnaXN0ZXItY3JlYXRlXCI+PC9kaXY+PC9maWVsZHNldD48L2Zvcm0+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59IiwiXG5tb2R1bGUuZXhwb3J0cyA9IGphZGUgPSAoZnVuY3Rpb24oZXhwb3J0cyl7XG4vKiFcbiAqIEphZGUgLSBydW50aW1lXG4gKiBDb3B5cmlnaHQoYykgMjAxMCBUSiBIb2xvd2F5Y2h1ayA8dGpAdmlzaW9uLW1lZGlhLmNhPlxuICogTUlUIExpY2Vuc2VkXG4gKi9cblxuLyoqXG4gKiBMYW1lIEFycmF5LmlzQXJyYXkoKSBwb2x5ZmlsbCBmb3Igbm93LlxuICovXG5cbmlmICghQXJyYXkuaXNBcnJheSkge1xuICBBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24oYXJyKXtcbiAgICByZXR1cm4gJ1tvYmplY3QgQXJyYXldJyA9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBMYW1lIE9iamVjdC5rZXlzKCkgcG9seWZpbGwgZm9yIG5vdy5cbiAqL1xuXG5pZiAoIU9iamVjdC5rZXlzKSB7XG4gIE9iamVjdC5rZXlzID0gZnVuY3Rpb24ob2JqKXtcbiAgICB2YXIgYXJyID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIGFyci5wdXNoKGtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH1cbn1cblxuLyoqXG4gKiBNZXJnZSB0d28gYXR0cmlidXRlIG9iamVjdHMgZ2l2aW5nIHByZWNlZGVuY2VcbiAqIHRvIHZhbHVlcyBpbiBvYmplY3QgYGJgLiBDbGFzc2VzIGFyZSBzcGVjaWFsLWNhc2VkXG4gKiBhbGxvd2luZyBmb3IgYXJyYXlzIGFuZCBtZXJnaW5nL2pvaW5pbmcgYXBwcm9wcmlhdGVseVxuICogcmVzdWx0aW5nIGluIGEgc3RyaW5nLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBhXG4gKiBAcGFyYW0ge09iamVjdH0gYlxuICogQHJldHVybiB7T2JqZWN0fSBhXG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5leHBvcnRzLm1lcmdlID0gZnVuY3Rpb24gbWVyZ2UoYSwgYikge1xuICB2YXIgYWMgPSBhWydjbGFzcyddO1xuICB2YXIgYmMgPSBiWydjbGFzcyddO1xuXG4gIGlmIChhYyB8fCBiYykge1xuICAgIGFjID0gYWMgfHwgW107XG4gICAgYmMgPSBiYyB8fCBbXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWMpKSBhYyA9IFthY107XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGJjKSkgYmMgPSBbYmNdO1xuICAgIGFjID0gYWMuZmlsdGVyKG51bGxzKTtcbiAgICBiYyA9IGJjLmZpbHRlcihudWxscyk7XG4gICAgYVsnY2xhc3MnXSA9IGFjLmNvbmNhdChiYykuam9pbignICcpO1xuICB9XG5cbiAgZm9yICh2YXIga2V5IGluIGIpIHtcbiAgICBpZiAoa2V5ICE9ICdjbGFzcycpIHtcbiAgICAgIGFba2V5XSA9IGJba2V5XTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYTtcbn07XG5cbi8qKlxuICogRmlsdGVyIG51bGwgYHZhbGBzLlxuICpcbiAqIEBwYXJhbSB7TWl4ZWR9IHZhbFxuICogQHJldHVybiB7TWl4ZWR9XG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5mdW5jdGlvbiBudWxscyh2YWwpIHtcbiAgcmV0dXJuIHZhbCAhPSBudWxsO1xufVxuXG4vKipcbiAqIFJlbmRlciB0aGUgZ2l2ZW4gYXR0cmlidXRlcyBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9ialxuICogQHBhcmFtIHtPYmplY3R9IGVzY2FwZWRcbiAqIEByZXR1cm4ge1N0cmluZ31cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmV4cG9ydHMuYXR0cnMgPSBmdW5jdGlvbiBhdHRycyhvYmosIGVzY2FwZWQpe1xuICB2YXIgYnVmID0gW11cbiAgICAsIHRlcnNlID0gb2JqLnRlcnNlO1xuXG4gIGRlbGV0ZSBvYmoudGVyc2U7XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKVxuICAgICwgbGVuID0ga2V5cy5sZW5ndGg7XG5cbiAgaWYgKGxlbikge1xuICAgIGJ1Zi5wdXNoKCcnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXVxuICAgICAgICAsIHZhbCA9IG9ialtrZXldO1xuXG4gICAgICBpZiAoJ2Jvb2xlYW4nID09IHR5cGVvZiB2YWwgfHwgbnVsbCA9PSB2YWwpIHtcbiAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgIHRlcnNlXG4gICAgICAgICAgICA/IGJ1Zi5wdXNoKGtleSlcbiAgICAgICAgICAgIDogYnVmLnB1c2goa2V5ICsgJz1cIicgKyBrZXkgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgwID09IGtleS5pbmRleE9mKCdkYXRhJykgJiYgJ3N0cmluZycgIT0gdHlwZW9mIHZhbCkge1xuICAgICAgICBidWYucHVzaChrZXkgKyBcIj0nXCIgKyBKU09OLnN0cmluZ2lmeSh2YWwpICsgXCInXCIpO1xuICAgICAgfSBlbHNlIGlmICgnY2xhc3MnID09IGtleSAmJiBBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICAgICAgYnVmLnB1c2goa2V5ICsgJz1cIicgKyBleHBvcnRzLmVzY2FwZSh2YWwuam9pbignICcpKSArICdcIicpO1xuICAgICAgfSBlbHNlIGlmIChlc2NhcGVkICYmIGVzY2FwZWRba2V5XSkge1xuICAgICAgICBidWYucHVzaChrZXkgKyAnPVwiJyArIGV4cG9ydHMuZXNjYXBlKHZhbCkgKyAnXCInKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1Zi5wdXNoKGtleSArICc9XCInICsgdmFsICsgJ1wiJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJ1Zi5qb2luKCcgJyk7XG59O1xuXG4vKipcbiAqIEVzY2FwZSB0aGUgZ2l2ZW4gc3RyaW5nIG9mIGBodG1sYC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaHRtbFxuICogQHJldHVybiB7U3RyaW5nfVxuICogQGFwaSBwcml2YXRlXG4gKi9cblxuZXhwb3J0cy5lc2NhcGUgPSBmdW5jdGlvbiBlc2NhcGUoaHRtbCl7XG4gIHJldHVybiBTdHJpbmcoaHRtbClcbiAgICAucmVwbGFjZSgvJig/IShcXHcrfFxcI1xcZCspOykvZywgJyZhbXA7JylcbiAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXG4gICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgIC5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyk7XG59O1xuXG4vKipcbiAqIFJlLXRocm93IHRoZSBnaXZlbiBgZXJyYCBpbiBjb250ZXh0IHRvIHRoZVxuICogdGhlIGphZGUgaW4gYGZpbGVuYW1lYCBhdCB0aGUgZ2l2ZW4gYGxpbmVub2AuXG4gKlxuICogQHBhcmFtIHtFcnJvcn0gZXJyXG4gKiBAcGFyYW0ge1N0cmluZ30gZmlsZW5hbWVcbiAqIEBwYXJhbSB7U3RyaW5nfSBsaW5lbm9cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmV4cG9ydHMucmV0aHJvdyA9IGZ1bmN0aW9uIHJldGhyb3coZXJyLCBmaWxlbmFtZSwgbGluZW5vKXtcbiAgaWYgKCFmaWxlbmFtZSkgdGhyb3cgZXJyO1xuXG4gIHZhciBjb250ZXh0ID0gM1xuICAgICwgc3RyID0gcmVxdWlyZSgnZnMnKS5yZWFkRmlsZVN5bmMoZmlsZW5hbWUsICd1dGY4JylcbiAgICAsIGxpbmVzID0gc3RyLnNwbGl0KCdcXG4nKVxuICAgICwgc3RhcnQgPSBNYXRoLm1heChsaW5lbm8gLSBjb250ZXh0LCAwKVxuICAgICwgZW5kID0gTWF0aC5taW4obGluZXMubGVuZ3RoLCBsaW5lbm8gKyBjb250ZXh0KTtcblxuICAvLyBFcnJvciBjb250ZXh0XG4gIHZhciBjb250ZXh0ID0gbGluZXMuc2xpY2Uoc3RhcnQsIGVuZCkubWFwKGZ1bmN0aW9uKGxpbmUsIGkpe1xuICAgIHZhciBjdXJyID0gaSArIHN0YXJ0ICsgMTtcbiAgICByZXR1cm4gKGN1cnIgPT0gbGluZW5vID8gJyAgPiAnIDogJyAgICAnKVxuICAgICAgKyBjdXJyXG4gICAgICArICd8ICdcbiAgICAgICsgbGluZTtcbiAgfSkuam9pbignXFxuJyk7XG5cbiAgLy8gQWx0ZXIgZXhjZXB0aW9uIG1lc3NhZ2VcbiAgZXJyLnBhdGggPSBmaWxlbmFtZTtcbiAgZXJyLm1lc3NhZ2UgPSAoZmlsZW5hbWUgfHwgJ0phZGUnKSArICc6JyArIGxpbmVub1xuICAgICsgJ1xcbicgKyBjb250ZXh0ICsgJ1xcblxcbicgKyBlcnIubWVzc2FnZTtcbiAgdGhyb3cgZXJyO1xufTtcblxuICByZXR1cm4gZXhwb3J0cztcblxufSkoe30pO1xuXG5qYWRlLnRlbXBsYXRlcyA9IHt9O1xuamFkZS5yZW5kZXIgPSBmdW5jdGlvbihub2RlLCB0ZW1wbGF0ZSwgZGF0YSkge1xuICB2YXIgdG1wID0gamFkZS50ZW1wbGF0ZXNbdGVtcGxhdGVdKGRhdGEpO1xuICBub2RlLmlubmVySFRNTCA9IHRtcDtcbn07XG5cbmphZGUudGVtcGxhdGVzW1wibGF5b3V0XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuIHZhciBpbnZpdGUgPSAoaW52aXRlT25seSkgPyBcIndpbmRvdy5pbnZpdGVPbmx5PSd0cnVlJztcIiA6ICcnXG5idWYucHVzaCgnPCFET0NUWVBFIGh0bWw+PCEtLVxcbuKWkeKWiOKWgOKWiOKWkeKWiOKWgOKWiOKWkeKWiOKWkeKWiOKWkeKWiOKWgOKWgOKWkeKWiOKWgOKWhOKWkeKWiOKWgOKWhOKWkeKWiOKWkeKWiOKWkeKWiOKWkeKWkeKWkeKWiOKWkeKWkeKWkeKWiOKWgOKWgOKWkeKWgOKWiOKWgOKWkeKWgOKWiOKWgOKWkeKWiOKWgOKWiFxcbuKWkeKWiOKWgOKWgOKWkeKWiOKWkeKWiOKWkeKWiOKWhOKWiOKWkeKWiOKWgOKWgOKWkeKWiOKWgOKWhOKWkeKWiOKWgOKWhOKWkeKWiOKWkeKWiOKWkeKWiOKWkeKWkeKWkeKWiOKWkeKWkeKWkeKWiOKWgOKWgOKWkeKWkeKWiOKWkeKWkeKWkeKWiOKWkeKWkeKWiOKWkeKWiFxcbuKWkeKWgOKWkeKWkeKWkeKWgOKWgOKWgOKWkeKWgOKWkeKWgOKWkeKWgOKWgOKWgOKWkeKWgOKWkeKWgOKWkeKWgOKWgOKWkeKWkeKWgOKWgOKWgOKWkeKWgOKWgOKWgOKWkeKWgOKWgOKWgOKWkeKWgOKWgOKWgOKWkeKWkeKWgOKWkeKWkeKWgOKWgOKWgOKWkeKWgOKWkeKWgCwganNiLm1hZS5raCB+LS0+PGh0bWw+PGhlYWQ+Jyk7XG5pZiAoIHR5cGVvZih0aXRsZSkgIT09ICd1bmRlZmluZWQnKVxue1xuYnVmLnB1c2goJzx0aXRsZT4nKTtcbnZhciBfX3ZhbF9fID0gdGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvdGl0bGU+Jyk7XG59XG5pZiAoIHR5cGVvZihtZXRhX2Rlc2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpXG57XG5idWYucHVzaCgnPG1ldGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ25hbWUnOignZGVzY3JpcHRpb24nKSwgJ2NvbnRlbnQnOihtZXRhX2Rlc2NyaXB0aW9uKSB9LCB7XCJuYW1lXCI6dHJ1ZSxcImNvbnRlbnRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5pZiAoIHR5cGVvZihtZXRhX2tleXdvcmRzKSAhPT0gJ3VuZGVmaW5lZCcpXG57XG5idWYucHVzaCgnPG1ldGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ25hbWUnOigna2V5d29yZHMnKSwgJ2NvbnRlbnQnOihtZXRhX2tleXdvcmRzLmpvaW4oJywgJykpIH0sIHtcIm5hbWVcIjp0cnVlLFwiY29udGVudFwiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmlmICggdHlwZW9mKG1ldGFfemlwY29kZSkgIT09ICd1bmRlZmluZWQnKVxue1xuYnVmLnB1c2goJzxtZXRhJyk7XG5idWYucHVzaChhdHRycyh7ICduYW1lJzooJ3ppcGNvZGUnKSwgJ2NvbnRlbnQnOihtZXRhX3ppcGNvZGUpIH0sIHtcIm5hbWVcIjp0cnVlLFwiY29udGVudFwiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8bWV0YSBodHRwLWVxdWl2PVwiWC1VQS1Db21wYXRpYmxlXCIgY29udGVudD1cIklFPUVtdWxhdGVJRTksY2hyb21lPTFcIi8+PG1ldGEgbmFtZT1cInJvYm90c1wiIGNvbnRlbnQ9XCJpbmRleCwgZm9sbG93XCIvPjxtZXRhIG5hbWU9XCJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlXCIgY29udGVudD1cInllc1wiLz48bWV0YSBuYW1lPVwiYXBwbGUtbW9iaWxlLXdlYi1hcHAtc3RhdHVzLWJhci1zdHlsZVwiIGNvbnRlbnQ9XCJibGFja1wiLz48bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwidXNlci1zY2FsYWJsZT0wLCBpbml0aWFsLXNjYWxlPTEsIG1heGltdW0tc2NhbGU9MSwgd2lkdGg9ZGV2aWNlLXdpZHRoXCIvPjxsaW5rJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9pbWFnZXMvZmF2aWNvbi5pY29cIiksICdyZWwnOignc2hvcnRjdXQgaWNvbicpLCAndHlwZSc6KCdpbWFnZS94LWljb24nKSB9LCB7XCJocmVmXCI6dHJ1ZSxcInJlbFwiOnRydWUsXCJ0eXBlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjxsaW5rJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCJcIiArIChjYWNoZTJVcmwpICsgXCIvaW1hZ2VzL2FwcGxlLXRvdWNoLWljb24ucG5nXCIpLCAncmVsJzooJ2FwcGxlLXRvdWNoLWljb24nKSB9LCB7XCJocmVmXCI6dHJ1ZSxcInJlbFwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGluaycpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiXCIgKyAoY2FjaGUzVXJsKSArIFwiL2ltYWdlcy9hcHBsZS10b3VjaC1pY29uLTcyeDcyLnBuZ1wiKSwgJ3NpemVzJzooXCI3Mng3MlwiKSwgJ3JlbCc6KCdhcHBsZS10b3VjaC1pY29uJykgfSwge1wiaHJlZlwiOnRydWUsXCJzaXplc1wiOnRydWUsXCJyZWxcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIlwiICsgKGNhY2hlNFVybCkgKyBcIi9pbWFnZXMvYXBwbGUtdG91Y2gtaWNvbi0xMTR4MTE0LnBuZ1wiKSwgJ3NpemVzJzooXCIxMTR4MTE0XCIpLCAncmVsJzooJ2FwcGxlLXRvdWNoLWljb24nKSB9LCB7XCJocmVmXCI6dHJ1ZSxcInNpemVzXCI6dHJ1ZSxcInJlbFwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGluayBocmVmPVwiaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PVNvdXJjZStTYW5zK1BybzoyMDAsMzAwLDQwMFwiIHJlbD1cInN0eWxlc2hlZXRcIiB0eXBlPVwidGV4dC9jc3NcIi8+Jyk7XG5pZiAoIGNzc1VybHMpXG57XG4vLyBpdGVyYXRlIGNzc1VybHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBjc3NVcmxzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IGNzc1VybHMubGVuZ3RoOyAkaW5kZXggPCAkJGw7ICRpbmRleCsrKSB7XG4gICAgICB2YXIgb2JqID0gY3NzVXJsc1skaW5kZXhdO1xuXG5idWYucHVzaCgnPGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3JlbCc6KCdzdHlsZXNoZWV0JyksICd0eXBlJzooJ3RleHQvY3NzJyksICdocmVmJzoob2JqLnVybCkgfSwge1wicmVsXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgJGluZGV4IGluIGNzc1VybHMpIHtcbiAgICAgIHZhciBvYmogPSBjc3NVcmxzWyRpbmRleF07XG5cbmJ1Zi5wdXNoKCc8bGluaycpO1xuYnVmLnB1c2goYXR0cnMoeyAncmVsJzooJ3N0eWxlc2hlZXQnKSwgJ3R5cGUnOigndGV4dC9jc3MnKSwgJ2hyZWYnOihvYmoudXJsKSB9LCB7XCJyZWxcIjp0cnVlLFwidHlwZVwiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xuICAgfVxuICB9XG59KS5jYWxsKHRoaXMpO1xuXG59XG5idWYucHVzaCgnPGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIlwiICsgKGNhY2hlNVVybCkgKyBcIi9zaXRlcy9cIiArIChjdXJyZW50RG9tYWluKSArIFwiLmNzc1wiKSwgJ3JlbCc6KCdzdHlsZXNoZWV0JyksICd0eXBlJzooJ3RleHQvY3NzJykgfSwge1wiaHJlZlwiOnRydWUsXCJyZWxcIjp0cnVlLFwidHlwZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbmlmICggc3R5bGUpXG57XG5idWYucHVzaCgnPGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIi9zaXRlcy9cIiArIChzaXRlSWQpICsgXCIuY3NzXCIpLCAncmVsJzooJ3N0eWxlc2hlZXQnKSwgJ3R5cGUnOigndGV4dC9jc3MnKSB9LCB7XCJocmVmXCI6dHJ1ZSxcInJlbFwiOnRydWUsXCJ0eXBlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuaWYgKCBjdmFycy5lbnYgIT0gJ3Byb2R1Y3Rpb24nKVxue1xuYnVmLnB1c2goJzxzY3JpcHQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3R5cGUnOigndGV4dC9qYXZhc2NyaXB0JyksICdzcmMnOihcIlwiICsgKGNhY2hlNVVybCkgKyBcIi9sb2NhbC9oZWFkLTAuOTkubG9hZC5taW4uanNcIikgfSwge1widHlwZVwiOnRydWUsXCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48L3NjcmlwdD4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIiBzcmM9XCIvL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9oZWFkanMvMC45OS9oZWFkLmxvYWQubWluLmpzXCI+PC9zY3JpcHQ+Jyk7XG59XG5pZiAoIGpzVXJscylcbntcbmJ1Zi5wdXNoKCc8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIj53aW5kb3cuc2l0ZU5hbWU9XCInICsgKChpbnRlcnAgPSBzaXRlTmFtZSkgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICdcIjt3aW5kb3cuc2l0ZUlkPScgKyAoKGludGVycCA9IHNpdGVJZCkgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICc7JyArICgoaW50ZXJwID0gaW52aXRlKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJ3dpbmRvdy5pbml0aWFsTXV0YW50PScgKyAoKGludGVycCA9IEpTT04uc3RyaW5naWZ5KGluaXRpYWxNdXRhbnQpKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJzt3aW5kb3cuY2FjaGVVcmw9JyArICgoaW50ZXJwID0gSlNPTi5zdHJpbmdpZnkoY3ZhcnMuY2FjaGVVcmwpKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJzt3aW5kb3cuYXV0aERvbWFpbj1cIicgKyAoKGludGVycCA9IGN2YXJzLmF1dGhEb21haW4pID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnXCI7d2luZG93LmhlYWRqcz1oZWFkLmpzO2hlYWQuanMuYXBwbHkoaGVhZCwnICsgKChpbnRlcnAgPSBKU09OLnN0cmluZ2lmeShjdmFycy5iYXNlSnNVcmxzLmNvbmNhdChqc1VybHMpKSkgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICcpOzwvc2NyaXB0PicpO1xufVxuYnVmLnB1c2goJzwvaGVhZD48Ym9keT48aGVhZGVyIGNsYXNzPVwiaGVhZGVyIHRvZ2dsZXJcIj48aDEgY2xhc3M9XCJsb2dvXCI+PGEgaHJlZj1cIi9cIiBjbGFzcz1cIm11dGFudFwiPlBvd2VyPHN0cm9uZz5CdWxsZXRpbjwvc3Ryb25nPjwvYT48L2gxPjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj48ZGl2IGNsYXNzPVwic2VhcmNoXCI+PGlucHV0IGlkPVwicXVlcnlcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoXCIgYXV0b2NvbXBsZXRlPVwib2ZmXCIgY2xhc3M9XCJxdWVyeVwiLz48ZGl2IHRpdGxlPVwiQ2xvc2UhXCIgY2xhc3M9XCJvbmNsaWNrLWNsb3NlIHRvZ2dsZXJcIj54PC9kaXY+PC9kaXY+PGRpdiBpZD1cIndhcm5pbmdcIiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48ZGl2IGNsYXNzPVwibWVudS1jb250YWluZXJcIj48bWVudSBpZD1cIm1lbnVcIiBjbGFzcz1cIm1lbnVcIj4nKTtcbi8vIGl0ZXJhdGUgbWVudVxuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIG1lbnUubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsICQkbCA9IG1lbnUubGVuZ3RoOyBpIDwgJCRsOyBpKyspIHtcbiAgICAgIHZhciBmID0gbWVudVtpXTtcblxuYnVmLnB1c2goJzxsaSBjbGFzcz1cInJvd1wiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXN1cmYnOihmLmlkKSwgJ2RhdGEtc2Nyb2xsLXRvJzooXCIjZm9ydW1fXCIgKyAoZi5pZCkgKyBcIlwiKSwgJ2hyZWYnOihcIi9cIiArIChmLnNsdWcpICsgXCJcIiksIFwiY2xhc3NcIjogKCd0aXRsZScpICsgJyAnICsgKFwiZm9ydW0tXCIgKyAoZi5pZCkgKyBcIlwiKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJkYXRhLXN1cmZcIjp0cnVlLFwiZGF0YS1zY3JvbGwtdG9cIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBmLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+Jyk7XG5pZiAoIGYuZm9ydW1zLmxlbmd0aClcbntcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwic3VibWVudVwiPjxtZW51PicpO1xuLy8gaXRlcmF0ZSBmLmZvcnVtc1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIGYuZm9ydW1zLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGkgPSAwLCAkJGwgPSBmLmZvcnVtcy5sZW5ndGg7IGkgPCAkJGw7IGkrKykge1xuICAgICAgdmFyIHNmID0gZi5mb3J1bXNbaV07XG5cbmJ1Zi5wdXNoKCc8bGkgY2xhc3M9XCJyb3dcIj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHNmLnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArIChcImZvcnVtLVwiICsgKHNmLmlkKSArIFwiXCIpIH0sIHtcImNsYXNzXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gc2YudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYT48L2xpPicpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpIGluIGYuZm9ydW1zKSB7XG4gICAgICB2YXIgc2YgPSBmLmZvcnVtc1tpXTtcblxuYnVmLnB1c2goJzxsaSBjbGFzcz1cInJvd1wiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooc2YudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpICsgJyAnICsgKFwiZm9ydW0tXCIgKyAoc2YuaWQpICsgXCJcIikgfSwge1wiY2xhc3NcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBzZi50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvbGk+Jyk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbmJ1Zi5wdXNoKCc8L21lbnU+PC9kaXY+Jyk7XG59XG5idWYucHVzaCgnPC9saT4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaSBpbiBtZW51KSB7XG4gICAgICB2YXIgZiA9IG1lbnVbaV07XG5cbmJ1Zi5wdXNoKCc8bGkgY2xhc3M9XCJyb3dcIj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1zdXJmJzooZi5pZCksICdkYXRhLXNjcm9sbC10byc6KFwiI2ZvcnVtX1wiICsgKGYuaWQpICsgXCJcIiksICdocmVmJzooXCIvXCIgKyAoZi5zbHVnKSArIFwiXCIpLCBcImNsYXNzXCI6ICgndGl0bGUnKSArICcgJyArIChcImZvcnVtLVwiICsgKGYuaWQpICsgXCJcIikgfSwge1wiY2xhc3NcIjp0cnVlLFwiZGF0YS1zdXJmXCI6dHJ1ZSxcImRhdGEtc2Nyb2xsLXRvXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gZi50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPicpO1xuaWYgKCBmLmZvcnVtcy5sZW5ndGgpXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInN1Ym1lbnVcIj48bWVudT4nKTtcbi8vIGl0ZXJhdGUgZi5mb3J1bXNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBmLmZvcnVtcy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgJCRsID0gZi5mb3J1bXMubGVuZ3RoOyBpIDwgJCRsOyBpKyspIHtcbiAgICAgIHZhciBzZiA9IGYuZm9ydW1zW2ldO1xuXG5idWYucHVzaCgnPGxpIGNsYXNzPVwicm93XCI+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihzZi51cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgKyAnICcgKyAoXCJmb3J1bS1cIiArIChzZi5pZCkgKyBcIlwiKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IHNmLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+PC9saT4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaSBpbiBmLmZvcnVtcykge1xuICAgICAgdmFyIHNmID0gZi5mb3J1bXNbaV07XG5cbmJ1Zi5wdXNoKCc8bGkgY2xhc3M9XCJyb3dcIj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHNmLnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArIChcImZvcnVtLVwiICsgKHNmLmlkKSArIFwiXCIpIH0sIHtcImNsYXNzXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gc2YudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYT48L2xpPicpO1xuICAgfVxuICB9XG59KS5jYWxsKHRoaXMpO1xuXG5idWYucHVzaCgnPC9tZW51PjwvZGl2PicpO1xufVxuYnVmLnB1c2goJzwvbGk+Jyk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbmJ1Zi5wdXNoKCc8L21lbnU+PC9kaXY+PG1lbnUgY2xhc3M9XCJ0b29sc1wiPjxhIGNsYXNzPVwicHJvZmlsZSBwaG90byBtdXRhbnRcIj48aW1nIGlkPVwicHJvZmlsZVwiLz48L2E+PGxpIGNsYXNzPVwib25jbGljay1sb2dpblwiPjxhIGhyZWY9XCIvYXV0aC9sb2dpblwiPkxvZ2luPC9hPjwvbGk+PGxpIGNsYXNzPVwiYWRtaW4tb25seVwiPjxhIGhyZWY9XCIvYWRtaW5cIiBjbGFzcz1cIm11dGFudFwiPkFkbWluPC9hPjwvbGk+PGxpPjxhIGhyZWY9XCIvdXNlcnNcIiBjbGFzcz1cIm11dGFudCBvbmNsaWNrLXByb2ZpbGVcIj5Qcm9maWxlPC9hPjwvbGk+PGxpIGNsYXNzPVwib25jbGljay1sb2dvdXRcIj48YSBocmVmPVwiL2F1dGgvbG9nb3V0XCI+TG9nb3V0PC9hPjwvbGk+PC9tZW51PjwvZGl2PjwvaGVhZGVyPjxzZWN0aW9uIGlkPVwibGVmdF9jb250ZW50XCIgY2xhc3M9XCJsZWZ0LWNvbnRlbnRcIj48ZGl2IGlkPVwiaGFuZGxlXCIgdGl0bGU9XCJUb2dnbGVcIiBjbGFzcz1cImhhbmRsZVwiPjwvZGl2PjxkaXYgaWQ9XCJsZWZ0X2NvbnRhaW5lclwiPjwvZGl2PjxkaXYgaWQ9XCJwYWdpbmF0b3JcIiB0aXRsZT1cIkdvIHRvIHRoaXMgUGFnZVwiPicpO1xuaWYgKCB0eXBlb2YgcGFnZSA9PSAnbnVtYmVyJylcbntcbmlmICggcGFnZSAhPSAxKVxue1xuaWYgKCBwYWdlICE9IDIpXG57XG5idWYucHVzaCgnPGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzooJ1ByZXZpb3VzIFBhZ2UnKSwgJ2hyZWYnOihcIlwiICsgKGZ1cmwudGhyZWFkVXJpKSArIFwiL3BhZ2UvXCIgKyAocGFnZSAtIDEpICsgXCJcIiksIFwiY2xhc3NcIjogKCdwYWdlJykgKyAnICcgKyAoJ3ByZXZpb3VzJykgfSwge1widGl0bGVcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPiA8L2E+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzooJ1ByZXZpb3VzIFBhZ2UnKSwgJ2hyZWYnOihcIlwiICsgKGZ1cmwudGhyZWFkVXJpKSArIFwiXCIpLCBcImNsYXNzXCI6ICgncGFnZScpICsgJyAnICsgKCdwcmV2aW91cycpIH0sIHtcInRpdGxlXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4gPC9hPicpO1xufVxufVxuZWxzZVxue1xuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICd0aXRsZSc6KCdQcmV2aW91cyBQYWdlJyksICdocmVmJzooXCJcIiArIChmdXJsLnRocmVhZFVyaSkgKyBcIlwiKSwgJ3N0eWxlJzooXCJkaXNwbGF5Om5vbmU7XCIpLCBcImNsYXNzXCI6ICgncGFnZScpICsgJyAnICsgKCdwcmV2aW91cycpIH0sIHtcInRpdGxlXCI6dHJ1ZSxcImhyZWZcIjp0cnVlLFwic3R5bGVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4gPC9hPicpO1xufVxuYnVmLnB1c2goJzxkaXYgdGl0bGU9XCJEcmFnIHRvIFBhZ2UgdGhyb3VnaFwiIGNsYXNzPVwiY3VycmVudFwiPjxkaXYgY2xhc3M9XCJ0b29sdGlwIHJpZ2h0XCI+PC9kaXY+PC9kaXY+Jyk7XG5pZiAoIHBhZ2UgIT0gcGFnZXNDb3VudClcbntcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAndGl0bGUnOignTmV4dCBQYWdlJyksICdocmVmJzooXCJcIiArIChmdXJsLnRocmVhZFVyaSkgKyBcIi9wYWdlL1wiICsgKHBhZ2UgKyAxKSArIFwiXCIpLCBcImNsYXNzXCI6ICgncGFnZScpICsgJyAnICsgKCduZXh0JykgfSwge1widGl0bGVcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPiA8L2E+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzooJ05leHQgUGFnZScpLCAnaHJlZic6KFwiXCIgKyAoZnVybC50aHJlYWRVcmkpICsgXCIvcGFnZS9cIiArIChwYWdlc0NvdW50KSArIFwiXCIpLCAnc3R5bGUnOihcImRpc3BsYXk6bm9uZTtcIiksIFwiY2xhc3NcIjogKCdwYWdlJykgKyAnICcgKyAoJ25leHQnKSB9LCB7XCJ0aXRsZVwiOnRydWUsXCJocmVmXCI6dHJ1ZSxcInN0eWxlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+IDwvYT4nKTtcbn1cbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8YSB0aXRsZT1cIlByZXZpb3VzIFBhZ2VcIiBocmVmPVwiL1wiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiIGNsYXNzPVwicGFnZSBwcmV2aW91c1wiPiA8L2E+PGRpdiB0aXRsZT1cIkRyYWcgdG8gUGFnZSB0aHJvdWdoXCIgY2xhc3M9XCJjdXJyZW50XCI+PGRpdiBjbGFzcz1cInRvb2x0aXAgcmlnaHRcIj48L2Rpdj48L2Rpdj48YSB0aXRsZT1cIk5leHQgUGFnZVwiIGhyZWY9XCIvXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIgY2xhc3M9XCJwYWdlIG5leHRcIj4gPC9hPicpO1xufVxuYnVmLnB1c2goJzwvZGl2Pjwvc2VjdGlvbj48c2VjdGlvbiBpZD1cIm1haW5fY29udGVudFwiIGNsYXNzPVwibWFpbi1jb250ZW50IGNvbnRhaW5lclwiPjwvc2VjdGlvbj48c2VjdGlvbiBjbGFzcz1cImV4dHJhXCI+PC9zZWN0aW9uPjxzZWN0aW9uIGlkPVwiYXV0aFwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPjwvc2VjdGlvbj4nKTtcbmlmICggY3ZhcnMuZW52ICE9ICdwcm9kdWN0aW9uJylcbntcbmJ1Zi5wdXNoKCc8ZGl2IGlkPVwibW9jaGFcIj48L2Rpdj4nKTtcbn1cbmJ1Zi5wdXNoKCc8Zm9vdGVyIGNsYXNzPVwib25jbGljay1mb290ZXItdG9nZ2xlXCI+PGRpdiBjbGFzcz1cInBvc3QtcmVwbHkgb25jbGljay1mb290ZXItdG9nZ2xlXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm9uY2xpY2stc2Nyb2xsLXRvcFwiPlRvcDwvZGl2PjxkaXYgaWQ9XCJwYl9wYWdpbmF0b3JcIj48L2Rpdj48aDYgY2xhc3M9XCJvbmNsaWNrLWZvb3Rlci10b2dnbGVcIj48c21hbGw+JmNvcHk7ICcgKyBlc2NhcGUoKGludGVycCA9IHNpdGVOYW1lKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJyAmbmJzcDs8L3NtYWxsPjxiPicpO1xudmFyIF9fdmFsX18gPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKClcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYj48L2g2PjxkaXYgY2xhc3M9XCJwb3N0LWNvbnRhaW5lclwiPjxmb3JtIGFjdGlvbj1cIi9yZXNvdXJjZXMvcG9zdHNcIiBtZXRob2Q9XCJwb3N0XCIgY2xhc3M9XCJwb3N0IHBvc3QtbmV3XCI+PGRpdiBpZD1cInBvc3RfbmV3XCI+PC9kaXY+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48L2Zvcm0+PC9kaXY+PC9mb290ZXI+PGRpdiBpZD1cImNoYXRfZHJhd2VyXCI+PC9kaXY+PGxpbmsnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIlwiICsgKGNhY2hlNVVybCkgKyBcIi9sb2NhbC9qcXVlcnktdWkubWluLmNzc1wiKSwgJ3JlbCc6KCdzdHlsZXNoZWV0JyksICd0eXBlJzooJ3RleHQvY3NzJykgfSwge1wiaHJlZlwiOnRydWUsXCJyZWxcIjp0cnVlLFwidHlwZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbnZhciBfX3ZhbF9fID0gYW5hbHl0aWNzXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9ib2R5PjwvaHRtbD4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiaG9tZXBhZ2VcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfcHJvZmlsZV9taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbiBpZiAoIXAudXNlcl9waG90bykgcC51c2VyX3Bob3RvID0gY2FjaGVVcmwgKyAnaW1hZ2VzL3Byb2ZpbGUuanBnJ1xuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvdXNlci9cIiArIChwLnVzZXJfbmFtZSkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3VzZXInKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxkaXYgY2xhc3M9XCJwcm9maWxlIHBob3RvXCI+Jyk7XG5pZiAoIHAudXNlcl9waG90byAmJiBwLnVzZXJfcGhvdG8ubWF0Y2goL15odHRwLykpXG57XG5idWYucHVzaCgnPGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAndGl0bGUnOihwLnVzZXJfbmFtZSksICdzcmMnOihcIlwiICsgKHAudXNlcl9waG90bykgKyBcIlwiKSB9LCB7XCJ0aXRsZVwiOnRydWUsXCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9cIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuYnVmLnB1c2goJzwvZGl2PjwvYT4nKTtcbn07XG52YXIgbWVkaWFfcG9zdF9taXhpbiA9IGZ1bmN0aW9uKGYsIGkpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihmLm1lZGlhX3VybCkgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufTtcbnZhciBodG1sX3Bvc3RfbWl4aW4gPSBmdW5jdGlvbihmLCB0LCBpKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG5idWYucHVzaCgnPHAgY2xhc3M9XCJib2R5XCI+Jyk7XG52YXIgX192YWxfXyA9IGYuaHRtbFxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvcD4nKTtcbn07XG52YXIgcG9zdHNfbWl4aW4gPSBmdW5jdGlvbihmLCBpKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4vLyBpdGVyYXRlIGYucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBmLnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGkgPSAwLCAkJGwgPSBmLnBvc3RzLmxlbmd0aDsgaSA8ICQkbDsgaSsrKSB7XG4gICAgICB2YXIgcCA9IGYucG9zdHNbaV07XG5cbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwicG9zdF9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgncG9zdCcpICsgJyAnICsgKFwiY29sXCIgKyAoTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkqMikpICsgXCJcIikgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48aDUgY2xhc3M9XCJ0aXRsZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPHNwYW4gY2xhc3M9XCJkYXRlXCI+JyArIGVzY2FwZSgoaW50ZXJwID0gcC5kYXRlKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJzwvc3Bhbj48L2g1PjwvYT4nKTtcbmlmICggcC5tZWRpYV91cmwpXG57XG5tZWRpYV9wb3N0X21peGluKHAsIGkpO1xufVxuZWxzZVxue1xuaHRtbF9wb3N0X21peGluKHAsIGkpO1xufVxuX3Bvc3RfcHJvZmlsZV9taXhpbihwLCBpKTtcbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaSBpbiBmLnBvc3RzKSB7XG4gICAgICB2YXIgcCA9IGYucG9zdHNbaV07XG5cbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwicG9zdF9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgncG9zdCcpICsgJyAnICsgKFwiY29sXCIgKyAoTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkqMikpICsgXCJcIikgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48aDUgY2xhc3M9XCJ0aXRsZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPHNwYW4gY2xhc3M9XCJkYXRlXCI+JyArIGVzY2FwZSgoaW50ZXJwID0gcC5kYXRlKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJzwvc3Bhbj48L2g1PjwvYT4nKTtcbmlmICggcC5tZWRpYV91cmwpXG57XG5tZWRpYV9wb3N0X21peGluKHAsIGkpO1xufVxuZWxzZVxue1xuaHRtbF9wb3N0X21peGluKHAsIGkpO1xufVxuX3Bvc3RfcHJvZmlsZV9taXhpbihwLCBpKTtcbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxufTtcbmlmICggZm9ydW1zKVxue1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgXCJjbGFzc1wiOiAoJ2hvbWVwYWdlJykgKyAnICcgKyAoYWN0aXZlRm9ydW1JZCE9J2hvbWVwYWdlJz8ncmVzaXphYmxlIGZvcnVtJzonJykgfSwge1wiY2xhc3NcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbi8vIGl0ZXJhdGUgZm9ydW1zXG47KGZ1bmN0aW9uKCl7XG4gIGlmICgnbnVtYmVyJyA9PSB0eXBlb2YgZm9ydW1zLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGkgPSAwLCAkJGwgPSBmb3J1bXMubGVuZ3RoOyBpIDwgJCRsOyBpKyspIHtcbiAgICAgIHZhciBmID0gZm9ydW1zW2ldO1xuXG5idWYucHVzaCgnPGRpdicpO1xuYnVmLnB1c2goYXR0cnMoeyAnaWQnOihcImZvcnVtX1wiICsgKGYuaWQpICsgXCJcIiksIFwiY2xhc3NcIjogKCdmb3J1bScpICsgJyAnICsgKGYuY2xhc3NlcyB8fCAnJykgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48aDIgY2xhc3M9XCJ0aXRsZVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooZi51cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBmLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+PC9oMj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnbmFtZSc6KFwiZm9ydW1fXCIgKyAoZi5pZCkgKyBcIlwiKSB9LCB7XCJuYW1lXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PC9hPjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj4nKTtcbnBvc3RzX21peGluKGYsIGkpO1xuYnVmLnB1c2goJzwvZGl2PjwvZGl2PicpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpIGluIGZvcnVtcykge1xuICAgICAgdmFyIGYgPSBmb3J1bXNbaV07XG5cbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZm9ydW1fXCIgKyAoZi5pZCkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ2ZvcnVtJykgKyAnICcgKyAoZi5jbGFzc2VzIHx8ICcnKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJpZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxoMiBjbGFzcz1cInRpdGxlXCI+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihmLnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IGYudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYT48L2gyPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICduYW1lJzooXCJmb3J1bV9cIiArIChmLmlkKSArIFwiXCIpIH0sIHtcIm5hbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48L2E+PGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPicpO1xucG9zdHNfbWl4aW4oZiwgaSk7XG5idWYucHVzaCgnPC9kaXY+PC9kaXY+Jyk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8cD5DcmVhdGUgYSBmb3J1bSBmaXJzdDxpPiE8L2k+PC9wPicpO1xufVxufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJvcmRlci1jb250cm9sXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJvcmRlcmVyXCI+PGRpdiBjbGFzcz1cImluZGljYXRvclwiPjwhLS0gVE9ETyAtLSAsIFtcXCduZWFyZXN0XFwnLCBcXCdOZWFyYnlcXCddXS0tPicpO1xudmFyIG9yZGVycyA9IChbWydwb3B1bGFyJywgJ1BvcHVsYXInXSwgWydyZWNlbnQnLCAnTW9zdCBSZWNlbnQnXSwgWydhY3RpdmUnLCAnTW9zdCBBY3RpdmUnXV0pO1xuYnVmLnB1c2goJzwvZGl2Pjx1bCBpZD1cIm9yZGVyXCI+Jyk7XG4vLyBpdGVyYXRlIG9yZGVyc1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIG9yZGVycy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciAkaW5kZXggPSAwLCAkJGwgPSBvcmRlcnMubGVuZ3RoOyAkaW5kZXggPCAkJGw7ICRpbmRleCsrKSB7XG4gICAgICB2YXIgbyA9IG9yZGVyc1skaW5kZXhdO1xuXG5pZiAoIG9bMF0gPT0gYWN0aXZlKVxue1xuYnVmLnB1c2goJzxsaScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS12YWx1ZSc6KG9bMF0pLCBcImNsYXNzXCI6ICgnYWN0aXZlJykgfSwge1wiZGF0YS12YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBvWzFdXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2xpPicpO1xufVxuZWxzZVxue1xuYnVmLnB1c2goJzxsaScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS12YWx1ZSc6KG9bMF0pIH0sIHtcImRhdGEtdmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gb1sxXVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9saT4nKTtcbn1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgJGluZGV4IGluIG9yZGVycykge1xuICAgICAgdmFyIG8gPSBvcmRlcnNbJGluZGV4XTtcblxuaWYgKCBvWzBdID09IGFjdGl2ZSlcbntcbmJ1Zi5wdXNoKCc8bGknKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdmFsdWUnOihvWzBdKSwgXCJjbGFzc1wiOiAoJ2FjdGl2ZScpIH0sIHtcImRhdGEtdmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gb1sxXVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9saT4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8bGknKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdmFsdWUnOihvWzBdKSB9LCB7XCJkYXRhLXZhbHVlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IG9bMV1cbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvbGk+Jyk7XG59XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbmJ1Zi5wdXNoKCc8L3VsPjxkaXYgY2xhc3M9XCJvbmNsaWNrLXNjcm9sbC10b3BcIj48L2Rpdj48L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1widGhyZWFkXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF90aHJlYWRfbWl4aW4gPSBmdW5jdGlvbih0KXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCF0LnVzZXJfcGhvdG8pIHQudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8bGknKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtaWQnOih0LmlkKSwgJ2RhdGEtdXNlci1pZCc6KHQudXNlcl9pZCksIFwiY2xhc3NcIjogKCd0aHJlYWQnKSB9LCB7XCJkYXRhLWlkXCI6dHJ1ZSxcImRhdGEtdXNlci1pZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXN1cmYnOih0LmZvcnVtX2lkKSwgJ2hyZWYnOih0LnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJkYXRhLXN1cmZcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxoNCBjbGFzcz1cInRpdGxlXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvaDQ+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGRpdiBjbGFzcz1cInByb2ZpbGUgcGhvdG9cIj48aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiXCIgKyAodC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2Rpdj48ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+PHNwYW4gY2xhc3M9XCJ1c2VybmFtZVwiPmJ5PGVtPicpO1xudmFyIF9fdmFsX18gPSB0LnVzZXJfbmFtZSAvLyBYWFggd2VpcmQgdGhpbmdzIGhhcHBlbmVkIHdoZW4gSSB0cmllZCB0byB0dXJuIHRoaXMgaW50byBhbiBhbmNob3JcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvZW0+PC9zcGFuPjxzcGFuJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOih0LmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2NyZWF0ZWQnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gdC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9zcGFuPjxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PjxzcGFuIGNsYXNzPVwicG9zdC1jb3VudFwiPicpO1xudmFyIF9fdmFsX18gPSB0LnBvc3RfY291bnRcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnBvc3RzPC9pPjwvc3Bhbj48c3BhbiBjbGFzcz1cInZpZXdzXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudmlld3NcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnZpZXdzPC9pPjwvc3Bhbj48L2Rpdj48L2E+PC9saT4nKTtcbn07XG5fdGhyZWFkX21peGluKHRocmVhZCk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIm5hdlwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbnZhciBfdGhyZWFkX21peGluID0gZnVuY3Rpb24odCl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuIGlmICghdC51c2VyX3Bob3RvKSB0LnVzZXJfcGhvdG8gPSBjYWNoZVVybCArICdpbWFnZXMvcHJvZmlsZS5qcGcnXG5idWYucHVzaCgnPGxpJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLWlkJzoodC5pZCksICdkYXRhLXVzZXItaWQnOih0LnVzZXJfaWQpLCBcImNsYXNzXCI6ICgndGhyZWFkJykgfSwge1wiZGF0YS1pZFwiOnRydWUsXCJkYXRhLXVzZXItaWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1zdXJmJzoodC5mb3J1bV9pZCksICdocmVmJzoodC51cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgfSwge1wiZGF0YS1zdXJmXCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48aDQgY2xhc3M9XCJ0aXRsZVwiPicpO1xudmFyIF9fdmFsX18gPSB0LnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2g0PjxkaXYgY2xhc3M9XCJicmVha1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJwcm9maWxlIHBob3RvXCI+PGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIlwiICsgKHQudXNlcl9waG90bykgKyBcIlwiKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PC9kaXY+PGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj5ieTxlbT4nKTtcbnZhciBfX3ZhbF9fID0gdC51c2VyX25hbWUgLy8gWFhYIHdlaXJkIHRoaW5ncyBoYXBwZW5lZCB3aGVuIEkgdHJpZWQgdG8gdHVybiB0aGlzIGludG8gYW4gYW5jaG9yXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2VtPjwvc3Bhbj48c3BhbicpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS10aW1lJzoodC5jcmVhdGVkX2lzbyksIFwiY2xhc3NcIjogKCdjcmVhdGVkJykgfSwge1wiZGF0YS10aW1lXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IHQuY3JlYXRlZF9odW1hblxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvc3Bhbj48ZGl2IGNsYXNzPVwiY2xlYXJcIj48L2Rpdj48c3BhbiBjbGFzcz1cInBvc3QtY291bnRcIj4nKTtcbnZhciBfX3ZhbF9fID0gdC5wb3N0X2NvdW50XG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8aT5wb3N0czwvaT48L3NwYW4+PHNwYW4gY2xhc3M9XCJ2aWV3c1wiPicpO1xudmFyIF9fdmFsX18gPSB0LnZpZXdzXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8aT52aWV3czwvaT48L3NwYW4+PC9kaXY+PC9hPjwvbGk+Jyk7XG59O1xudmFyIHN1YmZvcnVtX21peGluID0gZnVuY3Rpb24oZiwgc2YsIGkpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8bGkgY2xhc3M9XCJzdWJmb3J1bVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooc2YudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpICsgJyAnICsgKCd0aXRsZScpICsgJyAnICsgKCdzdHlsaXNoJykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBzZi50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvbGk+Jyk7XG59O1xudmFyIGZvcnVtX21peGluID0gZnVuY3Rpb24oZiwgaSl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxoMyBjbGFzcz1cInRpdGxlXCI+Rm9ydW1zPC9oMz4nKTtcbmlmICggZi5mb3J1bXMpXG57XG5idWYucHVzaCgnPHVsJyk7XG5idWYucHVzaChhdHRycyh7IFwiY2xhc3NcIjogKCdmb3J1bScpICsgJyAnICsgKFwiXCIgKyAoZi5jbGFzc2VzIHx8ICcnKSArIFwiIGZvcnVtLVwiICsgKGFjdGl2ZUZvcnVtSWQpICsgXCJcIikgfSwge1wiY2xhc3NcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbi8vIGl0ZXJhdGUgZi5mb3J1bXNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBmLmZvcnVtcy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpaSA9IDAsICQkbCA9IGYuZm9ydW1zLmxlbmd0aDsgaWkgPCAkJGw7IGlpKyspIHtcbiAgICAgIHZhciBzZiA9IGYuZm9ydW1zW2lpXTtcblxuc3ViZm9ydW1fbWl4aW4oZiwgc2YsIGlpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gZi5mb3J1bXMpIHtcbiAgICAgIHZhciBzZiA9IGYuZm9ydW1zW2lpXTtcblxuc3ViZm9ydW1fbWl4aW4oZiwgc2YsIGlpKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvdWw+Jyk7XG59XG59O1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJjcmVhdGVcIj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1lZGl0JzooJ3RydWUnKSwgJ2hyZWYnOihcIlwiICsgKGZvcnVtLnVyaSkgKyBcIi9uZXdcIiksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArICgnbm8tc3VyZicpICsgJyAnICsgKCdyZXF1aXJlLWxvZ2luJykgKyAnICcgKyAoJ2J1dHRvbicpIH0sIHtcImRhdGEtZWRpdFwiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Q3JlYXRlIFRocmVhZDwvYT48L2Rpdj48ZGl2IGlkPVwidGhyZWFkLXBhZ2luYXRvclwiPjwvZGl2PjxkaXYgY2xhc3M9XCJzY3JvbGxhYmxlXCI+Jyk7XG52YXIgX3RocmVhZF9taXhpbiA9IGZ1bmN0aW9uKHQpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbiBpZiAoIXQudXNlcl9waG90bykgdC51c2VyX3Bob3RvID0gY2FjaGVVcmwgKyAnaW1hZ2VzL3Byb2ZpbGUuanBnJ1xuYnVmLnB1c2goJzxsaScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1pZCc6KHQuaWQpLCAnZGF0YS11c2VyLWlkJzoodC51c2VyX2lkKSwgXCJjbGFzc1wiOiAoJ3RocmVhZCcpIH0sIHtcImRhdGEtaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtc3VyZic6KHQuZm9ydW1faWQpLCAnaHJlZic6KHQudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImRhdGEtc3VyZlwiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gdC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND48ZGl2IGNsYXNzPVwiYnJlYWtcIj48L2Rpdj48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCJcIiArICh0LnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvZGl2PjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj48c3BhbiBjbGFzcz1cInVzZXJuYW1lXCI+Ynk8ZW0+Jyk7XG52YXIgX192YWxfXyA9IHQudXNlcl9uYW1lIC8vIFhYWCB3ZWlyZCB0aGluZ3MgaGFwcGVuZWQgd2hlbiBJIHRyaWVkIHRvIHR1cm4gdGhpcyBpbnRvIGFuIGFuY2hvclxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9lbT48L3NwYW4+PHNwYW4nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdGltZSc6KHQuY3JlYXRlZF9pc28pLCBcImNsYXNzXCI6ICgnY3JlYXRlZCcpIH0sIHtcImRhdGEtdGltZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSB0LmNyZWF0ZWRfaHVtYW5cbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L3NwYW4+PGRpdiBjbGFzcz1cImNsZWFyXCI+PC9kaXY+PHNwYW4gY2xhc3M9XCJwb3N0LWNvdW50XCI+Jyk7XG52YXIgX192YWxfXyA9IHQucG9zdF9jb3VudFxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPGk+cG9zdHM8L2k+PC9zcGFuPjxzcGFuIGNsYXNzPVwidmlld3NcIj4nKTtcbnZhciBfX3ZhbF9fID0gdC52aWV3c1xuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPGk+dmlld3M8L2k+PC9zcGFuPjwvZGl2PjwvYT48L2xpPicpO1xufTtcbmJ1Zi5wdXNoKCc8dWwgY2xhc3M9XCJ0aHJlYWRzXCI+Jyk7XG4vLyBpdGVyYXRlIHRvcFRocmVhZHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiB0b3BUaHJlYWRzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGlpID0gMCwgJCRsID0gdG9wVGhyZWFkcy5sZW5ndGg7IGlpIDwgJCRsOyBpaSsrKSB7XG4gICAgICB2YXIgdCA9IHRvcFRocmVhZHNbaWldO1xuXG5fdGhyZWFkX21peGluKHQpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpaSBpbiB0b3BUaHJlYWRzKSB7XG4gICAgICB2YXIgdCA9IHRvcFRocmVhZHNbaWldO1xuXG5fdGhyZWFkX21peGluKHQpO1xuICAgfVxuICB9XG59KS5jYWxsKHRoaXMpO1xuXG5idWYucHVzaCgnPC91bD48L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wicG9zdHNcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xudmFyIF9wb3N0X3Byb2ZpbGVfbWl4aW4gPSBmdW5jdGlvbihwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCFwLnVzZXJfcGhvdG8pIHAudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL3VzZXIvXCIgKyAocC51c2VyX25hbWUpICsgXCJcIiksIFwiY2xhc3NcIjogKCd1c2VyJykgKyAnICcgKyAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPicpO1xuaWYgKCBwLnVzZXJfcGhvdG8gJiYgcC51c2VyX3Bob3RvLm1hdGNoKC9eaHR0cC8pKVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzoocC51c2VyX25hbWUpLCAnc3JjJzooXCJcIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1widGl0bGVcIjp0cnVlLFwic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuZWxzZVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAocC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2E+Jyk7XG59O1xudmFyIF9wb3N0X21peGluID0gZnVuY3Rpb24ocCwgaSl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooXCJwb3N0X1wiICsgKHAuaWQpICsgXCJcIiksICdkYXRhLXVzZXItaWQnOihwLnVzZXJfaWQpLCAnZGF0YS1wb3N0LWlkJzoocC5pZCksICdkYXRhLXRocmVhZC1pZCc6KHAudGhyZWFkX2lkKSwgJ2RhdGEtZm9ydW0taWQnOihwLmZvcnVtX2lkKSwgXCJjbGFzc1wiOiAoJ3Bvc3QnKSArICcgJyArIChwLnJlYXNvbiA/ICdjZW5zb3JlZCcgOiAnJykgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZSxcImRhdGEtcG9zdC1pZFwiOnRydWUsXCJkYXRhLXRocmVhZC1pZFwiOnRydWUsXCJkYXRhLWZvcnVtLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG5pZiAoIHAudGhyZWFkX3VyaSlcbntcbmJ1Zi5wdXNoKCc8aDQgY2xhc3M9XCJ0aXRsZVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC50aHJlYWRfdXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvaDQ+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND4nKTtcbn1cbl9wb3N0X3Byb2ZpbGVfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC51c2VyX25hbWVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvc3Bhbj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOihwLmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2RhdGUnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9kaXY+PGRpdiBjbGFzcz1cInBvc3QtY29udGVudFwiPicpO1xuaWYgKCBwLmh0bWwpXG57XG5idWYucHVzaCgnPHAgY2xhc3M9XCJib2R5XCI+Jyk7XG52YXIgX192YWxfXyA9IHAuaHRtbFxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvcD4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2Rpdj4nKTtcbl9wb3N0X2FjdGlvbnNfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInJlcGx5XCI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImNoaWxkcmVuXCI+Jyk7XG5pZiAoIHAucG9zdHMgJiYgcC5wb3N0cy5sZW5ndGgpXG57XG4vLyBpdGVyYXRlIHAucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBwLnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGlpID0gMCwgJCRsID0gcC5wb3N0cy5sZW5ndGg7IGlpIDwgJCRsOyBpaSsrKSB7XG4gICAgICB2YXIgcHAgPSBwLnBvc3RzW2lpXTtcblxuX3Bvc3RfbWl4aW4ocHAsIGlpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gcC5wb3N0cykge1xuICAgICAgdmFyIHBwID0gcC5wb3N0c1tpaV07XG5cbl9wb3N0X21peGluKHBwLCBpaSk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2UgaWYgKCBwLm1vcmVQb3N0cylcbntcbmJ1Zi5wdXNoKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwibG9hZC1tb3JlXCI+TW9yZSBQb3N0czwvYT4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn07XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xudmFyIF9icmVhZGNydW1iX21peGluID0gZnVuY3Rpb24ocCl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xudmFyIHBhdGggPSAoJycpO1xudmFyIHBhcnRzID0gKHAudXJpLnNwbGl0KCcvJykpO1xudmFyIHBhcnRzID0gKHBhcnRzLnNwbGljZSgxLCBwYXJ0cy5sZW5ndGgtMikpO1xuLy8gaXRlcmF0ZSBwYXJ0c1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHBhcnRzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IHBhcnRzLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIHBhcnQgPSBwYXJ0c1skaW5kZXhdO1xuXG5pZiAoIHBhcnQgIT0gJ3QnKVxue1xuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvXCIgKyAocGF0aCkgKyBcIlwiICsgKHBhcnQpICsgXCJcIiksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IHBhcnQucmVwbGFjZSgnLScsICcgJylcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYT48c3Bhbj4vPC9zcGFuPicpO1xufVxuIHBhdGggPSBwYXRoICsgcGFydCArICcvJ1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gcGFydHMpIHtcbiAgICAgIHZhciBwYXJ0ID0gcGFydHNbJGluZGV4XTtcblxuaWYgKCBwYXJ0ICE9ICd0JylcbntcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL1wiICsgKHBhdGgpICsgXCJcIiArIChwYXJ0KSArIFwiXCIpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwYXJ0LnJlcGxhY2UoJy0nLCAnICcpXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+PHNwYW4+Lzwvc3Bhbj4nKTtcbn1cbiBwYXRoID0gcGF0aCArIHBhcnQgKyAnLydcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzxlbT4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9lbT4nKTtcbn07XG5pZiAoIHR5cGVvZihwb3N0KSAhPT0gJ3VuZGVmaW5lZCcpXG57XG4gaWYgKCFwb3N0LnVzZXJfcGhvdG8pIHBvc3QudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiZm9ydW0gcmVzaXphYmxlXCI+Jyk7XG5pZiAoIHBhZ2UgPT0gMSlcbntcbmJ1Zi5wdXNoKCc8ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwicG9zdF9cIiArIChwb3N0LmlkKSArIFwiXCIpLCAnZGF0YS11c2VyLWlkJzoocG9zdC51c2VyX2lkKSwgJ2RhdGEtcG9zdC1pZCc6KHBvc3QuaWQpLCBcImNsYXNzXCI6ICgncG9zdCcpICsgJyAnICsgKCdoZWFkJykgKyAnICcgKyAocG9zdC5yZWFzb24gPyAnY2Vuc29yZWQnIDogJycpIH0sIHtcImNsYXNzXCI6dHJ1ZSxcImlkXCI6dHJ1ZSxcImRhdGEtdXNlci1pZFwiOnRydWUsXCJkYXRhLXBvc3QtaWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48aDMgY2xhc3M9XCJ0aXRsZVwiPicpO1xudmFyIF9fdmFsX18gPSBwb3N0LnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2gzPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvdXNlci9cIiArIChwb3N0LnVzZXJfbmFtZSkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3VzZXInKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxkaXYgY2xhc3M9XCJwcm9maWxlIHBob3RvXCI+PGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9cIiArIChwb3N0LnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvZGl2PjxzcGFuPicpO1xudmFyIF9fdmFsX18gPSBwb3N0LnVzZXJfbmFtZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9zcGFuPjwvYT48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOihwb3N0LmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2RhdGUnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcG9zdC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9kaXY+PGRpdiBjbGFzcz1cImVkaXQtY29udGFpbmVyXCI+PC9kaXY+Jyk7XG5pZiAoIHBvc3QuaHRtbClcbntcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYm9keVwiPicpO1xudmFyIF9fdmFsX18gPSBwb3N0Lmh0bWxcbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwicmVwbHlcIj48L2Rpdj48ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWZvb3Rlci10b2dnbGVcIj5SZXBseTwvYT48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1lZGl0JzoocG9zdC5pZCksICdocmVmJzooXCJcIiArIChwb3N0LnVyaS5yZXBsYWNlKC9cXC9cXGQrJC8sICcnKSkgKyBcIi9lZGl0L1wiICsgKHBvc3QuaWQpICsgXCJcIiksIFwiY2xhc3NcIjogKCdzdHlsaXNoJykgKyAnICcgKyAoJ2VkaXQnKSArICcgJyArICgnbXV0YW50JykgKyAnICcgKyAoJ25vLXN1cmYnKSB9LCB7XCJkYXRhLWVkaXRcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPkVkaXQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihwb3N0LnVyaSksIFwiY2xhc3NcIjogKCdzdHlsaXNoJykgKyAnICcgKyAoJ3Blcm1hbGluaycpICsgJyAnICsgKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+UGVybWFsaW5rPC9hPjxhIGNsYXNzPVwic3R5bGlzaCBjZW5zb3Igb25jbGljay1jZW5zb3ItcG9zdFwiPkNlbnNvcjwvYT48L2Rpdj48L2Rpdj4nKTtcbn1cbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiY2hpbGRyZW5cIj4nKTtcbmlmICggcG9zdC5wb3N0cy5sZW5ndGgpXG57XG5idWYucHVzaCgnPGRpdicpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1wYWdlJzoocGFnZSkgfSwge1wiZGF0YS1wYWdlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG4vLyBpdGVyYXRlIHBvc3QucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBwb3N0LnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IHBvc3QucG9zdHMubGVuZ3RoOyAkaW5kZXggPCAkJGw7ICRpbmRleCsrKSB7XG4gICAgICB2YXIgc3AgPSBwb3N0LnBvc3RzWyRpbmRleF07XG5cbmlmICggc3AucGFyZW50X2lkICE9PSBudWxsKVxue1xuX3Bvc3RfbWl4aW4oc3AsIDApO1xufVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gcG9zdC5wb3N0cykge1xuICAgICAgdmFyIHNwID0gcG9zdC5wb3N0c1skaW5kZXhdO1xuXG5pZiAoIHNwLnBhcmVudF9pZCAhPT0gbnVsbClcbntcbl9wb3N0X21peGluKHNwLCAwKTtcbn1cbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvZGl2PicpO1xufVxuZWxzZSBpZiAoIHBvc3QubW9yZVBvc3RzKVxue1xuYnVmLnB1c2goJzxhIGhyZWY9XCIjXCI+TG9hZCBtb3JlIHBvc3RzIC4uLjwvYT4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48cCBjbGFzcz1cIm9uY2xpY2stZm9vdGVyLXRvZ2dsZVwiPlBvc3QgUmVwbHk8L3A+PC9kaXY+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImZvcnVtIHJlc2l6YWJsZVwiPjwvZGl2PicpO1xufVxuaWYgKCB0eXBlb2YocG9zdCkgIT09ICd1bmRlZmluZWQnKVxue1xuYnVmLnB1c2goJzxkaXYgaWQ9XCJicmVhZGNydW1iXCIgY2xhc3M9XCJicmVhZGNydW1iXCI+Jyk7XG5fYnJlYWRjcnVtYl9taXhpbihwb3N0KTtcbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wicG9zdC1lZGl0XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF9wb3N0X2VkaXRfbWl4aW4gPSBmdW5jdGlvbih1LCBwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG52YXIgaHRtbF9pZCA9IChwLmlkID8gXCJfI3twLmlkfVwiIDogJycpO1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzoocC5pc19jb21tZW50ID8gaHRtbF9pZCA6ICdwb3N0X2VkaXQnKSwgXCJjbGFzc1wiOiAoJ3Bvc3QtZWRpdCcpICsgJyAnICsgKCdvbmNsaWNrLXN1Ym1pdCcpICsgJyAnICsgKHAuaXNfY29tbWVudCA/ICdjb21tZW50JyA6ICcnKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJpZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxmb3JtJyk7XG5idWYucHVzaChhdHRycyh7ICdhY3Rpb24nOihcIi9yZXNvdXJjZXMvcG9zdHNcIiksICdtZXRob2QnOihcIlwiICsgKHAubWV0aG9kIHx8ICdwdXQnKSArIFwiXCIpIH0sIHtcImFjdGlvblwiOnRydWUsXCJtZXRob2RcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwidG9vbHRpcFwiPjwvZGl2PjxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdXNlci1pZCc6KHUuaWQpLCBcImNsYXNzXCI6ICgnc3VtbWFyeScpIH0sIHtcImRhdGEtdXNlci1pZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAodS5waG90byB8fCAnaW1hZ2VzL3Byb2ZpbGUuanBnJykgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3Byb2ZpbGUnKSArICcgJyArICgncGhvdG8nKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PC9kaXY+Jyk7XG5pZiAoICFwLmlzX2NvbW1lbnQpXG57XG5idWYucHVzaCgnPGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICduYW1lJzooJ3RpdGxlJyksICd0eXBlJzooJ3RleHQnKSwgJ3BsYWNlaG9sZGVyJzooJ1RpdGxlJyksICd2YWx1ZSc6KHAudGl0bGUpLCBcImNsYXNzXCI6ICgndGl0bGUnKSB9LCB7XCJuYW1lXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwicGxhY2Vob2xkZXJcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5idWYucHVzaCgnPHRleHRhcmVhJyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZWRpdG9yXCIgKyAocC5pc19jb21tZW50ID8gaHRtbF9pZCA6ICcnKSArIFwiXCIpLCAnbmFtZSc6KCdib2R5JyksICdwbGFjZWhvbGRlcic6KCdDb21tZW50IC4uLicpLCBcImNsYXNzXCI6ICgnYm9keScpICsgJyAnICsgKCdvbnNoaWZ0ZW50ZXItc3VibWl0JykgfSwge1wiaWRcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLmJvZHlcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvdGV4dGFyZWE+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdpZCcpLCAndmFsdWUnOihwLmlkKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdmb3J1bV9pZCcpLCAndmFsdWUnOihwLmZvcnVtX2lkKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdwYXJlbnRfaWQnKSwgJ3ZhbHVlJzoocC5wYXJlbnRfaWQpIH0sIHtcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48aW5wdXQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3R5cGUnOignaGlkZGVuJyksICduYW1lJzooJ2NzcmYnKSwgJ3ZhbHVlJzoocC5jc3JmKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgbmFtZT1cInN1Ym1pdFwiIHZhbHVlPVwiU2F2ZVwiPlNhdmU8L2J1dHRvbj48ZGl2IGNsYXNzPVwiY2xvc2UgY2FuY2VsXCI+WDwvZGl2PjwvZm9ybT48ZGl2IGNsYXNzPVwicHJldmlld1wiPjwvZGl2PjwvZGl2PicpO1xufTtcbmlmICggdHlwZW9mKHBvc3QpICE9PSAndW5kZWZpbmVkJylcbntcbl9wb3N0X2VkaXRfbWl4aW4odXNlciwgcG9zdCk7XG59XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcInBvc3QtbmV3XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJmb3J1bSByZXNpemFibGVcIj48L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wicHJvZmlsZVwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+PGgyPicpO1xudmFyIF9fdmFsX18gPSBwcm9maWxlLm5hbWVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvaDI+PGRpdicpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS11c2VyLWlkJzooXCJcIiArIChwcm9maWxlLmlkKSArIFwiXCIpLCAnZGF0YS11c2VyLW5hbWUnOihcIlwiICsgKHByb2ZpbGUubmFtZSkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3Byb2ZpbGUnKSB9LCB7XCJkYXRhLXVzZXItaWRcIjp0cnVlLFwiZGF0YS11c2VyLW5hbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48Zm9ybScpO1xuYnVmLnB1c2goYXR0cnMoeyAnYWN0aW9uJzooXCIvcmVzb3VyY2VzL3VzZXJzL1wiICsgKHByb2ZpbGUuaWQpICsgXCIvYXZhdGFyXCIpLCAnZW5jdHlwZSc6KFwibXVsdGlwYXJ0L2Zvcm0tZGF0YVwiKSwgJ21ldGhvZCc6KFwicG9zdFwiKSB9LCB7XCJhY3Rpb25cIjp0cnVlLFwiZW5jdHlwZVwiOnRydWUsXCJtZXRob2RcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwiYXZhdGFyXCI+Jyk7XG5pZiAoIHByb2ZpbGUucGhvdG8pXG57XG5pZiAoIHByb2ZpbGUucGhvdG8ubWF0Y2goL15odHRwcz86LykpXG57XG5idWYucHVzaCgnPGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChwcm9maWxlLnBob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiL1wiICsgKHByb2ZpbGUucGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxufVxuZWxzZVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvaW1hZ2VzL3Byb2ZpbGUuanBnXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48aW5wdXQgdHlwZT1cImZpbGVcIiBuYW1lPVwiYXZhdGFyXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIvPjwvZm9ybT48L2Rpdj48dWw+PGxpIGNsYXNzPVwic2luY2VcIj48c3Bhbj5Kb2luZWQgPC9zcGFuPicpO1xudmFyIF9fdmFsX18gPSBwcm9maWxlLmNyZWF0ZWRfaHVtYW5cbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L2xpPjxsaSBjbGFzcz1cImNvdW50XCI+PGI+Jyk7XG52YXIgX192YWxfXyA9IHByb2ZpbGUuaHVtYW5fcG9zdF9jb3VudCBcbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L2I+PHNwYW4+ICcgKyBlc2NhcGUoKGludGVycCA9IHByb2ZpbGUucG9zdF9jb3VudCA9PSAxID8gXCJwb3N0XCIgOiBcInBvc3RzXCIpID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnPC9zcGFuPjwvbGk+PGxpIGNsYXNzPVwiY2hhdFwiPjxidXR0b24gdGl0bGU9XCJDaGF0XCIgY2xhc3M9XCJvbmNsaWNrLWNoYXRcIj5Qcml2YXRlIE1lc3NhZ2U8L2J1dHRvbj48L2xpPjwvdWw+PC9kaXY+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcInBvc3RzLWJ5LXVzZXJcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xudmFyIF9wb3N0X3Byb2ZpbGVfbWl4aW4gPSBmdW5jdGlvbihwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCFwLnVzZXJfcGhvdG8pIHAudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL3VzZXIvXCIgKyAocC51c2VyX25hbWUpICsgXCJcIiksIFwiY2xhc3NcIjogKCd1c2VyJykgKyAnICcgKyAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPicpO1xuaWYgKCBwLnVzZXJfcGhvdG8gJiYgcC51c2VyX3Bob3RvLm1hdGNoKC9eaHR0cC8pKVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzoocC51c2VyX25hbWUpLCAnc3JjJzooXCJcIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1widGl0bGVcIjp0cnVlLFwic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuZWxzZVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAocC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2E+Jyk7XG59O1xudmFyIF9wb3N0X21peGluID0gZnVuY3Rpb24ocCwgaSl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooXCJwb3N0X1wiICsgKHAuaWQpICsgXCJcIiksICdkYXRhLXVzZXItaWQnOihwLnVzZXJfaWQpLCAnZGF0YS1wb3N0LWlkJzoocC5pZCksICdkYXRhLXRocmVhZC1pZCc6KHAudGhyZWFkX2lkKSwgJ2RhdGEtZm9ydW0taWQnOihwLmZvcnVtX2lkKSwgXCJjbGFzc1wiOiAoJ3Bvc3QnKSArICcgJyArIChwLnJlYXNvbiA/ICdjZW5zb3JlZCcgOiAnJykgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZSxcImRhdGEtcG9zdC1pZFwiOnRydWUsXCJkYXRhLXRocmVhZC1pZFwiOnRydWUsXCJkYXRhLWZvcnVtLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG5pZiAoIHAudGhyZWFkX3VyaSlcbntcbmJ1Zi5wdXNoKCc8aDQgY2xhc3M9XCJ0aXRsZVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC50aHJlYWRfdXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvaDQ+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND4nKTtcbn1cbl9wb3N0X3Byb2ZpbGVfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC51c2VyX25hbWVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvc3Bhbj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOihwLmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2RhdGUnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9kaXY+PGRpdiBjbGFzcz1cInBvc3QtY29udGVudFwiPicpO1xuaWYgKCBwLmh0bWwpXG57XG5idWYucHVzaCgnPHAgY2xhc3M9XCJib2R5XCI+Jyk7XG52YXIgX192YWxfXyA9IHAuaHRtbFxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvcD4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2Rpdj4nKTtcbl9wb3N0X2FjdGlvbnNfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInJlcGx5XCI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImNoaWxkcmVuXCI+Jyk7XG5pZiAoIHAucG9zdHMgJiYgcC5wb3N0cy5sZW5ndGgpXG57XG4vLyBpdGVyYXRlIHAucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBwLnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGlpID0gMCwgJCRsID0gcC5wb3N0cy5sZW5ndGg7IGlpIDwgJCRsOyBpaSsrKSB7XG4gICAgICB2YXIgcHAgPSBwLnBvc3RzW2lpXTtcblxuX3Bvc3RfbWl4aW4ocHAsIGlpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gcC5wb3N0cykge1xuICAgICAgdmFyIHBwID0gcC5wb3N0c1tpaV07XG5cbl9wb3N0X21peGluKHBwLCBpaSk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2UgaWYgKCBwLm1vcmVQb3N0cylcbntcbmJ1Zi5wdXNoKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwibG9hZC1tb3JlXCI+TW9yZSBQb3N0czwvYT4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn07XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInJlc2l6YWJsZSBmb3J1bVwiPicpO1xuaWYgKCBwb3N0c0J5VXNlci5sZW5ndGgpXG57XG52YXIgbGFzdF90aHJlYWRfaWQgPSAoLTEpO1xuLy8gaXRlcmF0ZSBwb3N0c0J5VXNlclxuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHBvc3RzQnlVc2VyLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGkgPSAwLCAkJGwgPSBwb3N0c0J5VXNlci5sZW5ndGg7IGkgPCAkJGw7IGkrKykge1xuICAgICAgdmFyIHAgPSBwb3N0c0J5VXNlcltpXTtcblxuaWYgKCBsYXN0X3RocmVhZF9pZCAhPSBwLnRocmVhZF9pZClcbntcbmJ1Zi5wdXNoKCc8aDMgY2xhc3M9XCJoZWFkaW5nXCI+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihwLnRocmVhZF91cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgKyAnICcgKyAoJ3RpdGxlJykgKyAnICcgKyAoJ3N0eWxpc2gnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+IDxiPicgKyBlc2NhcGUoKGludGVycCA9IHAudGhyZWFkX3RpdGxlKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJyA8L2I+PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvdXNlci9cIiArIChwLnRocmVhZF91c2VybmFtZSkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpICsgJyAnICsgKCdieScpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5ieSA8Yj4nICsgZXNjYXBlKChpbnRlcnAgPSBwLnRocmVhZF91c2VybmFtZSkgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICcgPC9iPjwvYT48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAuZm9ydW1fdXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpICsgJyAnICsgKCdmb3J1bS1saW5rJykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPmluIDxiPicgKyBlc2NhcGUoKGludGVycCA9IHAuZm9ydW1fdGl0bGUpID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnPC9iPjwvYT48L2gzPicpO1xufVxuX3Bvc3RfbWl4aW4ocCwgaSk7XG52YXIgbGFzdF90aHJlYWRfaWQgPSAocC50aHJlYWRfaWQpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpIGluIHBvc3RzQnlVc2VyKSB7XG4gICAgICB2YXIgcCA9IHBvc3RzQnlVc2VyW2ldO1xuXG5pZiAoIGxhc3RfdGhyZWFkX2lkICE9IHAudGhyZWFkX2lkKVxue1xuYnVmLnB1c2goJzxoMyBjbGFzcz1cImhlYWRpbmdcIj48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KHAudGhyZWFkX3VyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArICgndGl0bGUnKSArICcgJyArICgnc3R5bGlzaCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4gPGI+JyArIGVzY2FwZSgoaW50ZXJwID0gcC50aHJlYWRfdGl0bGUpID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnIDwvYj48L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIi91c2VyL1wiICsgKHAudGhyZWFkX3VzZXJuYW1lKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgKyAnICcgKyAoJ2J5JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPmJ5IDxiPicgKyBlc2NhcGUoKGludGVycCA9IHAudGhyZWFkX3VzZXJuYW1lKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJyA8L2I+PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC5mb3J1bV91cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgKyAnICcgKyAoJ2ZvcnVtLWxpbmsnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+aW4gPGI+JyArIGVzY2FwZSgoaW50ZXJwID0gcC5mb3J1bV90aXRsZSkgPT0gbnVsbCA/ICcnIDogaW50ZXJwKSArICc8L2I+PC9hPjwvaDM+Jyk7XG59XG5fcG9zdF9taXhpbihwLCBpKTtcbnZhciBsYXN0X3RocmVhZF9pZCA9IChwLnRocmVhZF9pZCk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aDM+Q2hlY2sgYmFjayBmb3IgbXkgZmlyc3QgcG9zdDxpPiE8L2k+PC9oMz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wicG9zdFwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbnZhciBfcG9zdF9hY3Rpb25zX21peGluID0gZnVuY3Rpb24ocCl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJhY3Rpb25zXCI+PGEgY2xhc3M9XCJzdHlsaXNoIG9uY2xpY2stYXBwZW5kLXJlcGx5LXVpXCI+Q29tbWVudDwvYT48YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1lZGl0JzoocC5pZCksICdocmVmJzooXCJcIiArIChwLnVyaS5yZXBsYWNlKC9cXC9cXGQrJC8sICcnKSkgKyBcIi9lZGl0L1wiICsgKHAuaWQpICsgXCJcIiksIFwiY2xhc3NcIjogKCdzdHlsaXNoJykgKyAnICcgKyAoJ2VkaXQnKSArICcgJyArICgnbXV0YW50JykgKyAnICcgKyAoJ25vLXN1cmYnKSB9LCB7XCJkYXRhLWVkaXRcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPkVkaXQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihwLnVyaSksIFwiY2xhc3NcIjogKCdzdHlsaXNoJykgKyAnICcgKyAoJ3Blcm1hbGluaycpICsgJyAnICsgKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+UGVybWFsaW5rPC9hPjxhIGNsYXNzPVwic3R5bGlzaCBjZW5zb3Igb25jbGljay1jZW5zb3ItcG9zdFwiPkNlbnNvcjwvYT48L2Rpdj4nKTtcbn07XG52YXIgX3Bvc3RfcHJvZmlsZV9taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbiBpZiAoIXAudXNlcl9waG90bykgcC51c2VyX3Bob3RvID0gY2FjaGVVcmwgKyAnaW1hZ2VzL3Byb2ZpbGUuanBnJ1xuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvdXNlci9cIiArIChwLnVzZXJfbmFtZSkgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3VzZXInKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxkaXYgY2xhc3M9XCJwcm9maWxlIHBob3RvXCI+Jyk7XG5pZiAoIHAudXNlcl9waG90byAmJiBwLnVzZXJfcGhvdG8ubWF0Y2goL15odHRwLykpXG57XG5idWYucHVzaCgnPGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAndGl0bGUnOihwLnVzZXJfbmFtZSksICdzcmMnOihcIlwiICsgKHAudXNlcl9waG90bykgKyBcIlwiKSB9LCB7XCJ0aXRsZVwiOnRydWUsXCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9cIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuYnVmLnB1c2goJzwvZGl2PjwvYT4nKTtcbn07XG52YXIgX3Bvc3RfbWl4aW4gPSBmdW5jdGlvbihwLCBpKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG5idWYucHVzaCgnPGRpdicpO1xuYnVmLnB1c2goYXR0cnMoeyAnaWQnOihcInBvc3RfXCIgKyAocC5pZCkgKyBcIlwiKSwgJ2RhdGEtdXNlci1pZCc6KHAudXNlcl9pZCksICdkYXRhLXBvc3QtaWQnOihwLmlkKSwgJ2RhdGEtdGhyZWFkLWlkJzoocC50aHJlYWRfaWQpLCAnZGF0YS1mb3J1bS1pZCc6KHAuZm9ydW1faWQpLCBcImNsYXNzXCI6ICgncG9zdCcpICsgJyAnICsgKHAucmVhc29uID8gJ2NlbnNvcmVkJyA6ICcnKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJpZFwiOnRydWUsXCJkYXRhLXVzZXItaWRcIjp0cnVlLFwiZGF0YS1wb3N0LWlkXCI6dHJ1ZSxcImRhdGEtdGhyZWFkLWlkXCI6dHJ1ZSxcImRhdGEtZm9ydW0taWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbmlmICggcC50aHJlYWRfdXJpKVxue1xuYnVmLnB1c2goJzxoNCBjbGFzcz1cInRpdGxlXCI+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihwLnRocmVhZF91cmkpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+PC9oND4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aDQgY2xhc3M9XCJ0aXRsZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2g0PicpO1xufVxuX3Bvc3RfcHJvZmlsZV9taXhpbihwKTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+PHNwYW4gY2xhc3M9XCJ1c2VybmFtZVwiPicpO1xudmFyIF9fdmFsX18gPSBwLnVzZXJfbmFtZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9zcGFuPjxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdGltZSc6KHAuY3JlYXRlZF9pc28pLCBcImNsYXNzXCI6ICgnZGF0ZScpIH0sIHtcImRhdGEtdGltZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLmNyZWF0ZWRfaHVtYW5cbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L2Rpdj48ZGl2IGNsYXNzPVwicG9zdC1jb250ZW50XCI+Jyk7XG5pZiAoIHAuaHRtbClcbntcbmJ1Zi5wdXNoKCc8cCBjbGFzcz1cImJvZHlcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC5odG1sXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9wPicpO1xufVxuYnVmLnB1c2goJzwvZGl2PjwvZGl2PicpO1xuX3Bvc3RfYWN0aW9uc19taXhpbihwKTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwicmVwbHlcIj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPVwiY2hpbGRyZW5cIj4nKTtcbmlmICggcC5wb3N0cyAmJiBwLnBvc3RzLmxlbmd0aClcbntcbi8vIGl0ZXJhdGUgcC5wb3N0c1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHAucG9zdHMubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgaWkgPSAwLCAkJGwgPSBwLnBvc3RzLmxlbmd0aDsgaWkgPCAkJGw7IGlpKyspIHtcbiAgICAgIHZhciBwcCA9IHAucG9zdHNbaWldO1xuXG5fcG9zdF9taXhpbihwcCwgaWkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpaSBpbiBwLnBvc3RzKSB7XG4gICAgICB2YXIgcHAgPSBwLnBvc3RzW2lpXTtcblxuX3Bvc3RfbWl4aW4ocHAsIGlpKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxufVxuZWxzZSBpZiAoIHAubW9yZVBvc3RzKVxue1xuYnVmLnB1c2goJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJsb2FkLW1vcmVcIj5Nb3JlIFBvc3RzPC9hPicpO1xufVxuYnVmLnB1c2goJzwvZGl2PicpO1xufTtcbl9wb3N0X21peGluKHBvc3QsIDApO1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJhZG1pbi1kb21haW5zXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJkb21haW5zXCI+PGZvcm0nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2FjdGlvbic6KFwiL3Jlc291cmNlcy9zaXRlcy9cIiArIChzaXRlSWQpICsgXCJcIiksICdtZXRob2QnOihcInB1dFwiKSwgXCJjbGFzc1wiOiAoJ29uY2xpY2stc3VibWl0JykgfSwge1wiYWN0aW9uXCI6dHJ1ZSxcIm1ldGhvZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxkaXYgY2xhc3M9XCJkb21haW5cIj48bGFiZWwgZm9yPVwiZG9tYWluXCI+U2VsZWN0IGEgRG9tYWluPC9sYWJlbD48c2VsZWN0IGlkPVwiZG9tYWluXCIgbmFtZT1cImRvbWFpblwiPicpO1xuLy8gaXRlcmF0ZSBzaXRlLmRvbWFpbnNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBzaXRlLmRvbWFpbnMubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgJGluZGV4ID0gMCwgJCRsID0gc2l0ZS5kb21haW5zLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIGQgPSBzaXRlLmRvbWFpbnNbJGluZGV4XTtcblxuYnVmLnB1c2goJzxvcHRpb24nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3ZhbHVlJzooZC5pZCkgfSwge1widmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gZC5uYW1lXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L29wdGlvbj4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgJGluZGV4IGluIHNpdGUuZG9tYWlucykge1xuICAgICAgdmFyIGQgPSBzaXRlLmRvbWFpbnNbJGluZGV4XTtcblxuYnVmLnB1c2goJzxvcHRpb24nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3ZhbHVlJzooZC5pZCkgfSwge1widmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gZC5uYW1lXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L29wdGlvbj4nKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvc2VsZWN0PjwvZGl2Pjxici8+PGZpZWxkc2V0PjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvaW1hZ2VzL2ZhY2Vib29rXzMyLnBuZ1wiKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGxlZ2VuZD5GYWNlYm9vazwvbGVnZW5kPjxsYWJlbCBmb3I9XCJmYWNlYm9va19jbGllbnRfaWRcIj5JRDwvbGFiZWw+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZmFjZWJvb2tfY2xpZW50X2lkXCIpLCAndHlwZSc6KCd0ZXh0JyksICduYW1lJzooJ2ZhY2Vib29rQ2xpZW50SWQnKSwgJ3BsYWNlaG9sZGVyJzooJ0ZhY2Vib29rIEFQSSBJRCAuLi4nKSwgJ3ZhbHVlJzooc2l0ZS5jb25maWcuZmFjZWJvb2tDbGllbnRJZCksIFwiY2xhc3NcIjogKCdmaXJzdCcpIH0sIHtcImlkXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGFiZWwgZm9yPVwiZmFjZWJvb2tfY2xpZW50X3NlY3JldFwiPlNlY3JldDwvbGFiZWw+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZmFjZWJvb2tfY2xpZW50X3NlY3JldFwiKSwgJ3R5cGUnOigndGV4dCcpLCAnbmFtZSc6KCdmYWNlYm9va0NsaWVudFNlY3JldCcpLCAncGxhY2Vob2xkZXInOignRmFjZWJvb2sgc2VjcmV0IC4uLicpLCAndmFsdWUnOihzaXRlLmNvbmZpZy5mYWNlYm9va0NsaWVudElkKSB9LCB7XCJpZFwiOnRydWUsXCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwicGxhY2Vob2xkZXJcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PC9maWVsZHNldD48ZmllbGRzZXQ+PGltZycpO1xuYnVmLnB1c2goYXR0cnMoeyAnc3JjJzooXCJcIiArIChjYWNoZVVybCkgKyBcIi9pbWFnZXMvdHdpdHRlcl8zMi5wbmdcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjxsZWdlbmQ+VHdpdHRlcjwvbGVnZW5kPjxsYWJlbCBmb3I9XCJ0d2l0dGVyX2tleVwiPktleTwvbGFiZWw+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwidHdpdHRlcl9rZXlcIiksICd0eXBlJzooJ3RleHQnKSwgJ25hbWUnOigndHdpdHRlckNvbnN1bWVyS2V5JyksICdwbGFjZWhvbGRlcic6KCdUd2l0dGVyIEFQSSBrZXkgLi4uJyksICd2YWx1ZSc6KHNpdGUuY29uZmlnLnR3aXR0ZXJDb25zdW1lcktleSksIFwiY2xhc3NcIjogKCdmaXJzdCcpIH0sIHtcImlkXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGFiZWwgZm9yPVwidHdpdHRlcl9zZWNyZXRcIj5TZWNyZXQ8L2xhYmVsPjxpbnB1dCcpO1xuYnVmLnB1c2goYXR0cnMoeyAnaWQnOihcInR3aXR0ZXJfc2VjcmV0XCIpLCAndHlwZSc6KCd0ZXh0JyksICduYW1lJzooJ3R3aXR0ZXJDb25zdW1lclNlY3JldCcpLCAncGxhY2Vob2xkZXInOignVHdpdHRlciBBUEkgc2VjcmV0IC4uLicpLCAndmFsdWUnOihzaXRlLmNvbmZpZy50d2l0dGVyQ29uc3VtZXJTZWNyZXQpIH0sIHtcImlkXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2ZpZWxkc2V0PjxmaWVsZHNldD48aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiL2ltYWdlcy9nb29nbGVfMzIucG5nXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGVnZW5kPkdvb2dsZSs8L2xlZ2VuZD48bGFiZWwgZm9yPVwiZ29vZ2xlX2tleVwiPktleTwvbGFiZWw+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZ29vZ2xlX2tleVwiKSwgJ3R5cGUnOigndGV4dCcpLCAnbmFtZSc6KCdnb29nbGVDb25zdW1lcktleScpLCAncGxhY2Vob2xkZXInOignR29vZ2xlKyBBUEkga2V5IC4uLicpLCAndmFsdWUnOihzaXRlLmNvbmZpZy5nb29nbGVDb25zdW1lcktleSksIFwiY2xhc3NcIjogKCdmaXJzdCcpIH0sIHtcImlkXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48bGFiZWwgZm9yPVwiZ29vZ2xlX3NlY3JldFwiPlNlY3JldDwvbGFiZWw+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZ29vZ2xlX3NlY3JldFwiKSwgJ3R5cGUnOigndGV4dCcpLCAnbmFtZSc6KCdnb29nbGVDb25zdW1lclNlY3JldCcpLCAncGxhY2Vob2xkZXInOignR29vZ2xlKyBBUEkgc2VjcmV0IC4uLicpLCAndmFsdWUnOihzaXRlLmNvbmZpZy5nb29nbGVDb25zdW1lclNlY3JldCkgfSwge1wiaWRcIjp0cnVlLFwidHlwZVwiOnRydWUsXCJuYW1lXCI6dHJ1ZSxcInBsYWNlaG9sZGVyXCI6dHJ1ZSxcInZhbHVlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvZmllbGRzZXQ+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJTYXZlXCI+U2F2ZTwvYnV0dG9uPjxkaXYgY2xhc3M9XCJ0b29sdGlwXCI+PC9kaXY+PGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiYWN0aW9uXCIgdmFsdWU9XCJkb21haW5zXCIvPjwvZm9ybT48L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiYWRtaW4tZ2VuZXJhbFwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbnZhciBhbmFseXRpY3MgPSAodW5lc2NhcGUoc2l0ZS5jb25maWcuYW5hbHl0aWNzKSk7XG5idWYucHVzaCgnPGZvcm0nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2FjdGlvbic6KFwiL3Jlc291cmNlcy9zaXRlcy9cIiArIChzaXRlSWQpICsgXCJcIiksICdtZXRob2QnOihcInB1dFwiKSwgXCJjbGFzc1wiOiAoJ29uY2xpY2stc3VibWl0JykgKyAnICcgKyAoJ25vLWZvY3VzJykgfSwge1wiYWN0aW9uXCI6dHJ1ZSxcIm1ldGhvZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxmaWVsZHNldD48bGFiZWwgZm9yPVwibmFtZVwiPlRpdGxlPC9sYWJlbD48aW5wdXQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooJ25hbWUnKSwgJ25hbWUnOignbmFtZScpLCAndHlwZSc6KCd0ZXh0JyksICd2YWx1ZSc6KHNpdGUubmFtZSksIFwiY2xhc3NcIjogKCduYW1lJykgfSwge1wiaWRcIjp0cnVlLFwiY2xhc3NcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJ0eXBlXCI6dHJ1ZSxcInZhbHVlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjxkaXYgY2xhc3M9XCJicmVha1wiPjwvZGl2PjxsYWJlbCBmb3I9XCJwb3N0c19wZXJfcGFnZVwiPlBvc3RzIHBlciBQYWdlPC9sYWJlbD48aW5wdXQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooJ3Bvc3RzX3Blcl9wYWdlJyksICduYW1lJzooJ3Bvc3RzUGVyUGFnZScpLCAndHlwZSc6KCd0ZXh0JyksICd2YWx1ZSc6KHNpdGUuY29uZmlnLnBvc3RzUGVyUGFnZSksICdtYXhsZW5ndGgnOig0KSwgXCJjbGFzc1wiOiAoJ3Bvc3RzLXBlci1wYWdlJykgfSwge1wiaWRcIjp0cnVlLFwiY2xhc3NcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJ0eXBlXCI6dHJ1ZSxcInZhbHVlXCI6dHJ1ZSxcIm1heGxlbmd0aFwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48ZGl2IGNsYXNzPVwiYnJlYWtcIj48L2Rpdj48bGFiZWw+UHJpdmFjeTwvbGFiZWw+PGRpdiBjbGFzcz1cImJveFwiPjxpbnB1dCcpO1xuYnVmLnB1c2goYXR0cnMoeyAnaWQnOigncHJpdmF0ZScpLCAndHlwZSc6KCdjaGVja2JveCcpLCAndmFsdWUnOignY2hlY2tlZCcpLCAnbmFtZSc6KCdwcml2YXRlJyksICdjaGVja2VkJzooc2l0ZS5jb25maWcucHJpdmF0ZSkgfSwge1widHlwZVwiOnRydWUsXCJ2YWx1ZVwiOnRydWUsXCJuYW1lXCI6dHJ1ZSxcImNoZWNrZWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGxhYmVsIGZvcj1cInByaXZhdGVcIiBjbGFzcz1cInN3aXRjaC1jb250cm9sXCI+PGRpdiBjbGFzcz1cInN3aXRjaFwiPjwvZGl2PjwvbGFiZWw+PHNwYW4gY2xhc3M9XCJsYWJlbCBjaGVja2VkXCI+T248L3NwYW4+PGRpdiBjbGFzcz1cIm5vdGVcIj5IaWRlIGNvbnRlbnQgZnJvbSBzZWFyY2ggZW5naW5lcyAmYW1wOyB0aGUgcHVibGljPC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGxhYmVsPkludml0ZSBPbmx5PC9sYWJlbD48ZGl2IGNsYXNzPVwiYm94XCI+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KCdpbnZpdGVfb25seScpLCAndHlwZSc6KCdjaGVja2JveCcpLCAndmFsdWUnOignY2hlY2tlZCcpLCAnbmFtZSc6KCdpbnZpdGVPbmx5JyksICdjaGVja2VkJzooc2l0ZS5jb25maWcuaW52aXRlT25seSkgfSwge1widHlwZVwiOnRydWUsXCJ2YWx1ZVwiOnRydWUsXCJuYW1lXCI6dHJ1ZSxcImNoZWNrZWRcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGxhYmVsIGZvcj1cImludml0ZV9vbmx5XCIgY2xhc3M9XCJzd2l0Y2gtY29udHJvbFwiPjxkaXYgY2xhc3M9XCJzd2l0Y2hcIj48L2Rpdj48L2xhYmVsPjxzcGFuIGNsYXNzPVwibGFiZWwgY2hlY2tlZFwiPk9uPC9zcGFuPjxkaXYgY2xhc3M9XCJub3RlXCI+RGlzYWxsb3cgdGhlIHB1YmxpYyBmcm9tIHJlZ2lzdGVyaW5nIC0gPGEgaHJlZj1cIi9hZG1pbi9pbnZpdGVzXCIgY2xhc3M9XCJtdXRhbnRcIj5JbnZpdGVzPC9hPjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJicmVhayBkb3VibGVcIj48L2Rpdj48bGFiZWwgZm9yPVwia2V5d29yZHNcIj5LZXl3b3JkczwvbGFiZWw+PHRleHRhcmVhIGlkPVwia2V5d29yZHNcIiBuYW1lPVwibWV0YUtleXdvcmRzXCI+Jyk7XG52YXIgX192YWxfXyA9IHNpdGUuY29uZmlnLm1ldGFLZXl3b3Jkc1xuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC90ZXh0YXJlYT48ZGl2IGNsYXNzPVwibm90ZVwiPlNlcGFyYXRlIG1ldGEga2V5d29yZHMgd2l0aCBjb21tYXM8L2Rpdj48ZGl2IGNsYXNzPVwiYnJlYWtcIj48L2Rpdj48bGFiZWwgZm9yPVwic3R5bGVcIj5TdHlsZTwvbGFiZWw+PHRleHRhcmVhIGlkPVwic3R5bGVcIiBuYW1lPVwic3R5bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gc2l0ZS5jb25maWcuc3R5bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvdGV4dGFyZWE+PGRpdiBjbGFzcz1cIm5vdGVcIj5QYXN0ZTxhIGhyZWY9XCJodHRwOi8vd3d3Lnczc2Nob29scy5jb20vY3NzcmVmL1wiIHRhcmdldD1cIl9ibGFua1wiPkNTUzwvYT5vciA8YSBocmVmPVwiaHR0cDovL2xlYXJuYm9vc3QuZ2l0aHViLmlvL3N0eWx1cy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5TdHlsdXM8L2E+Y29kZSBpbiBhYm92ZTwvZGl2PjxkaXYgY2xhc3M9XCJicmVha1wiPjwvZGl2PjxsYWJlbCBmb3I9XCJhbmFseXRpY3NcIj5BbmFseXRpY3M8L2xhYmVsPjx0ZXh0YXJlYSBpZD1cImFuYWx5dGljc1wiIG5hbWU9XCJhbmFseXRpY3NcIj4nKTtcbnZhciBfX3ZhbF9fID0gYW5hbHl0aWNzXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L3RleHRhcmVhPjxkaXYgY2xhc3M9XCJub3RlXCI+UGFzdGUgSmF2YXNjcmlwdCBjb2RlIGFib3ZlLCBleGNsdWRpbmcgJmx0O3NjcmlwdCZndDsgdGFnczwvZGl2PjwvZmllbGRzZXQ+PGRpdiBjbGFzcz1cInRvb2x0aXBcIj48L2Rpdj48YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIlNhdmVcIj5TYXZlPC9idXR0b24+PGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiYWN0aW9uXCIgdmFsdWU9XCJnZW5lcmFsXCIvPjwvZm9ybT4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiYWRtaW4taW52aXRlc1wiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbmJ1Zi5wdXNoKCc8Zm9ybSBhY3Rpb249XCIvcmVzb3VyY2VzL3VzZXJzXCIgbWV0aG9kPVwicG9zdFwiIGNsYXNzPVwib25jbGljay1zdWJtaXRcIj48ZmllbGRzZXQ+PGxhYmVsIGZvcj1cImVtYWlsc1wiPkVtYWlsczwvbGFiZWw+PGlucHV0IGlkPVwiZW1haWxzXCIgbmFtZT1cImVtYWlsc1wiIHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJlbWFpbHMgY2xlYXJcIi8+PGRpdiBjbGFzcz1cIm5vdGVcIj5TZXBhcmF0ZWQgYnkgY29tbWFzPC9kaXY+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGxhYmVsIGZvcj1cIm1lc3NhZ2VcIj5NZXNzYWdlPC9sYWJlbD48dGV4dGFyZWEgaWQ9XCJtZXNzYWdlXCIgbmFtZT1cIm1lc3NhZ2VcIj48L3RleHRhcmVhPjwvZmllbGRzZXQ+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJTZW5kXCI+U2VuZDwvYnV0dG9uPjxkaXYgZGF0YS1tc2c9XCJJbnZpdGVzIHNlbnQhXCIgY2xhc3M9XCJ0b29sdGlwXCI+PC9kaXY+PGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiYWN0aW9uXCIgdmFsdWU9XCJpbnZpdGVzXCIvPjwvZm9ybT4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiYWRtaW4tbmF2XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJjb250YWluZXJcIj48bWVudT48bGkgY2xhc3M9XCJnZW5lcmFsXCI+PGEgaHJlZj1cIi9hZG1pblwiIGNsYXNzPVwibXV0YW50XCI+R2VuZXJhbDwvYT48L2xpPjxsaSBjbGFzcz1cIm1lbnVcIj48YSBocmVmPVwiL2FkbWluL21lbnVcIiBjbGFzcz1cIm11dGFudFwiPk1lbnU8L2E+PC9saT48bGkgY2xhc3M9XCJpbnZpdGVzXCI+PGEgaHJlZj1cIi9hZG1pbi9pbnZpdGVzXCIgY2xhc3M9XCJtdXRhbnRcIj5JbnZpdGVzPC9hPjwvbGk+PGxpIGNsYXNzPVwiZG9tYWluc1wiPjxhIGhyZWY9XCIvYWRtaW4vZG9tYWluc1wiIGNsYXNzPVwibXV0YW50XCI+RG9tYWluczwvYT48L2xpPjxsaSBjbGFzcz1cImZlYXR1cmUgdXBncmFkZVwiPjxhIGhyZWY9XCIvYWRtaW4vdXBncmFkZVwiIGNsYXNzPVwibXV0YW50XCI+UFJPPC9hPjwvbGk+PC9tZW51PjwvZGl2PicpO1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJzZWFyY2hcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xudmFyIF9wb3N0X3Byb2ZpbGVfbWl4aW4gPSBmdW5jdGlvbihwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCFwLnVzZXJfcGhvdG8pIHAudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL3VzZXIvXCIgKyAocC51c2VyX25hbWUpICsgXCJcIiksIFwiY2xhc3NcIjogKCd1c2VyJykgKyAnICcgKyAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPicpO1xuaWYgKCBwLnVzZXJfcGhvdG8gJiYgcC51c2VyX3Bob3RvLm1hdGNoKC9eaHR0cC8pKVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzoocC51c2VyX25hbWUpLCAnc3JjJzooXCJcIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1widGl0bGVcIjp0cnVlLFwic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuZWxzZVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAocC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2E+Jyk7XG59O1xudmFyIF9wb3N0X21peGluID0gZnVuY3Rpb24ocCwgaSl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooXCJwb3N0X1wiICsgKHAuaWQpICsgXCJcIiksICdkYXRhLXVzZXItaWQnOihwLnVzZXJfaWQpLCAnZGF0YS1wb3N0LWlkJzoocC5pZCksICdkYXRhLXRocmVhZC1pZCc6KHAudGhyZWFkX2lkKSwgJ2RhdGEtZm9ydW0taWQnOihwLmZvcnVtX2lkKSwgXCJjbGFzc1wiOiAoJ3Bvc3QnKSArICcgJyArIChwLnJlYXNvbiA/ICdjZW5zb3JlZCcgOiAnJykgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZSxcImRhdGEtcG9zdC1pZFwiOnRydWUsXCJkYXRhLXRocmVhZC1pZFwiOnRydWUsXCJkYXRhLWZvcnVtLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG5pZiAoIHAudGhyZWFkX3VyaSlcbntcbmJ1Zi5wdXNoKCc8aDQgY2xhc3M9XCJ0aXRsZVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC50aHJlYWRfdXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvaDQ+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND4nKTtcbn1cbl9wb3N0X3Byb2ZpbGVfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC51c2VyX25hbWVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvc3Bhbj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOihwLmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2RhdGUnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9kaXY+PGRpdiBjbGFzcz1cInBvc3QtY29udGVudFwiPicpO1xuaWYgKCBwLmh0bWwpXG57XG5idWYucHVzaCgnPHAgY2xhc3M9XCJib2R5XCI+Jyk7XG52YXIgX192YWxfXyA9IHAuaHRtbFxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvcD4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2Rpdj4nKTtcbl9wb3N0X2FjdGlvbnNfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInJlcGx5XCI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImNoaWxkcmVuXCI+Jyk7XG5pZiAoIHAucG9zdHMgJiYgcC5wb3N0cy5sZW5ndGgpXG57XG4vLyBpdGVyYXRlIHAucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBwLnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGlpID0gMCwgJCRsID0gcC5wb3N0cy5sZW5ndGg7IGlpIDwgJCRsOyBpaSsrKSB7XG4gICAgICB2YXIgcHAgPSBwLnBvc3RzW2lpXTtcblxuX3Bvc3RfbWl4aW4ocHAsIGlpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gcC5wb3N0cykge1xuICAgICAgdmFyIHBwID0gcC5wb3N0c1tpaV07XG5cbl9wb3N0X21peGluKHBwLCBpaSk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2UgaWYgKCBwLm1vcmVQb3N0cylcbntcbmJ1Zi5wdXNoKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwibG9hZC1tb3JlXCI+TW9yZSBQb3N0czwvYT4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn07XG5idWYucHVzaCgnPGRpdiBpZD1cImJyZWFkY3J1bWJcIiBjbGFzcz1cImJyZWFkY3J1bWJcIj48ZGl2IGlkPVwibmV3X2hpdHNcIj48L2Rpdj48L2Rpdj4nKTtcbnZhciBzdWZmaXggPSAoZWxyZXMudG90YWwgPT0gMSA/ICcnIDogJ3MnKTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwic2VhcmNoIHJlc2l6YWJsZVwiPjxlbSBpZD1cImhpdF9jb3VudFwiPjxiPicgKyBlc2NhcGUoKGludGVycCA9IGVscmVzLnRvdGFsKSA9PSBudWxsID8gJycgOiBpbnRlcnApICsgJyBoaXQnICsgZXNjYXBlKChpbnRlcnAgPSBzdWZmaXgpID09IG51bGwgPyAnJyA6IGludGVycCkgKyAnPC9iPjwvZW0+PHNwYW4gaWQ9XCJuZXdfaGl0X2NvdW50XCI+PGEgaHJlZj1cIiNcIiBvbmNsaWNrPVwic2hvd05ld0hpdHMoKVwiPi0gPHNwYW4gY2xhc3M9XCJjb3VudFwiPjAgPC9zcGFuPm5ldyE8L2E+PC9zcGFuPjxkaXYgaWQ9XCJuZXdfcG9zdHNcIj48L2Rpdj4nKTtcbmlmICggZWxyZXMuaGl0cy5sZW5ndGgpXG57XG4vLyBpdGVyYXRlIGVscmVzLmhpdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBlbHJlcy5oaXRzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IGVscmVzLmhpdHMubGVuZ3RoOyAkaW5kZXggPCAkJGw7ICRpbmRleCsrKSB7XG4gICAgICB2YXIgaGl0ID0gZWxyZXMuaGl0c1skaW5kZXhdO1xuXG5idWYucHVzaCgnPCEtLSBhbHdheXMgdXNlIHRocmVhZCB0aXRsZS0tPicpO1xuIGhpdC5fc291cmNlLnRpdGxlID0gaGl0Ll9zb3VyY2UudGhyZWFkX3RpdGxlXG5pZiAoIGVudiAhPSAncHJvZHVjdGlvbicpXG57XG5idWYucHVzaCgnPCEtLSBzaG93IHNjb3JlIGluIGRldiBtb2RlLS0+Jyk7XG4gaGl0Ll9zb3VyY2UudGl0bGUgPSBoaXQuX3NvdXJjZS50aXRsZSArICcgKHNjb3JlOiAnICsgaGl0Ll9zY29yZSArICcgKSdcbn1cbmlmICggaGl0Ll9zb3VyY2UuaWQgPT0gaGl0Ll9zb3VyY2UudGhyZWFkX2lkKVxue1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJ0aHJlYWQtaGl0XCI+Jyk7XG5fcG9zdF9taXhpbihoaXQuX3NvdXJjZSwgMCk7XG5idWYucHVzaCgnPC9kaXY+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbW1lbnQtaGl0XCI+Jyk7XG5fcG9zdF9taXhpbihoaXQuX3NvdXJjZSwgMCk7XG5idWYucHVzaCgnPC9kaXY+Jyk7XG59XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAodmFyICRpbmRleCBpbiBlbHJlcy5oaXRzKSB7XG4gICAgICB2YXIgaGl0ID0gZWxyZXMuaGl0c1skaW5kZXhdO1xuXG5idWYucHVzaCgnPCEtLSBhbHdheXMgdXNlIHRocmVhZCB0aXRsZS0tPicpO1xuIGhpdC5fc291cmNlLnRpdGxlID0gaGl0Ll9zb3VyY2UudGhyZWFkX3RpdGxlXG5pZiAoIGVudiAhPSAncHJvZHVjdGlvbicpXG57XG5idWYucHVzaCgnPCEtLSBzaG93IHNjb3JlIGluIGRldiBtb2RlLS0+Jyk7XG4gaGl0Ll9zb3VyY2UudGl0bGUgPSBoaXQuX3NvdXJjZS50aXRsZSArICcgKHNjb3JlOiAnICsgaGl0Ll9zY29yZSArICcgKSdcbn1cbmlmICggaGl0Ll9zb3VyY2UuaWQgPT0gaGl0Ll9zb3VyY2UudGhyZWFkX2lkKVxue1xuYnVmLnB1c2goJzxkaXYgY2xhc3M9XCJ0aHJlYWQtaGl0XCI+Jyk7XG5fcG9zdF9taXhpbihoaXQuX3NvdXJjZSwgMCk7XG5idWYucHVzaCgnPC9kaXY+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbW1lbnQtaGl0XCI+Jyk7XG5fcG9zdF9taXhpbihoaXQuX3NvdXJjZSwgMCk7XG5idWYucHVzaCgnPC9kaXY+Jyk7XG59XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aDQ+VHJ5IGEgbW9yZSBnZW5lcmFsIHNlYXJjaDxpPiE8L2k+PC9oND4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wic2VhcmNoLWZpbHRlcnNcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgZm9ydW1PcHRpb25zX21peGluID0gZnVuY3Rpb24oZm9ydW1zLCBwcmVmaXgpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbi8vIGl0ZXJhdGUgZm9ydW1zXG47KGZ1bmN0aW9uKCl7XG4gIGlmICgnbnVtYmVyJyA9PSB0eXBlb2YgZm9ydW1zLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IGZvcnVtcy5sZW5ndGg7ICRpbmRleCA8ICQkbDsgJGluZGV4KyspIHtcbiAgICAgIHZhciBmID0gZm9ydW1zWyRpbmRleF07XG5cbmJ1Zi5wdXNoKCc8b3B0aW9uJyk7XG5idWYucHVzaChhdHRycyh7ICd2YWx1ZSc6KGYuaWQpIH0sIHtcInZhbHVlXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IHByZWZpeCArIGYudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvb3B0aW9uPicpO1xuZm9ydW1PcHRpb25zX21peGluKGYuZm9ydW1zLCAnLScpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gZm9ydW1zKSB7XG4gICAgICB2YXIgZiA9IGZvcnVtc1skaW5kZXhdO1xuXG5idWYucHVzaCgnPG9wdGlvbicpO1xuYnVmLnB1c2goYXR0cnMoeyAndmFsdWUnOihmLmlkKSB9LCB7XCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwcmVmaXggKyBmLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L29wdGlvbj4nKTtcbmZvcnVtT3B0aW9uc19taXhpbihmLmZvcnVtcywgJy0nKTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxufTtcbmJ1Zi5wdXNoKCc8ZGl2IGlkPVwic2VhcmNoX2ZpbHRlcnNcIj48ZGl2PjxsYWJlbD48aDQ+RmlsdGVyIGJ5IEZvcnVtPC9oND48c2VsZWN0IG5hbWU9XCJmb3J1bV9pZFwiPjxvcHRpb24gdmFsdWU9XCJcIj4tIEFsbCAtPC9vcHRpb24+Jyk7XG5mb3J1bU9wdGlvbnNfbWl4aW4obWVudSwgJycpO1xuYnVmLnB1c2goJzwvc2VsZWN0PjwvbGFiZWw+PC9kaXY+PGRpdj48bGFiZWw+PGg0PldpdGhpbiBhIFRpbWVmcmFtZTwvaDQ+PHNlbGVjdCBuYW1lPVwid2l0aGluXCI+PG9wdGlvbiB2YWx1ZT1cIlwiPi0gQW55IFRpbWUgLTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9XCJkYXlcIj5XaXRoaW4gTGFzdCBEYXk8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwid2Vla1wiPldpdGhpbiBMYXN0IFdlZWs8L29wdGlvbj48b3B0aW9uIHZhbHVlPVwibW9udGhcIj5XaXRoaW4gTGFzdCBNb250aDwvb3B0aW9uPjwvc2VsZWN0PjwvbGFiZWw+PC9kaXY+PC9kaXY+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcInNlYXJjaC1mYWNldHNcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG5idWYucHVzaCgnPGRpdiBpZD1cInNlYXJjaF9mYWNldHNcIj48ZGl2IHN0eWxlPVwiaGVpZ2h0OjMwcHhcIj48L2Rpdj4nKTtcbmlmICggZmFjZXRzLmZvcnVtLmxlbmd0aCA+IDEpXG57XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImZhY2V0XCI+PGRpdiBjbGFzcz1cImZhY2V0LXRpdGxlXCI+SGl0cyBieSBGb3J1bTwvZGl2PicpO1xuLy8gaXRlcmF0ZSBmYWNldHMuZm9ydW1cbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBmYWNldHMuZm9ydW0ubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgJGluZGV4ID0gMCwgJCRsID0gZmFjZXRzLmZvcnVtLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIGZvcnVtID0gZmFjZXRzLmZvcnVtWyRpbmRleF07XG5cbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KGZvcnVtLnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSArICcgJyArICgnZmFjZXQtaGl0JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxlbT4nKTtcbnZhciBfX3ZhbF9fID0gZm9ydW0uaGl0Q291bnRcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvZW0+PHNwYW4+Jyk7XG52YXIgX192YWxfXyA9IGZvcnVtLnRpdGxlXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L3NwYW4+PC9hPicpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gZmFjZXRzLmZvcnVtKSB7XG4gICAgICB2YXIgZm9ydW0gPSBmYWNldHMuZm9ydW1bJGluZGV4XTtcblxuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooZm9ydW0udXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpICsgJyAnICsgKCdmYWNldC1oaXQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGVtPicpO1xudmFyIF9fdmFsX18gPSBmb3J1bS5oaXRDb3VudFxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9lbT48c3Bhbj4nKTtcbnZhciBfX3ZhbF9fID0gZm9ydW0udGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvc3Bhbj48L2E+Jyk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiX190aHJlYWRzXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF90aHJlYWRfbWl4aW4gPSBmdW5jdGlvbih0KXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCF0LnVzZXJfcGhvdG8pIHQudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8bGknKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtaWQnOih0LmlkKSwgJ2RhdGEtdXNlci1pZCc6KHQudXNlcl9pZCksIFwiY2xhc3NcIjogKCd0aHJlYWQnKSB9LCB7XCJkYXRhLWlkXCI6dHJ1ZSxcImRhdGEtdXNlci1pZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXN1cmYnOih0LmZvcnVtX2lkKSwgJ2hyZWYnOih0LnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJkYXRhLXN1cmZcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxoNCBjbGFzcz1cInRpdGxlXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvaDQ+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGRpdiBjbGFzcz1cInByb2ZpbGUgcGhvdG9cIj48aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiXCIgKyAodC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2Rpdj48ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+PHNwYW4gY2xhc3M9XCJ1c2VybmFtZVwiPmJ5PGVtPicpO1xudmFyIF9fdmFsX18gPSB0LnVzZXJfbmFtZSAvLyBYWFggd2VpcmQgdGhpbmdzIGhhcHBlbmVkIHdoZW4gSSB0cmllZCB0byB0dXJuIHRoaXMgaW50byBhbiBhbmNob3JcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvZW0+PC9zcGFuPjxzcGFuJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOih0LmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2NyZWF0ZWQnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gdC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9zcGFuPjxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PjxzcGFuIGNsYXNzPVwicG9zdC1jb3VudFwiPicpO1xudmFyIF9fdmFsX18gPSB0LnBvc3RfY291bnRcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnBvc3RzPC9pPjwvc3Bhbj48c3BhbiBjbGFzcz1cInZpZXdzXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudmlld3NcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnZpZXdzPC9pPjwvc3Bhbj48L2Rpdj48L2E+PC9saT4nKTtcbn07XG5idWYucHVzaCgnPHVsIGNsYXNzPVwidGhyZWFkc1wiPicpO1xuLy8gaXRlcmF0ZSB0b3BUaHJlYWRzXG47KGZ1bmN0aW9uKCl7XG4gIGlmICgnbnVtYmVyJyA9PSB0eXBlb2YgdG9wVGhyZWFkcy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpaSA9IDAsICQkbCA9IHRvcFRocmVhZHMubGVuZ3RoOyBpaSA8ICQkbDsgaWkrKykge1xuICAgICAgdmFyIHQgPSB0b3BUaHJlYWRzW2lpXTtcblxuX3RocmVhZF9taXhpbih0KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gdG9wVGhyZWFkcykge1xuICAgICAgdmFyIHQgPSB0b3BUaHJlYWRzW2lpXTtcblxuX3RocmVhZF9taXhpbih0KTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvdWw+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIl9icmVhZGNydW1iXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF9icmVhZGNydW1iX21peGluID0gZnVuY3Rpb24ocCl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xudmFyIHBhdGggPSAoJycpO1xudmFyIHBhcnRzID0gKHAudXJpLnNwbGl0KCcvJykpO1xudmFyIHBhcnRzID0gKHBhcnRzLnNwbGljZSgxLCBwYXJ0cy5sZW5ndGgtMikpO1xuLy8gaXRlcmF0ZSBwYXJ0c1xuOyhmdW5jdGlvbigpe1xuICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHBhcnRzLmxlbmd0aCkge1xuICAgIGZvciAodmFyICRpbmRleCA9IDAsICQkbCA9IHBhcnRzLmxlbmd0aDsgJGluZGV4IDwgJCRsOyAkaW5kZXgrKykge1xuICAgICAgdmFyIHBhcnQgPSBwYXJ0c1skaW5kZXhdO1xuXG5pZiAoIHBhcnQgIT0gJ3QnKVxue1xuYnVmLnB1c2goJzxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzooXCIvXCIgKyAocGF0aCkgKyBcIlwiICsgKHBhcnQpICsgXCJcIiksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG52YXIgX192YWxfXyA9IHBhcnQucmVwbGFjZSgnLScsICcgJylcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvYT48c3Bhbj4vPC9zcGFuPicpO1xufVxuIHBhdGggPSBwYXRoICsgcGFydCArICcvJ1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciAkaW5kZXggaW4gcGFydHMpIHtcbiAgICAgIHZhciBwYXJ0ID0gcGFydHNbJGluZGV4XTtcblxuaWYgKCBwYXJ0ICE9ICd0JylcbntcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL1wiICsgKHBhdGgpICsgXCJcIiArIChwYXJ0KSArIFwiXCIpLCBcImNsYXNzXCI6ICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwYXJ0LnJlcGxhY2UoJy0nLCAnICcpXG5idWYucHVzaChlc2NhcGUobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pKTtcbmJ1Zi5wdXNoKCc8L2E+PHNwYW4+Lzwvc3Bhbj4nKTtcbn1cbiBwYXRoID0gcGF0aCArIHBhcnQgKyAnLydcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzxlbT4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9lbT4nKTtcbn07XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIl9wb3N0LWFjdGlvbnNcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xufVxucmV0dXJuIGJ1Zi5qb2luKFwiXCIpO1xufVxuamFkZS50ZW1wbGF0ZXNbXCJfcG9zdC1lZGl0XCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF9wb3N0X2VkaXRfbWl4aW4gPSBmdW5jdGlvbih1LCBwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG52YXIgaHRtbF9pZCA9IChwLmlkID8gXCJfI3twLmlkfVwiIDogJycpO1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzoocC5pc19jb21tZW50ID8gaHRtbF9pZCA6ICdwb3N0X2VkaXQnKSwgXCJjbGFzc1wiOiAoJ3Bvc3QtZWRpdCcpICsgJyAnICsgKCdvbmNsaWNrLXN1Ym1pdCcpICsgJyAnICsgKHAuaXNfY29tbWVudCA/ICdjb21tZW50JyA6ICcnKSB9LCB7XCJjbGFzc1wiOnRydWUsXCJpZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxmb3JtJyk7XG5idWYucHVzaChhdHRycyh7ICdhY3Rpb24nOihcIi9yZXNvdXJjZXMvcG9zdHNcIiksICdtZXRob2QnOihcIlwiICsgKHAubWV0aG9kIHx8ICdwdXQnKSArIFwiXCIpIH0sIHtcImFjdGlvblwiOnRydWUsXCJtZXRob2RcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwidG9vbHRpcFwiPjwvZGl2PjxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdXNlci1pZCc6KHUuaWQpLCBcImNsYXNzXCI6ICgnc3VtbWFyeScpIH0sIHtcImRhdGEtdXNlci1pZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAodS5waG90byB8fCAnaW1hZ2VzL3Byb2ZpbGUuanBnJykgKyBcIlwiKSwgXCJjbGFzc1wiOiAoJ3Byb2ZpbGUnKSArICcgJyArICgncGhvdG8nKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PC9kaXY+Jyk7XG5pZiAoICFwLmlzX2NvbW1lbnQpXG57XG5idWYucHVzaCgnPGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICduYW1lJzooJ3RpdGxlJyksICd0eXBlJzooJ3RleHQnKSwgJ3BsYWNlaG9sZGVyJzooJ1RpdGxlJyksICd2YWx1ZSc6KHAudGl0bGUpLCBcImNsYXNzXCI6ICgndGl0bGUnKSB9LCB7XCJuYW1lXCI6dHJ1ZSxcInR5cGVcIjp0cnVlLFwicGxhY2Vob2xkZXJcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5idWYucHVzaCgnPHRleHRhcmVhJyk7XG5idWYucHVzaChhdHRycyh7ICdpZCc6KFwiZWRpdG9yXCIgKyAocC5pc19jb21tZW50ID8gaHRtbF9pZCA6ICcnKSArIFwiXCIpLCAnbmFtZSc6KCdib2R5JyksICdwbGFjZWhvbGRlcic6KCdDb21tZW50IC4uLicpLCBcImNsYXNzXCI6ICgnYm9keScpICsgJyAnICsgKCdvbnNoaWZ0ZW50ZXItc3VibWl0JykgfSwge1wiaWRcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJwbGFjZWhvbGRlclwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSBwLmJvZHlcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvdGV4dGFyZWE+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdpZCcpLCAndmFsdWUnOihwLmlkKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdmb3J1bV9pZCcpLCAndmFsdWUnOihwLmZvcnVtX2lkKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGlucHV0Jyk7XG5idWYucHVzaChhdHRycyh7ICd0eXBlJzooJ2hpZGRlbicpLCAnbmFtZSc6KCdwYXJlbnRfaWQnKSwgJ3ZhbHVlJzoocC5wYXJlbnRfaWQpIH0sIHtcInR5cGVcIjp0cnVlLFwibmFtZVwiOnRydWUsXCJ2YWx1ZVwiOnRydWV9KSk7XG5idWYucHVzaCgnLz48aW5wdXQnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3R5cGUnOignaGlkZGVuJyksICduYW1lJzooJ2NzcmYnKSwgJ3ZhbHVlJzoocC5jc3JmKSB9LCB7XCJ0eXBlXCI6dHJ1ZSxcIm5hbWVcIjp0cnVlLFwidmFsdWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgbmFtZT1cInN1Ym1pdFwiIHZhbHVlPVwiU2F2ZVwiPlNhdmU8L2J1dHRvbj48ZGl2IGNsYXNzPVwiY2xvc2UgY2FuY2VsXCI+WDwvZGl2PjwvZm9ybT48ZGl2IGNsYXNzPVwicHJldmlld1wiPjwvZGl2PjwvZGl2PicpO1xufTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiX3Bvc3QtcHJvZmlsZVwiXSA9IGZ1bmN0aW9uKGxvY2FscywgYXR0cnMsIGVzY2FwZSwgcmV0aHJvdywgbWVyZ2UpIHtcbmF0dHJzID0gYXR0cnMgfHwgamFkZS5hdHRyczsgZXNjYXBlID0gZXNjYXBlIHx8IGphZGUuZXNjYXBlOyByZXRocm93ID0gcmV0aHJvdyB8fCBqYWRlLnJldGhyb3c7IG1lcmdlID0gbWVyZ2UgfHwgamFkZS5tZXJnZTtcbnZhciBidWYgPSBbXTtcbndpdGggKGxvY2FscyB8fCB7fSkge1xudmFyIGludGVycDtcbnZhciBfcG9zdF9wcm9maWxlX21peGluID0gZnVuY3Rpb24ocCl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuIGlmICghcC51c2VyX3Bob3RvKSBwLnVzZXJfcGhvdG8gPSBjYWNoZVVybCArICdpbWFnZXMvcHJvZmlsZS5qcGcnXG5idWYucHVzaCgnPGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2hyZWYnOihcIi91c2VyL1wiICsgKHAudXNlcl9uYW1lKSArIFwiXCIpLCBcImNsYXNzXCI6ICgndXNlcicpICsgJyAnICsgKCdtdXRhbnQnKSB9LCB7XCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGRpdiBjbGFzcz1cInByb2ZpbGUgcGhvdG9cIj4nKTtcbmlmICggcC51c2VyX3Bob3RvICYmIHAudXNlcl9waG90by5tYXRjaCgvXmh0dHAvKSlcbntcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICd0aXRsZSc6KHAudXNlcl9uYW1lKSwgJ3NyYyc6KFwiXCIgKyAocC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInRpdGxlXCI6dHJ1ZSxcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmVsc2VcbntcbmJ1Zi5wdXNoKCc8aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiL1wiICsgKHAudXNlcl9waG90bykgKyBcIlwiKSB9LCB7XCJzcmNcIjp0cnVlfSkpO1xuYnVmLnB1c2goJy8+Jyk7XG59XG5idWYucHVzaCgnPC9kaXY+PC9hPicpO1xufTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiX3Bvc3RcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3Bvc3RfYWN0aW9uc19taXhpbiA9IGZ1bmN0aW9uKHApe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbmJ1Zi5wdXNoKCc8ZGl2IGNsYXNzPVwiYWN0aW9uc1wiPjxhIGNsYXNzPVwic3R5bGlzaCBvbmNsaWNrLWFwcGVuZC1yZXBseS11aVwiPkNvbW1lbnQ8L2E+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtZWRpdCc6KHAuaWQpLCAnaHJlZic6KFwiXCIgKyAocC51cmkucmVwbGFjZSgvXFwvXFxkKyQvLCAnJykpICsgXCIvZWRpdC9cIiArIChwLmlkKSArIFwiXCIpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdlZGl0JykgKyAnICcgKyAoJ211dGFudCcpICsgJyAnICsgKCduby1zdXJmJykgfSwge1wiZGF0YS1lZGl0XCI6dHJ1ZSxcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz5FZGl0PC9hPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC51cmkpLCBcImNsYXNzXCI6ICgnc3R5bGlzaCcpICsgJyAnICsgKCdwZXJtYWxpbmsnKSArICcgJyArICgnbXV0YW50JykgfSwge1wiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPlBlcm1hbGluazwvYT48YSBjbGFzcz1cInN0eWxpc2ggY2Vuc29yIG9uY2xpY2stY2Vuc29yLXBvc3RcIj5DZW5zb3I8L2E+PC9kaXY+Jyk7XG59O1xudmFyIF9wb3N0X3Byb2ZpbGVfbWl4aW4gPSBmdW5jdGlvbihwKXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCFwLnVzZXJfcGhvdG8pIHAudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8YScpO1xuYnVmLnB1c2goYXR0cnMoeyAnaHJlZic6KFwiL3VzZXIvXCIgKyAocC51c2VyX25hbWUpICsgXCJcIiksIFwiY2xhc3NcIjogKCd1c2VyJykgKyAnICcgKyAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPicpO1xuaWYgKCBwLnVzZXJfcGhvdG8gJiYgcC51c2VyX3Bob3RvLm1hdGNoKC9eaHR0cC8pKVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3RpdGxlJzoocC51c2VyX25hbWUpLCAnc3JjJzooXCJcIiArIChwLnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1widGl0bGVcIjp0cnVlLFwic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPicpO1xufVxuZWxzZVxue1xuYnVmLnB1c2goJzxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCIvXCIgKyAocC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2E+Jyk7XG59O1xudmFyIF9wb3N0X21peGluID0gZnVuY3Rpb24ocCwgaSl7XG52YXIgYmxvY2sgPSB0aGlzLmJsb2NrLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzIHx8IHt9LCBlc2NhcGVkID0gdGhpcy5lc2NhcGVkIHx8IHt9O1xuYnVmLnB1c2goJzxkaXYnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2lkJzooXCJwb3N0X1wiICsgKHAuaWQpICsgXCJcIiksICdkYXRhLXVzZXItaWQnOihwLnVzZXJfaWQpLCAnZGF0YS1wb3N0LWlkJzoocC5pZCksICdkYXRhLXRocmVhZC1pZCc6KHAudGhyZWFkX2lkKSwgJ2RhdGEtZm9ydW0taWQnOihwLmZvcnVtX2lkKSwgXCJjbGFzc1wiOiAoJ3Bvc3QnKSArICcgJyArIChwLnJlYXNvbiA/ICdjZW5zb3JlZCcgOiAnJykgfSwge1wiY2xhc3NcIjp0cnVlLFwiaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZSxcImRhdGEtcG9zdC1pZFwiOnRydWUsXCJkYXRhLXRocmVhZC1pZFwiOnRydWUsXCJkYXRhLWZvcnVtLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+Jyk7XG5pZiAoIHAudGhyZWFkX3VyaSlcbntcbmJ1Zi5wdXNoKCc8aDQgY2xhc3M9XCJ0aXRsZVwiPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdocmVmJzoocC50aHJlYWRfdXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImhyZWZcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9hPjwvaDQ+Jyk7XG59XG5lbHNlXG57XG5idWYucHVzaCgnPGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND4nKTtcbn1cbl9wb3N0X3Byb2ZpbGVfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwidXNlcm5hbWVcIj4nKTtcbnZhciBfX3ZhbF9fID0gcC51c2VyX25hbWVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvc3Bhbj48ZGl2Jyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOihwLmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2RhdGUnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gcC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9kaXY+PGRpdiBjbGFzcz1cInBvc3QtY29udGVudFwiPicpO1xuaWYgKCBwLmh0bWwpXG57XG5idWYucHVzaCgnPHAgY2xhc3M9XCJib2R5XCI+Jyk7XG52YXIgX192YWxfXyA9IHAuaHRtbFxuYnVmLnB1c2gobnVsbCA9PSBfX3ZhbF9fID8gXCJcIiA6IF9fdmFsX18pO1xuYnVmLnB1c2goJzwvcD4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj48L2Rpdj4nKTtcbl9wb3N0X2FjdGlvbnNfbWl4aW4ocCk7XG5idWYucHVzaCgnPGRpdiBjbGFzcz1cInJlcGx5XCI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1cImNoaWxkcmVuXCI+Jyk7XG5pZiAoIHAucG9zdHMgJiYgcC5wb3N0cy5sZW5ndGgpXG57XG4vLyBpdGVyYXRlIHAucG9zdHNcbjsoZnVuY3Rpb24oKXtcbiAgaWYgKCdudW1iZXInID09IHR5cGVvZiBwLnBvc3RzLmxlbmd0aCkge1xuICAgIGZvciAodmFyIGlpID0gMCwgJCRsID0gcC5wb3N0cy5sZW5ndGg7IGlpIDwgJCRsOyBpaSsrKSB7XG4gICAgICB2YXIgcHAgPSBwLnBvc3RzW2lpXTtcblxuX3Bvc3RfbWl4aW4ocHAsIGlpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gcC5wb3N0cykge1xuICAgICAgdmFyIHBwID0gcC5wb3N0c1tpaV07XG5cbl9wb3N0X21peGluKHBwLCBpaSk7XG4gICB9XG4gIH1cbn0pLmNhbGwodGhpcyk7XG5cbn1cbmVsc2UgaWYgKCBwLm1vcmVQb3N0cylcbntcbmJ1Zi5wdXNoKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwibG9hZC1tb3JlXCI+TW9yZSBQb3N0czwvYT4nKTtcbn1cbmJ1Zi5wdXNoKCc8L2Rpdj4nKTtcbn07XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59XG5qYWRlLnRlbXBsYXRlc1tcIl90aHJlYWRcIl0gPSBmdW5jdGlvbihsb2NhbHMsIGF0dHJzLCBlc2NhcGUsIHJldGhyb3csIG1lcmdlKSB7XG5hdHRycyA9IGF0dHJzIHx8IGphZGUuYXR0cnM7IGVzY2FwZSA9IGVzY2FwZSB8fCBqYWRlLmVzY2FwZTsgcmV0aHJvdyA9IHJldGhyb3cgfHwgamFkZS5yZXRocm93OyBtZXJnZSA9IG1lcmdlIHx8IGphZGUubWVyZ2U7XG52YXIgYnVmID0gW107XG53aXRoIChsb2NhbHMgfHwge30pIHtcbnZhciBpbnRlcnA7XG52YXIgX3RocmVhZF9taXhpbiA9IGZ1bmN0aW9uKHQpe1xudmFyIGJsb2NrID0gdGhpcy5ibG9jaywgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcyB8fCB7fSwgZXNjYXBlZCA9IHRoaXMuZXNjYXBlZCB8fCB7fTtcbiBpZiAoIXQudXNlcl9waG90bykgdC51c2VyX3Bob3RvID0gY2FjaGVVcmwgKyAnaW1hZ2VzL3Byb2ZpbGUuanBnJ1xuYnVmLnB1c2goJzxsaScpO1xuYnVmLnB1c2goYXR0cnMoeyAnZGF0YS1pZCc6KHQuaWQpLCAnZGF0YS11c2VyLWlkJzoodC51c2VyX2lkKSwgXCJjbGFzc1wiOiAoJ3RocmVhZCcpIH0sIHtcImRhdGEtaWRcIjp0cnVlLFwiZGF0YS11c2VyLWlkXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGEnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtc3VyZic6KHQuZm9ydW1faWQpLCAnaHJlZic6KHQudXJpKSwgXCJjbGFzc1wiOiAoJ211dGFudCcpIH0sIHtcImRhdGEtc3VyZlwiOnRydWUsXCJocmVmXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCc+PGg0IGNsYXNzPVwidGl0bGVcIj4nKTtcbnZhciBfX3ZhbF9fID0gdC50aXRsZVxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9oND48ZGl2IGNsYXNzPVwiYnJlYWtcIj48L2Rpdj48ZGl2IGNsYXNzPVwicHJvZmlsZSBwaG90b1wiPjxpbWcnKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ3NyYyc6KFwiXCIgKyAoY2FjaGVVcmwpICsgXCJcIiArICh0LnVzZXJfcGhvdG8pICsgXCJcIikgfSwge1wic3JjXCI6dHJ1ZX0pKTtcbmJ1Zi5wdXNoKCcvPjwvZGl2PjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj48c3BhbiBjbGFzcz1cInVzZXJuYW1lXCI+Ynk8ZW0+Jyk7XG52YXIgX192YWxfXyA9IHQudXNlcl9uYW1lIC8vIFhYWCB3ZWlyZCB0aGluZ3MgaGFwcGVuZWQgd2hlbiBJIHRyaWVkIHRvIHR1cm4gdGhpcyBpbnRvIGFuIGFuY2hvclxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPC9lbT48L3NwYW4+PHNwYW4nKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtdGltZSc6KHQuY3JlYXRlZF9pc28pLCBcImNsYXNzXCI6ICgnY3JlYXRlZCcpIH0sIHtcImRhdGEtdGltZVwiOnRydWV9KSk7XG5idWYucHVzaCgnPicpO1xudmFyIF9fdmFsX18gPSB0LmNyZWF0ZWRfaHVtYW5cbmJ1Zi5wdXNoKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKTtcbmJ1Zi5wdXNoKCc8L3NwYW4+PGRpdiBjbGFzcz1cImNsZWFyXCI+PC9kaXY+PHNwYW4gY2xhc3M9XCJwb3N0LWNvdW50XCI+Jyk7XG52YXIgX192YWxfXyA9IHQucG9zdF9jb3VudFxuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPGk+cG9zdHM8L2k+PC9zcGFuPjxzcGFuIGNsYXNzPVwidmlld3NcIj4nKTtcbnZhciBfX3ZhbF9fID0gdC52aWV3c1xuYnVmLnB1c2goZXNjYXBlKG51bGwgPT0gX192YWxfXyA/IFwiXCIgOiBfX3ZhbF9fKSk7XG5idWYucHVzaCgnPGk+dmlld3M8L2k+PC9zcGFuPjwvZGl2PjwvYT48L2xpPicpO1xufTtcbn1cbnJldHVybiBidWYuam9pbihcIlwiKTtcbn1cbmphZGUudGVtcGxhdGVzW1wiX190aHJlYWRzXCJdID0gZnVuY3Rpb24obG9jYWxzLCBhdHRycywgZXNjYXBlLCByZXRocm93LCBtZXJnZSkge1xuYXR0cnMgPSBhdHRycyB8fCBqYWRlLmF0dHJzOyBlc2NhcGUgPSBlc2NhcGUgfHwgamFkZS5lc2NhcGU7IHJldGhyb3cgPSByZXRocm93IHx8IGphZGUucmV0aHJvdzsgbWVyZ2UgPSBtZXJnZSB8fCBqYWRlLm1lcmdlO1xudmFyIGJ1ZiA9IFtdO1xud2l0aCAobG9jYWxzIHx8IHt9KSB7XG52YXIgaW50ZXJwO1xudmFyIF90aHJlYWRfbWl4aW4gPSBmdW5jdGlvbih0KXtcbnZhciBibG9jayA9IHRoaXMuYmxvY2ssIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMgfHwge30sIGVzY2FwZWQgPSB0aGlzLmVzY2FwZWQgfHwge307XG4gaWYgKCF0LnVzZXJfcGhvdG8pIHQudXNlcl9waG90byA9IGNhY2hlVXJsICsgJ2ltYWdlcy9wcm9maWxlLmpwZydcbmJ1Zi5wdXNoKCc8bGknKTtcbmJ1Zi5wdXNoKGF0dHJzKHsgJ2RhdGEtaWQnOih0LmlkKSwgJ2RhdGEtdXNlci1pZCc6KHQudXNlcl9pZCksIFwiY2xhc3NcIjogKCd0aHJlYWQnKSB9LCB7XCJkYXRhLWlkXCI6dHJ1ZSxcImRhdGEtdXNlci1pZFwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxhJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXN1cmYnOih0LmZvcnVtX2lkKSwgJ2hyZWYnOih0LnVyaSksIFwiY2xhc3NcIjogKCdtdXRhbnQnKSB9LCB7XCJkYXRhLXN1cmZcIjp0cnVlLFwiaHJlZlwiOnRydWV9KSk7XG5idWYucHVzaCgnPjxoNCBjbGFzcz1cInRpdGxlXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudGl0bGVcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvaDQ+PGRpdiBjbGFzcz1cImJyZWFrXCI+PC9kaXY+PGRpdiBjbGFzcz1cInByb2ZpbGUgcGhvdG9cIj48aW1nJyk7XG5idWYucHVzaChhdHRycyh7ICdzcmMnOihcIlwiICsgKGNhY2hlVXJsKSArIFwiXCIgKyAodC51c2VyX3Bob3RvKSArIFwiXCIpIH0sIHtcInNyY1wiOnRydWV9KSk7XG5idWYucHVzaCgnLz48L2Rpdj48ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+PHNwYW4gY2xhc3M9XCJ1c2VybmFtZVwiPmJ5PGVtPicpO1xudmFyIF9fdmFsX18gPSB0LnVzZXJfbmFtZSAvLyBYWFggd2VpcmQgdGhpbmdzIGhhcHBlbmVkIHdoZW4gSSB0cmllZCB0byB0dXJuIHRoaXMgaW50byBhbiBhbmNob3JcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzwvZW0+PC9zcGFuPjxzcGFuJyk7XG5idWYucHVzaChhdHRycyh7ICdkYXRhLXRpbWUnOih0LmNyZWF0ZWRfaXNvKSwgXCJjbGFzc1wiOiAoJ2NyZWF0ZWQnKSB9LCB7XCJkYXRhLXRpbWVcIjp0cnVlfSkpO1xuYnVmLnB1c2goJz4nKTtcbnZhciBfX3ZhbF9fID0gdC5jcmVhdGVkX2h1bWFuXG5idWYucHVzaChudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXyk7XG5idWYucHVzaCgnPC9zcGFuPjxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PjxzcGFuIGNsYXNzPVwicG9zdC1jb3VudFwiPicpO1xudmFyIF9fdmFsX18gPSB0LnBvc3RfY291bnRcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnBvc3RzPC9pPjwvc3Bhbj48c3BhbiBjbGFzcz1cInZpZXdzXCI+Jyk7XG52YXIgX192YWxfXyA9IHQudmlld3NcbmJ1Zi5wdXNoKGVzY2FwZShudWxsID09IF9fdmFsX18gPyBcIlwiIDogX192YWxfXykpO1xuYnVmLnB1c2goJzxpPnZpZXdzPC9pPjwvc3Bhbj48L2Rpdj48L2E+PC9saT4nKTtcbn07XG5idWYucHVzaCgnPHVsIGNsYXNzPVwidGhyZWFkc1wiPicpO1xuLy8gaXRlcmF0ZSB0b3BUaHJlYWRzXG47KGZ1bmN0aW9uKCl7XG4gIGlmICgnbnVtYmVyJyA9PSB0eXBlb2YgdG9wVGhyZWFkcy5sZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpaSA9IDAsICQkbCA9IHRvcFRocmVhZHMubGVuZ3RoOyBpaSA8ICQkbDsgaWkrKykge1xuICAgICAgdmFyIHQgPSB0b3BUaHJlYWRzW2lpXTtcblxuX3RocmVhZF9taXhpbih0KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWkgaW4gdG9wVGhyZWFkcykge1xuICAgICAgdmFyIHQgPSB0b3BUaHJlYWRzW2lpXTtcblxuX3RocmVhZF9taXhpbih0KTtcbiAgIH1cbiAgfVxufSkuY2FsbCh0aGlzKTtcblxuYnVmLnB1c2goJzwvdWw+Jyk7XG59XG5yZXR1cm4gYnVmLmpvaW4oXCJcIik7XG59IiwiLy8gbm90aGluZyB0byBzZWUgaGVyZS4uLiBubyBmaWxlIG1ldGhvZHMgZm9yIHRoZSBicm93c2VyXG4iLCJpZiAodHlwZW9mIGRlZmluZSAhPT0gJ2Z1bmN0aW9uJykgeyB2YXIgZGVmaW5lID0gcmVxdWlyZSgnYW1kZWZpbmUnKShtb2R1bGUsIHJlcXVpcmUpOyB9XG5kZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSl7IHJldHVybiByZXF1aXJlKCcuL3NyYy9Db21wb25lbnQnKTsgfSk7XG4iLCIoZnVuY3Rpb24ocHJvY2VzcyxfX2ZpbGVuYW1lKXsvKiogdmltOiBldDp0cz00OnN3PTQ6c3RzPTRcbiAqIEBsaWNlbnNlIGFtZGVmaW5lIDAuMC41IENvcHlyaWdodCAoYykgMjAxMSwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogQXZhaWxhYmxlIHZpYSB0aGUgTUlUIG9yIG5ldyBCU0QgbGljZW5zZS5cbiAqIHNlZTogaHR0cDovL2dpdGh1Yi5jb20vanJidXJrZS9hbWRlZmluZSBmb3IgZGV0YWlsc1xuICovXG5cbi8qanNsaW50IG5vZGU6IHRydWUgKi9cbi8qZ2xvYmFsIG1vZHVsZSwgcHJvY2VzcyAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgZGVmaW5lIGZvciBub2RlLlxuICogQHBhcmFtIHtPYmplY3R9IG1vZHVsZSB0aGUgXCJtb2R1bGVcIiBvYmplY3QgdGhhdCBpcyBkZWZpbmVkIGJ5IE5vZGUgZm9yIHRoZVxuICogY3VycmVudCBtb2R1bGUuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcmVxdWlyZV0uIE5vZGUncyByZXF1aXJlIGZ1bmN0aW9uIGZvciB0aGUgY3VycmVudCBtb2R1bGUuXG4gKiBJdCBvbmx5IG5lZWRzIHRvIGJlIHBhc3NlZCBpbiBOb2RlIHZlcnNpb25zIGJlZm9yZSAwLjUsIHdoZW4gbW9kdWxlLnJlcXVpcmVcbiAqIGRpZCBub3QgZXhpc3QuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IGEgZGVmaW5lIGZ1bmN0aW9uIHRoYXQgaXMgdXNhYmxlIGZvciB0aGUgY3VycmVudCBub2RlXG4gKiBtb2R1bGUuXG4gKi9cbmZ1bmN0aW9uIGFtZGVmaW5lKG1vZHVsZSwgcmVxdWlyZSkge1xuICAgIHZhciBkZWZpbmVDYWNoZSA9IHt9LFxuICAgICAgICBsb2FkZXJDYWNoZSA9IHt9LFxuICAgICAgICBhbHJlYWR5Q2FsbGVkID0gZmFsc2UsXG4gICAgICAgIG1ha2VSZXF1aXJlLCBzdHJpbmdSZXF1aXJlO1xuXG4gICAgLyoqXG4gICAgICogVHJpbXMgdGhlIC4gYW5kIC4uIGZyb20gYW4gYXJyYXkgb2YgcGF0aCBzZWdtZW50cy5cbiAgICAgKiBJdCB3aWxsIGtlZXAgYSBsZWFkaW5nIHBhdGggc2VnbWVudCBpZiBhIC4uIHdpbGwgYmVjb21lXG4gICAgICogdGhlIGZpcnN0IHBhdGggc2VnbWVudCwgdG8gaGVscCB3aXRoIG1vZHVsZSBuYW1lIGxvb2t1cHMsXG4gICAgICogd2hpY2ggYWN0IGxpa2UgcGF0aHMsIGJ1dCBjYW4gYmUgcmVtYXBwZWQuIEJ1dCB0aGUgZW5kIHJlc3VsdCxcbiAgICAgKiBhbGwgcGF0aHMgdGhhdCB1c2UgdGhpcyBmdW5jdGlvbiBzaG91bGQgbG9vayBub3JtYWxpemVkLlxuICAgICAqIE5PVEU6IHRoaXMgbWV0aG9kIE1PRElGSUVTIHRoZSBpbnB1dCBhcnJheS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnkgdGhlIGFycmF5IG9mIHBhdGggc2VnbWVudHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJpbURvdHMoYXJ5KSB7XG4gICAgICAgIHZhciBpLCBwYXJ0O1xuICAgICAgICBmb3IgKGkgPSAwOyBhcnlbaV07IGkrPSAxKSB7XG4gICAgICAgICAgICBwYXJ0ID0gYXJ5W2ldO1xuICAgICAgICAgICAgaWYgKHBhcnQgPT09ICcuJykge1xuICAgICAgICAgICAgICAgIGFyeS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgaSAtPSAxO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0ID09PSAnLi4nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKGFyeVsyXSA9PT0gJy4uJyB8fCBhcnlbMF0gPT09ICcuLicpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90XG4gICAgICAgICAgICAgICAgICAgIC8vcGF0aCBzZWdtZW50IGF0IHRoZSBmcm9udCBzbyBpdCBjYW4gYmUgbWFwcGVkXG4gICAgICAgICAgICAgICAgICAgIC8vY29ycmVjdGx5IHRvIGRpc2suIE90aGVyd2lzZSwgdGhlcmUgaXMgbGlrZWx5XG4gICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLlxuICAgICAgICAgICAgICAgICAgICAvL1RoaXMgY2FuIHN0aWxsIGZhaWwsIGJ1dCBjYXRjaGVzIHRoZSBtb3N0IHJlYXNvbmFibGVcbiAgICAgICAgICAgICAgICAgICAgLy91c2VzIG9mIC4uXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYXJ5LnNwbGljZShpIC0gMSwgMik7XG4gICAgICAgICAgICAgICAgICAgIGkgLT0gMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBub3JtYWxpemUobmFtZSwgYmFzZU5hbWUpIHtcbiAgICAgICAgdmFyIGJhc2VQYXJ0cztcblxuICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuXG4gICAgICAgIGlmIChuYW1lICYmIG5hbWUuY2hhckF0KDApID09PSAnLicpIHtcbiAgICAgICAgICAgIC8vSWYgaGF2ZSBhIGJhc2UgbmFtZSwgdHJ5IHRvIG5vcm1hbGl6ZSBhZ2FpbnN0IGl0LFxuICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbFxuICAgICAgICAgICAgLy9iZSByZWxhdGl2ZSB0byBiYXNlVXJsIGluIHRoZSBlbmQuXG4gICAgICAgICAgICBpZiAoYmFzZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBiYXNlUGFydHMgPSBiYXNlTmFtZS5zcGxpdCgnLycpO1xuICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZVBhcnRzLmNvbmNhdChuYW1lLnNwbGl0KCcvJykpO1xuICAgICAgICAgICAgICAgIHRyaW1Eb3RzKGJhc2VQYXJ0cyk7XG4gICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5qb2luKCcvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIG5vcm1hbGl6ZSgpIGZ1bmN0aW9uIHBhc3NlZCB0byBhIGxvYWRlciBwbHVnaW4nc1xuICAgICAqIG5vcm1hbGl6ZSBtZXRob2QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWtlTG9hZChpZCkge1xuICAgICAgICBmdW5jdGlvbiBsb2FkKHZhbHVlKSB7XG4gICAgICAgICAgICBsb2FkZXJDYWNoZVtpZF0gPSB2YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWQuZnJvbVRleHQgPSBmdW5jdGlvbiAoaWQsIHRleHQpIHtcbiAgICAgICAgICAgIC8vVGhpcyBvbmUgaXMgZGlmZmljdWx0IGJlY2F1c2UgdGhlIHRleHQgY2FuL3Byb2JhYmx5IHVzZXNcbiAgICAgICAgICAgIC8vZGVmaW5lLCBhbmQgYW55IHJlbGF0aXZlIHBhdGhzIGFuZCByZXF1aXJlcyBzaG91bGQgYmUgcmVsYXRpdmVcbiAgICAgICAgICAgIC8vdG8gdGhhdCBpZCB3YXMgaXQgd291bGQgYmUgZm91bmQgb24gZGlzay4gQnV0IHRoaXMgd291bGQgcmVxdWlyZVxuICAgICAgICAgICAgLy9ib290c3RyYXBwaW5nIGEgbW9kdWxlL3JlcXVpcmUgZmFpcmx5IGRlZXBseSBmcm9tIG5vZGUgY29yZS5cbiAgICAgICAgICAgIC8vTm90IHN1cmUgaG93IGJlc3QgdG8gZ28gYWJvdXQgdGhhdCB5ZXQuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FtZGVmaW5lIGRvZXMgbm90IGltcGxlbWVudCBsb2FkLmZyb21UZXh0Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGxvYWQ7XG4gICAgfVxuXG4gICAgbWFrZVJlcXVpcmUgPSBmdW5jdGlvbiAoc3lzdGVtUmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlLCByZWxJZCkge1xuICAgICAgICBmdW5jdGlvbiBhbWRSZXF1aXJlKGRlcHMsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9TeW5jaHJvbm91cywgc2luZ2xlIG1vZHVsZSByZXF1aXJlKCcnKVxuICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdSZXF1aXJlKHN5c3RlbVJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSwgZGVwcywgcmVsSWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL0FycmF5IG9mIGRlcGVuZGVuY2llcyB3aXRoIGEgY2FsbGJhY2suXG5cbiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgdGhlIGRlcGVuZGVuY2llcyB0byBtb2R1bGVzLlxuICAgICAgICAgICAgICAgIGRlcHMgPSBkZXBzLm1hcChmdW5jdGlvbiAoZGVwTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nUmVxdWlyZShzeXN0ZW1SZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUsIGRlcE5hbWUsIHJlbElkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vV2FpdCBmb3IgbmV4dCB0aWNrIHRvIGNhbGwgYmFjayB0aGUgcmVxdWlyZSBjYWxsLlxuICAgICAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBkZXBzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGFtZFJlcXVpcmUudG9VcmwgPSBmdW5jdGlvbiAoZmlsZVBhdGgpIHtcbiAgICAgICAgICAgIGlmIChmaWxlUGF0aC5pbmRleE9mKCcuJykgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplKGZpbGVQYXRoLCBwYXRoLmRpcm5hbWUobW9kdWxlLmZpbGVuYW1lKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlUGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gYW1kUmVxdWlyZTtcbiAgICB9O1xuXG4gICAgLy9GYXZvciBleHBsaWNpdCB2YWx1ZSwgcGFzc2VkIGluIGlmIHRoZSBtb2R1bGUgd2FudHMgdG8gc3VwcG9ydCBOb2RlIDAuNC5cbiAgICByZXF1aXJlID0gcmVxdWlyZSB8fCBmdW5jdGlvbiByZXEoKSB7XG4gICAgICAgIHJldHVybiBtb2R1bGUucmVxdWlyZS5hcHBseShtb2R1bGUsIGFyZ3VtZW50cyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHJ1bkZhY3RvcnkoaWQsIGRlcHMsIGZhY3RvcnkpIHtcbiAgICAgICAgdmFyIHIsIGUsIG0sIHJlc3VsdDtcblxuICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgIGUgPSBsb2FkZXJDYWNoZVtpZF0gPSB7fTtcbiAgICAgICAgICAgIG0gPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgIHVyaTogX19maWxlbmFtZSxcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgciA9IG1ha2VSZXF1aXJlKHJlcXVpcmUsIGUsIG0sIGlkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vT25seSBzdXBwb3J0IG9uZSBkZWZpbmUgY2FsbCBwZXIgZmlsZVxuICAgICAgICAgICAgaWYgKGFscmVhZHlDYWxsZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FtZGVmaW5lIHdpdGggbm8gbW9kdWxlIElEIGNhbm5vdCBiZSBjYWxsZWQgbW9yZSB0aGFuIG9uY2UgcGVyIGZpbGUuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhbHJlYWR5Q2FsbGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy9Vc2UgdGhlIHJlYWwgdmFyaWFibGVzIGZyb20gbm9kZVxuICAgICAgICAgICAgLy9Vc2UgbW9kdWxlLmV4cG9ydHMgZm9yIGV4cG9ydHMsIHNpbmNlXG4gICAgICAgICAgICAvL3RoZSBleHBvcnRzIGluIGhlcmUgaXMgYW1kZWZpbmUgZXhwb3J0cy5cbiAgICAgICAgICAgIGUgPSBtb2R1bGUuZXhwb3J0cztcbiAgICAgICAgICAgIG0gPSBtb2R1bGU7XG4gICAgICAgICAgICByID0gbWFrZVJlcXVpcmUocmVxdWlyZSwgZSwgbSwgbW9kdWxlLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vSWYgdGhlcmUgYXJlIGRlcGVuZGVuY2llcywgdGhleSBhcmUgc3RyaW5ncywgc28gbmVlZFxuICAgICAgICAvL3RvIGNvbnZlcnQgdGhlbSB0byBkZXBlbmRlbmN5IHZhbHVlcy5cbiAgICAgICAgaWYgKGRlcHMpIHtcbiAgICAgICAgICAgIGRlcHMgPSBkZXBzLm1hcChmdW5jdGlvbiAoZGVwTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByKGRlcE5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL0NhbGwgdGhlIGZhY3Rvcnkgd2l0aCB0aGUgcmlnaHQgZGVwZW5kZW5jaWVzLlxuICAgICAgICBpZiAodHlwZW9mIGZhY3RvcnkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhY3RvcnkuYXBwbHkobW9kdWxlLmV4cG9ydHMsIGRlcHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gZmFjdG9yeTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbS5leHBvcnRzID0gcmVzdWx0O1xuICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgbG9hZGVyQ2FjaGVbaWRdID0gbS5leHBvcnRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RyaW5nUmVxdWlyZSA9IGZ1bmN0aW9uIChzeXN0ZW1SZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUsIGlkLCByZWxJZCkge1xuICAgICAgICAvL1NwbGl0IHRoZSBJRCBieSBhICEgc28gdGhhdFxuICAgICAgICB2YXIgaW5kZXggPSBpZC5pbmRleE9mKCchJyksXG4gICAgICAgICAgICBvcmlnaW5hbElkID0gaWQsXG4gICAgICAgICAgICBwcmVmaXgsIHBsdWdpbjtcblxuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICBpZCA9IG5vcm1hbGl6ZShpZCwgcmVsSWQpO1xuXG4gICAgICAgICAgICAvL1N0cmFpZ2h0IG1vZHVsZSBsb29rdXAuIElmIGl0IGlzIG9uZSBvZiB0aGUgc3BlY2lhbCBkZXBlbmRlbmNpZXMsXG4gICAgICAgICAgICAvL2RlYWwgd2l0aCBpdCwgb3RoZXJ3aXNlLCBkZWxlZ2F0ZSB0byBub2RlLlxuICAgICAgICAgICAgaWYgKGlkID09PSAncmVxdWlyZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFrZVJlcXVpcmUoc3lzdGVtUmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlLCByZWxJZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnZXhwb3J0cycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaWQgPT09ICdtb2R1bGUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vZHVsZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZGVyQ2FjaGUuaGFzT3duUHJvcGVydHkoaWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRlckNhY2hlW2lkXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVmaW5lQ2FjaGVbaWRdKSB7XG4gICAgICAgICAgICAgICAgcnVuRmFjdG9yeS5hcHBseShudWxsLCBkZWZpbmVDYWNoZVtpZF0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBsb2FkZXJDYWNoZVtpZF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmKHN5c3RlbVJlcXVpcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbVJlcXVpcmUob3JpZ2luYWxJZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBtb2R1bGUgd2l0aCBJRDogJyArIGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL1RoZXJlIGlzIGEgcGx1Z2luIGluIHBsYXkuXG4gICAgICAgICAgICBwcmVmaXggPSBpZC5zdWJzdHJpbmcoMCwgaW5kZXgpO1xuICAgICAgICAgICAgaWQgPSBpZC5zdWJzdHJpbmcoaW5kZXggKyAxLCBpZC5sZW5ndGgpO1xuXG4gICAgICAgICAgICBwbHVnaW4gPSBzdHJpbmdSZXF1aXJlKHN5c3RlbVJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSwgcHJlZml4LCByZWxJZCk7XG5cbiAgICAgICAgICAgIGlmIChwbHVnaW4ubm9ybWFsaXplKSB7XG4gICAgICAgICAgICAgICAgaWQgPSBwbHVnaW4ubm9ybWFsaXplKGlkLCBtYWtlTm9ybWFsaXplKHJlbElkKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vTm9ybWFsaXplIHRoZSBJRCBub3JtYWxseS5cbiAgICAgICAgICAgICAgICBpZCA9IG5vcm1hbGl6ZShpZCwgcmVsSWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobG9hZGVyQ2FjaGVbaWRdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRlckNhY2hlW2lkXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGx1Z2luLmxvYWQoaWQsIG1ha2VSZXF1aXJlKHN5c3RlbVJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSwgcmVsSWQpLCBtYWtlTG9hZChpZCksIHt9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBsb2FkZXJDYWNoZVtpZF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy9DcmVhdGUgYSBkZWZpbmUgZnVuY3Rpb24gc3BlY2lmaWMgdG8gdGhlIG1vZHVsZSBhc2tpbmcgZm9yIGFtZGVmaW5lLlxuICAgIGZ1bmN0aW9uIGRlZmluZShpZCwgZGVwcywgZmFjdG9yeSkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpZCkpIHtcbiAgICAgICAgICAgIGZhY3RvcnkgPSBkZXBzO1xuICAgICAgICAgICAgZGVwcyA9IGlkO1xuICAgICAgICAgICAgaWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgZmFjdG9yeSA9IGlkO1xuICAgICAgICAgICAgaWQgPSBkZXBzID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlcHMgJiYgIUFycmF5LmlzQXJyYXkoZGVwcykpIHtcbiAgICAgICAgICAgIGZhY3RvcnkgPSBkZXBzO1xuICAgICAgICAgICAgZGVwcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZGVwcykge1xuICAgICAgICAgICAgZGVwcyA9IFsncmVxdWlyZScsICdleHBvcnRzJywgJ21vZHVsZSddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9TZXQgdXAgcHJvcGVydGllcyBmb3IgdGhpcyBtb2R1bGUuIElmIGFuIElELCB0aGVuIHVzZVxuICAgICAgICAvL2ludGVybmFsIGNhY2hlLiBJZiBubyBJRCwgdGhlbiB1c2UgdGhlIGV4dGVybmFsIHZhcmlhYmxlc1xuICAgICAgICAvL2ZvciB0aGlzIG5vZGUgbW9kdWxlLlxuICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgIC8vUHV0IHRoZSBtb2R1bGUgaW4gZGVlcCBmcmVlemUgdW50aWwgdGhlcmUgaXMgYVxuICAgICAgICAgICAgLy9yZXF1aXJlIGNhbGwgZm9yIGl0LlxuICAgICAgICAgICAgZGVmaW5lQ2FjaGVbaWRdID0gW2lkLCBkZXBzLCBmYWN0b3J5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJ1bkZhY3RvcnkoaWQsIGRlcHMsIGZhY3RvcnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy9kZWZpbmUucmVxdWlyZSwgd2hpY2ggaGFzIGFjY2VzcyB0byBhbGwgdGhlIHZhbHVlcyBpbiB0aGVcbiAgICAvL2NhY2hlLiBVc2VmdWwgZm9yIEFNRCBtb2R1bGVzIHRoYXQgYWxsIGhhdmUgSURzIGluIHRoZSBmaWxlLFxuICAgIC8vYnV0IG5lZWQgdG8gZmluYWxseSBleHBvcnQgYSB2YWx1ZSB0byBub2RlIGJhc2VkIG9uIG9uZSBvZiB0aG9zZVxuICAgIC8vSURzLlxuICAgIGRlZmluZS5yZXF1aXJlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIGlmIChsb2FkZXJDYWNoZVtpZF0pIHtcbiAgICAgICAgICAgIHJldHVybiBsb2FkZXJDYWNoZVtpZF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVmaW5lQ2FjaGVbaWRdKSB7XG4gICAgICAgICAgICBydW5GYWN0b3J5LmFwcGx5KG51bGwsIGRlZmluZUNhY2hlW2lkXSk7XG4gICAgICAgICAgICByZXR1cm4gbG9hZGVyQ2FjaGVbaWRdO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGRlZmluZS5hbWQgPSB7fTtcblxuICAgIHJldHVybiBkZWZpbmU7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gYW1kZWZpbmU7XG5cbn0pKHJlcXVpcmUoXCJfX2Jyb3dzZXJpZnlfcHJvY2Vzc1wiKSxcIi8uLi9ub2RlX21vZHVsZXMveWFjb21wb25lbnQvbm9kZV9tb2R1bGVzL2FtZGVmaW5lL2FtZGVmaW5lLmpzXCIpIiwidmFyIENvbXBvbmVudCwgY2gsIHRlbXBsYXRlcywgQWRtaW5NZW51O1xuQ29tcG9uZW50ID0gcmVxdWlyZSgneWFjb21wb25lbnQnKTtcbmNoID0gcmVxdWlyZSgnLi4vYXBwL2NsaWVudC1oZWxwZXJzLmxzJyk7XG50ZW1wbGF0ZXMgPSByZXF1aXJlKCcuLi9idWlsZC9jb21wb25lbnQtamFkZS5qcycpLnRlbXBsYXRlcztcbm1vZHVsZS5leHBvcnRzID0gQWRtaW5NZW51ID0gKGZ1bmN0aW9uKHN1cGVyY2xhc3Mpe1xuICB2YXIgcHJlZml4LCBvcHRzLCBwcm90b3R5cGUgPSBleHRlbmQkKChpbXBvcnQkKEFkbWluTWVudSwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnQWRtaW5NZW51JywgQWRtaW5NZW51KSwgc3VwZXJjbGFzcykucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEFkbWluTWVudTtcbiAgcHJlZml4ID0gJ2xpc3RfJztcbiAgb3B0cyA9IHtcbiAgICBoYW5kbGU6ICdkaXYnLFxuICAgIGl0ZW1zOiAnbGknLFxuICAgIG1heExldmVsczogMixcbiAgICB0b2xlcmFuY2U6ICdwb2ludGVyJyxcbiAgICB0b2xlcmFuY2VFbGVtZW50OiAnPiBkaXYnLFxuICAgIHBsYWNlaG9sZGVyOiAncGxhY2Vob2xkZXInXG4gIH07XG4gIHByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlcy5BZG1pbk1lbnU7XG4gIHByb3RvdHlwZS5jdXJyZW50ID0gbnVsbDtcbiAgcHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpe1xuICAgIHZhciB0aGlzJCA9IHRoaXM7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzJC4kLmZpbmQoJy5jb2wyJykuc2hvdygzMDApO1xuICAgIH0sIDMwMCk7XG4gIH07XG4gIHByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgIHZhciBlLCB4JCwgcmVmJDtcbiAgICBjb25zb2xlLmxvZygnY2xvbmU6JywgaXRlbSk7XG4gICAgZSA9IHRoaXMuJC5maW5kKCcuZGVmYXVsdCcpLmNsb25lKCkucmVtb3ZlQ2xhc3MoJ2RlZmF1bHQnKS5hdHRyKCdpZCcsIGl0ZW0uaWQpO1xuICAgIHgkID0gZS5maW5kKCdpbnB1dCcpO1xuICAgIHgkLmRhdGEoJ21lbnUnLCAocmVmJCA9IGl0ZW0uZGF0YSkgIT0gbnVsbCA/IHJlZiQubWVudSA6IHZvaWQgOCk7XG4gICAgeCQuZGF0YSgndGl0bGUnLCAocmVmJCA9IGl0ZW0uZGF0YSkgIT0gbnVsbCA/IHJlZiQudGl0bGUgOiB2b2lkIDgpO1xuICAgIHgkLnZhbCgocmVmJCA9IGl0ZW0uZGF0YSkgIT0gbnVsbCA/IHJlZiQudGl0bGUgOiB2b2lkIDgpO1xuICAgIHJldHVybiBlO1xuICB9O1xuICBwcm90b3R5cGUuY3VycmVudFN0b3JlID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZSwgZm9ybSwgeCQ7XG4gICAgaWYgKCEoZSA9IHRoaXMuY3VycmVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ2hlcmUnKTtcbiAgICBmb3JtID0gdGhpcy4kLmZpbmQoJ2Zvcm0nKTtcbiAgICBpZiAoZm9ybSkge1xuICAgICAgZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwibWVudVwiXScgIT0gbnVsbFxuICAgICAgICA/ICdpbnB1dFtuYW1lPVwibWVudVwiXSdcbiAgICAgICAgOiByZW1vdmUoKSk7XG4gICAgICB4JCA9IGU7XG4gICAgICB4JC5kYXRhKCdmb3JtJywgZm9ybS5zZXJpYWxpemUoKSk7XG4gICAgICB4JC5kYXRhKCd0aXRsZScsIHRoaXMuY3VycmVudC52YWwoKSk7XG4gICAgICBjb25zb2xlLmxvZygnc3RvcmUtbWVudTonLCBlLmRhdGEoJ21lbnUnKSk7XG4gICAgICBjb25zb2xlLmxvZygnc3RvcmUtdGl0bGU6JywgZS5kYXRhKCd0aXRsZScpKTtcbiAgICB9XG4gIH07XG4gIHByb3RvdHlwZS5jdXJyZW50UmVzdG9yZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGUsIGZvcm0sIHJlc2V0LCByZWYkLCB0aXRsZTtcbiAgICBpZiAoIShlID0gdGhpcy5jdXJyZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZm9ybSA9IHRoaXMuJC5maW5kKCdmb3JtJykpIHtcbiAgICAgIHJlc2V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGZvcm0uZ2V0KDApLnJlc2V0KCk7XG4gICAgICB9O1xuICAgICAgcmVmJCA9IHRoaXMuY3VycmVudC5kYXRhLCBmb3JtID0gcmVmJC5mb3JtLCB0aXRsZSA9IHJlZiQudGl0bGU7XG4gICAgICBlLnZhbCh0aXRsZSk7XG4gICAgICBpZiAobWVudSkge1xuICAgICAgICBmb3JtLmRlc2VyaWFsaXplKGZvcm0pO1xuICAgICAgICB0aGlzLmN1cnJlbnQudmFsKHRpdGxlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3Jlc3RvcmVkOicsIGZvcm0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHByb3RvdHlwZS5vbkF0dGFjaCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNpdGUsIHMsIGkkLCByZWYkLCBsZW4kLCBpdGVtLCB0aGlzJCA9IHRoaXM7XG4gICAgc2l0ZSA9IHRoaXMuc3RhdGUuc2l0ZSgpO1xuICAgIGlmIChzaXRlLmNvbmZpZy5tZW51KSB7XG4gICAgICBzID0gdGhpcy4kLmZpbmQoJy5zb3J0YWJsZScpO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSAocmVmJCA9IEpTT04ucGFyc2Uoc2l0ZS5jb25maWcubWVudSkpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIGl0ZW0gPSByZWYkW2kkXTtcbiAgICAgICAgY29uc29sZS5sb2coJ3BhcnNlZDonLCBpdGVtKTtcbiAgICAgICAgaWYgKGl0ZW0uaWQpIHtcbiAgICAgICAgICBpdGVtLmlkID0gcHJlZml4ICsgXCJcIiArIGl0ZW0uaWQ7XG4gICAgICAgICAgcy5hcHBlbmQodGhpcy5jbG9uZShpdGVtKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHMubmVzdGVkU29ydGFibGUob3B0cyk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBzLmZpbmQoJ2lucHV0OmZpcnN0JykuZm9jdXMoKTtcbiAgICAgIH0sIDIwMCk7XG4gICAgICB0aGlzLnNob3coKTtcbiAgICB9XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICcub25jbGljay1hZGQnLCBmdW5jdGlvbihldil7XG4gICAgICB2YXIgcywgbWF4LCBpZCwgZSwgeCQ7XG4gICAgICB0aGlzJC5zaG93KCk7XG4gICAgICBzID0gdGhpcyQuJC5maW5kKCcuc29ydGFibGUnKTtcbiAgICAgIG1heCA9IHBhcnNlSW50KG1heGltdW0obWFwKGZ1bmN0aW9uKGl0KXtcbiAgICAgICAgcmV0dXJuIGl0LmlkLnJlcGxhY2UocHJlZml4LCAnJyk7XG4gICAgICB9KShcbiAgICAgIHMuZmluZCgnbGknKSkpKTtcbiAgICAgIGlkID0gIW1heFxuICAgICAgICA/IDFcbiAgICAgICAgOiBtYXggKyAxO1xuICAgICAgZSA9IHRoaXMkLmNsb25lKHtcbiAgICAgICAgaWQ6IHByZWZpeCArIFwiXCIgKyBpZFxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygnY3JlYXRlZDonLCBlKTtcbiAgICAgIHgkID0gdGhpcyQuJC5maW5kKCcuc29ydGFibGUnKTtcbiAgICAgIHgkLmFwcGVuZChlKTtcbiAgICAgIHgkLm5lc3RlZFNvcnRhYmxlKG9wdHMpO1xuICAgICAgeCQuZmluZCgnaW5wdXQnKS5mb2N1cygpO1xuICAgICAgdGhpcyQuY3VycmVudFJlc3RvcmU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgdGhpcy4kLm9uKCdjbGljaycsICdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScsIGZ1bmN0aW9uKGV2KXtcbiAgICAgIHZhciBtZW51LCBmb3JtO1xuICAgICAgdGhpcyQuY3VycmVudFN0b3JlKCk7XG4gICAgICBtZW51ID0gdGhpcyQuJC5maW5kKCcuc29ydGFibGUnKS5kYXRhKCdtanNOZXN0ZWRTb3J0YWJsZScpLnRvSGllcmFyY2h5KCk7XG4gICAgICBpZiAoIW1lbnUubGVuZ3RoKSB7XG4gICAgICAgIG1lbnUgPSBbbWVudV07XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZygnc2F2aW5nLW5lc3RlZC1zb3J0YWJsZTonLCBtZW51KTtcbiAgICAgIGZvcm0gPSB0aGlzJC4kLmZpbmQoJ2Zvcm0nKTtcbiAgICAgIGZvcm0uYXBwZW5kKGNvbnN0cnVjdG9yLiQoJzxpbnB1dD4nKS5hdHRyKCd0eXBlJywgJ2hpZGRlbicpLmF0dHIoJ25hbWUnLCAnbWVudScpLnZhbChKU09OLnN0cmluZ2lmeShtZW51KSkpO1xuICAgICAgcmV0dXJuIHN1Ym1pdEZvcm0oZXYsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICB2YXIgZiwgdCwgcmVmJDtcbiAgICAgICAgZiA9ICQodGhpcyk7XG4gICAgICAgIHQgPSAkKGZvcm0uZmluZCgnLnRvb2x0aXAnKSk7XG4gICAgICAgIHJldHVybiBzaG93VG9vbHRpcCh0LCAhZGF0YS5zdWNjZXNzID8gZGF0YSAhPSBudWxsID8gKHJlZiQgPSBkYXRhLmVycm9ycykgIT0gbnVsbCA/IHJlZiQuam9pbignPGJyPicpIDogdm9pZCA4IDogdm9pZCA4IDogJ1NhdmVkIScpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgdGhpcy4kLm9uKCdibHVyJywgJy5yb3cnLCBmdW5jdGlvbihldil7XG4gICAgICByZXR1cm4gdGhpcyQuY3VycmVudFN0b3JlKCk7XG4gICAgfSk7XG4gICAgdGhpcy4kLm9uKCdjaGFuZ2UnLCAnZm9ybScsIGZ1bmN0aW9uKGV2KXtcbiAgICAgIHJldHVybiB0aGlzJC5jdXJyZW50U3RvcmUoKTtcbiAgICB9KTtcbiAgICB0aGlzLiQub24oJ2NsaWNrJywgJy5yb3cnLCBmdW5jdGlvbihldil7XG4gICAgICB0aGlzJC5jdXJyZW50ID0gJChldi50YXJnZXQpO1xuICAgICAgcmV0dXJuIHRoaXMkLmN1cnJlbnRSZXN0b3JlO1xuICAgIH0pO1xuICAgIHRoaXMuJC5maW5kKCcuc29ydGFibGUnKS5uZXN0ZWRTb3J0YWJsZShvcHRzKTtcbiAgfTtcbiAgcHJvdG90eXBlLm9uRGV0YWNoID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy4kLm9mZigpO1xuICB9O1xuICBmdW5jdGlvbiBBZG1pbk1lbnUoKXtcbiAgICB0aGlzLm9uQXR0YWNoID0gYmluZCQodGhpcywgJ29uQXR0YWNoJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLmN1cnJlbnRSZXN0b3JlID0gYmluZCQodGhpcywgJ2N1cnJlbnRSZXN0b3JlJywgcHJvdG90eXBlKTtcbiAgICB0aGlzLmN1cnJlbnRTdG9yZSA9IGJpbmQkKHRoaXMsICdjdXJyZW50U3RvcmUnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMuY2xvbmUgPSBiaW5kJCh0aGlzLCAnY2xvbmUnLCBwcm90b3R5cGUpO1xuICAgIHRoaXMuc2hvdyA9IGJpbmQkKHRoaXMsICdzaG93JywgcHJvdG90eXBlKTtcbiAgICBBZG1pbk1lbnUuc3VwZXJjbGFzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG4gIHJldHVybiBBZG1pbk1lbnU7XG59KENvbXBvbmVudCkpO1xuZnVuY3Rpb24gYmluZCQob2JqLCBrZXksIHRhcmdldCl7XG4gIHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gKHRhcmdldCB8fCBvYmopW2tleV0uYXBwbHkob2JqLCBhcmd1bWVudHMpIH07XG59XG5mdW5jdGlvbiBleHRlbmQkKHN1Yiwgc3VwKXtcbiAgZnVuY3Rpb24gZnVuKCl7fSBmdW4ucHJvdG90eXBlID0gKHN1Yi5zdXBlcmNsYXNzID0gc3VwKS5wcm90b3R5cGU7XG4gIChzdWIucHJvdG90eXBlID0gbmV3IGZ1bikuY29uc3RydWN0b3IgPSBzdWI7XG4gIGlmICh0eXBlb2Ygc3VwLmV4dGVuZGVkID09ICdmdW5jdGlvbicpIHN1cC5leHRlbmRlZChzdWIpO1xuICByZXR1cm4gc3ViO1xufVxuZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgcmV0dXJuIG9iajtcbn0iLCJ2YXIgQ29tcG9uZW50LCB0ZW1wbGF0ZXMsIEFkbWluVXBncmFkZTtcbkNvbXBvbmVudCA9IHJlcXVpcmUoJ3lhY29tcG9uZW50Jyk7XG50ZW1wbGF0ZXMgPSByZXF1aXJlKCcuLi9idWlsZC9jb21wb25lbnQtamFkZS5qcycpLnRlbXBsYXRlcztcbm1vZHVsZS5leHBvcnRzID0gQWRtaW5VcGdyYWRlID0gKGZ1bmN0aW9uKHN1cGVyY2xhc3Mpe1xuICB2YXIgcHJvdG90eXBlID0gZXh0ZW5kJCgoaW1wb3J0JChBZG1pblVwZ3JhZGUsIHN1cGVyY2xhc3MpLmRpc3BsYXlOYW1lID0gJ0FkbWluVXBncmFkZScsIEFkbWluVXBncmFkZSksIHN1cGVyY2xhc3MpLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBBZG1pblVwZ3JhZGU7XG4gIHByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlcy5BZG1pblVwZ3JhZGU7XG4gIGZ1bmN0aW9uIEFkbWluVXBncmFkZSgpe1xuICAgIEFkbWluVXBncmFkZS5zdXBlcmNsYXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cbiAgcmV0dXJuIEFkbWluVXBncmFkZTtcbn0oQ29tcG9uZW50KSk7XG5mdW5jdGlvbiBleHRlbmQkKHN1Yiwgc3VwKXtcbiAgZnVuY3Rpb24gZnVuKCl7fSBmdW4ucHJvdG90eXBlID0gKHN1Yi5zdXBlcmNsYXNzID0gc3VwKS5wcm90b3R5cGU7XG4gIChzdWIucHJvdG90eXBlID0gbmV3IGZ1bikuY29uc3RydWN0b3IgPSBzdWI7XG4gIGlmICh0eXBlb2Ygc3VwLmV4dGVuZGVkID09ICdmdW5jdGlvbicpIHN1cC5leHRlbmRlZChzdWIpO1xuICByZXR1cm4gc3ViO1xufVxuZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gIHZhciBvd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgcmV0dXJuIG9iajtcbn0iLCIoZnVuY3Rpb24ocHJvY2Vzcyl7ZnVuY3Rpb24gZmlsdGVyICh4cywgZm4pIHtcbiAgICB2YXIgcmVzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB4cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZm4oeHNbaV0sIGksIHhzKSkgcmVzLnB1c2goeHNbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xufVxuXG4vLyByZXNvbHZlcyAuIGFuZCAuLiBlbGVtZW50cyBpbiBhIHBhdGggYXJyYXkgd2l0aCBkaXJlY3RvcnkgbmFtZXMgdGhlcmVcbi8vIG11c3QgYmUgbm8gc2xhc2hlcywgZW1wdHkgZWxlbWVudHMsIG9yIGRldmljZSBuYW1lcyAoYzpcXCkgaW4gdGhlIGFycmF5XG4vLyAoc28gYWxzbyBubyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVzIC0gaXQgZG9lcyBub3QgZGlzdGluZ3Vpc2hcbi8vIHJlbGF0aXZlIGFuZCBhYnNvbHV0ZSBwYXRocylcbmZ1bmN0aW9uIG5vcm1hbGl6ZUFycmF5KHBhcnRzLCBhbGxvd0Fib3ZlUm9vdCkge1xuICAvLyBpZiB0aGUgcGF0aCB0cmllcyB0byBnbyBhYm92ZSB0aGUgcm9vdCwgYHVwYCBlbmRzIHVwID4gMFxuICB2YXIgdXAgPSAwO1xuICBmb3IgKHZhciBpID0gcGFydHMubGVuZ3RoOyBpID49IDA7IGktLSkge1xuICAgIHZhciBsYXN0ID0gcGFydHNbaV07XG4gICAgaWYgKGxhc3QgPT0gJy4nKSB7XG4gICAgICBwYXJ0cy5zcGxpY2UoaSwgMSk7XG4gICAgfSBlbHNlIGlmIChsYXN0ID09PSAnLi4nKSB7XG4gICAgICBwYXJ0cy5zcGxpY2UoaSwgMSk7XG4gICAgICB1cCsrO1xuICAgIH0gZWxzZSBpZiAodXApIHtcbiAgICAgIHBhcnRzLnNwbGljZShpLCAxKTtcbiAgICAgIHVwLS07XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgdGhlIHBhdGggaXMgYWxsb3dlZCB0byBnbyBhYm92ZSB0aGUgcm9vdCwgcmVzdG9yZSBsZWFkaW5nIC4uc1xuICBpZiAoYWxsb3dBYm92ZVJvb3QpIHtcbiAgICBmb3IgKDsgdXAtLTsgdXApIHtcbiAgICAgIHBhcnRzLnVuc2hpZnQoJy4uJyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHBhcnRzO1xufVxuXG4vLyBSZWdleCB0byBzcGxpdCBhIGZpbGVuYW1lIGludG8gWyosIGRpciwgYmFzZW5hbWUsIGV4dF1cbi8vIHBvc2l4IHZlcnNpb25cbnZhciBzcGxpdFBhdGhSZSA9IC9eKC4rXFwvKD8hJCl8XFwvKT8oKD86Lis/KT8oXFwuW14uXSopPykkLztcblxuLy8gcGF0aC5yZXNvbHZlKFtmcm9tIC4uLl0sIHRvKVxuLy8gcG9zaXggdmVyc2lvblxuZXhwb3J0cy5yZXNvbHZlID0gZnVuY3Rpb24oKSB7XG52YXIgcmVzb2x2ZWRQYXRoID0gJycsXG4gICAgcmVzb2x2ZWRBYnNvbHV0ZSA9IGZhbHNlO1xuXG5mb3IgKHZhciBpID0gYXJndW1lbnRzLmxlbmd0aDsgaSA+PSAtMSAmJiAhcmVzb2x2ZWRBYnNvbHV0ZTsgaS0tKSB7XG4gIHZhciBwYXRoID0gKGkgPj0gMClcbiAgICAgID8gYXJndW1lbnRzW2ldXG4gICAgICA6IHByb2Nlc3MuY3dkKCk7XG5cbiAgLy8gU2tpcCBlbXB0eSBhbmQgaW52YWxpZCBlbnRyaWVzXG4gIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycgfHwgIXBhdGgpIHtcbiAgICBjb250aW51ZTtcbiAgfVxuXG4gIHJlc29sdmVkUGF0aCA9IHBhdGggKyAnLycgKyByZXNvbHZlZFBhdGg7XG4gIHJlc29sdmVkQWJzb2x1dGUgPSBwYXRoLmNoYXJBdCgwKSA9PT0gJy8nO1xufVxuXG4vLyBBdCB0aGlzIHBvaW50IHRoZSBwYXRoIHNob3VsZCBiZSByZXNvbHZlZCB0byBhIGZ1bGwgYWJzb2x1dGUgcGF0aCwgYnV0XG4vLyBoYW5kbGUgcmVsYXRpdmUgcGF0aHMgdG8gYmUgc2FmZSAobWlnaHQgaGFwcGVuIHdoZW4gcHJvY2Vzcy5jd2QoKSBmYWlscylcblxuLy8gTm9ybWFsaXplIHRoZSBwYXRoXG5yZXNvbHZlZFBhdGggPSBub3JtYWxpemVBcnJheShmaWx0ZXIocmVzb2x2ZWRQYXRoLnNwbGl0KCcvJyksIGZ1bmN0aW9uKHApIHtcbiAgICByZXR1cm4gISFwO1xuICB9KSwgIXJlc29sdmVkQWJzb2x1dGUpLmpvaW4oJy8nKTtcblxuICByZXR1cm4gKChyZXNvbHZlZEFic29sdXRlID8gJy8nIDogJycpICsgcmVzb2x2ZWRQYXRoKSB8fCAnLic7XG59O1xuXG4vLyBwYXRoLm5vcm1hbGl6ZShwYXRoKVxuLy8gcG9zaXggdmVyc2lvblxuZXhwb3J0cy5ub3JtYWxpemUgPSBmdW5jdGlvbihwYXRoKSB7XG52YXIgaXNBYnNvbHV0ZSA9IHBhdGguY2hhckF0KDApID09PSAnLycsXG4gICAgdHJhaWxpbmdTbGFzaCA9IHBhdGguc2xpY2UoLTEpID09PSAnLyc7XG5cbi8vIE5vcm1hbGl6ZSB0aGUgcGF0aFxucGF0aCA9IG5vcm1hbGl6ZUFycmF5KGZpbHRlcihwYXRoLnNwbGl0KCcvJyksIGZ1bmN0aW9uKHApIHtcbiAgICByZXR1cm4gISFwO1xuICB9KSwgIWlzQWJzb2x1dGUpLmpvaW4oJy8nKTtcblxuICBpZiAoIXBhdGggJiYgIWlzQWJzb2x1dGUpIHtcbiAgICBwYXRoID0gJy4nO1xuICB9XG4gIGlmIChwYXRoICYmIHRyYWlsaW5nU2xhc2gpIHtcbiAgICBwYXRoICs9ICcvJztcbiAgfVxuICBcbiAgcmV0dXJuIChpc0Fic29sdXRlID8gJy8nIDogJycpICsgcGF0aDtcbn07XG5cblxuLy8gcG9zaXggdmVyc2lvblxuZXhwb3J0cy5qb2luID0gZnVuY3Rpb24oKSB7XG4gIHZhciBwYXRocyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XG4gIHJldHVybiBleHBvcnRzLm5vcm1hbGl6ZShmaWx0ZXIocGF0aHMsIGZ1bmN0aW9uKHAsIGluZGV4KSB7XG4gICAgcmV0dXJuIHAgJiYgdHlwZW9mIHAgPT09ICdzdHJpbmcnO1xuICB9KS5qb2luKCcvJykpO1xufTtcblxuXG5leHBvcnRzLmRpcm5hbWUgPSBmdW5jdGlvbihwYXRoKSB7XG4gIHZhciBkaXIgPSBzcGxpdFBhdGhSZS5leGVjKHBhdGgpWzFdIHx8ICcnO1xuICB2YXIgaXNXaW5kb3dzID0gZmFsc2U7XG4gIGlmICghZGlyKSB7XG4gICAgLy8gTm8gZGlybmFtZVxuICAgIHJldHVybiAnLic7XG4gIH0gZWxzZSBpZiAoZGlyLmxlbmd0aCA9PT0gMSB8fFxuICAgICAgKGlzV2luZG93cyAmJiBkaXIubGVuZ3RoIDw9IDMgJiYgZGlyLmNoYXJBdCgxKSA9PT0gJzonKSkge1xuICAgIC8vIEl0IGlzIGp1c3QgYSBzbGFzaCBvciBhIGRyaXZlIGxldHRlciB3aXRoIGEgc2xhc2hcbiAgICByZXR1cm4gZGlyO1xuICB9IGVsc2Uge1xuICAgIC8vIEl0IGlzIGEgZnVsbCBkaXJuYW1lLCBzdHJpcCB0cmFpbGluZyBzbGFzaFxuICAgIHJldHVybiBkaXIuc3Vic3RyaW5nKDAsIGRpci5sZW5ndGggLSAxKTtcbiAgfVxufTtcblxuXG5leHBvcnRzLmJhc2VuYW1lID0gZnVuY3Rpb24ocGF0aCwgZXh0KSB7XG4gIHZhciBmID0gc3BsaXRQYXRoUmUuZXhlYyhwYXRoKVsyXSB8fCAnJztcbiAgLy8gVE9ETzogbWFrZSB0aGlzIGNvbXBhcmlzb24gY2FzZS1pbnNlbnNpdGl2ZSBvbiB3aW5kb3dzP1xuICBpZiAoZXh0ICYmIGYuc3Vic3RyKC0xICogZXh0Lmxlbmd0aCkgPT09IGV4dCkge1xuICAgIGYgPSBmLnN1YnN0cigwLCBmLmxlbmd0aCAtIGV4dC5sZW5ndGgpO1xuICB9XG4gIHJldHVybiBmO1xufTtcblxuXG5leHBvcnRzLmV4dG5hbWUgPSBmdW5jdGlvbihwYXRoKSB7XG4gIHJldHVybiBzcGxpdFBhdGhSZS5leGVjKHBhdGgpWzNdIHx8ICcnO1xufTtcblxuZXhwb3J0cy5yZWxhdGl2ZSA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7XG4gIGZyb20gPSBleHBvcnRzLnJlc29sdmUoZnJvbSkuc3Vic3RyKDEpO1xuICB0byA9IGV4cG9ydHMucmVzb2x2ZSh0bykuc3Vic3RyKDEpO1xuXG4gIGZ1bmN0aW9uIHRyaW0oYXJyKSB7XG4gICAgdmFyIHN0YXJ0ID0gMDtcbiAgICBmb3IgKDsgc3RhcnQgPCBhcnIubGVuZ3RoOyBzdGFydCsrKSB7XG4gICAgICBpZiAoYXJyW3N0YXJ0XSAhPT0gJycpIGJyZWFrO1xuICAgIH1cblxuICAgIHZhciBlbmQgPSBhcnIubGVuZ3RoIC0gMTtcbiAgICBmb3IgKDsgZW5kID49IDA7IGVuZC0tKSB7XG4gICAgICBpZiAoYXJyW2VuZF0gIT09ICcnKSBicmVhaztcbiAgICB9XG5cbiAgICBpZiAoc3RhcnQgPiBlbmQpIHJldHVybiBbXTtcbiAgICByZXR1cm4gYXJyLnNsaWNlKHN0YXJ0LCBlbmQgLSBzdGFydCArIDEpO1xuICB9XG5cbiAgdmFyIGZyb21QYXJ0cyA9IHRyaW0oZnJvbS5zcGxpdCgnLycpKTtcbiAgdmFyIHRvUGFydHMgPSB0cmltKHRvLnNwbGl0KCcvJykpO1xuXG4gIHZhciBsZW5ndGggPSBNYXRoLm1pbihmcm9tUGFydHMubGVuZ3RoLCB0b1BhcnRzLmxlbmd0aCk7XG4gIHZhciBzYW1lUGFydHNMZW5ndGggPSBsZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoZnJvbVBhcnRzW2ldICE9PSB0b1BhcnRzW2ldKSB7XG4gICAgICBzYW1lUGFydHNMZW5ndGggPSBpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgdmFyIG91dHB1dFBhcnRzID0gW107XG4gIGZvciAodmFyIGkgPSBzYW1lUGFydHNMZW5ndGg7IGkgPCBmcm9tUGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpO1xuICB9XG5cbiAgb3V0cHV0UGFydHMgPSBvdXRwdXRQYXJ0cy5jb25jYXQodG9QYXJ0cy5zbGljZShzYW1lUGFydHNMZW5ndGgpKTtcblxuICByZXR1cm4gb3V0cHV0UGFydHMuam9pbignLycpO1xufTtcblxufSkocmVxdWlyZShcIl9fYnJvd3NlcmlmeV9wcm9jZXNzXCIpKSIsIihmdW5jdGlvbigpe1xuICB2YXIgZGVmaW5lO1xuICBkZWZpbmUgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cgIT09IG51bGwgPyB3aW5kb3cuZGVmaW5lIDogdm9pZCA4KSB8fCByZXF1aXJlKCdhbWRlZmluZScpKG1vZHVsZSwgcmVxdWlyZSk7XG4gIGRlZmluZShmdW5jdGlvbihyZXF1aXJlKXtcbiAgICB2YXIgcmVhY3RpdmVqcywgZG9sbGFyaXNoLCBDb21wb25lbnQ7XG4gICAgcmVhY3RpdmVqcyA9IHJlcXVpcmUoJ3JlYWN0aXZlanMnKTtcbiAgICBkb2xsYXJpc2ggPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdyAhPT0gbnVsbFxuICAgICAgPyB3aW5kb3cuJFxuICAgICAgOiByZXF1aXJlKCdjaGVlcmlvJyk7XG4gICAgcmV0dXJuIENvbXBvbmVudCA9IChmdW5jdGlvbigpe1xuICAgICAgQ29tcG9uZW50LmRpc3BsYXlOYW1lID0gJ0NvbXBvbmVudCc7XG4gICAgICB2YXIgcHJvdG90eXBlID0gQ29tcG9uZW50LnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBDb21wb25lbnQ7XG4gICAgICBDb21wb25lbnQuJCA9IGRvbGxhcmlzaDtcbiAgICAgIENvbXBvbmVudC4kUiA9IHJlYWN0aXZlanM7XG4gICAgICBmdW5jdGlvbiBDb21wb25lbnQoYXJnJCwgc2VsZWN0b3IsIHBhcmVudCl7XG4gICAgICAgIHZhciByZWYkLCBsb2NhbHMsIHJlZjEkLCBhdXRvUmVuZGVyLCBhdXRvQXR0YWNoLCByZXMkLCBrLCB2O1xuICAgICAgICByZWYkID0gYXJnJCAhPSBudWxsXG4gICAgICAgICAgPyBhcmckXG4gICAgICAgICAgOiB7fSwgbG9jYWxzID0gKHJlZjEkID0gcmVmJC5sb2NhbHMpICE9IG51bGxcbiAgICAgICAgICA/IHJlZjEkXG4gICAgICAgICAgOiB7fSwgYXV0b1JlbmRlciA9IChyZWYxJCA9IHJlZiQuYXV0b1JlbmRlcikgIT0gbnVsbCA/IHJlZjEkIDogdHJ1ZSwgYXV0b0F0dGFjaCA9IChyZWYxJCA9IHJlZiQuYXV0b0F0dGFjaCkgIT0gbnVsbCA/IHJlZjEkIDogdHJ1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgcmVzJCA9IHt9O1xuICAgICAgICBmb3IgKGsgaW4gbG9jYWxzKSB7XG4gICAgICAgICAgdiA9IGxvY2Fsc1trXTtcbiAgICAgICAgICByZXMkW2tdID0gdiAhPSBudWxsICYmIHYuX2lzUmVhY3RpdmVcbiAgICAgICAgICAgID8gdlxuICAgICAgICAgICAgOiBjb25zdHJ1Y3Rvci4kUi5zdGF0ZSh2ID09PSB2b2lkIDggPyBudWxsIDogdik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHJlcyQ7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdG9yKSB7XG4gICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XG4gICAgICAgICAgICB0aGlzLiQgPSB0aGlzLnBhcmVudC4kLmZpbmQodGhpcy5zZWxlY3Rvcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJCA9IGNvbnN0cnVjdG9yLiQodGhpcy5zZWxlY3Rvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuJHRvcCA9IGNvbnN0cnVjdG9yLiQoJzxkaXY+PGRpdi8+PC9kaXY+Jyk7XG4gICAgICAgICAgdGhpcy4kID0gdGhpcy4kdG9wLmZpbmQoJ2RpdicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluaXQpIHtcbiAgICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMucGFyZW50KSB7XG4gICAgICAgICAgaWYgKGF1dG9SZW5kZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChhdXRvQXR0YWNoKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjaCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcHJvdG90eXBlLmlzQ2xpZW50ID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cgIT09IG51bGw7XG4gICAgICBwcm90b3R5cGUudGVtcGxhdGUgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9O1xuICAgICAgcHJvdG90eXBlLmF0dGFjaCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBpJCwgcmVmJCwgY2hpbGQ7XG4gICAgICAgIGlmICghdGhpcy5pc0NsaWVudCkge1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbikge1xuICAgICAgICAgIGZvciAoaSQgaW4gcmVmJCA9IHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGNoaWxkID0gcmVmJFtpJF07XG4gICAgICAgICAgICBjaGlsZC5hdHRhY2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub25BdHRhY2gpIHtcbiAgICAgICAgICB0aGlzLm9uQXR0YWNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9O1xuICAgICAgcHJvdG90eXBlLmRldGFjaCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBpJCwgcmVmJCwgY2hpbGQ7XG4gICAgICAgIGlmICghdGhpcy5pc0NsaWVudCkge1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgICAgICBmb3IgKGkkIGluIHJlZiQgPSB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBjaGlsZCA9IHJlZiRbaSRdO1xuICAgICAgICAgICAgY2hpbGQuZGV0YWNoKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9uRGV0YWNoKSB7XG4gICAgICAgICAgdGhpcy5vbkRldGFjaCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH07XG4gICAgICBwcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGxvY2FscywgdGVtcGxhdGVPdXQsICRkb20sIGkkLCByZWYkLCBjaGlsZDtcbiAgICAgICAgdGhpcy4kLmFkZENsYXNzKHRoaXMuY29uc3RydWN0b3IubmFtZSk7XG4gICAgICAgIGxvY2FscyA9IHRoaXMubG9jYWxzKCk7XG4gICAgICAgIHRlbXBsYXRlT3V0ID0gdGhpcy50ZW1wbGF0ZShsb2NhbHMpO1xuICAgICAgICBpZiAodGhpcy5tdXRhdGUgfHwgdGhpcy5jaGlsZHJlbikge1xuICAgICAgICAgICRkb20gPSBjb25zdHJ1Y3Rvci4kKCc8ZGl2IGNsYXNzPVwicmVuZGVyLXdyYXBwZXJcIj4nICsgdGVtcGxhdGVPdXQgKyAnPC9kaXY+Jyk7XG4gICAgICAgICAgaWYgKHRoaXMubXV0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLm11dGF0ZSgkZG9tKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy4kLmh0bWwoJGRvbS5odG1sKCkpO1xuICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBmb3IgKGkkIGluIHJlZiQgPSB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgIGNoaWxkID0gcmVmJFtpJF07XG4gICAgICAgICAgICAgIGNoaWxkLiQgPSB0aGlzLiQuZmluZChjaGlsZC5zZWxlY3Rvcik7XG4gICAgICAgICAgICAgIGNoaWxkLnJlbmRlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLiQuaHRtbCh0ZW1wbGF0ZU91dCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9O1xuICAgICAgcHJvdG90eXBlLnJlbG9hZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmRldGFjaCgpLnJlbmRlcigpLmF0dGFjaCgpO1xuICAgICAgfTtcbiAgICAgIHByb3RvdHlwZS5sb2NhbHMgPSBmdW5jdGlvbihuZXdMb2NhbHMpe1xuICAgICAgICB2YXIgaywgdiwgcmVmJCwgcywgcmVzdWx0cyQgPSB7fTtcbiAgICAgICAgaWYgKG5ld0xvY2Fscykge1xuICAgICAgICAgIGZvciAoayBpbiBuZXdMb2NhbHMpIHtcbiAgICAgICAgICAgIHYgPSBuZXdMb2NhbHNba107XG4gICAgICAgICAgICB0aGlzLmxvY2FsKGssIHYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGsgaW4gcmVmJCA9IHRoaXMuc3RhdGUpIHtcbiAgICAgICAgICBzID0gcmVmJFtrXTtcbiAgICAgICAgICByZXN1bHRzJFtrXSA9IHMoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0cyQ7XG4gICAgICB9O1xuICAgICAgcHJvdG90eXBlLmxvY2FsID0gZnVuY3Rpb24oaywgdil7XG4gICAgICAgIHZhciBleGlzdGluZ1I7XG4gICAgICAgIGV4aXN0aW5nUiA9IHRoaXMuc3RhdGVba107XG4gICAgICAgIGlmICh2ID09PSB2b2lkIDgpIHtcbiAgICAgICAgICBpZiAoZXhpc3RpbmdSKSB7XG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdSKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChleGlzdGluZ1IpIHtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ1IudmFsID09PSB2b2lkIDgpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ1wiICsgayArIFwiJyBpcyBub3QgcmVhY3RpdmUgc3RhdGUsIHlvdSBjYW4gb25seSBzZXQgcmVhY3RpdmUgc3RhdGVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdSKHYgPT09IHZvaWQgOCA/IG51bGwgOiB2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZVtrXSA9IGNvbnN0cnVjdG9yLiRSLnN0YXRlKHYgPT09IHZvaWQgOCA/IG51bGwgOiB2KTtcbiAgICAgICAgICAgIHJldHVybiB2O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHByb3RvdHlwZS5odG1sID0gZnVuY3Rpb24od3JhcHBlZCl7XG4gICAgICAgIHdyYXBwZWQgPT0gbnVsbCAmJiAod3JhcHBlZCA9IHRydWUpO1xuICAgICAgICByZXR1cm4gKCh3cmFwcGVkICYmIHRoaXMuJHRvcCkgfHwgdGhpcy4kKS5odG1sKCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIENvbXBvbmVudDtcbiAgICB9KCkpO1xuICB9KTtcbn0pLmNhbGwodGhpcyk7XG4iXX0=
;